<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Lift Cookbook</title>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
    <link rel="stylesheet" type="text/css" href="theme/html/html.css">
  </head>
  <body data-type="book">
    <figure data-type="cover" id="id-5q4iV">
<img src="images/cover.png">
</figure>
<section data-type="titlepage" id="lift-cookbook-RWEso">
<h1>Lift Cookbook</h1>
<p class="author">Richard Dallaway</p>
</section>
<section xmlns="http://www.w3.org/1999/xhtml" data-type="copyright-page" id="lift-cookbook-6eKsx">
  <h1>Lift Cookbook</h1>
  <p class="author">By Richard Dallaway</p>
  <p class="copyright">Copyright © 2013 Richard Dallaway. All rights reserved.</p>
  <p class="printlocation">Printed in the United States of America.</p>
  <p class="publisher">Published by <span class="publishername">O'Reilly Media, Inc.</span>, 1005 Gravenstein Highway North, Sebastopol, CA 95472.</p>
  <p>O'Reilly books may be purchased for educational, business, or sales promotional use. Online editions are also available for most
      titles (<a href="http://safaribooksonline.com">http://safaribooksonline.com</a>). For more information, contact our corporate/institutional sales department: 800-998-9938 or <span data-type="email">corporate@oreilly.com</span>.</p>
  <ul class="stafflist">
    <li><span class="staffrole">Editor: </span>Meghan Blanchette</li>
    <li><span class="staffrole">Production Editor: </span>Kara Ebrahim</li>
    <li><span class="staffrole">Copyeditor: </span>Kiel Van Horn</li>
    <li><span class="staffrole">Proofreader: </span>Linley Dolby</li>
    <li><span class="staffrole">Indexer: </span>Judy McConville</li>
    <li><span class="staffrole">Interior Designer: </span>David Futato</li>
    <li><span class="staffrole">Cover Designer: </span>Randy Comer</li>
    <li><span class="staffrole">Illustrator: </span>Rebecca Demarest</li>
  </ul>
  <ul class="printings">
    <li><span class="printedition">June, 2013:</span> First Edition</li>
  </ul>
  <div>
    <h1 class="revisions">Revision History for the First Edition</h1>
    <ul class="releases">
      <li><span class="revdate">2013-06-21:</span> First release</li>
    </ul>
  </div>
  <p class="errata">See <a href="http://oreilly.com/catalog/errata.csp?isbn=9781449362683">http://oreilly.com/catalog/errata.csp?isbn=9781449362683</a> for release details.</p>
  <div class="legal">
    <p>The O'Reilly logo is a registered trademark of O'Reilly Media, Inc. <em>Lift Cookbook</em>, the cover image, and related trade dress are trademarks of O'Reilly Media, Inc.</p>
    <p>While the publisher and the authors have used good faith efforts to ensure that the information and instructions contained in this work are accurate, the publisher and the authors disclaim all responsibility for errors or omissions, including without limitation responsibility for damages resulting from the use of or reliance on this work. Use of the information and instructions contained in this work is at your own risk. If any code samples or other technology this work contains or describes is subject to open source licenses or the intellectual property rights of others, it is your responsibility to ensure that your use thereof complies with such licenses and/or rights.<!--PROD: Uncomment the following sentence if appropriate and add it to the above para: --><!--This book is not intended as [legal/medical/financial; use the appropriate reference] advice. Please consult a qualified professional if you require [legal/medical/financial] advice.--></p>
  </div>
  <div class="copyright-bottom">
    <p class="isbn">978-1-449-36268-3</p>
    <p class="printer">[LSI]</p>
  </div>
</section>

<nav data-type="toc">
<ol>
  <li data-type="preface">
    <a href="book.html">Preface</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#Contributors">Contributors</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#source-zVsKcy">Source</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#updates-yDsBiZ">Updates</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#software-versions-V7sVuw">Software Versions</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#conventions-used-in-this-book-rWsgUE">Conventions Used in This Book</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#using-code-examples-wPsQCe">Using Code Examples</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#safarir-books-online-xqsvsy">Safari® Books Online</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#how-to-contact-us-PasXHw">How to Contact Us</a>
            <ol>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#acknowledgments-OKsyf9">Acknowledgments</a>
            <ol>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">Installing and Running Lift</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#DownloadAndRun">Downloading and Running Lift</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-9psdFBI7">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-ZKsnImIy">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-zVsbtzIg">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-yDsYh1Ir">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#LiftFromScratch">Creating a Lift Project from Scratch Using SBT</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-ZKs1Flty">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-zVsXIvtg">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-yDsgtktr">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-V7sohjtm">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#texteditor">Developing Using a Text Editor</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-zVskFyhg">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-yDsrIZhr">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-V7s2twhm">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-rWsZhEhO">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#jrebel">Incorporating JRebel</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-yDsyFYTr">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solutions-V7sQIDTm">Solutions</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-rWswtATO">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-wPsjhoT4">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#eclipse">Developing Using Eclipse</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-V7spFlcm">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-rWseIqcO">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-wPsDtnc4">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-xqsjhdcl">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#idea">Developing Using IntelliJ IDEA</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-rWspF7iO">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-wPsrIBi4">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-xqs1tEil">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-Pas0hXi0">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#ViewH2">Viewing the lift_proto H2 Database</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-wPs4Fau4">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-xqs0IZul">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-PasetPu0">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-OKsGhdub">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#snapshot">Using the Latest Lift Build</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZFOUl">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskIbU0">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVtlUb">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-XQsXhZUL">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#NewScala">Using a New Version of Scala</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFlC0">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOIeCb">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtdCL">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskh9CE">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">HTML</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#TestingAndDebuggingSelectors">Testing and Debugging CSS Selectors</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-zVskFvtj">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-yDsrIktP">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-V7s2tjtw">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-rWsZhNtz">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SequencingSelectorOps">Sequencing CSS Selector Operations</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-yDsyFZhP">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-V7sQIwhw">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-rWswtEhz">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-wPsjhehm">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SetMetaTag">Setting Meta Tag Contents</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-V7spFDTw">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-rWseIATz">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-wPsDtoTm">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-xqsjhnTE">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SetPageTitle">Setting the Page Title</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-rWspFqcz">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-wPsrIncm">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-xqs1tdcE">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-Pas0hLcx">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#ConditionalIncludes">HTML Conditional Comments</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-wPs4FBim">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-xqs0IEiE">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-PasetXix">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-OKsGhyi7">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#PassThru">Returning Snippet Markup Unchanged</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZFZuE">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskIPux">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVtdu7">Discussion</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SnippetNotFound">Snippet Not Found When Using HTML5</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFbUx">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOIlU7">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtZUP">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskhzUk">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#AvoidAssetCaching">Avoiding CSS and JavaScript Caching</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFeC7">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIdCP">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvt9Ck">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhzCg">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#AddToHead">Adding to the Head of a Page</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFwsP">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjInsk">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtMsg">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJhDsA">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#Custom404">Custom 404 Page</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslF7Hk">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIgHg">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswtYHA">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNhWHk">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#CustomStatusPage">Other Custom Status Pages</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFqfg">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIrfA">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytOfk">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhvfN">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#LinksInNotice">Links in Notices</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqFESA">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seIlSk">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1tJSN">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhWSG">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#DownloadLink">Link to Download Data</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skFQFk">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2IeFN">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtNFG">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9hZFM">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#TestingReq">Test on a Req</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-g0swF4IN">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-q8sGIwIG">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-1Lswt9IM">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-YmsghkIK">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#Textile">Rendering Textile Markup</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-q8sAFptG">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-1LsEIDtM">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-YmsMtWtK">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-vJskhlte">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">Forms Processing in Lift</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#PlainFormProcessing">Plain Old Form Processing</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-V7spFwhr">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-rWseIEh0">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-wPsDtehz">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-xqsjhyhG">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#AjaxFormProcessing">Ajax Form Processing</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-rWspFAT0">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-wPsrIoTz">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-xqs1tnTG">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-Pas0hZTP">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#JsonForms">Ajax JSON Form Processing</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-wPs4Fncz">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-xqs0IdcG">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-PasetLcP">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-OKsGhbc4">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#DatePicker">Use a Date Picker for Input</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZFEiG">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskIXiP">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVtyi4">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-XQsXhGiv">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#Autocomplete">Making Suggestions with Autocomplete</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFPuP">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOIdu4">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtluv">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskhjuD">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#Radio">Offering Choices with Radio Buttons</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFlU4">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIZUv">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvtzUD">Discussion</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#DisableCheckbox">Conditionally Disable a Checkbox</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFdCv">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjI9CD">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtzCY">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJhpCm">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MultiSelectBox">Use a Select Box with Multiple Options</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslFnsD">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIMsY">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswtDsm">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNh2sz">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#FileUpload">File Upload</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFgHY">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIYHm">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytWHz">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhwHB">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#DRYFormsWithLayout">DRY Forms with Layout</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqFrfm">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seIOfz">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1tvfB">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhyfW">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">REST</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#DRYURLs">DRY URLs</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-V7spFjtb">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-rWseINtw">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-wPsDt9tg">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-xqsjh7tQ">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MissingSuffix">Missing File Suffix</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-rWspFEhw">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-wPsrIehg">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-xqs1tyhQ">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-Pas0hwh8">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MissingDotCom">Missing .com from Email Addresses</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#solution-xqs0InTQ">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-PasetZT8">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-OKsGhrTY">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SuffixMatchFail">Failing to Match on a File Suffix</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZFdcQ">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskILc8">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVtbcY">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-XQsXhpcp">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RestBinaryData">Accept Binary Data in a REST Service</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFXi8">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOIyiY">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtGip">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskhvia">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#ServingVideo">Serving Videos</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFduY">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIlup">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvtjua">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhEuQ">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#JSONREST">Returning JSON</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFZUp">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjIzUa">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtGUQ">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJhoUz">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#GoogleSitemap">Google Sitemap</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslF9Ca">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIzCQ">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswtpCz">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNhyC7">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#iOSNativePost">Calling REST Service from a Native iOS Application</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFMsQ">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIDsz">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8syt2s7">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhms4">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">JavaScript, Ajax, and Comet</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#ButtonTriggerServerCode">Trigger Server-Side Code from a Button</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-wPs4FehP">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-xqs0IyhW">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-Pasetwhz">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-OKsGh9ho">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SelectOptionChange">Call Server When Select Option Changes</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZFnTW">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskIZTz">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVtrTo">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-XQsXhBTe">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#ClientSideOnlyActions">Creating Client-Side Actions in Your Scala Code</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFLcz">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOIbco">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtpce">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskhlcj">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#FocusOnLoad">Focus on a Field on Page Load</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFyio">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIGie">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvtvij">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhaiN">See Also</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#problem-pWsBT2i0">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8svcGib">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0sEipio">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sJuQib">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#DynamicTemplateLoading">Running a Template via JavaScript</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFlue">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjIjuj">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtEuN">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJhvu0">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#JavaScriptTail">Move JavaScript to End of Page</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslFzUj">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIGUN">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswtoU0">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNhNUb">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#CometSessionLossJS">Run JavaScript on Comet Session Loss</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFzCN">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIpC0">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytyCb">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhxCo">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#AjaxFileUpload">Ajax File Upload</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqFDs0">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seI2sb">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1tmso">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhPsb">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#FormatWiring">Format a Wired Cell</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skFWHb">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2IwHo">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtBHb">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9hGHg">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">Request Pipeline</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#DebugRequest">Debugging a Request</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZFyhA">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskIwha">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVt9hJ">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-XQsXhMhm">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#OnSession">Running Code When Sessions Are Created (or Destroyed)</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFZTa">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOIrTJ">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtBTm">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskh4TV">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#ShutdownHooks">Run Code When Lift Shuts Down</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFbcJ">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIpcm">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvtlcV">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhBcr">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RunningStateless">Running Stateless</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFGim">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjIviV">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtair">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJh2iL">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#CatchException">Catch Any Exception</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslFjuV">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIEur">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswtvuL">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNhku1">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RestStreamContent">Streaming Content</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFGUr">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIoUL">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytNU1">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhbUL">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#DiskAccessControl">Serving a File with Access Control</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqFpCL">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seIyC1">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1txCL">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhLCA">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RestrictByHeader">Access Restriction by HTTP Header</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skF2s1">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2ImsL">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtPsA">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9hXsN">See Also</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#problem-YmsbTqsA">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-vJsoc8sW">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-lqsDiwsk">Discussion</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RewriteForHttps">Force HTTPS Requests</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-g0swFwHL">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-q8sGIBHA">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-1LswtGHN">Discussion</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">Relational Database Persistence with Record and Squeryl</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#ConfiguringSqueryl">Configuring Squeryl and Record</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZF7tP">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskIptK">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVtJtm">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-XQsXhLtq">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylJNDI">Using a JNDI DataSource</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFwhK">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOI9hm">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtMhq">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskhAhM">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylOneToMany">One-to-Many Relationship</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFrTm">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIBTq">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvt4TM">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhrT8">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylManyToMany">Many-to-Many Relationship</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFpcq">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjIlcM">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtBc8">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJhKcj">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#FieldValidation">Adding Validation to a Field</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslFviM">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIai8">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswt2ij">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNhGiW">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#CustomValidation">Custom Validation Logic</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFEu8">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIvuj">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytkuW">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxh9uj">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylFilter">Modify a Field Value Before It Is Set</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqFoUj">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seINUW">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1tbUj">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhdUL">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylUnitTest">Testing with Specs</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skFyCW">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2IxCj">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtLCL">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9heCx">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RandomValueColumn">Store a Random Value in a Column</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-g0swFmsj">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-q8sGIPsL">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-1LswtXsx">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-YmsghqsD">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylUpdatedCreated">Automatic Created and Updated Timestamps</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-q8sAFBHL">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-1LsEIGHx">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-YmsMtNHD">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-vJskheHA">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylLogging">Logging SQL</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-1LskFKfx">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-YmsxIzfD">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-vJsrtOfA">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-lqszhvfL">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#SquerylMediumText">Model a Column with MySQL MEDIUMTEXT</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-YmseFJSD">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-vJslINSA">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-lqs8taSL">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-nqslhZSJ">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MySQLCharSet">MySQL Character Set Encoding</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-vJsJFpFA">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-lqsAIdFL">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-nqs9tgFJ">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-NbsrhpFr">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">MongoDB Persistence with Record</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#ConnectingToMongo">Connecting to a MongoDB Database</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-xqsZFqI7">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-PaskIAIj">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-OKsVtVI0">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-XQsXhDI7">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MongoHashMap">Storing a Hash Map in a MongoDB Record</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-PasxFptj">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-OKsOIJt0">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-XQsbtLt7">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-jWskhPtO">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MongoEnum">Storing an Enumeration in MongoDB</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLF9h0">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIMh7">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvtAhO">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhwhD">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MongoEmbedding">Embedding a Document Inside a MongoDB Record</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFBT7">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjI4TO">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtrTD">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJh0Te">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#linking-between-mongodb-records-XQslco">Linking Between MongoDB Records</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslFlcO">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIBcD">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswtKce">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNhAcA">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#QueryingWithRogue">Using Rogue</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFaiD">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZI2ie">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytGiA">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhpiK">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MongoGeospatial">Storing Geospatial Values</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqFvue">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seIkuA">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1t9uK">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhbuj">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MongoScalaConsole">Running Queries from the Scala Console</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skFNUA">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2IbUK">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtdUj">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9h4Up">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#MongoUnitTest">Unit Testing Record with MongoDB</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-g0swFxCK">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-q8sGILCj">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-1LswteCp">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-YmsghyCm">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">Around Lift</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#SendTextEmail">Sending Plain-Text Email</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFJtV">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKILtl">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvtPt7">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhpt9">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#LogEmail">Logging Email Rather than Sending</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFMhl">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjIAh7">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtwh9">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJhXhV">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#HTMLEmail">HTML Email</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslF4T7">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIrT9">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswt0TV">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNhqTy">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#AuthEmail">Sending Authenticated Email</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFBc9">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIKcV">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytAcy">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhdc2">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#EmailWithAttachments">Sending Email with Attachments</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqF2iV">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seIGiy">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1tpi2">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhQiD">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RunLater">Run a Task Later</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skFkuy">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2I9u2">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtbuD">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9hOuo">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#RunTasksPeriodically">Run Tasks Periodically</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-g0swFbU2">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-q8sGIdUD">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-1Lswt4Uo">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-YmsghBUk">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#FetchURLs">Fetching URLs</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-q8sAFLCD">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-1LsEIeCo">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-YmsMtyCk">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-vJskhaCo">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">Production Deployment</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#CloudBees">Deploying to CloudBees</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFrTj">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZI0TP">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8sytqTZ">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhoTz">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#Beanstalk">Deploying to Amazon Elastic Beanstalk</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqFKcP">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seIAcZ">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1tdcz">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhAcV">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#HerokuDeployment">Deploying to Heroku</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skFGiZ">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2Ipiz">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtQiV">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9hQin">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="chapter">
    <a href="book.html">Contributing, Bug Reports, and Getting Help</a>
            <ol>
  <li data-type="sect1">
    <a href="book.html#GettingHelp">You’d Like Some Help</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-OKsLFmFO">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-XQsKIOFb">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-jWsvtoFq">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-2ksZhjFV">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#HowToReportBugs">How to Report Bugs</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-XQspFDIb">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-jWsjIEIq">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-2ksLtxIV">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-pWsJhkI2">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#LiftCodeContributions">Contributing Small Code Changes and ScalaDoc</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-jWslFPtq">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-2kseIptV">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-pWswtWt2">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-o8sNh1tN">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#wiki">Contributing Documentation</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-2kslFwhV">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-pWsZIXh2">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-o8syt4hN">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-g0sxhyhQ">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#AddRecipe">How to Add a New Recipe to This Cookbook</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-pWsqF0T2">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-o8seIqTN">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-g0s1toTQ">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-q8sZhJT4">See Also</a>
  </li>
</ol>
      </li>
  <li data-type="sect1">
    <a href="book.html#modules">Sharing Code in Modules</a>
            <ol>
  <li data-type="sect2">
    <a href="book.html#problem-o8skFAcN">Problem</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#solution-g0s2IdcQ">Solution</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#discussion-q8svtAc4">Discussion</a>
  </li>
  <li data-type="sect2">
    <a href="book.html#see-also-1Ls9hrcv">See Also</a>
  </li>
</ol>
      </li>
</ol>
      </li>
  <li data-type="index">
    <a href="book.html">Index</a>
            <ol>
</ol>
      </li>
</ol>
</nav>





<section data-type="preface" id="preface">
<h1>Preface</h1>


<p>This is a collection of solutions to questions you might have while developing
web applications with the Lift Web Framework.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="prerequisites" id="id-mwCoSyFp"></a></p>

<p>The aim is to give a single, short answer to a specific question. When there are multiple approaches, or styles, we’ll give you one solution, but will point you at alternatives in the discussion.</p>

<p><a data-type="xref" href="#InstallAndRunning">Installing and Running Lift</a> will get you up and running with Lift, but in other respects, this cookbook is aimed at practitioners and the questions they have asked. If this is the first time you’ve heard of Lift, you’ll want to look at:</p>

<ul>
<li>
<p><a href="http://simply.liftweb.net"><em>Simply Lift</em></a></p>
</li>
<li>
<p>Torsten Uhlmann’s <em>Instant Lift Web Applications How-to</em> (PACKT <span class="keep-together">Publishing</span>)</p>
</li>
<li>
<p>Timothy Perrett’s <em>Lift in Action</em> (Manning Publications)</p>
</li>
</ul>






<section data-type="sect1" id="Contributors">
<h1>Contributors</h1>

<p>I’ve mined the Lift mailing list for these recipes, but I’m not the only one.  Recipes have been contributed by<a data-type="indexterm" data-primary="Lift Cookbook" data-secondary="contributors" id="id-EnCMSMFwTJ"></a><a data-type="indexterm" data-primary="contributors" data-secondary="to Lift Cookbook" id="id-QnCPFXF7Tp"></a>:</p>

<ul>
<li>
<p>Jono Ferguson, who’s a Scala consultant based in Sydney, Australia. He can be found lurking on the Lift mailing list and occasionally helps out with Lift modules. Find him at <a href="https://twitter.com/jonoabroad"><em class="hyperlink">https://twitter.com/jonoabroad</em></a> and <a href="http://underscoreconsulting.com"><em class="hyperlink">http://underscoreconsulting.com</em></a>.</p>
</li>
<li>
<p>Franz Bettag, who’s been an enthusiastic Scala hacker for several years now. He joined the Lift team in January 2012 and actively tweets and blogs about his newest Scala adventures. Find him at <a href="https://twitter.com/fbettag"><em class="hyperlink">https://twitter.com/fbettag</em></a>.</p>
</li>
<li>
<p>Marek Żebrowski.</p>
</li>
<li>
<p>Peter Robinett, who’s a web and mobile developer and a Lift committer. He can be found <a href="http://www.bubblefoundry.com">on the Web</a> and <a href="http://twitter.com/pr1001">on Twitter</a>.</p>
</li>
<li>
<p>Kevin Lau, who’s a founder of a few web apps with a focus in AWS cloud, iOS, and Lift.</p>
</li>
<li>
<p>Tony Kay.</p>
</li>
<li>
<p>Chenguang He.</p>
</li>
</ul>

<p id="jointhem">You should join them: <a data-type="xref" href="#AddRecipe">How to Add a New Recipe to This Cookbook</a> tells you how.</p>
</section>













<section data-type="sect1" id="source-zVsKcy">
<h1>Source</h1>

<p>The text of this cookbook is at <a href="https://github.com/d6y/lift-cookbook"><em class="hyperlink">https://github.com/d6y/lift-cookbook</em></a>.</p>

<p>You’ll find projects for each chapter <a href="https://github.com/LiftCookbook/">on GitHub</a>.<a data-type="indexterm" data-primary="Lift Cookbook" data-secondary="projects for" id="id-KnCdF1IQcJ"></a></p>
</section>













<section data-type="sect1" id="updates-yDsBiZ">
<h1>Updates</h1>

<p>Follow <a href="https://twitter.com/liftcookbook">@LiftCookbook</a> on Twitter.</p>
</section>













<section data-type="sect1" id="software-versions-V7sVuw">
<h1>Software Versions</h1>

<p>Except where otherwise indicated, the examples use Lift 2.6 with SBT
0.13 and <span class="keep-together">Scala 2.11.</span><a data-type="indexterm" data-primary="Lift Cookbook" data-secondary="software versions used in" id="id-aeCdFEFpuW"></a></p>
</section>













<section data-type="sect1" id="conventions-used-in-this-book-rWsgUE">
<h1>Conventions Used in This Book</h1>

<p>The following typographical conventions are used in this book:</p>
<dl>
<dt><em>Italic</em></dt>
<dd>
<p>Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>
</dd>
<dt><code>Constant width</code></dt>
<dd>
<p>Used for program listings, as well as within paragraphs to refer to program elements such as variable or function names, databases, data types, environment variables, statements, and keywords.</p>
</dd>
<dt><strong><code>Constant width bold</code></strong></dt>
<dd>
<p>Shows commands or other text that should be typed literally by the user.</p>
</dd>
<dt><em><code>Constant width italic</code></em></dt>
<dd>
<p>Shows text that should be replaced with user-supplied values or by values determined by context.</p>
</dd>
</dl>
<div data-type="tip" id="id-0pUbtgU9"><h6>Tip</h6>
<p>This icon signifies a tip, suggestion, or general note.</p>
</div>
<div data-type="warning" id="id-LmUYhEUX"><h6>Warning</h6>
<p>This icon indicates a warning or caution.</p>
</div>
</section>













<section data-type="sect1" id="using-code-examples-wPsQCe">
<h1>Using Code Examples</h1>

<p>This book is here to help you get your job done. In general, if this book includes code examples, you may use the code in this book in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing a CD-ROM of examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does<a data-type="indexterm" data-primary="Lift Cookbook" data-secondary="code use permissions" id="id-0nCXSGFXCK"></a> require <span class="keep-together">permission.</span></p>

<p>We appreciate, but do not require, attribution. An attribution usually includes the title, author, publisher, and ISBN. For example: “<em>Lift Cookbook</em> by Richard Dallaway (O’Reilly). Copyright 2013 Richard Dallaway, 978-1-449-36268-3.”</p>

<p>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a class="email" href="mailto:permissions@oreilly.com"><em>permissions@oreilly.com</em></a>.</p>
</section>













<section data-type="sect1" id="safarir-books-online-xqsvsy">
<h1>Safari® Books Online</h1>
<div data-type="note" class="safarienabled" id="id-0pUEFBs9"><h6>Note</h6>
<p><a href="http://safaribooksonline.com" class="orm:hideurl:ital"><em class="hyperlink">Safari Books Online</em></a> is an on-demand digital library that delivers expert <a href="https://www.safaribooksonline.com/explore/" class="orm:hideurl">content</a> in both book and video form from the world’s leading authors in technology and business.</p>
</div>

<p>Technology professionals, software developers, web designers, and business and creative professionals use Safari Books Online as their primary resource for research, problem solving, learning, and certification training.</p>
<p>Safari Books Online offers a range of <a href="https://www.safaribooksonline.com/pricing/" class="orm:hideurl">plans and pricing</a> for <a href="https://www.safaribooksonline.com/enterprise/" class="orm:hideurl">enterprise</a>, <a href="https://www.safaribooksonline.com/government/" class="orm:hideurl">government</a>, <a href="https://www.safaribooksonline.com/academic-public-library/" class="orm:hideurl">education</a>, and individuals.</p>

<p>Members have access to thousands of books, training videos, and prepublication manuscripts in one fully searchable database from publishers like O’Reilly Media, Prentice Hall Professional, Addison-Wesley Professional, Microsoft Press, Sams, Que, Peachpit Press, Focal Press, Cisco Press, John Wiley &amp; Sons, Syngress, Morgan Kaufmann, IBM Redbooks, Packt, Adobe Press, FT Press, Apress, Manning, New Riders, McGraw-Hill, Jones &amp; Bartlett, Course Technology, and hundreds <a href="https://www.safaribooksonline.com/our-library/" class="orm:hideurl">more</a>. For more information about Safari Books Online, please visit us <a class="orm:hideurl" href="http://safaribooksonline.com">online</a>.</p>
</section>













<section data-type="sect1" id="how-to-contact-us-PasXHw">
<h1>How to Contact Us</h1>

<p>Please address comments and questions concerning this book to the publisher:</p>
<ul class="simplelist">
  <li>O’Reilly Media, Inc.</li>
  <li>1005 Gravenstein Highway North</li>
  <li>Sebastopol, CA 95472</li>
  <li>800-998-9938 (in the United States or Canada)</li>
  <li>707-829-0515 (international or local)</li>
  <li>707-829-0104 (fax)</li>
</ul>

<p>We have a web page for this book, where we list errata, examples, and any additional information. You can access this page at <a href="http://oreil.ly/lift-cookbook"><em class="hyperlink">http://oreil.ly/lift-cookbook</em></a>.</p>

<p>To comment or ask technical questions about this book, send email to <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a>.</p>

<p>For more information about our books, courses, conferences, and news, see our website at <a href="http://www.oreilly.com"><em class="hyperlink">http://www.oreilly.com</em></a>.</p>

<p>Find us on Facebook: <a href="http://facebook.com/oreilly"><em class="hyperlink">http://facebook.com/oreilly</em></a></p>

<p>Follow us on Twitter: <a href="http://twitter.com/oreillymedia"><em class="hyperlink">http://twitter.com/oreillymedia</em></a></p>

<p>Watch us on YouTube: <a href="http://www.youtube.com/oreillymedia"><em class="hyperlink">http://www.youtube.com/oreillymedia</em></a></p>
</section>













<section data-type="sect1" id="acknowledgments-OKsyf9">
<h1>Acknowledgments</h1>

<p>These recipes exist because of the many contributions on the Lift mailing list, where <em>Liftafarians</em>, as they are known, generously give their time to ask questions, put together example projects, give answers, share alternatives, and chip in with comments. Thank you.</p>

<p>I am indebted to the contributors who have taken the trouble to write new recipes, and to those who have provided corrections and suggestions.</p>

<p>You’ll see I’ve repeatedly referenced the work of Antonio Salazar Cardozo, Diego Medina, Tim Nelson, David Pollak, and Dave Whittaker. These are fantastic communicators: thank you guys.</p>

<p>It’s been a pleasure working with the O’Reilly team, and they have immensely improved the text. Thank you, especially Meghan Blanchette, Kara Ebrahim, and Kiel Van Horn.</p>

<p>Many thanks to Jono for all the encouragement and help.</p>

<p>To Jane, Mum, Dad: thank you. It’s amazing what you can do with a supportive family.</p>
</section>







</section>














<section data-type="chapter" id="InstallAndRunning" class="pagenumrestart">
<h1>Installing and Running Lift</h1>


<p>This chapter covers questions regarding starting development with Lift: running a first Lift application and setting up a coding environment. You’ll find answers regarding production deployment in <a data-type="xref" href="#deployment">Production Deployment</a>.</p>






<section data-type="sect1" id="DownloadAndRun">
<h1>Downloading and Running Lift</h1>








<section data-type="sect2" id="problem-9psdFBI7">
<h2>Problem</h2>

<p>You want to install and run Lift on your computer.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="downloading" id="id-7nCJSgFDFVId"></a></p>
</section>













<section data-type="sect2" id="solution-ZKsnImIy">
<h2>Solution</h2>

<p>The only prerequisite for installing and running Lift is to have Java
1.7 or later installed. Instructions for installing Java can be found at
<a href="http://java.com/"><em class="hyperlink">http://java.com/</em></a>.</p>

<p>You can find out if you have Java from the shell or command prompt by asking for the version you have installed<a data-type="indexterm" data-primary="Java, installation of" id="id-QnCkSPIJINIE"></a>:</p>

<pre data-type="programlisting">$ java -version
java version "1.7.0_13"
Java(TM) SE Runtime Environment (build 1.7.0_13-b20)
Java HotSpot(TM) 64-Bit Server VM (build 23.7-b01, mixed mode)</pre>

<p>Once you have Java, the following instructions will download, build, and
start a basic Lift application.<a data-type="indexterm" data-primary="Lift applications" data-secondary="basic instructions" id="id-KnCnS8heIAIv"></a></p>










<section data-type="sect3" id="for-mac-and-linux-wPsvTDIYIb">
<h3>For Mac and Linux</h3>

<ul>
<li>
<p>Visit <a href="http://liftweb.net/download"><em class="hyperlink">http://liftweb.net/download</em></a> and download the most recent Lift 2.6 ZIP file.</p>
</li>
<li>
<p>Unzip the file.</p>
</li>
<li>
<p>Start Terminal or your favourite shell tool.</p>
</li>
<li>
<p>Navigate into the unzipped folder and into the <em>scala_211</em> subfolder and then into the <em>lift_basic</em> folder.</p>
</li>
<li>
<p>Run <code>./sbt</code>.</p>
</li>
<li>
<p>Required libraries will be downloaded automatically.</p>
</li>
<li>
<p>At the SBT prompt (&gt;), type <strong><code>container:start</code></strong>.</p>
</li>
<li>
<p>Open your browser and go to <em><a href="http://127.0.0.1:8080/"><em class="hyperlink">http://127.0.0.1:8080/</em></a></em>.</p>
</li>
<li>
<p>When you’re done, type <strong><code>exit</code></strong> at the SBT prompt to stop your application from running.</p>
</li>
</ul>
</section>













<section data-type="sect3" id="for-windows-xqspcqIoIm">
<h3>For Windows</h3>

<ul>
<li>
<p>Visit <a href="http://liftweb.net/download"><em class="hyperlink">http://liftweb.net/download</em></a> and locate the link to the most recent ZIP version of Lift 2.6 and save this to disk.</p>
</li>
<li>
<p>Extract the contents of the ZIP file.</p>
</li>
<li>
<p>Navigate in Explorer to the extracted folder, and once inside, navigate into <em>scala_211</em> and then <em>lift_basic</em>.</p>
</li>
<li>
<p>Double-click <em>sbt.bat</em> to run the build tool; a Terminal window should open.</p>
</li>
<li>
<p>Some versions of windows will display a warning that the SBT "publisher could not be verified". Click "Run" if this happens.</p>
</li>
<li>
<p>Required libraries will be downloaded automatically.</p>
</li>
<li>
<p>At the SBT prompt (&gt;), type <strong><code>container:start</code></strong>.</p>
</li>
<li>
<p>You may find Windows Firewall blocking Java from running. If so, opt to "allow access."</p>
</li>
<li>
<p>Start your browser and go to <em><a href="http://127.0.0.1:8080/"><em class="hyperlink">http://127.0.0.1:8080/</em></a></em>.</p>
</li>
<li>
<p>When you’re done, type <strong><code>exit</code></strong> at the SBT prompt to stop your application from running.</p>
</li>
</ul>
</section>













<section data-type="sect3" id="expected-result-Pas8iAIXI1">
<h3>Expected result</h3>

<p>The result of these commands should be a basic Lift application running on
your computer, as shown in <a data-type="xref" href="#LiftBasicScreenshot">Figure 1-1</a>.</p>

<figure id="LiftBasicScreenshot">
<img src="images/lfcb_0101.png" alt="lfcb 0101">
<figcaption><span class="label">Figure 1-1. </span>The basic Lift application home page</figcaption>
</figure>
</section>



</section>













<section data-type="sect2" id="discussion-zVsbtzIg">
<h2>Discussion</h2>

<p>Lift isn’t installed in the usual sense of "installing software."
Instead, you use standard build tools, such as SBT or Maven, to assemble your application with the Lift framework. In this recipe, we downloaded a ZIP file containing four fairly minimal Lift applications, and then started one of them via the build tool.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="vs. conventional software" id="id-QnCkSXFytNIE"></a></p>










<section data-type="sect3" id="simple-build-tool-V7sQIjt9Ir">
<h3>Simple Build Tool</h3>

<p>Typing <code>sbt</code> starts a <em>Simple Build Tool</em> used by Scala projects (it’s not specific to Lift).  SBT will check the project definition and download any libraries required, which will include the Lift framework.<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="starting" id="id-0nClIGFPIMtvIp"></a></p>

<p>This download happens once, and the downloaded
files are stored on disk in <em>.ivy2</em> under your home folder.</p>

<p>Your application build is configured by <em>build.sbt</em>.  Looking inside, you’ll see<a data-type="indexterm" data-primary="build.sbt, contents" id="id-LnCbFetxI0tQI8"></a>:</p>

<ul>
<li>
<p>Basic information about your application, including a name and version</p>
</li>
<li>
<p>Resolvers, which inform SBT where to fetch dependencies from</p>
</li>
<li>
<p>Settings for plugins and the Scala compiler</p>
</li>
<li>
<p>A list of dependencies required to run your application, which will include the Lift framework</p>
</li>
</ul>
</section>













<section data-type="sect3" id="RunningYourApplication">
<h3>Running your application</h3>

<p>The SBT command <code>container:start</code> starts the web server on the default port of 8080 and
passes requests to your Lift application. The word <em>container</em> refers to the
software you deploy your application into. There are a variety of containers (<em>Jetty</em> and
<em>Tomcat</em> are probably the best known) all of which conform to a standard for deployment.
The upshot is you can build your application and deploy to whichever one you prefer.
The <code>container:start</code> command uses Jetty.<a data-type="indexterm" data-primary="Lift applications" data-secondary="running" id="id-e4CpTJFQtat0ID"></a><a data-type="indexterm" data-primary="containers" data-secondary="types of" id="id-GnCycgFmtntyIN"></a><a data-type="indexterm" data-primary="Jetty" id="id-DnC7iWFvtZt9IJ"></a><a data-type="indexterm" data-primary="Tomcat" id="id-kVC9upFDtatKIj"></a></p>
</section>













<section data-type="sect3" id="source-code-wPsjh9tYIb">
<h3>Source code</h3>

<p>The source code of the application resides in <em>src/main/webapp</em> and <em>src/main/scala</em>. If you take a look at <em>index.html</em> in the <em>webapp</em> folder, you’ll see mention of <code>data-lift="helloWorld.howdy"</code>. That’s a reference to the class defined in <em>scala/code/snippet/HelloWorld.scala</em>. This is a <em>snippet invocation</em> and an example of Lift’s <em>view first</em> approach to web applications. That is, there’s no routing set up for the index page to collect the data and forward it to the view. Instead, the view defines areas of the content that are replaced with functions, such as those functions defined in <em>HelloWorld.scala</em>.<a data-type="indexterm" data-primary="snippet invocation" id="id-JnCQUlFkhKtXIl"></a><a data-type="indexterm" data-primary="view first approach" data-secondary="definition of" id="id-9nCkCvFKhptnIY"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="view first approach of" id="id-ZbCdsMFahrtPID"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="source code for" id="id-zdC8HGFJhxt2IO"></a><a data-type="indexterm" data-primary="source code" id="id-yYC8fpFnh4tQIj"></a></p>

<p>Lift knows to look in the <code>code</code> package for snippets, because that package is declared as a location for snippets in <em>scala/bootstrap/liftweb/Boot.scala</em>. The Boot class is run when starting your application, and it’s where you can configure the behaviour of Lift.<a data-type="indexterm" data-primary="Boot.scala" id="id-W7CQIGIDhXtJIw"></a></p>
</section>



</section>













<section data-type="sect2" id="see-also-yDsYh1Ir">
<h2>See Also</h2>

<p>The Simple Build Tool documentation is at <a href="http://www.scala-sbt.org"><em class="hyperlink">http://www.scala-sbt.org</em></a>.</p>

<p>Tutorials for Lift can be found in <a href="http://simply.liftweb.net/"><em>Simply Lift</em></a>, <em>Instant Lift Web Applications How-to</em> (PACKT Publishing), and in <em>Lift in Action</em> (Manning Publications Co.).</p>
</section>





</section>













<section data-type="sect1" id="LiftFromScratch">
<h1>Creating a Lift Project from Scratch Using SBT</h1>








<section data-type="sect2" id="problem-ZKs1Flty">
<h2>Problem</h2>

<p>You want to create a Lift web project from scratch without using the ZIP files provided on the official Lift website.</p>
</section>













<section data-type="sect2" id="solution-zVsXIvtg">
<h2>Solution</h2>

<p>You will need to configure SBT and the Lift project yourself. Luckily, only five small files are needed.<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="configuration of" id="id-QnCkSXFJI0tE"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="creating from scratch" id="id-bGCgF2FaIgta"></a></p>

<p>First, create an SBT plugin file at <em>project/plugins.sbt</em> (all filenames are given relative to the project root directory):</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">addSbtPlugin</code><code class="o">(</code><code class="s">"com.earldouglas"</code> <code class="o">%</code> <code class="s">"xsbt-web-plugin"</code> <code class="o">%</code> <code class="s">"0.7.0"</code><code class="o">)</code></pre>

<p>This file tells SBT that you will be using the <code>xsbt-web-plugin</code>. This plugin will allow you to start and stop your application.</p>

<p>Next, create an SBT build file, <em>build.sbt</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">organization</code> <code class="o">:=</code> <code class="s">"org.yourorganization"</code>

<code class="n">name</code> <code class="o">:=</code> <code class="s">"liftfromscratch"</code>

<code class="n">version</code> <code class="o">:=</code> <code class="s">"0.1-SNAPSHOT"</code>

<code class="n">scalaVersion</code> <code class="o">:=</code> <code class="s">"2.11.1"</code>

<code class="n">seq</code><code class="o">(</code><code class="n">webSettings</code> <code class="k">:_</code><code class="kt">*</code><code class="o">)</code>

<code class="n">libraryDependencies</code> <code class="o">++=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="s">"2.6-RC1"</code>
  <code class="nc">Seq</code><code class="o">(</code>
    <code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-webkit"</code> <code class="o">%</code> <code class="n">liftVersion</code> <code class="o">%</code> <code class="s">"compile"</code><code class="o">,</code>
    <code class="s">"org.eclipse.jetty"</code> <code class="o">%</code> <code class="s">"jetty-webapp"</code> <code class="o">%</code> <code class="s">"8.1.7.v20120910"</code>  <code class="o">%</code>
      <code class="s">"container,test"</code><code class="o">,</code>
    <code class="s">"org.eclipse.jetty.orbit"</code> <code class="o">%</code> <code class="s">"javax.servlet"</code> <code class="o">%</code> <code class="s">"3.0.0.v201112011016"</code> <code class="o">%</code>
      <code class="s">"container,compile"</code> <code class="n">artifacts</code> <code class="nc">Artifact</code><code class="o">(</code><code class="s">"javax.servlet"</code><code class="o">,</code> <code class="s">"jar"</code><code class="o">,</code> <code class="s">"jar"</code><code class="o">)</code>
  <code class="o">)</code>
<code class="o">}</code></pre>

<p>Feel free to change the various versions, though be aware that certain versions of Lift are only built for certain versions of Scala.</p>

<p>Now that you have the basics of an SBT project, you can launch the <code>sbt</code> console. It should load all the necessary dependencies, including the proper Scala version, and bring you to a prompt.</p>

<p>Next, create the following file at <em>src/main/webapp/WEB-INF/web.xml</em>:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true"><code class="cp">&lt;!DOCTYPE web-app SYSTEM "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;</code>
<code class="nt">&lt;web-app&gt;</code>
  <code class="nt">&lt;filter&gt;</code>
    <code class="nt">&lt;filter-name&gt;</code>LiftFilter<code class="nt">&lt;/filter-name&gt;</code>
    <code class="nt">&lt;display-name&gt;</code>Lift Filter<code class="nt">&lt;/display-name&gt;</code>
    <code class="nt">&lt;description&gt;</code>The Filter that intercepts Lift calls<code class="nt">&lt;/description&gt;</code>
    <code class="nt">&lt;filter-class&gt;</code>net.liftweb.http.LiftFilter<code class="nt">&lt;/filter-class&gt;</code>
  <code class="nt">&lt;/filter&gt;</code>
  <code class="nt">&lt;filter-mapping&gt;</code>
    <code class="nt">&lt;filter-name&gt;</code>LiftFilter<code class="nt">&lt;/filter-name&gt;</code>
    <code class="nt">&lt;url-pattern&gt;</code>/*<code class="nt">&lt;/url-pattern&gt;</code>
  <code class="nt">&lt;/filter-mapping&gt;</code>
<code class="nt">&lt;/web-app&gt;</code></pre>

<p>The <em>web.xml</em> file tells web containers, such as Jetty as configured by <code>xsbt-web-plugin</code>, to pass all requests on to Lift.</p>

<p>Next, create a sample <em>index.html</em> file at <em>src/main/webapp/index.html</em> for our Lift app to load. For example:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;html&gt;</code>
  <code class="nt">&lt;head&gt;</code>
    <code class="nt">&lt;title&gt;</code>Lift From Scratch<code class="nt">&lt;/title&gt;</code>
  <code class="nt">&lt;/head&gt;</code>
  <code class="nt">&lt;body&gt;</code>
    <code class="nt">&lt;h1&gt;</code>Welcome, you now have a working Lift installation<code class="nt">&lt;/h1&gt;</code>
  <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>Finally, set up the basic Lift boot settings by creating a <em>Boot.scala</em> file at <em>src/main/scala/bootstrap/Boot.scala</em>. The following contents will be sufficient:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">bootstrap.liftweb</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="nc">Html5Properties</code><code class="o">,</code> <code class="nc">LiftRules</code><code class="o">,</code> <code class="nc">Req</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.sitemap.</code><code class="o">{</code><code class="nc">Menu</code><code class="o">,</code> <code class="nc">SiteMap</code><code class="o">}</code>

<code class="cm">/**</code>
<code class="cm"> * A class that's instantiated early and run.  It allows the application</code>
<code class="cm"> * to modify lift's environment</code>
<code class="cm"> */</code>
<code class="k">class</code> <code class="nc">Boot</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">boot</code> <code class="o">{</code>
    <code class="c1">// where to search snippet</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">addToPackages</code><code class="o">(</code><code class="s">"org.yourorganization.liftfromscratch"</code><code class="o">)</code>

    <code class="c1">// Build SiteMap</code>
    <code class="k">def</code> <code class="n">sitemap</code><code class="o">()</code><code class="k">:</code> <code class="kt">SiteMap</code> <code class="o">=</code> <code class="nc">SiteMap</code><code class="o">(</code>
      <code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"Home"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"index"</code>
    <code class="o">)</code>

    <code class="c1">// Use HTML5 for rendering</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">htmlProperties</code><code class="o">.</code><code class="n">default</code><code class="o">.</code><code class="n">set</code><code class="o">((</code><code class="n">r</code><code class="k">:</code> <code class="kt">Req</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="k">new</code> <code class="nc">Html5Properties</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">userAgent</code><code class="o">))</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Congratulations, you now have a working Lift project!</p>

<p>You can verify that you have a working Lift project by launching the Jetty web container from the SBT console with the <code>container:start</code> command. First, the <em>Boot.scala</em> file should be compiled and then you should be notified that Jetty has launched and is listening at <em><a href="http://localhost:8080"><em class="hyperlink">http://localhost:8080</em></a></em>. You should be able to go to the address in your web browser and see the rendered <em>index.html</em> file you created earlier.<a data-type="indexterm" data-primary="Lift applications" data-secondary="verification of" id="id-wqCjhGtYIztm"></a></p>
</section>













<section data-type="sect2" id="discussion-yDsgtktr">
<h2>Discussion</h2>

<p>As shown previously, creating a Lift project from scratch is a relatively simple process. However, it can be a tricky one for newcomers, especially if you are not used to the Java Virtual Machine (JVM) ecosystem and its conventions for web containers. If you run into problems, make sure the files are in the correct locations and that their contents were not mistakenly modified. If all else fails, refer to the sample project next or ask for help on the <a href="http://groups.google.com/group/liftweb">Lift mailing list</a>.<a data-type="indexterm" data-primary="containers" data-secondary="troubleshooting" id="id-KnCdFeFqtetv"></a><a data-type="indexterm" data-primary="Java Virtual Machine (JVM)" data-secondary="troubleshooting" id="id-aeCNIEFJtOtY"></a><a data-type="indexterm" data-primary="web containers" data-seealso="containers" id="id-0nCbtGFYtMtr"></a></p>

<p>Lift projects using SBT or similar build tools follow a standard project layout, where Scala source code is in <em>src/main/scala</em> and web resources are in <em>src/main/webapp</em>. Your Scala files must be placed either directly at <em>src/main/scala</em> or in nested directories matching the organization and name you defined in <em>build.sbt</em>, in our case giving us <em>src/main/scala/org/yourorganization/liftfromscratch/</em>. Test files match the directory structure but are placed in <em>src/test/</em> instead of <em>src/main/</em>. Likewise, the <em>web.xml</em> file must be placed in <em>src/main/webapp/WEB-INF/</em> for it to be properly detected.<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="standard layout with" id="id-kVCnU2IDtatX"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="standard layout of" id="id-4nCmCAINt1tl"></a><a data-type="indexterm" data-primary="source code" id="id-JnClsjIDtKtw"></a><a data-type="indexterm" data-primary="directory structure" id="id-9nCvHBI4tptl"></a></p>

<p>Given these conventions, you should have a directory structure looking quite, if not exactly, like this:</p>

<pre data-type="programlisting">- project root directory
  | build.sbt
  - project/
    | plugins.sbt
  - src/
    - main/
      - scala/
        - bootstrap/
          | Boot.scala
        - org/
          - yourorganization/
            - liftfromscratch/
              | &lt;your Scala code goes here&gt;
      - webapp/
        | index.html
        | &lt;any other web resources - images, HTML, JavaScript, etc - go here&gt;
        - WEB-INF/
          | web.xml
    - test/
      - scala/
        - org/
          - yourorganization/
            - liftfromscratch/
              | &lt;your tests go here&gt;</pre>
</section>













<section data-type="sect2" id="see-also-V7sohjtm">
<h2>See Also</h2>

<p>There is a <a href="https://github.com/bubblefoundry/lift-from-scratch">sample project created using this method</a>.</p>
</section>





</section>













<section data-type="sect1" id="texteditor">
<h1>Developing Using a Text Editor</h1>








<section data-type="sect2" id="problem-zVskFyhg">
<h2>Problem</h2>

<p>You want to develop your Lift application using your favourite text
editor, hitting reload in your browser to see changes.<a data-type="indexterm" data-primary="Lift applications" data-secondary="text editor development" id="id-QnCkSXFjFphE"></a><a data-type="indexterm" data-primary="text editors, development with" id="id-bGCgF2FLFmha"></a><a data-type="indexterm" data-primary="browsers" data-secondary="reloading" id="id-KnC9IeFbFJhv"></a></p>
</section>













<section data-type="sect2" id="solution-yDsrIZhr">
<h2>Solution</h2>

<p>Run SBT while you are editing, and ask it to detect and compile changes to Scala files.  To do that, start <code>sbt</code> and enter the following to the SBT prompt<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="text editor development with" id="id-KnCdFeFeIJhv"></a>:</p>

<pre data-type="programlisting">~; container:start; container:reload /</pre>

<p>When you save a source file in your editor, SBT will detect this change,
compile the file, and reload the web container.</p>
</section>













<section data-type="sect2" id="discussion-V7s2twhm">
<h2>Discussion</h2>

<p>An SBT command prefixed with <code>~</code> makes that command run when files
change. The first semicolon introduces a sequence of commands, where if
the first command succeeds, the second will run. The second semicolon
means the <code>reload</code> command will run if the <code>start</code> command ran OK. The <code>start</code>
command will recompile any Scala source files that have changed.</p>

<p>When you run SBT in this way, you’ll notice the following output:</p>

<pre data-type="programlisting">1. Waiting for source changes... (press enter to interrupt)</pre>

<p>And indeed, if you do press Enter in the SBT window, you’ll exit this <em>triggered
execution</em> mode and SBT will no longer be looking for file changes. However, while
SBT is watching for changes, the output will indicate when this happens with something
that looks a little like this<a data-type="indexterm" data-primary="triggered execution mode" id="id-AnCDF0hVtNhE"></a><a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="triggered execution mode" id="id-W7CQInhAtzhB"></a>:</p>

<pre data-type="programlisting">[info] Compiling 1 Scala source to target/scala-2.11/classes...
[success] Total time: 1 s, completed 26-Aug-2014 17:17:47
[pool-301-thread-4] DEBUG net.liftweb.http.LiftServlet - Destroyed Lift handler.
[info] stopped o.e.j.w.WebAppContext{/,[src/main/webapp/]}
[info] NO JSP Support for /, did not find org.apache.jasper.servlet.JspServlet
[info] started o.e.j.w.WebAppContext{/,[src/main/webapp/]}
[success] Total time: 0 s, completed 26-Aug-2014 17:17:48
2. Waiting for source changes... (press enter to interrupt)</pre>

<p>Edits to HTML files don’t trigger the SBT compile and reload commands.
This is because SBT’s default behaviour is to look for
Scala and Java source file changes, and also changes to files in <em>src/main/resources/</em>.
This works out just fine, because Jetty will use your modified HTML file when you
reload the browser page.</p>

<p>Restarting the web container each time you edit a Scala file isn’t ideal. You can reduce
the need for restarts by integrating JRebel into your development environment, as described
in <a data-type="xref" href="#jrebel">Incorporating JRebel</a>.<a data-type="indexterm" data-primary="web containers" id="id-GnCZF9imtKhe"></a><a data-type="indexterm" data-primary="browsers" data-secondary="reloading" id="id-DnCXIVivt4hn"></a><a data-type="indexterm" data-primary="JRebel" data-secondary="reducing restarts with" id="id-kVCltbiDtZhX"></a></p>

<p>However, if you are making a serious number of edits, you may prefer to issue a <code>container:stop</code> command until you’re ready to run you application again with <code>container:start</code>. This will prevent SBT compiling and restarting your application over and over. The SBT console has a command history, and using the up and down keyboard arrows allows you to navigate to previous commands and run them by pressing the Return key.  That takes some of the tedium out of these long commands.<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="command history in" id="id-kVCAImuDtZhX"></a><a data-type="indexterm" data-primary="error messages" data-secondary="java.lang.OutOfMemoryError: PermGen space" id="id-4nCPtVuNtVhl"></a></p>

<p>If you are using Java before Java 8, one error you may run into is:</p>

<pre data-type="programlisting">java.lang.OutOfMemoryError: PermGen space</pre>

<p>The <em>permanent generation</em> is a Java Virtual Machine concept. It’s the area of memory used for storing classes (amongst other things). It’s a fixed size, and once it is full, this PermGen error appears.  As you might imagine, continually restarting a container causes many classes to be loaded and unloaded, but the process is not perfect, effectively leaking memory. The best you can do is stop and then restart SBT.  If you’re seeing this error often, check the setting for <code>-XX:MaxPermSize</code> inside the <em>sbt</em> (or <em>sbt.bat</em>) script, and if you can, double it.<a data-type="indexterm" data-primary="Java Virtual Machine (JVM)" data-secondary="troubleshooting" id="id-zdCrhNsDt7hM"></a><a data-type="indexterm" data-primary="permanent generation" id="id-yYC4TasvtBhX"></a></p>
</section>













<section data-type="sect2" id="see-also-rWsZhEhO">
<h2>See Also</h2>

<p>Triggered execution has a number of settings you can adjust, as described in <a href="http://bit.ly/154mizT">the SBT documentation</a>.</p>

<p>See <a href="http://bit.ly/178Zztv">the SBT Command Line Reference</a> for an overview of available commands.</p>

<p>Commands and configuration options for the SBT web plugin are described on <a href="https://github.com/JamesEarlDouglas/xsbt-web-plugin/wiki">the GitHub wiki</a>.</p>
</section>





</section>













<section data-type="sect1" id="jrebel">
<h1>Incorporating JRebel</h1>








<section data-type="sect2" id="problem-yDsyFYTr">
<h2>Problem</h2>

<p>You want to avoid application restarts when you change a Scala source file by using JRebel.</p>
</section>













<section data-type="sect2" id="solutions-V7sQIDTm">
<h2>Solutions</h2>

<p>There are three steps required: install JRebel once; each year, request the free Scala license; and configure SBT to use JRebel.<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="using JRebel with" id="id-KnCnSeFeIOTv"></a><a data-type="indexterm" data-primary="JRebel" data-secondary="license for" id="id-aeCdFEFrIVTY"></a><a data-type="indexterm" data-primary="license, for JRebel" id="id-0nClIGFPIzTr"></a></p>

<p>First, visit <a href="https://my.jrebel.com/plans"><em class="hyperlink">https://my.jrebel.com/plans</em></a> and request the free Scala license.</p>

<p>Second, download the "Generic ZIP Archive" version of JRebel, unzip it to where you like. For this recipe, I’ve chosen to use <em>/opt/zt/jrebel/</em>.</p>

<p>When you have received your account confirmation email from JRebel, you can copy your "authentication token" from the "Active" area of ZeroTurnaround’s site. To apply the token to your local install, run the JRebel configuration script<a data-type="indexterm" data-primary="authentication tokens" id="id-LnC7S2hxIkTZ"></a>:</p>

<pre data-type="programlisting">$ /opt/zt/jrebel/bin/jrebel-config.sh</pre>

<p>For Windows, navigate to and launch <em>bin\jrebel-config.cmd</em>.</p>

<p>In the "Activation" setting, select "I want to use myJRebel" and then in the "License" section, paste in your activation token. Click the "Activate" button, and once you see the license status change to "You have a valid myJRebel token," click "Finish."</p>

<p>Finally, configure SBT by modifying the <em>sbt</em> script to enable JRebel.  This means setting the <code>-javaagent</code> and <code>-noverify</code> flags for Java, and enabling the JRebel Lift plugin.</p>

<p>For Mac and Linux, the script that’s included with the Lift downloads would become:</p>

<pre data-type="programlisting">java -Drebel.lift_plugin=true -noverify -javaagent:/opt/zt/jrebel/jrebel.jar \
 -Xmx1024M -Xss2M -XX:MaxPermSize=512m -XX:+CMSClassUnloadingEnabled -jar \
 `dirname $0`/sbt-launch-0.12.jar "$@"</pre>

<p>For Windows, modify <em>sbt.bat</em> to be:</p>

<pre data-type="programlisting">set SCRIPT_DIR=%~dp0
java -Drebel.lift_plugin=true -noverify -javaagent:c:/opt/zt/jrebel/jrebel.jar \
 -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256m -Xmx1024M -Xss2M \
 -jar "%SCRIPT_DIR%\sbt-launch-0.12.jar" %*</pre>

<p>There’s nothing else to do to use JRebel.  When you start SBT, you’ll see a large banner stating something like this:</p>

<pre data-type="programlisting">#############################################################

  JRebel 5.1.1 (201211271929)
  (c) Copyright ZeroTurnaround OU, Estonia, Tartu.

  Over the last 30 days JRebel prevented
  at least 335 redeploys/restarts saving you about 13.6 hours.
....</pre>

<p>With JRebel installed, you can now <code>container:start</code> your application, modify and compile a Scala file, and reload a page in your application. You’ll see a notice that the class has been reloaded:</p>

<pre data-type="programlisting">[2012-12-16 23:15:44] JRebel: Reloading class 'code.snippet.HelloWorld'.</pre>

<p>That change is live, without having to restart the container.</p>
</section>













<section data-type="sect2" id="discussion-rWswtATO">
<h2>Discussion</h2>

<p>JRebel is very likely to speed up your development. It updates code in a running Java Virtual Machine, without having to stop and restart it.  The effect is that, on the whole, you can compile a class, then hit reload in your browser to see the change in your Lift application.<a data-type="indexterm" data-primary="Java Virtual Machine (JVM)" data-secondary="troubleshooting" id="id-aeCvSEFJtVTY"></a><a data-type="indexterm" data-primary="JRebel" data-secondary="reducing restarts with" id="id-0nCEFGFYtzTr"></a><a data-type="indexterm" data-primary="browsers" data-secondary="reloading" id="id-LnCNIGFWtkTZ"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="speeding development of" id="id-AnCVtZFVtjTE"></a></p>

<p>Even with JRebel you will need to restart your applications from time to time, but JRebel usually reduces the number of restarts. For example, <em>Boot.scala</em> is run when your application starts, so if you modify something in your <em>Boot.scala</em>, you’ll need to stop and start your application. JRebel can’t help with that.</p>

<p>But there are also other situations that JRebel cannot help with, such as when a superclass changes. Generally, JRebel will emit a warning about this in the console window.  If that happens, stop and start your application.<a data-type="indexterm" data-primary="superclass changes" id="id-LnC7SetWtkTZ"></a></p>

<p>The <code>-Drebel.lift_plugin=true</code> setting adds Lift-specific functionality to JRebel.  Specifically, it allows JRebel to reload changes to <code>LiftScreen</code>, <code>Wizard</code>, and <code>RestHelper</code>. This means you can change fields or screens, and change REST <code>serve</code> code.<a data-type="indexterm" data-primary="Drebel plugin" id="id-kVCOT7hDt4TX"></a><a data-type="indexterm" data-primary="Wizard" id="id-4nCZcohNtXTl"></a><a data-type="indexterm" data-primary="RestHelper" id="id-JnC7iLhDtJTw"></a></p>










<section data-type="sect3" id="purchased-licenses-XQsyTLtLTv">
<h3>Purchased licenses</h3>

<p>This recipe uses a free Scala license for a service called myJRebel. This communicates with JRebel servers via the activation code.  If you have purchased a license from ZeroTurnaround, the situation is slightly different.  In this case, you will have a license key that you store in a file called <em>jrebel.lic</em>. You can place the file in a <em>.jrebel</em> folder in your home directory, or alongside <em>jrebel.jar</em> (e.g., in the <em>/opt/zt/jrebel/</em> folder, if that’s where you installed JRebel), or you can specify some other location.  For the latter option, modify the <em>sbt</em> script and specify the location of the file by adding another Java setting<a data-type="indexterm" data-primary="license, for JRebel" id="id-JnC0TlF2TKtwTl"></a><a data-type="indexterm" data-primary="JRebel" data-secondary="license for" id="id-9nCNcvF7TptlTY"></a><a data-type="indexterm" data-primary="ZeroTurnaround" id="id-ZbCDiMFyTrtXTD"></a>:</p>

<pre data-type="programlisting">-Drebel.license=/path/to/jrebel.lic</pre>
</section>



</section>













<section data-type="sect2" id="see-also-wPsjhoT4">
<h2>See Also</h2>

<p>Details about how JRebel works can be found in <a href="http://zeroturnaround.com/software/jrebel/resources/faq/">the ZeroTurnaround FAQ</a>.</p>

<p>The Lift support was announced in a <a href="http://zeroturnaround.com/jrebel/lift-support-in-jrebel/">blog post in 2012</a>, where you’ll find more about the capabilities of the plugin.</p>
</section>





</section>













<section data-type="sect1" id="eclipse">
<h1>Developing Using Eclipse</h1>








<section data-type="sect2" id="problem-V7spFlcm">
<h2>Problem</h2>

<p>You want to develop your Lift application using the Eclipse IDE, hitting
reload in your browser to see changes.<a data-type="indexterm" data-primary="Lift applications" data-secondary="Eclipse IDE development" id="id-KnCnSeFbFKcv"></a><a data-type="indexterm" data-primary="Eclipse IDE, development in" id="id-aeCdFEF2FlcY"></a></p>
</section>













<section data-type="sect2" id="solution-rWseIqcO">
<h2>Solution</h2>

<p>Use the "Scala IDE for Eclipse" plugin to Eclipse, and the <em>sbteclipse</em> plugin for SBT.  This will give Eclipse the ability to understand Scala, and SBT the ability to create project files that Eclipse can load.<a data-type="indexterm" data-primary="Scala IDE for Eclipse plugin" id="id-0nCEFGFPIDcr"></a><a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="Eclipse plugin for" id="id-LnCNIGFxI8cZ"></a></p>

<p>The instructions for the Eclipse plugin are given at <a href="http://scala-ide.org"><em class="hyperlink">http://scala-ide.org</em></a>. There are a number of options to be aware of when picking an update site to use: there are different sites for Scala 2.9 and 2.10, and for different versions of Eclipse. Start with the <em>stable</em> version of the plugin rather than a nightly or milestone version. This will give you an Eclipse perspective that knows about Scala.</p>

<p>Once the Eclipse plugin is installed and restarted, you need to create the project files to allow Eclipse to load your Lift project. Install <em>sbteclipse</em> by adding the following to <em>projects/plugins.sbt</em> in your Lift project:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">addSbtPlugin</code><code class="o">(</code><code class="s">"com.typesafe.sbteclipse"</code> <code class="o">%</code> <code class="s">"sbteclipse-plugin"</code> <code class="o">%</code> <code class="s">"2.5.0"</code><code class="o">)</code></pre>

<p>You can then create Eclipse project files (<em>.project</em> and <em>.classpath</em>) by entering the following into the SBT prompt:</p>

<pre data-type="programlisting">eclipse</pre>

<p>Open the project in Eclipse by navigating to "File → Import…" and selecting "General → Existing Projects into Workspace." Browse to and choose your Lift project. You are now set up to develop your application in Eclipse.</p>

<p>To see live changes as you edit and save your work, run SBT in a separate terminal window.  That is, start <em>sbt</em> from a terminal window outside of Eclipse and enter the following:</p>

<pre data-type="programlisting">~; container:start; container:reload /</pre>

<p>The behaviour of this command is described in <a data-type="xref" href="#texteditor">Developing Using a Text Editor</a>, but if you’re using JRebel (see <a data-type="xref" href="#jrebel">Incorporating JRebel</a>), then you just need to run <code>container:start</code> by itself.</p>

<p>You can then edit in Eclipse, save to compile, and in your web browser, hit reload to see
the changes.</p>
</section>













<section data-type="sect2" id="discussion-wPsDtnc4">
<h2>Discussion</h2>

<p>One of the great benefits of an IDE is the ability to navigate source, by Cmd+click (Mac) or F3 (PC).
You can ask the SBT <code>eclipse</code> command to download the Lift
source and Scaladoc, allowing you to click through to the Lift source from
methods and classes, which is a useful way to discover more about Lift.<a data-type="indexterm" data-primary="Cmd+click shortcut" id="id-LnCbFGFWt8cZ"></a><a data-type="indexterm" data-primary="F3 shortcut" id="id-AnCKIZFVtVcE"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="learning more about" id="id-W7CetLFAtJcB"></a></p>

<p>To achieve this in a project, run <code>eclipse with-source=true</code> in SBT, but if you want
this to be the default behaviour, add the following to your <em>build.sbt</em> file:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">EclipseKeys</code><code class="o">.</code><code class="n">withSource</code> <code class="o">:=</code> <code class="kc">true</code></pre>

<p>If you find yourself using the plugin frequently, you may wish to declare it
in your global SBT configuration files so it applies to all projects.  To do that,
create a <em>~/.sbt/0.13/plugins/build.sbt</em> file containing:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">resolvers</code> <code class="o">+=</code> <code class="nc">Classpaths</code><code class="o">.</code><code class="n">typesafeResolver</code>

<code class="n">addSbtPlugin</code><code class="o">(</code><code class="s">"com.typesafe.sbteclipse"</code> <code class="o">%</code> <code class="s">"sbteclipse-plugin"</code> <code class="o">%</code> <code class="s">"2.5.0"</code><code class="o">)</code></pre>

<p>Note the blank line between the <code>resolvers</code> and the <code>addSbtPlugin</code>.  In <em>.sbt</em> files, a blank line is required between statements.</p>

<p>Finally, set any global configurations (such as <code>withSource</code>) in <em>~/.sbt/0.13/global.sbt</em>.</p>
</section>













<section data-type="sect2" id="see-also-xqsjhdcl">
<h2>See Also</h2>

<p><a href="https://github.com/typesafehub/sbteclipse/wiki">There are other useful settings for <em>sbteclipse</em></a>. You’ll also find the latest version number for the plugin on that site.</p>

<p>The SBT <em>~/.sbt/</em> structure is described in the <a href="http://bit.ly/144HiaM">guide to using plugins</a> and in the <a href="http://bit.ly/19A3eAw">wiki page for global configuration</a>.</p>
</section>





</section>













<section data-type="sect1" id="idea">
<h1>Developing Using IntelliJ IDEA</h1>








<section data-type="sect2" id="problem-rWspF7iO">
<h2>Problem</h2>

<p>You want to use the IntelliJ IDEA development environment when writing your Lift application.<a data-type="indexterm" data-primary="Lift applications" data-secondary="IntelliJ IDEA development" id="id-aeCvSEF2FgiY"></a><a data-type="indexterm" data-primary="IntelliJ IDEA development environment" id="id-0nCEFGFqFYir"></a></p>
</section>













<section data-type="sect2" id="solution-wPsrIBi4">
<h2>Solution</h2>

<p>You need the Scala plugin for IntelliJ, and an SBT plugin to generate the IDEA project files.</p>

<p>The IntelliJ plugin you’ll need to install only once, and these instructions are for IntelliJ IDEA 13.  The details may vary between releases of the IDE, but the basic idea is to find the JetBrains Scala plugin, and download and install it.</p>

<p>From the "Welcome to IntelliJ IDEA" or "Quick Staert" screen, select "Configure" and then "Plugins." Select "Browse repositories…" In the search box, top right, type "Scala."  You’ll find on the left a number of matches: select "Scala."  On the right, you’ll see confirmation that this is the "Plugin for Scala language support" and the vendor is JetBrains, Inc.  Click the "Install Plugin" button, confirm you want to install, then "Close" the repository browser, and finally OK out of the plugins window. You’ll be prompted to restart IntelliJ IDEA.</p>

<p>With the IDE configured, you now need to include the SBT plugin inside your Lift project by adding the following to the file <em>projects/plugins.sbt</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">addSbtPlugin</code><code class="o">(</code><code class="s">"com.github.mpeltonen"</code> <code class="o">%</code> <code class="s">"sbt-idea"</code> <code class="o">%</code> <code class="s">"1.6.0"</code><code class="o">)</code></pre>

<p>Start SBT, and at the SBT prompt, create the IDEA project files by typing:</p>

<pre data-type="programlisting">gen-idea</pre>

<p>This will generate the <em>.idea</em> and <em>.iml</em> files that IntelliJ uses. Inside IntelliJ you can open the project from the "File" menu, picking "Open…" and then navigating to your project and selecting the directory.</p>

<p>To see live changes as you edit and save your work, run SBT in a separate Terminal window.  That is, start <em>sbt</em> from a Terminal window outside of IntelliJ and enter the following:</p>

<pre data-type="programlisting">~; container:start; container:reload /</pre>

<p>This behaviour of this command is described in <a data-type="xref" href="#texteditor">Developing Using a Text Editor</a>, but if you’re using JRebel (see <a data-type="xref" href="#jrebel">Incorporating JRebel</a>), then you just need to run <code>container:start</code> by itself.</p>

<p>Each time you compile or make the project, the container will pick up the changes, and you can see them by reloading your browser window.</p>
</section>













<section data-type="sect2" id="discussion-xqs1tEil">
<h2>Discussion</h2>

<p>By default, the <code>gen-idea</code> command will fetch source for dependent libraries. That means out of the box you can click through to Lift source code to explore it and learn more about the framework.</p>

<p>If you want to try the latest snapshot version of the plugin, you’ll need to include the snapshot repository in your <em>plugin.sbt</em> file:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">resolvers</code> <code class="o">+=</code> <code class="s">"Sonatype snapshots"</code> <code class="n">at</code>
  <code class="s">"http://oss.sonatype.org/content/repositories/snapshots/"</code></pre>

<p>Setting up the SBT IDEA plugin globally, for all SBT projects, is the same pattern as described for Eclipse in <a data-type="xref" href="#eclipse">Developing Using Eclipse</a>.</p>
</section>













<section data-type="sect2" id="see-also-Pas0hXi0">
<h2>See Also</h2>

<p><a href="https://github.com/mpeltonen/sbt-idea">The <em>sbt-idea</em> plugin</a> doesn’t have a configuration guide yet. One way to discover the features is to browse the release notes in the <em>notes</em> folder of that project.</p>

<p>JetBrains has a <a href="http://blog.jetbrains.com/scala/">blog for the Scala plugin</a> with feature news and tips.</p>
</section>





</section>













<section data-type="sect1" id="ViewH2">
<h1>Viewing the lift_proto H2 Database</h1>








<section data-type="sect2" id="problem-wPs4Fau4">
<h2>Problem</h2>

<p>You’re developing using the default <em>lift_proto.db</em> H2 database, and
you would like to use a tool to look at the tables.<a data-type="indexterm" data-primary="Lift applications" data-secondary="lift_proto.db H2 database for" id="id-LnCbFGFQFeuZ"></a><a data-type="indexterm" data-primary="lift_basic H2 database" id="id-AnCKIZFvF9uE"></a><a data-type="indexterm" data-primary="H2 Database Engine" id="id-W7CetLFYFmuB"></a><a data-type="indexterm" data-primary="tables, viewing in databases" id="id-e4CWhJFZFguG"></a><a data-type="indexterm" data-primary="databases" data-secondary="viewing" id="id-GnCzTgFbFQue"></a></p>
</section>













<section data-type="sect2" id="solution-xqs0IZul">
<h2>Solution</h2>

<p>Use the web interface included as part of H2. Here are the steps:</p>
<ol>
<li>
<p>Locate the H2 JAR file. For me, this was: <em>~/.ivy2/cache/com.h2database/h2/jars/h2-1.2.147.jar</em>.</p>
</li>
<li>
<p>Start the server from a Terminal window using the JAR file: <code>java -cp /path/to/h2-version.jar org.h2.tools.Server</code>.</p>
</li>
<li>
<p>This should launch your web browser, asking you to log in.</p>
</li>
<li>
<p>Select "Generic H2 Server" in "Saved Settings."</p>
</li>
<li>
<p>Enter <strong><code>jdbc:h2:/path/to/youapp/lift_proto.db;AUTO_SERVER=TRUE</code></strong> for "JDBC URL," adjusting the path for the location of your database, and adjusting the name of the database (<em>lift_proto.db</em>) if different in your <em>Boot.scala</em>.</p>
</li>
<li>
<p>Press "Connect" to view and edit your database.</p>
</li>

</ol>
</section>













<section data-type="sect2" id="discussion-PasetPu0">
<h2>Discussion</h2>

<p>The default Lift projects that include a database, such as <em>lift_basic</em>, use the H2 relational database, as it can be included as an SBT dependency and requires no external installation or configuration. It’s a fine product, although production deployments typically use standalone databases, such as PostgreSQL or MySQL.<a data-type="indexterm" data-primary="databases" data-secondary="alternative" id="id-W7CoFLFAtmuB"></a><a data-type="indexterm" data-primary="production deployments" data-secondary="databases for" id="id-e4CxIJFQtguG"></a></p>

<p>Even if you’re deploying to a non–H2 database, it may be useful to keep H2 around because it has an in-memory mode, which is great for unit tests. This means you can create a database in memory, and throw it away when your unit test ends.<a data-type="indexterm" data-primary="unit tests" data-secondary="H2's in-memory mode and" id="id-W7CESGIAtmuB"></a><a data-type="indexterm" data-primary="in-memory mode" id="id-e4CAF8IQtguG"></a></p>

<p>If you don’t like the web interface, the connection settings described in this recipe should give you the information you need to configure other SQL tools.</p>
</section>













<section data-type="sect2" id="see-also-OKsGhdub">
<h2>See Also</h2>

<p><a href="http://www.h2database.com">The H2 site</a> lists the features and configuration options for database engine.</p>

<p>If you’re using the console frequently, consider making it accessible from your Lift application in development node. This is described by Diego Medina in a <a href="https://fmpwizard.telegr.am/blog/lift-and-h2">blog post</a>.</p>

<p>The example Lift <a href="http://bit.ly/10iFg9Q">project</a> for <a data-type="xref" href="#Squeryl">Relational Database Persistence with Record and Squeryl</a> has the H2 console <span class="keep-together">enabled.</span></p>
</section>





</section>













<section data-type="sect1" id="snapshot">
<h1>Using the Latest Lift Build</h1>








<section data-type="sect2" id="problem-xqsZFOUl">
<h2>Problem</h2>

<p>You want to use the latest ("snapshot") build of Lift.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="latest build of" id="id-LnC7SGFQFxUZ"></a><a data-type="indexterm" data-primary="snapshot releases" id="id-AnCDFZFvF7UE"></a><a data-type="indexterm" data-primary="Lift Cookbook" data-secondary="software versions used in" id="id-W7CQILFYFlUB"></a></p>
</section>













<section data-type="sect2" id="solution-PaskIbU0">
<h2>Solution</h2>

<p>You need to make two changes to your <em>build.sbt</em> file. First, reference
the snapshot <span class="keep-together">repository:</span></p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">resolvers</code> <code class="o">+=</code> <code class="s">"snapshots"</code> <code class="n">at</code>
  <code class="s">"http://oss.sonatype.org/content/repositories/snapshots"</code></pre>

<p>Second, change the <code>liftVersion</code> in your build to be the latest version. For this example, let’s use the 3.0 snapshot version of Lift:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="s">"3.0-SNAPSHOT"</code></pre>

<p>Restarting SBT (or issuing a <code>reload</code> command) will trigger a download
of the latest build.</p>
</section>













<section data-type="sect2" id="discussion-OKsVtlUb">
<h2>Discussion</h2>

<p>Production releases of Lift (e.g., 2.5, 2.6), as well as milestone releases
(e.g., 2.6-M3) and release candidates (e.g., 2.6-RC1) are published
into a releases repository. When SBT downloads them, they are downloaded
once.<a data-type="indexterm" data-primary="production releases" id="id-W7CESLFAtlUB"></a><a data-type="indexterm" data-primary="milestone releases" id="id-e4CAFJFQtOUG"></a><a data-type="indexterm" data-primary="release candidates" id="id-GnC7IgFmtyUe"></a><a data-type="indexterm" data-primary="releases repository" id="id-DnCqtWFvtwUn"></a></p>

<p>Snapshot releases are different: they are the result of an automated
build, and change often. You can force SBT to resolve the latest
versions by running the command <code>clean</code> and then <code>update</code>.</p>
</section>













<section data-type="sect2" id="see-also-XQsXhZUL">
<h2>See Also</h2>

<p>To learn the detail of snapshot versions, dig into the <a href="http://bit.ly/11Nc1ub">Maven Complete Reference</a>.</p>
</section>





</section>













<section data-type="sect1" id="NewScala">
<h1>Using a New Version of Scala</h1>








<section data-type="sect2" id="problem-PasxFlC0">
<h2>Problem</h2>

<p>A new Scala version has just been released and you want to immediately
use it in your Lift project.<a data-type="indexterm" data-primary="Scala" data-secondary="changing versions of" id="id-AnCPSZFvFWCE"></a></p>
</section>













<section data-type="sect2" id="solution-OKsOIeCb">
<h2>Solution</h2>

<p>Providing that the Scala version is <em>binary compatible</em> with the latest
version used by Lift, you can change your build file to use the latest
version of Scala.<a data-type="indexterm" data-primary="binary compatibility" id="id-e4CAFJFqIWCG"></a><a data-type="indexterm" data-primary="Scala" data-secondary="binary compatibility in" id="id-GnC7IgFkIkCe"></a></p>

<p>For example, let’s assume your <em>build.sbt</em> file is set up to use Lift 2.6
with Scala 2.11.1:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scalaVersion</code> <code class="o">:=</code> <code class="s">"2.11.1"</code>

<code class="n">libraryDependencies</code> <code class="o">++=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="s">"2.6"</code>
  <code class="nc">Seq</code><code class="o">(</code>
    <code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-webkit"</code> <code class="o">%</code> <code class="n">liftVersion</code> <code class="o">%</code> <code class="s">"compile-&gt;default"</code>
  <code class="o">)</code>
<code class="o">}</code></pre>

<p>To use Scala 2.11.2, just change the value in <code>scalaVersion</code>.</p>
</section>













<section data-type="sect2" id="discussion-XQsbtdCL">
<h2>Discussion</h2>

<p>Dependencies have a particular naming convention.  For example, the <code>lift-webkit</code> library for Lift 2.6 is called <em>lift-webkit_2.11-2.6.jar</em>.  Normally, in <em>build.sbt</em> we simply refer to <code>"net.liftweb" %% "lift-webkit"</code>, and SBT turns that into the name of a file that can be downloaded.<a data-type="indexterm" data-primary="dependencies, naming conventions of" id="id-4nCrhYFNtlCl"></a><a data-type="indexterm" data-primary="names/naming" data-secondary="of dependencies" id="id-JnC0TlFDt2Cw"></a></p>

<p>If for any reason you need to control the dependency downloaded, you can drop the <code>%%</code> and use <code>%</code> instead:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scalaVersion</code> <code class="o">:=</code> <code class="s">"2.11.2"</code>

<code class="n">libraryDependencies</code> <code class="o">++=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="s">"2.6"</code>
  <code class="nc">Seq</code><code class="o">(</code>
    <code class="s">"net.liftweb"</code> <code class="o">%</code> <code class="s">"lift-webkit_2.11"</code> <code class="o">%</code> <code class="n">liftVersion</code> <code class="o">%</code> <code class="s">"compile-&gt;default"</code>
  <code class="o">)</code>
<code class="o">}</code></pre>

<p>What we’ve done here is explicitly specified we want the 2.11 Scala version for Lift.  This is the difference between using <code>%%</code> and <code>%</code> in a
dependency: with <code>%%</code> you do not specify the Scala version, as SBT will append
the <code>scalaVersion</code> number automatically; with <em>%</em> this automatic change is not made,
so we have to manually specify more details for the name of the library.</p>

<p>Please note this only works for minor releases of Scala: major releases
break compatibility.  For example, Scala 2.10.1 is compatible with Scala 2.10.2 but not 2.11.</p>
</section>













<section data-type="sect2" id="see-also-jWskh9CE">
<h2>See Also</h2>

<p>Binary compatibility in Scala is discussed on the <a href="http://article.gmane.org/gmane.comp.lang.scala.user/39290">Scala user mailing list</a>.<a data-type="indexterm" data-primary="binary compatibility" id="id-DnCaFWFMhnCn"></a><a data-type="indexterm" data-primary="Scala" data-secondary="binary compatibility in" id="id-kVCAIpFQhPCX"></a></p>

<p><a href="http://bit.ly/163xPlx">The SBT Library Dependencies page</a> describes how SBT manages version numbers.</p>

<p><a data-type="xref" href="#snapshot">Using the Latest Lift Build</a> describes how to use a snapshot version of Lift.</p>
</section>





</section>







</section>














<section data-type="chapter" id="HTML">
<h1>HTML</h1>


<p>Generating HTML is often a major component of web applications.  This chapter is concerned with Lift’s <em>View First</em> approach and use of <em>CSS Selectors</em>.  Later chapters focus more specifically on form processing, REST web services, JavaScript, Ajax, and Comet.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="view first approach of" id="id-7nCEIgFp"></a><a data-type="indexterm" data-primary="view first approach" data-secondary="CSS selectors and" id="id-EnCmtMF7"></a><a data-type="indexterm" id="ix_LAhtml" data-primary="Lift applications" data-secondary="HTML generation"></a></p>

<p>Code for this chapter is at <a href="https://github.com/LiftCookbook/cookbook_html"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_html</em></a>.</p>






<section data-type="sect1" id="TestingAndDebuggingSelectors">
<h1>Testing and Debugging CSS Selectors</h1>








<section data-type="sect2" id="problem-zVskFvtj">
<h2>Problem</h2>

<p>You want to explore or debug CSS selectors interactively.<a data-type="indexterm" data-primary="CSS selectors" data-secondary="testing/debugging" id="id-QnCkSXFjF0ta"></a><a data-type="indexterm" data-primary="interactive development, CSS selector debugging" id="id-bGCgF2FLFgtn"></a></p>
</section>













<section data-type="sect2" id="solution-yDsrIktP">
<h2>Solution</h2>

<p>You can use the Scala REPL to run your CSS selectors.<a data-type="indexterm" data-primary="Scala" data-secondary="REPL CSS selector testing" id="id-bGCmS2FaIgtn"></a></p>

<p>Here’s an example where we test out a CSS selector that adds an <code>href</code> attribute to a link.
Start from within SBT and use the <code>console</code> command to get into the REPL:</p>

<pre data-type="programlisting">&gt; console
[info] Starting scala interpreter...
[info]
Welcome to Scala version 2.9.1.final
Type in expressions to have them evaluated.
Type :help for more information.</pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="k">val</code> <code class="n">f</code> <code class="k">=</code> <code class="s">"a [href]"</code> <code class="o">#&gt;</code> <code class="s">"http://example.org"</code>
<code class="n">f</code><code class="k">:</code> <code class="kt">net.liftweb.util.CssSel</code> <code class="o">=</code>
  <code class="o">(</code><code class="nc">Full</code><code class="o">(</code><code class="n">a</code> <code class="o">[</code><code class="kt">href</code><code class="o">]),</code> <code class="nc">Full</code><code class="o">(</code><code class="nc">ElemSelector</code><code class="o">(</code><code class="n">a</code><code class="o">,</code><code class="nc">Full</code><code class="o">(</code><code class="nc">AttrSubNode</code><code class="o">(</code><code class="n">href</code><code class="o">)))))</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="k">val</code> <code class="n">in</code> <code class="k">=</code> <code class="o">&lt;</code><code class="n">a</code><code class="o">&gt;</code><code class="n">click</code> <code class="n">me</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="n">in</code><code class="k">:</code> <code class="kt">scala.xml.Elem</code> <code class="o">=</code> <code class="o">&lt;</code><code class="n">a</code><code class="o">&gt;</code><code class="n">click</code> <code class="n">me</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">(</code><code class="n">in</code><code class="o">)</code>
<code class="n">res0</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=</code>
  <code class="nc">NodeSeq</code><code class="o">(&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"http://example.org"</code><code class="o">&gt;</code><code class="n">click</code> <code class="n">me</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;)</code></pre>

<p>The <code>Helpers._</code> import brings in the CSS selector functionality, which we then exercise by creating a selector, <code>f</code>, calling it with a very simple template, <code>in</code>, and observing the result, <code>res0</code>.</p>
</section>













<section data-type="sect2" id="discussion-V7s2tjtw">
<h2>Discussion</h2>

<p>CSS selector transforms are one of the distinguishing features of Lift. They succinctly describe a node in your template (lefthand side) and give a replacement (operation, the righthand side). They do take a little while to get used to, so being able to test them at the Scala REPL is useful.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="CSS selector transforms" id="id-KnCnSeFqtetb"></a></p>

<p>It may help to know that prior to CSS selectors, Lift snippets were typically defined in terms
of a function that took a <code>NodeSeq</code> and returned a <code>NodeSeq</code>, often via a method called <code>bind</code>. Lift would take your template, which would be the input <code>NodeSeq</code>, apply the function, and return a new <code>NodeSeq</code>.  You won’t see that usage so often anymore, but the principle is the same.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="snippets in" id="id-e4CpT8IQtat2"></a><a data-type="indexterm" data-primary="snippets" id="id-GnCycjImtnt7"></a></p>

<p>The CSS selector functionality in Lift gives you a <code>CssSel</code> function,
which is <code>NodeSeq =&gt; NodeSeq</code>. We exploit this in the previous example by constructing an input
<code>NodeSeq</code> (called <code>in</code>), then creating a CSS function (called <code>f</code>).  Because we know that <code>CssSel</code>
is defined as a <code>NodeSeq =&gt; NodeSeq</code>, the natural way to execute the selector is to supply
the <code>in</code> as a parameter, and this gives us the answer, <code>res0</code>.</p>

<p>If you use an IDE that supports a <em>worksheet</em>, which both Eclipse and IntelliJ IDEA do, then you can also run transformations in a worksheet.</p>
</section>













<section data-type="sect2" id="see-also-rWsZhNtz">
<h2>See Also</h2>

<p>The syntax for selectors is best described in <a href="http://simply.liftweb.net/"><em>Simply Lift</em></a>.</p>

<p>See <a data-type="xref" href="#eclipse">Developing Using Eclipse</a> and <a data-type="xref" href="#idea">Developing Using IntelliJ IDEA</a> for how to work with Eclipse and IntelliJ IDEA.</p>
</section>





</section>













<section data-type="sect1" id="SequencingSelectorOps">
<h1>Sequencing CSS Selector Operations</h1>








<section data-type="sect2" id="problem-yDsyFZhP">
<h2>Problem</h2>

<p>You want your CSS selector binding to apply to the results of earlier
binding expressions.<a data-type="indexterm" data-primary="CSS selectors" data-secondary="applying to earlier expressions" id="id-bGCmS2FLFmhn"></a></p>
</section>













<section data-type="sect2" id="solution-V7sQIwhw">
<h2>Solution</h2>

<p>Use <code>andThen</code> rather than <code>&amp;</code> to compose your selector expressions.<a data-type="indexterm" data-primary="andThen selector expressions" id="id-0nClIGFPIKh8"></a><a data-type="indexterm" data-primary="&amp; (combining) selectors" id="id-LnCvtGFxI7hr"></a></p>

<p>For example, suppose we want to replace <code>&lt;div id="foo"/&gt;</code> with
<code>&lt;div id="bar"&gt;bar content&lt;/div&gt;</code> but for some reason we need to
generate the <code>bar</code> div as a separate step in the selector expression:</p>

<pre data-type="programlisting">sbt&gt; console
[info] Starting scala interpreter...
[info]
Welcome to Scala version 2.9.1.final (Java 1.7.0_05).
Type in expressions to have them evaluated.
Type :help for more information.</pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"#foo"</code> <code class="o">#&gt;</code> <code class="o">&lt;</code><code class="n">div</code> <code class="n">id</code><code class="o">=</code><code class="s">"bar"</code><code class="o">/&gt;</code> <code class="n">andThen</code> <code class="s">"#bar *"</code> <code class="o">#&gt;</code> <code class="s">"bar content"</code>
<code class="n">render</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=&gt;</code> <code class="n">scala</code><code class="o">.</code><code class="n">xml</code><code class="o">.</code><code class="nc">NodeSeq</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="n">render</code><code class="o">(&lt;</code><code class="n">div</code> <code class="n">id</code><code class="o">=</code><code class="s">"foo"</code><code class="o">/&gt;)</code>
<code class="n">res0</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=</code> <code class="nc">NodeSeq</code><code class="o">(&lt;</code><code class="n">div</code> <code class="n">id</code><code class="o">=</code><code class="s">"bar"</code><code class="o">&gt;</code><code class="n">bar</code> <code class="n">content</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;)</code></pre>
</section>













<section data-type="sect2" id="discussion-rWswtEhz">
<h2>Discussion</h2>

<p>When using <code>&amp;</code>, think of the CSS selectors as always applying to the
original template, no matter what other expressions you are combining.
This is because <code>&amp;</code> is aggregating the selectors together before applying them. In contrast, <code>andThen</code> is
a method of all Scala functions that composes two functions together, with the first being
called before the second.</p>

<p>Compare the previous example if we change the <code>andThen</code> to
<code>&amp;</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"#foo"</code> <code class="o">#&gt;</code> <code class="o">&lt;</code><code class="n">div</code> <code class="n">id</code><code class="o">=</code><code class="s">"bar"</code> <code class="o">/&gt;</code> <code class="o">&amp;</code> <code class="s">"#bar *"</code> <code class="o">#&gt;</code> <code class="s">"bar content"</code>
<code class="n">render</code><code class="k">:</code> <code class="kt">net.liftweb.util.CssSel</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="n">render</code><code class="o">(&lt;</code><code class="n">div</code> <code class="n">id</code><code class="o">=</code><code class="s">"foo"</code><code class="o">/&gt;)</code>
<code class="n">res1</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=</code> <code class="nc">NodeSeq</code><code class="o">(&lt;</code><code class="n">div</code> <code class="n">id</code><code class="o">=</code><code class="s">"bar"</code><code class="o">&gt;&lt;/</code><code class="n">div</code><code class="o">&gt;)</code></pre>

<p>The second expression will not match, as it is applied to the original
input of <code>&lt;div id="foo"/&gt;</code>—the selector of <code>#bar</code> won’t match on <code>id=foo</code>,
and so adds nothing to the results of <code>render</code>.</p>
</section>













<section data-type="sect2" id="see-also-wPsjhehm">
<h2>See Also</h2>

<p><a href="https://www.assembla.com/spaces/liftweb/wiki/Binding_via_CSS_Selectors">The Lift wiki page for CSS selectors</a> also describes this use of <code>andThen</code>.</p>
</section>





</section>













<section data-type="sect1" id="SetMetaTag">
<h1>Setting Meta Tag Contents</h1>








<section data-type="sect2" id="problem-V7spFDTw">
<h2>Problem</h2>

<p>You want to set the content of an HTML meta tag from a snippet.<a data-type="indexterm" data-primary="meta tag contents, setting" id="id-KnCnSeFbFOTb"></a><a data-type="indexterm" data-primary="snippets" id="id-aeCdFEF2FVT0"></a><a data-type="indexterm" data-primary="HTML" data-secondary="meta tags" id="id-0nClIGFqFzT8"></a><a data-type="indexterm" data-primary="CSS selectors" data-secondary="setting meta tag contents with" id="id-LnCvtGFQFkTr"></a></p>
</section>













<section data-type="sect2" id="solution-rWseIATz">
<h2>Solution</h2>

<p>Use the <code>@</code> CSS binding name selector. For example, given<a data-type="indexterm" data-primary="@ selector expressions" id="id-0nCEFGFPIzT8"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"keywords"</code> <code class="na">content=</code><code class="s">"words, here, please"</code> <code class="nt">/&gt;</code></pre>

<p>The following snippet code will update the value of the content
attribute:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">"@keywords [content]"</code> <code class="o">#&gt;</code> <code class="s">"words, we, really, want"</code></pre>
</section>













<section data-type="sect2" id="discussion-wPsDtoTm">
<h2>Discussion</h2>

<p>The <code>@</code> selector selects all elements with the given name. It’s useful in this case to change the <code>&lt;meta name="keyword"&gt;</code> tag, but you may also see it used elsewhere. For example, in an HTML form, you can select input fields such as <code>&lt;input name="address"&gt;</code> with <code>"@address"</code>.<a data-type="indexterm" data-primary="forms processing" data-secondary="HTML input fields" id="id-e4CWhJFQtxT2"></a></p>

<p>The <code>[content]</code> part is an example of a <em>replacement rule</em> that can follow a selector. That’s to say, it’s not specific to the <code>@</code> selector and can be used with other selectors.  In this example, it replaces the value of the attribute called "content."  If the meta tag had no "content" attribute, it would be added.<a data-type="indexterm" data-primary="replacement rules" id="id-e4CLt8IQtxT2"></a><a data-type="indexterm" data-primary="attributes" id="id-GnCEhjImtgT7"></a></p>

<p>There are two other replacement rules useful for manipulating attributes:</p>

<ul>
<li>
<p><code>[content!]</code> to remove an attribute with a matching value.</p>
</li>
<li>
<p><code>[content+]</code> to append to the value.</p>
</li>
</ul>

<p>Examples of these would be:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="k">val</code> <code class="n">in</code> <code class="k">=</code> <code class="o">&lt;</code><code class="n">meta</code> <code class="n">name</code><code class="o">=</code><code class="s">"keywords"</code> <code class="n">content</code><code class="o">=</code><code class="s">"words, here, please"</code> <code class="o">/&gt;</code>
<code class="n">in</code><code class="k">:</code> <code class="kt">scala.xml.Elem</code> <code class="o">=</code> <code class="o">&lt;</code><code class="n">meta</code> <code class="n">name</code><code class="o">=</code><code class="s">"keywords"</code> <code class="n">content</code><code class="o">=</code><code class="s">"words, here, please"</code><code class="o">&gt;&lt;/</code><code class="n">meta</code><code class="o">&gt;</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="k">val</code> <code class="n">remove</code> <code class="k">=</code> <code class="s">"@keywords [content!]"</code> <code class="o">#&gt;</code> <code class="s">"words, here, please"</code>
<code class="n">remove</code><code class="k">:</code> <code class="kt">net.liftweb.util.CssSel</code> <code class="o">=</code> <code class="nc">CssBind</code><code class="o">(</code><code class="nc">Full</code><code class="o">(</code><code class="nd">@keywords</code> <code class="o">[</code><code class="kt">content!</code><code class="o">]),</code>
  <code class="nc">Full</code><code class="o">(</code><code class="nc">NameSelector</code><code class="o">(</code><code class="n">keywords</code><code class="o">,</code><code class="nc">Full</code><code class="o">(</code><code class="nc">AttrRemoveSubNode</code><code class="o">(</code><code class="n">content</code><code class="o">)))))</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="n">remove</code><code class="o">(</code><code class="n">in</code><code class="o">)</code>
<code class="n">res0</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=</code> <code class="nc">NodeSeq</code><code class="o">(&lt;</code><code class="n">meta</code> <code class="n">name</code><code class="o">=</code><code class="s">"keywords"</code><code class="o">&gt;&lt;/</code><code class="n">meta</code><code class="o">&gt;)</code></pre>

<p>and:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">val</code> <code class="n">add</code> <code class="k">=</code> <code class="s">"@keywords [content+]"</code> <code class="o">#&gt;</code> <code class="s">", thank you"</code>
<code class="n">add</code><code class="k">:</code> <code class="kt">net.liftweb.util.CssSel</code> <code class="o">=</code> <code class="nc">CssBind</code><code class="o">(</code><code class="nc">Full</code><code class="o">(</code><code class="nd">@keywords</code> <code class="o">[</code><code class="kt">content+</code><code class="o">]),</code>
  <code class="nc">Full</code><code class="o">(</code><code class="nc">NameSelector</code><code class="o">(</code><code class="n">keywords</code><code class="o">,</code><code class="nc">Full</code><code class="o">(</code><code class="nc">AttrAppendSubNode</code><code class="o">(</code><code class="n">content</code><code class="o">)))))</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="n">add</code><code class="o">(</code><code class="n">in</code><code class="o">)</code>
<code class="n">res1</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=</code> <code class="nc">NodeSeq</code><code class="o">(&lt;</code><code class="n">meta</code> <code class="n">content</code><code class="o">=</code><code class="s">"words, here, please, thank you"</code>
  <code class="n">name</code><code class="o">=</code><code class="s">"keywords"</code><code class="o">&gt;&lt;/</code><code class="n">meta</code><code class="o">&gt;)</code></pre>










<section data-type="sect3" id="appending-to-a-class-attribute-g0sAUBtOTW">
<h3>Appending to a class attribute</h3>

<p>Although not directly relevant to <code>meta</code> tags, you should be aware that there is one convenient special case for appending to an attribute. If the attribute is <code>class</code>, a space is added together with your class value.<a data-type="indexterm" data-primary="class attributes" id="id-ZbCnIMFjUrtXTn"></a> As a demonstration of that, here’s an example of appending a class called <code>btn-primary</code> to a <code>div</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"div [class+]"</code> <code class="o">#&gt;</code> <code class="s">"btn-primary"</code>
<code class="n">render</code><code class="k">:</code> <code class="kt">net.liftweb.util.CssSel</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="n">render</code><code class="o">(&lt;</code><code class="n">div</code> <code class="n">class</code><code class="o">=</code><code class="s">"btn"</code><code class="o">/&gt;)</code>
<code class="n">res0</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=</code> <code class="nc">NodeSeq</code><code class="o">(&lt;</code><code class="n">div</code> <code class="n">class</code><code class="o">=</code><code class="s">"btn btn-primary"</code><code class="o">&gt;&lt;/</code><code class="n">div</code><code class="o">&gt;)</code></pre>
</section>



</section>













<section data-type="sect2" id="see-also-xqsjhnTE">
<h2>See Also</h2>

<p>The syntax for selectors is best described in <a href="http://simply.liftweb.net/"><em>Simply Lift</em></a>.</p>

<p>See <a data-type="xref" href="#TestingAndDebuggingSelectors">Testing and Debugging CSS Selectors</a> for how to run selectors from the REPL.<a data-type="indexterm" data-primary="CSS selectors" data-secondary="syntax for" id="id-W7CoFGIDhQTa"></a></p>
</section>





</section>













<section data-type="sect1" id="SetPageTitle">
<h1>Setting the Page Title</h1>








<section data-type="sect2" id="problem-rWspFqcz">
<h2>Problem</h2>

<p>You want to set the <code>&lt;title&gt;</code> of the page from a Lift snippet.<a data-type="indexterm" data-primary="element selectors" id="id-0nCEFGFqFDc8"></a><a data-type="indexterm" data-primary="page titles" id="id-LnCNIGFQF8cr"></a><a data-type="indexterm" data-primary="titles, page titles" id="id-AnCVtZFvFVca"></a><a data-type="indexterm" data-primary="snippets" id="id-W7CwhLFYFJca"></a><a data-type="indexterm" data-primary="names/naming" data-secondary="page titles" id="id-e4CpTJFZFmc2"></a></p>
</section>













<section data-type="sect2" id="solution-wPsrIncm">
<h2>Solution</h2>

<p>Select the content of the <code>title</code> element and replace it with the
text you want:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">"title *"</code> <code class="o">#&gt;</code> <code class="s">"I am different"</code></pre>

<p>Assuming you have a <code>&lt;title&gt;</code> tag in your template, this will
result in:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;title&gt;</code>I am different<code class="nt">&lt;/title&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-xqs1tdcE">
<h2>Discussion</h2>

<p>This example uses an element selector, which picks out tags in the HTML template and replaces the content.  Notice that we are using <code>"title *"</code> to select the <em>content</em> of the <code>title</code> tag. If we had left off the <code>*</code>, the entire <code>title</code> tag would have been replaced with text.</p>

<p>As an alternative, it is also possible to set the page title from the contents of <code>SiteMap</code>,
meaning the title used will be the title you’ve assigned to the page in
the site map.  To do that, make use of <code>Menu.title</code> in your template directly:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;title</code> <code class="na">data-lift=</code><code class="s">"Menu.title"</code><code class="nt">&gt;&lt;/title&gt;</code></pre>

<p>The <code>Menu.title</code> code appends to any existing text in the title.
This means the following will have the phrase <code>"Site Title - "</code> in the
title, followed by the page title:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;title</code> <code class="na">data-lift=</code><code class="s">"Menu.title"</code><code class="nt">&gt;</code>Site Title - <code class="nt">&lt;/title&gt;</code></pre>

<p>If you need more control, you can of course bind on <code>&lt;title&gt;</code> using a
regular snippet. This example uses a custom snippet to put the site
title after the page title:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;title</code> <code class="na">data-lift=</code><code class="s">"MyTitle"</code><code class="nt">&gt;&lt;/title&gt;</code></pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">MyTitle</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">&lt;</code><code class="n">title</code><code class="o">&gt;&lt;</code><code class="n">lift</code><code class="k">:</code><code class="kt">Menu.title</code> <code class="kt">/&gt;</code> <code class="kt">-</code> <code class="kt">Site</code> <code class="kt">Title&lt;/title&gt;</code>
<code class="o">}</code></pre>

<p>Notice that our snippet is returning another snippet, <code>&lt;lift:Menu.title/&gt;</code>.  This is a perfectly normal thing to do in Lift, and snippet invocations returned from snippets will be processed by Lift as normal.</p>
</section>













<section data-type="sect2" id="see-also-Pas0hLcx">
<h2>See Also</h2>

<p><a data-type="xref" href="#SnippetNotFound">Snippet Not Found When Using HTML5</a> describes the different ways to reference a snippet, such as <code>data-lift</code> and <code>&lt;lift: ... /&gt;</code>.</p>

<p>At <a href="https://www.assembla.com/spaces/liftweb/wiki/SiteMap">the Assembla website</a>, there’s more about <code>SiteMap</code> and the <code>Menu</code> snippets.</p>
</section>





</section>













<section data-type="sect1" id="ConditionalIncludes">
<h1>HTML Conditional Comments</h1>








<section data-type="sect2" id="problem-wPs4FBim">
<h2>Problem</h2>

<p>You want to make use of Internet Explorer HTML conditional comments<a data-type="indexterm" data-primary="HTML" data-secondary="conditional comments" id="id-0nCXSGFqFYi8"></a><a data-type="indexterm" data-primary="Internet Explorer, conditional comments" id="id-LnCbFGFQFMir"></a><a data-type="indexterm" data-primary="templates" data-secondary="using IE HTML conditional comments in" id="id-AnCKIZFvFoia"></a><a data-type="indexterm" data-primary="conditional comments" id="id-W7CetLFYFKia"></a> in your <span class="keep-together">templates.</span></p>
</section>













<section data-type="sect2" id="solution-xqs0IEiE">
<h2>Solution</h2>

<p>Put the markup in a snippet and include the snippet in your page or
template.<a data-type="indexterm" data-primary="snippets" id="id-LnC7SGFxIMir"></a></p>

<p>For example, suppose we want to include the HTML5 Shiv (a.k.a. HTML5 Shim) JavaScript so we can use HTML5
elements with legacy IE browsers.  To do that, our snippet would be<a data-type="indexterm" data-primary="browsers" data-secondary="using legacy" id="id-AnCPS1IYIoia"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">scala.xml.Unparsed</code>

<code class="k">object</code> <code class="nc">Html5Shiv</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="nc">Unparsed</code><code class="o">(</code><code class="s">"""&lt;!--[if lt IE 9]&gt;</code>
<code class="s">    &lt;script src="http://html5shim.googlecode.com/svn/trunk/html5.js"&gt;</code>
<code class="s">    &lt;/script&gt;&lt;![endif]--&gt;"""</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>We would then reference the snippet in the <code>&lt;head&gt;</code> of a page, perhaps even in
all pages via <em>templates-hidden/default.html</em>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">data-lift=</code><code class="s">"Html5Shiv"</code><code class="nt">&gt;&lt;/script&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-PasetXix">
<h2>Discussion</h2>

<p>The HTML5 parser used by Lift does not carry comments from the source
through to the rendered page. If you just tried to paste the <em>html5shim</em> markup into
your template you’d find it missing from the rendered page.<a data-type="indexterm" data-primary="HTML5" data-secondary="parser" id="id-W7CoFLFAtKia"></a></p>

<p>We deal with this by generating unparsed markup from a snippet. If you’re looking at
<code>Unparsed</code> and are worried, your instincts are correct.  Normally, Lift would cause the
markup to be escaped, but in this case, we really do want
unparsed XML content (the comment tag) included in the output.<a data-type="indexterm" data-primary="unparsed XML content" id="id-e4CAF8IQtri2"></a></p>

<p>If you find you’re using IE conditional comments frequently, you may want to create a more general version of the snippet.
For example<a data-type="indexterm" data-primary="S." data-secondary="attr" id="id-e4CzSjtQtri2"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">xml.</code><code class="o">{</code><code class="nc">NodeSeq</code><code class="o">,</code> <code class="nc">Unparsed</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.S</code>

<code class="k">object</code> <code class="nc">IEOnly</code> <code class="o">{</code>

  <code class="k">private</code> <code class="k">def</code> <code class="n">condition</code> <code class="k">:</code> <code class="kt">String</code> <code class="o">=</code>
    <code class="n">S</code><code class="o">.</code><code class="n">attr</code><code class="o">(</code><code class="s">"cond"</code><code class="o">)</code> <code class="n">openOr</code> <code class="s">"IE"</code>

  <code class="k">def</code> <code class="n">render</code><code class="o">(</code><code class="n">ns</code><code class="k">:</code> <code class="kt">NodeSeq</code><code class="o">)</code> <code class="k">:</code> <code class="kt">NodeSeq</code> <code class="o">=</code>
    <code class="nc">Unparsed</code><code class="o">(</code><code class="s">"&lt;!--[if "</code> <code class="o">+</code> <code class="n">condition</code> <code class="o">+</code> <code class="s">"]&gt;"</code><code class="o">)</code> <code class="o">++</code> <code class="n">ns</code> <code class="o">++</code> <code class="nc">Unparsed</code><code class="o">(</code><code class="s">"&lt;![endif]--&gt;"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>It would be used like this:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"IEOnly"</code><code class="nt">&gt;</code>
  A div just for IE
<code class="nt">&lt;/div&gt;</code></pre>

<p>and produces output like this:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="c">&lt;!--[if IE]&gt;&lt;div&gt;</code>
<code class="c">  A div just for IE</code>
<code class="c">&lt;/div&gt;&lt;![endif]--&gt;</code></pre>

<p>Notice that the <code>condition</code> test defaults to <code>IE</code>, but first tries to look for an attribute called <code>cond</code>. This allows you to write:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"IEOnly?cond=lt+IE+9"</code><code class="nt">&gt;</code>
  You're using IE 8 or earlier
<code class="nt">&lt;/div&gt;</code></pre>

<p>The <code>+</code> symbol is the URL encoding for a space, resulting in:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="c">&lt;!--[if lt IE 9]&gt;&lt;div&gt;</code>
<code class="c">  You're using IE 8 or earlier</code>
<code class="c">&lt;/div&gt;&lt;![endif]--&gt;</code></pre>
</section>













<section data-type="sect2" id="see-also-OKsGhyi7">
<h2>See Also</h2>

<p>The <code>IEOnly</code> example is derived from a <a href="http://bit.ly/lift-ieonly">posting on the mailing list from Antonio Salazar Cardozo</a>.</p>

<p>The <em>html5shim</em> project can be downloaded from its <a href="http://bit.ly/11ltJBR">Google Code site</a>.</p>
</section>





</section>













<section data-type="sect1" id="PassThru">
<h1>Returning Snippet Markup Unchanged</h1>








<section data-type="sect2" id="problem-xqsZFZuE">
<h2>Problem</h2>

<p>You want a snippet to return the original markup associated with the
snippet invocation.<a data-type="indexterm" data-primary="snippets" id="id-LnC7SGFQFeur"></a><a data-type="indexterm" data-primary="PassThru transform" id="id-AnCDFZFvF9ua"></a></p>
</section>













<section data-type="sect2" id="solution-PaskIPux">
<h2>Solution</h2>

<p>Use the <code>PassThru</code> transform.</p>

<p>Suppose you have a snippet that performs a transform when some
condition is met, but if the condition is not met, you want the snippet to
return the original markup.</p>

<p>Starting with the original markup:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;h2&gt;</code>Pass Thru Example<code class="nt">&lt;/h2&gt;</code>

<code class="nt">&lt;p&gt;</code>There's a 50:50 chance of seeing "Try again" or "Congratulations!":<code class="nt">&lt;/p&gt;</code>

<code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"PassThruSnippet"</code><code class="nt">&gt;</code>
  Try again - this is the template content.
<code class="nt">&lt;/div&gt;</code></pre>

<p>We could leave it alone or change it with this snippet:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.PassThru</code>

<code class="k">import</code> <code class="nn">scala.util.Random</code>
<code class="k">import</code> <code class="nn">xml.Text</code>

<code class="k">class</code> <code class="nc">PassThruSnippet</code> <code class="o">{</code>

  <code class="k">private</code> <code class="k">def</code> <code class="n">fiftyFifty</code> <code class="k">=</code> <code class="nc">Random</code><code class="o">.</code><code class="n">nextBoolean</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">fiftyFifty</code><code class="o">)</code> <code class="s">"*"</code> <code class="o">#&gt;</code> <code class="nc">Text</code><code class="o">(</code><code class="s">"Congratulations! The content was changed"</code><code class="o">)</code>
    <code class="k">else</code> <code class="nc">PassThru</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="discussion-OKsVtdu7">
<h2>Discussion</h2>

<p><code>PassThru</code> is an <em>identity function</em> of type <code>NodeSeq =&gt; NodeSeq</code>. It returns the input it
is given<a data-type="indexterm" data-primary="identity functions" id="id-DnCqtWFvtaux"></a><a data-type="indexterm" data-primary="functions" data-secondary="identity" id="id-kVCvhpFDtXu4"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">PassThru</code> <code class="k">extends</code> <code class="nc">Function1</code><code class="o">[</code><code class="kt">NodeSeq</code>, <code class="kt">NodeSeq</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">apply</code><code class="o">(</code><code class="n">in</code><code class="k">:</code> <code class="kt">NodeSeq</code><code class="o">)</code><code class="k">:</code> <code class="kt">NodeSeq</code> <code class="o">=</code> <code class="n">in</code>
<code class="o">}</code></pre>

<p>A related example is <code>ClearNodes</code>, defined as:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">ClearNodes</code> <code class="k">extends</code> <code class="nc">Function1</code><code class="o">[</code><code class="kt">NodeSeq</code>, <code class="kt">NodeSeq</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">apply</code><code class="o">(</code><code class="n">in</code><code class="k">:</code> <code class="kt">NodeSeq</code><code class="o">)</code><code class="k">:</code> <code class="kt">NodeSeq</code> <code class="o">=</code> <code class="nc">NodeSeq</code><code class="o">.</code><code class="nc">Empty</code>
<code class="o">}</code></pre>

<p>The pattern of converting one <code>NodeSeq</code> to another is simple, but also powerful enough to get you out of most situations, as you can always arbitrarily rewrite the <code>NodeSeq</code>.</p>
</section>





</section>













<section data-type="sect1" id="SnippetNotFound">
<h1>Snippet Not Found When Using HTML5</h1>








<section data-type="sect2" id="problem-PasxFbUx">
<h2>Problem</h2>

<p>You’re using Lift with the HTML5 parser and one of your snippets is rendering with a "Class Not
Found" error.<a data-type="indexterm" data-primary="error messages" data-secondary="Class Not Found" id="id-AnCPSZFvF7Ua"></a><a data-type="indexterm" data-primary="Class Not Found error message" id="id-W7CoFLFYFlUa"></a><a data-type="indexterm" data-primary="HTML5" data-secondary="parser" id="id-e4CxIJFZFOU2"></a><a data-type="indexterm" data-primary="snippets" id="id-GnCPtgFbFyU7"></a> It even happens for <code>&lt;lift:HelloWorld.howdy /&gt;</code>.</p>
</section>













<section data-type="sect2" id="solution-OKsOIlU7">
<h2>Solution</h2>

<p>Switch to the designer-friendly snippet invocation mechanism. For example<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="as designer-friendly" id="id-W7CESLFBIlUa"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"HellowWorld.howdy"</code><code class="nt">&gt;&lt;/div&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-XQsbtZUP">
<h2>Discussion</h2>

<p>In this Cookbook, we use the HTML5 parser, which is set in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="c1">// Use HTML5 for rendering</code>
<code class="nc">LiftRules</code><code class="o">.</code><code class="n">htmlProperties</code><code class="o">.</code><code class="n">default</code><code class="o">.</code><code class="n">set</code><code class="o">(</code> <code class="o">(</code><code class="n">r</code><code class="k">:</code> <code class="kt">Req</code><code class="o">)</code> <code class="k">=&gt;</code>
  <code class="k">new</code> <code class="nc">Html5Properties</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">userAgent</code><code class="o">)</code> <code class="o">)</code></pre>

<p>The HTML5 parser and the traditional Lift XHTML parser have different
behaviours. In particular, the HTML5 parser converts elements and attribute names to lowercase when looking up snippets. This means Lift would take <code>&lt;lift:HelloWorld.howdy /&gt;</code> and look for a class called <code>helloworld</code> rather than <code>HelloWorld</code>, which would be the cause of the "Class Not Found" error.</p>

<p>Switching to the designer-friendly mechanism is the solution here, and you gain validating HTML as a bonus.</p>

<p>There are four popular ways of referencing a snippet:</p>
<dl>
<dt>As an HTML5 data attribute: <code>data-lift="MySnippet"</code></dt>
<dd>
<p>This is the style we use in this book, and is valid HTML5 markup.</p>
</dd>
<dt>Via a CSS class: <code>class="lift:MySnippet"</code></dt>
<dd>
<p>Also valid HTML5, but you must include the "lift" prefix for Lift to recognise this as a snippet.</p>
</dd>
<dt>Using the <code>lift</code> attribute, as in: <code>lift="MySnippet"</code></dt>
<dd>
<p>This won’t strictly validate against HTML5, but you may see it used.</p>
</dd>
<dt>The XHTML namespace version: <code>&lt;lift:MySnippet /&gt;</code></dt>
<dd>
<p>You’ll see the usage of this tag in templates declining because of the way it interacts with the HTML5 parser. However, it works just fine outside of a template, for example when embedding a snippet invocation in your server-side code (<a data-type="xref" href="#SetPageTitle">Setting the Page Title</a> includes an example of this for <code>Menu.title</code>).<a data-type="indexterm" data-primary="XHTML parser" id="id-PnCkIaSPi8cptGU7"></a></p>
</dd>
</dl>
</section>













<section data-type="sect2" id="see-also-jWskhzUk">
<h2>See Also</h2>

<p>The key differences between the XHTML and HTML5 parsers are outlined on <a href="http://bit.ly/lift-parsers">the mailing list</a>.</p>
</section>





</section>













<section data-type="sect1" id="AvoidAssetCaching">
<h1>Avoiding CSS and JavaScript Caching</h1>








<section data-type="sect2" id="problem-OKsLFeC7">
<h2>Problem</h2>

<p>You’ve modified CSS or JavaScript in your application, but web browsers
have cached your resources and are using the older versions. You’d like
to avoid this browser caching.<a data-type="indexterm" data-primary="browsers" data-secondary="avoiding caching" id="id-W7CESLFYFZCa"></a><a data-type="indexterm" data-primary="CSS caching" id="id-e4CAFJFZFWC2"></a><a data-type="indexterm" data-primary="JavaScript" data-secondary="caching" id="id-GnC7IgFbFkC7"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKIdCP">
<h2>Solution</h2>

<p>Add the <code>with-resource-id</code> attribute to script or link tags<a data-type="indexterm" data-primary="resource ID attribute" id="id-GnCZFgFkIkC7"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">data-lift=</code><code class="s">"with-resource-id"</code> <code class="na">src=</code><code class="s">"/myscript.js"</code>
 <code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;&lt;/script&gt;</code></pre>

<p>The addition of this attribute will cause Lift to append a <em>resource ID</em> to
your <code>src</code> (or <code>href</code>), and as this resource ID changes each time Lift
starts, it defeats browser caching.</p>

<p>The resultant HTML might be:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"/myscript.js?F619732897824GUCAAN=_"</code>
  <code class="na">type=</code><code class="s">"text/javascript"</code> <code class="nt">&gt;&lt;/script&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-jWsvt9Ck">
<h2>Discussion</h2>

<p>The random value that is appended to the resource is computed when your Lift application boots.  This means it should be stable between releases of your application.</p>

<p>If you need some other behaviour from <code>with-resource-id</code>, you can assign
a new function of type <code>String =&gt; String</code> to
<code>LiftRules.attachResourceId</code>. The default implementation, shown previously,
takes the resource name, <em>/myscript.js</em> in the example, and returns the
resource name with an ID appended.</p>

<p>You can also wrap a number of tags inside a
<code>&lt;lift:with-resource-id&gt;...&lt;lift:with-resource-id&gt;</code> block. However,
avoid doing this in the <code>&lt;head&gt;</code> of your page, as the HTML5 parser will
move the tags to be outside of the head section.</p>










<section data-type="sect3" id="working-with-proxies-g0sxhBtLCW">
<h3>Working with proxies</h3>

<p>Note that some proxies may choose not to cache resources with query
parameters at all. If that impacts you, it’s possible to code a custom resource ID method
to move the random resource ID out of the query parameter and into the path.</p>

<p>Here’s one approach to doing this. Rather than generate JavaScript and CSS links that look like <em>/assets/style.css?F61973</em>, we will generate <em>/cache/F61973/assets/style.css</em>. We will then will need to tell our container or web server to take requests
that look like this new format, and remove the <em>/cache/F61973/</em> part.</p>

<p>The code to change the way links are created:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.lib</code>

<code class="k">import</code> <code class="nn">net.liftweb.util._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http._</code>

<code class="k">object</code> <code class="nc">CustomResourceId</code> <code class="o">{</code>

 <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
  <code class="c1">// The random number we're using to avoid caching</code>
  <code class="k">val</code> <code class="n">resourceId</code> <code class="k">=</code> <code class="nc">Helpers</code><code class="o">.</code><code class="n">nextFuncName</code>

  <code class="c1">// Prefix with-resource-id links with "/cache/{resouceId}"</code>
  <code class="nc">LiftRules</code><code class="o">.</code><code class="n">attachResourceId</code> <code class="k">=</code> <code class="o">(</code><code class="n">path</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="o">{</code>
   <code class="s">"/cache/"</code> <code class="o">+</code> <code class="n">resourceId</code> <code class="o">+</code> <code class="n">path</code>
  <code class="o">}</code>

 <code class="o">}</code>
<code class="o">}</code></pre>

<p>This would be initialised in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">CustomResourceId</code><code class="o">.</code><code class="n">init</code><code class="o">()</code></pre>

<p>or you could just paste all the code into <em>Boot.scala</em>, if you prefer.</p>

<p>With the code in place, we can, for example, modify <em>templates-hidden/default.html</em> and add a resource ID class to jQuery:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">id=</code><code class="s">"jquery"</code> <code class="na">data-lift=</code><code class="s">"with-resource-id"</code>
  <code class="na">src=</code><code class="s">"/classpath/jquery.js"</code> <code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;&lt;/script&gt;</code></pre>

<p>At runtime, this would be rendered in HTML as:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code> <code class="na">id=</code><code class="s">"jquery"</code>
  <code class="na">src=</code><code class="s">"/cache/F352555437877UHCNRW/classpath/jquery.js"</code><code class="nt">&gt;&lt;/script&gt;</code></pre>

<p>Finally we need a way to rewrite URLs like this back to the original path. That is, remove the <em>/cache/…</em> part. There are a few ways to achieve this. If you’re using nginx or Apache in front of your Lift application, you can configure those web servers to perform the rewrite before it reaches Lift.</p>
</section>



</section>













<section data-type="sect2" id="see-also-2ksZhzCg">
<h2>See Also</h2>

<p><a href="http://bit.ly/14BfNYJ"><em class="hyperlink">http://bit.ly/14BfNYJ</em></a> shows the default implementation of <code>attachResourceId</code>.</p>

<p><a href="http://bit.ly/154phIM">Google’s "Optimize caching" notes</a> are a good source of information about browser <span class="keep-together">behaviour.</span></p>

<p>There is support for URL rewriting, described on the <a href="http://bit.ly/1abV4x2">Lift wiki</a>. Rewriting is used rarely, and only for special cases.  It’s not suitable for this recpie, as outlined in <a href="http://stackoverflow.com/a/17957509/154248">a posting to Stackoverflow</a>. Many problems that look like rewriting problems are better solved with a <a href="http://bit.ly/10iHiHb">Menu Param</a>.</p>

<p><a href="http://gruntjs.com/">Grunt</a> and similar tools can modify paths. Diego Medina’s post on <a href="http://blog.fmpwizard.com/blog/using-grunt-and-bowerwith-lift">Using Grunt and Bower with Lift</a> is a good starting point.</p>
</section>





</section>













<section data-type="sect1" id="AddToHead">
<h1>Adding to the Head of a Page</h1>








<section data-type="sect2" id="problem-XQspFwsP">
<h2>Problem</h2>

<p>You use a template for layout, but on one specific page you need to add
something to the <code>&lt;head&gt;</code> section.<a data-type="indexterm" data-primary="templates" data-secondary="adding to the head section" id="id-GnCZFgFbFWs7"></a><a data-type="indexterm" data-primary="head section, adding to" id="id-DnCXIWFwFxsx"></a><a data-type="indexterm" data-primary="snippets" id="id-kVCltpFLF2s4"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjInsk">
<h2>Solution</h2>

<p>Use the <code>head</code> snippet so Lift knows to merge the
contents with the <code>&lt;head&gt;</code> of your page. For example, suppose you have
the following contents in <em>templates-hidden/default.html</em>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code> <code class="na">xmlns:lift=</code><code class="s">"http://liftweb.net/"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;head&gt;</code>
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;&lt;/meta&gt;</code>
    <code class="nt">&lt;title</code> <code class="na">data-lift=</code><code class="s">"Menu.title"</code><code class="nt">&gt;</code>App: <code class="nt">&lt;/title&gt;</code>
    <code class="nt">&lt;script </code><code class="na">id=</code><code class="s">"jquery"</code> <code class="na">src=</code><code class="s">"/classpath/jquery.js"</code>
      <code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;&lt;/script&gt;</code>
    <code class="nt">&lt;script </code><code class="na">id=</code><code class="s">"json"</code> <code class="na">src=</code><code class="s">"/classpath/json.js"</code>
      <code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;&lt;/script&gt;</code>
 <code class="nt">&lt;/head&gt;</code>
 <code class="nt">&lt;body&gt;</code>
     <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"content"</code><code class="nt">&gt;</code>The main content will get bound here<code class="nt">&lt;/div&gt;</code>
 <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>Also suppose you have <em>index.html</em> on which you want to include <em>red-titles.css</em> to change the style of just this page.</p>

<p>Do so by including the CSS in the part of the page that will get processed, and mark it with the <code>head</code> snippet:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;html&gt;</code>
 <code class="nt">&lt;head&gt;</code>
   <code class="nt">&lt;title&gt;</code>Special CSS<code class="nt">&lt;/title&gt;</code>
 <code class="nt">&lt;/head&gt;</code>
 <code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;link</code> <code class="na">data-lift=</code><code class="s">"head"</code> <code class="na">rel=</code><code class="s">"stylesheet"</code>
       <code class="na">href=</code><code class="s">"red-titles.css"</code> <code class="na">type=</code><code class="s">"text/css"</code> <code class="nt">/&gt;</code>
    <code class="nt">&lt;h2&gt;</code>Hello<code class="nt">&lt;/h2&gt;</code>
  <code class="nt">&lt;/div&gt;</code>
 <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>Note that this <em>index.html</em> page is validated HTML5, and will produce a
result with the custom CSS inside the <code>&lt;head&gt;</code> tag, something like this:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;title&gt;</code>App:  Special CSS<code class="nt">&lt;/title&gt;</code>
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code>
    <code class="na">src=</code><code class="s">"/classpath/jquery.js"</code> <code class="na">id=</code><code class="s">"jquery"</code><code class="nt">&gt;&lt;/script&gt;</code>
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code>
    <code class="na">src=</code><code class="s">"/classpath/json.js"</code> <code class="na">id=</code><code class="s">"json"</code><code class="nt">&gt;&lt;/script&gt;</code>
  <code class="nt">&lt;link</code> <code class="na">rel=</code><code class="s">"stylesheet"</code> <code class="na">href=</code><code class="s">"red-titles.css"</code> <code class="na">type=</code><code class="s">"text/css"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;/head&gt;</code>
 <code class="nt">&lt;body&gt;</code>
   <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
     <code class="nt">&lt;h2&gt;</code>Hello<code class="nt">&lt;/h2&gt;</code>
   <code class="nt">&lt;/div&gt;</code>
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code> <code class="na">src=</code><code class="s">"/ajax_request/liftAjax.js"</code><code class="nt">&gt;&lt;/script&gt;</code>
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>
  <code class="c1">// &lt;![CDATA[</code>
  <code class="kd">var</code> <code class="nx">lift_page</code> <code class="o">=</code> <code class="s2">"F557573613430HI02U4"</code><code class="p">;</code>
  <code class="c1">// ]]&gt;</code>
  <code class="nt">&lt;/script&gt;</code>
 <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-2ksLtMsg">
<h2>Discussion</h2>

<p>If you find your tags not appearing in the <code>&lt;head&gt;</code> section, check that
the HTML in your template and page is valid HTML5.<a data-type="indexterm" data-primary="HTML5" data-secondary="markup issues" id="id-kVCEFpFDt2s4"></a></p>

<p>You can also use <code>&lt;lift:head&gt;...&lt;/lift:head&gt;</code> to wrap a number of
expressions, and will see <code>&lt;head_merge&gt;...&lt;/head_merge&gt;</code> used in the code
example as an alternative to <code>&lt;lift:head&gt;</code>.</p>

<p>Another variant you may see is <code>class="lift:head"</code>, as an alternative to <code>data-lift="head"</code>.</p>

<p>The <code>head</code> snippet is a built-in snippet, but otherwise no different from any snippet you might write.  What the snippet does is emit a <code>&lt;head&gt;</code> block, containing the elements you want in the head.  These can be <code>&lt;title&gt;</code>, <code>&lt;link&gt;</code>, <code>&lt;meta&gt;</code>, <code>&lt;style&gt;</code>, <code>&lt;script&gt;</code>, or <code>&lt;base&gt;</code> tags.  How does this <code>&lt;head&gt;</code> block produced by the <code>head</code> snippet end up inside the main <code>&lt;head&gt;</code> section of the page?  When Lift processes your template, it automatically merges all <code>&lt;head&gt;</code> tags into the main <code>&lt;head&gt;</code> section of the page.</p>

<p>You might suspect you can therefore put a plain old <code>&lt;head&gt;</code> section anywhere on your template. You can, but that would not necessarily be valid HTML5 markup.</p>

<p>There’s also <code>tail</code>, which works in a similar way, except anything marked with this snippet is moved to be just before the close of the <code>body</code> tag.</p>
</section>













<section data-type="sect2" id="see-also-pWsJhDsA">
<h2>See Also</h2>

<p><a data-type="xref" href="#JavaScriptTail">Move JavaScript to End of Page</a> describes how to move JavaScript to the end of the page with the <code>tail</code> snippet.</p>

<p>The <a href="http://validator.w3.org/">W3C HTML validator</a> is a useful tool for tracking down HTML markup issues that may cause problems with content being moved into the head of your page.</p>
</section>





</section>













<section data-type="sect1" id="Custom404">
<h1>Custom 404 Page</h1>








<section data-type="sect2" id="problem-jWslF7Hk">
<h2>Problem</h2>

<p>You want to show a customised "404" (not found) page.<a data-type="indexterm" data-primary="error messages" data-secondary="404 (not found) pages" id="id-GnCJSgFbFbH7"></a><a data-type="indexterm" data-primary="404 (not found) pages" id="id-DnCaFWFwFjHx"></a><a data-type="indexterm" data-primary="page not found (404 error) message" id="id-kVCAIpFLFwH4"></a><a data-type="indexterm" data-primary="not found messages" id="id-4nCPtYFVFqHa"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIgHg">
<h2>Solution</h2>

<p>In <em>Boot.scala</em>, add the following:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http._</code>

<code class="nc">LiftRules</code><code class="o">.</code><code class="n">uriNotFound</code><code class="o">.</code><code class="n">prepend</code><code class="o">(</code><code class="nc">NamedPF</code><code class="o">(</code><code class="s">"404handler"</code><code class="o">){</code>
  <code class="k">case</code> <code class="o">(</code><code class="n">req</code><code class="o">,</code><code class="n">failure</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="nc">NotFoundAsTemplate</code><code class="o">(</code><code class="nc">ParsePath</code><code class="o">(</code><code class="nc">List</code><code class="o">(</code><code class="s">"404"</code><code class="o">),</code><code class="s">"html"</code><code class="o">,</code><code class="kc">true</code><code class="o">,</code><code class="kc">false</code><code class="o">))</code>
<code class="o">})</code></pre>

<p>The file <em>src/main/webapp/404.html</em> will now be served for requests to
unknown <span class="keep-together">resources.</span></p>
</section>













<section data-type="sect2" id="discussion-pWswtYHA">
<h2>Discussion</h2>

<p>The <code>uriNotFound</code> Lift rule needs to return a <code>NotFound</code> in reply to a
<code>Req</code> and <code>Box[Failure]</code>. This allows you to customise the
response based on the request and the type of failure.</p>

<p>There are three types of <code>NotFound</code>:</p>
<dl>
<dt><code>NotFoundAsTemplate</code></dt>
<dd>
<p>Useful to invoke the Lift template processing
facilities from a <code>ParsePath</code></p>
</dd>
<dt><code>NotFoundAsResponse</code></dt>
<dd>
<p>Allows you to return a specific <code>LiftResponse</code></p>
</dd>
<dt><code>NotFoundAsNode</code></dt>
<dd>
<p>Wraps a <code>NodeSeq</code> for Lift to translate into a 404
response</p>
</dd>
</dl>

<p>In the example, we’re matching any not found situation, regardless of the request and the failure, and evaluating
this as a resource identified by <code>ParsePath</code>.  The path we’ve used is <em>/404.html</em>.</p>

<p>In case you’re wondering, the last two <code>true</code> and <code>false</code> arguments to <code>ParsePath</code>
indicate the path we’ve given is absolute and doesn’t end in a
slash.  <code>ParsePath</code> is a representation for a URI path, and exposing
if the path is absolute or ends in a slash are useful flags for matching on, but
in this case, they’re not relevant.</p>

<p>Be aware that 404 pages, when rendered this way, won’t have a location in the site map. That’s because we’ve not included the <em>404.html</em> file in the site map, and we don’t have to, because we’re rendering via <code>NotFoundAsTemplate</code> rather than sending a redirect to <span class="keep-together"><em>/404.html</em>.</span> However, this means that if you display an error page using a template that contains <code>Menu.builder</code> or similar (as <em>templates-hidden/default.html</em> does), you’ll see "No Navigation Defined."  In that case, you’ll probably want to use a different template on your 404 page.</p>

<p>As an alternative, you could include the 404 page in your site map but make it hidden when the site map is displayed via the <code>Menu.builder</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"404"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"404"</code> <code class="o">&gt;&gt;</code> <code class="nc">Hidden</code></pre>
</section>













<section data-type="sect2" id="see-also-o8sNhWHk">
<h2>See Also</h2>

<p><a data-type="xref" href="#CatchException">Catch Any Exception</a> shows how to catch any exception thrown from your code.</p>
</section>





</section>













<section data-type="sect1" id="CustomStatusPage">
<h1>Other Custom Status Pages</h1>








<section data-type="sect2" id="problem-2kslFqfg">
<h2>Problem</h2>

<p>You want to show a customised page for certain HTTP status codes.<a data-type="indexterm" data-primary="HTTP" data-secondary="status codes" id="id-DnC1SWFwFyfx"></a><a data-type="indexterm" data-primary="custom HTTP status pages" id="id-kVCEFpFLFQf4"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIrfA">
<h2>Solution</h2>

<p>Use <code>LiftRules.responseTransformers</code> to match against the response and
supply an alternative.</p>

<p>As an example, suppose we want to provide a custom page for 403
("Forbidden") statuses created in our Lift application.  Further, suppose that
this page might contain snippets so will need to pass through the Lift
rendering flow.<a data-type="indexterm" data-primary="403 (forbidden) statuses" id="id-4nCqSAIMIYfa"></a><a data-type="indexterm" data-primary="forbidden (403) status pages" id="id-JnCzFjIpIrfk"></a></p>

<p>To do this in <em>Boot.scala</em>, we define the <code>LiftResponse</code> we want to generate
and use the response when a 403 status is about to be produced by Lift<a data-type="indexterm" data-primary="S." data-secondary="session" id="id-ZbCnIltkIVfy"></a><a data-type="indexterm" data-primary="S." data-secondary="request" id="id-zdCbtvtpI0fX"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">my403</code> <code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">LiftResponse</code><code class="o">]</code> <code class="k">=</code>
  <code class="k">for</code> <code class="o">{</code>
    <code class="n">session</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">session</code>
    <code class="n">req</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">request</code>
    <code class="n">template</code> <code class="k">=</code> <code class="nc">Templates</code><code class="o">(</code><code class="s">"403"</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">)</code>
    <code class="n">response</code> <code class="k">&lt;-</code> <code class="n">session</code><code class="o">.</code><code class="n">processTemplate</code><code class="o">(</code><code class="n">template</code><code class="o">,</code> <code class="n">req</code><code class="o">,</code> <code class="n">req</code><code class="o">.</code><code class="n">path</code><code class="o">,</code> <code class="mi">403</code><code class="o">)</code>
  <code class="o">}</code> <code class="k">yield</code> <code class="n">response</code>

<code class="nc">LiftRules</code><code class="o">.</code><code class="n">responseTransformers</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="n">resp</code> <code class="k">if</code> <code class="n">resp</code><code class="o">.</code><code class="n">toResponse</code><code class="o">.</code><code class="n">code</code> <code class="o">==</code> <code class="mi">403</code> <code class="k">=&gt;</code> <code class="n">my403</code> <code class="n">openOr</code> <code class="n">resp</code>
  <code class="k">case</code> <code class="n">resp</code> <code class="k">=&gt;</code> <code class="n">resp</code>
<code class="o">}</code></pre>

<p>The file <em>src/main/webapp/403.html</em> will now be served for requests that
generate 403 status codes. Other non–403 responses are left untouched.</p>
</section>













<section data-type="sect2" id="discussion-o8sytOfk">
<h2>Discussion</h2>

<p><code>LiftRules.responseTransformers</code> allows you to supply
<code>LiftResponse =&gt; LiftResponse</code> functions to change a response right at the end
of the HTTP processing cycle. This is a very general mechanism: in this
example, we are matching on a status code, but we could match on anything
exposed by <code>LiftResponse</code>.</p>

<p>In the recipe, we respond with a template, but you may find
situations where other kinds of responses make sense, such as an <code>InMemoryResponse</code>.</p>

<p>You could even simplify the example to just this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">responseTransformers</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="n">resp</code> <code class="k">if</code> <code class="n">resp</code><code class="o">.</code><code class="n">toResponse</code><code class="o">.</code><code class="n">code</code> <code class="o">==</code> <code class="mi">403</code> <code class="k">=&gt;</code> <code class="nc">RedirectResponse</code><code class="o">(</code><code class="s">"/403.html"</code><code class="o">)</code>
  <code class="k">case</code> <code class="n">resp</code> <code class="k">=&gt;</code> <code class="n">resp</code>
<code class="o">}</code></pre>
<div data-type="note" id="id-ZdU9Tltzfo"><h6>Note</h6>
<p>In Lift 3, <code>responseTransformers</code> will be modified to be a partial function, meaning you’ll be able to leave off the final <code>case resp =&gt; resp</code> part of this example.</p>
</div>

<p>That redirect will work just fine, with the only downside that the HTTP status code sent back to the web browser won’t be a 403 code.</p>

<p>A more general approach, if you’re customising a number of pages, would be to define the status codes you want to
customise, create a page for each, and then match only on those pages:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">responseTransformers</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Customised</code><code class="o">(</code><code class="n">resp</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">resp</code>
  <code class="k">case</code> <code class="n">resp</code> <code class="k">=&gt;</code> <code class="n">resp</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Customised</code> <code class="o">{</code>

  <code class="c1">// The pages we have customised: 403.html and 500.html</code>
  <code class="k">val</code> <code class="n">definedPages</code> <code class="k">=</code> <code class="mi">403</code> <code class="o">::</code> <code class="mi">500</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">def</code> <code class="n">unapply</code><code class="o">(</code><code class="n">resp</code><code class="k">:</code> <code class="kt">LiftResponse</code><code class="o">)</code> <code class="k">:</code> <code class="kt">Option</code><code class="o">[</code><code class="kt">LiftResponse</code><code class="o">]</code> <code class="k">=</code>
    <code class="n">definedPages</code><code class="o">.</code><code class="n">find</code><code class="o">(</code><code class="k">_</code> <code class="o">==</code> <code class="n">resp</code><code class="o">.</code><code class="n">toResponse</code><code class="o">.</code><code class="n">code</code><code class="o">).</code><code class="n">flatMap</code><code class="o">(</code><code class="n">toResponse</code><code class="o">)</code></pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true">  <code class="k">def</code> <code class="n">toResponse</code><code class="o">(</code><code class="n">status</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code> <code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">LiftResponse</code><code class="o">]</code> <code class="k">=</code>
    <code class="k">for</code> <code class="o">{</code>
      <code class="n">session</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">session</code>
      <code class="n">req</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">request</code>
      <code class="n">template</code> <code class="k">=</code> <code class="nc">Templates</code><code class="o">(</code><code class="n">status</code><code class="o">.</code><code class="n">toString</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">)</code>
      <code class="n">response</code> <code class="k">&lt;-</code> <code class="n">session</code><code class="o">.</code><code class="n">processTemplate</code><code class="o">(</code><code class="n">template</code><code class="o">,</code> <code class="n">req</code><code class="o">,</code> <code class="n">req</code><code class="o">.</code><code class="n">path</code><code class="o">,</code> <code class="n">status</code><code class="o">)</code>
  <code class="o">}</code> <code class="k">yield</code> <code class="n">response</code>

<code class="o">}</code></pre>

<p>The convention in <code>Customised</code> is that we have an HTML file in <em>src/main/webapp</em> that matches
the status code we want to show, but of course you can change that by using a different
pattern in the argument to <code>Templates</code>.</p>

<p>One way to test the previous examples is to add the following to <em>Boot.scala</em> to
make all requests to <em>/secret</em> return a 403:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="nc">Protected</code> <code class="k">=</code> <code class="nc">If</code><code class="o">(()</code> <code class="k">=&gt;</code> <code class="kc">false</code><code class="o">,</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="nc">ForbiddenResponse</code><code class="o">(</code><code class="s">"No!"</code><code class="o">))</code>

<code class="k">val</code> <code class="n">entries</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code>
  <code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"Home"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"index"</code><code class="o">,</code>
  <code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"secret"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"secret"</code> <code class="o">&gt;&gt;</code> <code class="nc">Protected</code><code class="o">,</code>
  <code class="c1">// rest of your site map here...</code>
<code class="o">)</code></pre>

<p>If you request <em>/secret</em>, a 403 response will be triggered, which will match the response transformer showing you
the contents of the <em>403.html</em> template.</p>
</section>













<section data-type="sect2" id="see-also-g0sxhvfN">
<h2>See Also</h2>

<p><a data-type="xref" href="#Custom404">Custom 404 Page</a> explains the built-in support for custom 404 messages.</p>

<p><a data-type="xref" href="#CatchException">Catch Any Exception</a> shows how to catch any exception thrown from your code.</p>
</section>





</section>













<section data-type="sect1" id="LinksInNotice">
<h1>Links in Notices</h1>








<section data-type="sect2" id="problem-pWsqFESA">
<h2>Problem</h2>

<p>You want to include a clickable link in your <code>S.error</code>, <code>S.notice</code>, or
<code>S.warning</code> messages.<a data-type="indexterm" data-primary="links" data-secondary="clickable" id="id-9nCDtvFpFmSX"></a><a data-type="indexterm" data-primary="clickable links" id="id-ZbCBhMFXFjSy"></a><a data-type="indexterm" data-primary="error messages" data-secondary="clickable links in" id="id-zdCLTGFWFOSX"></a><a data-type="indexterm" data-primary="S." data-secondary="error" id="id-yYClcpF9FDSz"></a><a data-type="indexterm" data-primary="S." data-secondary="notice" id="id-VMCBirFXFWSz"></a><a data-type="indexterm" data-primary="S." data-secondary="warning messages" id="id-rjCmuYFKF1SM"></a></p>
</section>













<section data-type="sect2" id="solution-o8seIlSk">
<h2>Solution</h2>

<p>Include a <code>NodeSeq</code> containing a link in your notice:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">S</code><code class="o">.</code><code class="n">error</code><code class="o">(</code><code class="s">"checkPrivacyPolicy"</code><code class="o">,</code>
  <code class="o">&lt;</code><code class="n">span</code><code class="o">&gt;</code><code class="nc">See</code> <code class="n">our</code> <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"/policy"</code><code class="o">&gt;</code><code class="n">privacy</code> <code class="n">policy</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;&lt;/</code><code class="n">span</code><code class="o">&gt;)</code></pre>

<p>You might pair this with the following in your template:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;span</code> <code class="na">data-lift=</code><code class="s">"Msg?id=checkPrivacyPolicy"</code><code class="nt">&gt;&lt;/span&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-g0s1tJSN">
<h2>Discussion</h2>

<p>You may be more familiar with the <code>S.error(String)</code> signature of Lift notices than the versions
that take a <code>NodeSeq</code> as an argument, but the <code>String</code> versions just convert the <code>String</code> argument
to a <code>scala.xml.Text</code> kind of <code>NodeSeq</code>.</p>
</section>













<section data-type="sect2" id="see-also-q8sZhWSG">
<h2>See Also</h2>

<p>Lift notices are described on <a href="http://www.assembla.com/spaces/liftweb/wiki/Lift_Notices_and_Auto_Fadeout">the wiki</a>.</p>
</section>





</section>













<section data-type="sect1" id="DownloadLink">
<h1>Link to Download Data</h1>








<section data-type="sect2" id="problem-o8skFQFk">
<h2>Problem</h2>

<p>You want a button or a link that, when clicked, will trigger a download in the browser rather than visiting a page.<a data-type="indexterm" data-primary="browsers" data-secondary="downloads vs. visits" id="id-4nCqSYFVFPFa"></a><a data-type="indexterm" data-primary="clickable links" id="id-JnCzFlFNFxFk"></a><a data-type="indexterm" data-primary="downloads, triggering" id="id-9nCrIvFpF7FX"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2IeFN">
<h2>Solution</h2>

<p>Create a link using <code>SHtml.link</code>, provide a function to return a <code>LiftResponse</code>, and wrap the response in a <code>ResponseShortcutException</code>.</p>

<p>As an example, we will create a snippet that shows the user a poem and provides a link to download the poem as a text file.  The template for this snippet will present each line of the poem separated by a <code>&lt;br&gt;</code>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;h1&gt;</code>A poem<code class="nt">&lt;/h1&gt;</code>

<code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"DownloadLink"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;blockquote&gt;</code>
    <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"poem"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"line"</code><code class="nt">&gt;</code>line goes here<code class="nt">&lt;/span&gt;</code> <code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
    <code class="nt">&lt;/span&gt;</code>
  <code class="nt">&lt;/blockquote&gt;</code>
  <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">""</code><code class="nt">&gt;</code>download link here<code class="nt">&lt;/a&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>The snippet itself will render the poem and replace the download link with one that will send a
response that the browser will interpret as a file to download:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http._</code>
<code class="k">import</code> <code class="nn">xml.Text</code>

<code class="k">class</code> <code class="nc">DownloadLink</code> <code class="o">{</code></pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true">  <code class="k">val</code> <code class="n">poem</code> <code class="k">=</code>
    <code class="s">"Roses are red,"</code> <code class="o">::</code>
    <code class="s">"Violets are blue,"</code> <code class="o">::</code>
    <code class="s">"Lift rocks!"</code> <code class="o">::</code>
    <code class="s">"And so do you."</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="s">".poem"</code> <code class="o">#&gt;</code> <code class="n">poem</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">line</code> <code class="k">=&gt;</code> <code class="s">".line"</code> <code class="o">#&gt;</code> <code class="n">line</code><code class="o">)</code> <code class="o">&amp;</code>
    <code class="s">"a"</code> <code class="o">#&gt;</code> <code class="n">downloadLink</code>

  <code class="k">def</code> <code class="n">downloadLink</code> <code class="k">=</code>
    <code class="nc">SHtml</code><code class="o">.</code><code class="n">link</code><code class="o">(</code><code class="s">"/notused"</code><code class="o">,</code>
      <code class="o">()</code> <code class="k">=&gt;</code> <code class="k">throw</code> <code class="k">new</code> <code class="nc">ResponseShortcutException</code><code class="o">(</code><code class="n">poemTextFile</code><code class="o">),</code>
      <code class="nc">Text</code><code class="o">(</code><code class="s">"Download"</code><code class="o">)</code> <code class="o">)</code>

  <code class="k">def</code> <code class="n">poemTextFile</code> <code class="k">:</code> <code class="kt">LiftResponse</code> <code class="o">=</code>
    <code class="nc">InMemoryResponse</code><code class="o">(</code>
      <code class="n">poem</code><code class="o">.</code><code class="n">mkString</code><code class="o">(</code><code class="s">"\n"</code><code class="o">).</code><code class="n">getBytes</code><code class="o">(</code><code class="s">"UTF-8"</code><code class="o">),</code>
      <code class="s">"Content-Type"</code> <code class="o">-&gt;</code> <code class="s">"text/plain; charset=utf8"</code> <code class="o">::</code>
      <code class="s">"Content-Disposition"</code> <code class="o">-&gt;</code> <code class="s">"attachment; filename=\"poem.txt\""</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code>
      <code class="n">cookies</code><code class="k">=</code><code class="nc">Nil</code><code class="o">,</code> <code class="mi">200</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>Recall that <code>SHtml.link</code> generates a link and executes a function you supply before following the link.</p>

<p>The trick here is that wrapping the <code>LiftResponse</code> in a <code>ResponseShortcutException</code> will indicate
to Lift that the response is complete, so the page being linked to (in this case, <code>notused</code>) won’t be processed. The browser is happy: it has a response to the link the user clicked on, and will render it how it wants to, which in this case will probably be by saving the file to disk.</p>
</section>













<section data-type="sect2" id="discussion-q8svtNFG">
<h2>Discussion</h2>

<p><code>SHtml.link</code> works by generating a URL that Lift associates with the function you give it. On a page called <code>downloadlink</code>, the URL will look something like:</p>

<pre data-type="programlisting">downloadlink?F845451240716XSXE3G=_#notused</pre>

<p>When that link is followed, Lift looks up the function and executes it, before processing the linked-to resource. However, in this case, we are shortcutting the Lift pipeline by throwing this particular exception.  This is caught by Lift, and the response wrapped by the exception is taken as the final response from the request.<a data-type="indexterm" data-primary="request pipeline" data-secondary="shortcutting" id="id-zdCxSvtDtwFX"></a><a data-type="indexterm" data-primary="S." data-secondary="redirectTo" id="id-yYCyFktvtQFz"></a></p>

<p>This shortcutting is used by <code>S.redirectTo</code> via <code>ResponseShortcutException.redirect</code>. This companion object also defines <code>shortcutResponse</code>, which you can use like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.ResponseShortcutException._</code>

<code class="k">def</code> <code class="n">downloadLink</code> <code class="k">=</code>
  <code class="nc">SHtml</code><code class="o">.</code><code class="n">link</code><code class="o">(</code><code class="s">"/notused"</code><code class="o">,</code>
    <code class="o">()</code> <code class="k">=&gt;</code> <code class="o">{</code>
      <code class="n">S</code><code class="o">.</code><code class="n">notice</code><code class="o">(</code><code class="s">"The file was downloaded"</code><code class="o">)</code>
      <code class="k">throw</code> <code class="n">shortcutResponse</code><code class="o">(</code><code class="n">poemTextFile</code><code class="o">)</code>
    <code class="o">},</code>
    <code class="nc">Text</code><code class="o">(</code><code class="s">"Download"</code><code class="o">)</code> <code class="o">)</code></pre>

<p>We’ve included an <code>S.notice</code> to highlight that <code>throw shortcutResponse</code> will process Lift notices when the page next loads, whereas <code>throw new ResponseShortcutException</code> does not.  In this case, the notice will not appear when the user downloads the file, but it will be included the next time notices are shown, such as when the user navigates to another page.  For many situations, the difference is immaterial.<a data-type="indexterm" data-primary="S." data-secondary="notice" id="id-PnCetLcAtXF1"></a></p>

<p>This recipe has used Lift’s stateful features.  You can see how useful it is to be able to close over state (the poem), and offer the data for download from memory.  If you’ve created a report from a database, you can offer it as a download without having to regenerate the items from the database.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="stateful features of" id="id-wqC7SBiBtaFG"></a><a data-type="indexterm" data-primary="REST web services" data-secondary="and report generation" id="id-x1CZFEiYtrFe"></a><a data-type="indexterm" data-primary="reports, generating" id="id-PnCkIXiAtXF1"></a></p>

<p>However, in other situations you might want to avoid holding this data as a function on a link. In that case, you’ll want to create a REST service that returns a <code>LiftResponse</code>.</p>
</section>













<section data-type="sect2" id="see-also-1Ls9hZFM">
<h2>See Also</h2>

<p><a data-type="xref" href="#REST">REST</a> looks at REST-based services in Lift.</p>

<p><a data-type="xref" href="#RestStreamContent">Streaming Content</a> discusses <code>InMemoryResponse</code> and similar responses to return content to the browser.</p>

<p>For reports, <a href="http://poi.apache.org/">the Apache POI project</a> includes libraries for generating Excel files; and <a href="http://opencsv.sourceforge.net">OpenCSV</a> is a library for generating CSV files.</p>
</section>





</section>













<section data-type="sect1" id="TestingReq">
<h1>Test on a Req</h1>








<section data-type="sect2" id="problem-g0swF4IN">
<h2>Problem</h2>

<p>You want to be able to test a function that needs a <code>Req</code>.<a data-type="indexterm" data-primary="functions" data-secondary="testing of" id="id-9nCdFvFpFjIX"></a><a data-type="indexterm" data-primary="requests" data-secondary="creating mock" id="id-ZbCnIMFXF7Iy"></a><a data-type="indexterm" data-primary="mock requests" id="id-zdCbtGFWFyIX"></a></p>
</section>













<section data-type="sect2" id="solution-q8sGIwIG">
<h2>Solution</h2>

<p>Supply a mock request to Lift’s <code>MockWeb.testReq</code>, and run your test in the context of the <code>Req</code> supplied by <code>testReq</code>.</p>

<p>The first step is to add Lift’s Test Kit as a dependency to your project in <em>build.sbt</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">libraryDependencies</code> <code class="o">+=</code> <code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-testkit"</code> <code class="o">%</code> <code class="s">"2.5"</code> <code class="o">%</code> <code class="s">"test"</code></pre>

<p>To demonstrate how to use <code>testReq</code>, we will test a function that detects a Google crawler. Google identifies
crawlers via various <code>User-Agent</code> header values, so the function we want to test would look like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.lib</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.Req</code>

<code class="k">object</code> <code class="nc">RobotDetector</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">botNames</code> <code class="k">=</code>
    <code class="s">"Googlebot"</code> <code class="o">::</code>
    <code class="s">"Mediapartners-Google"</code> <code class="o">::</code>
    <code class="s">"AdsBot-Google"</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">def</code> <code class="n">known_?</code><code class="o">(</code><code class="n">ua</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">=</code>
    <code class="n">botNames</code><code class="o">.</code><code class="n">exists</code><code class="o">(</code><code class="n">ua</code> <code class="n">contains</code> <code class="k">_</code><code class="o">)</code>

  <code class="k">def</code> <code class="n">googlebot_?</code><code class="o">(</code><code class="n">r</code><code class="k">:</code> <code class="kt">Req</code><code class="o">)</code> <code class="k">:</code> <code class="kt">Boolean</code> <code class="o">=</code>
    <code class="n">r</code><code class="o">.</code><code class="n">header</code><code class="o">(</code><code class="s">"User-Agent"</code><code class="o">).</code><code class="n">exists</code><code class="o">(</code><code class="n">known_?</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>We have the list of magic <code>botNames</code> that Google sends as a user agent, and we define a check, <code>known_?</code>, that takes the user agent string and looks to see if any robot satisfies the condition of being contained in that user agent string.</p>

<p>The <code>googlebot_?</code> method is given a Lift <code>Req</code> object, and from this, we look up the header.  This evaluates to a <code>Box[String]</code>, as it’s possible there is no header. We find the answer by seeing if there exists in the <code>Box</code> a value that satisfies the <code>known_?</code> condition.</p>

<p>To test this, we create a user agent string, prepare a <code>MockHttpServletRequest</code> with the header, and use Lift’s <code>MockWeb</code> to turn the low-level request into a Lift <code>Req</code> for us to test with:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.lib</code>

<code class="k">import</code> <code class="nn">org.specs2.mutable._</code>
<code class="k">import</code> <code class="nn">net.liftweb.mocks.MockHttpServletRequest</code>
<code class="k">import</code> <code class="nn">net.liftweb.mockweb.MockWeb</code>

<code class="k">class</code> <code class="nc">SingleRobotDetectorSpec</code> <code class="k">extends</code> <code class="nc">Specification</code> <code class="o">{</code>

  <code class="s">"Google Bot Detector"</code> <code class="n">should</code> <code class="o">{</code>

    <code class="s">"spot a web crawler"</code> <code class="n">in</code> <code class="o">{</code>

      <code class="k">val</code> <code class="n">userAgent</code> <code class="k">=</code> <code class="s">"Mozilla/5.0 (compatible; Googlebot/2.1)"</code>

      <code class="c1">// Mock a request with the right header:</code>
      <code class="k">val</code> <code class="n">http</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">MockHttpServletRequest</code><code class="o">()</code>
      <code class="n">http</code><code class="o">.</code><code class="n">headers</code> <code class="k">=</code> <code class="nc">Map</code><code class="o">(</code><code class="s">"User-Agent"</code> <code class="o">-&gt;</code> <code class="nc">List</code><code class="o">(</code><code class="n">userAgent</code><code class="o">))</code>

      <code class="c1">// Test with a Lift Req:</code>
      <code class="nc">MockWeb</code><code class="o">.</code><code class="n">testReq</code><code class="o">(</code><code class="n">http</code><code class="o">)</code> <code class="o">{</code> <code class="n">r</code> <code class="k">=&gt;</code>
        <code class="nc">RobotDetector</code><code class="o">.</code><code class="n">googlebot_?</code><code class="o">(</code><code class="n">r</code><code class="o">)</code> <code class="n">must</code> <code class="n">beTrue</code>
      <code class="o">}</code>
    <code class="o">}</code>

  <code class="o">}</code>

<code class="o">}</code></pre>

<p>Running this from SBT with the <code>test</code> command would produce:</p>

<pre data-type="programlisting">[info] SingleRobotDetectorSpec
[info]
[info] Google Bot Detector should
[info] + spot a web crawler
[info]
[info] Total for specification SingleRobotDetectorSpec
[info] Finished in 18 ms
[info] 1 example, 0 failure, 0 error</pre>
</section>













<section data-type="sect2" id="discussion-1Lswt9IM">
<h2>Discussion</h2>

<p>Although <code>MockWeb.testReq</code> is handling the creation of a <code>Req</code> for us, the environment for that <code>Req</code> is supplied by the <code>MockHttpServletRequest</code>. To configure a request, create an instance of the mock and mutate the state of it as required before using it with <code>testReq</code>.<a data-type="indexterm" data-primary="requests" data-secondary="configuring" id="id-wqCvTPFBtjIG"></a></p>

<p>Aside from HTTP headers, you can set cookies, content type, query parameters, the HTTP method, authentication type, and the body.  There are variations on the <code>body</code> assignment, which conveniently set the content type depending on the value you assign<a data-type="indexterm" data-primary="content types, setting" id="id-yYCyF1IvtrIz"></a>:</p>

<ul>
<li>
<p><code>JValue</code> will use a content type of <code>application/json</code>.</p>
</li>
<li>
<p><code>NodeSeq</code> will use <code>text/xml</code> (or you can supply an alternative).</p>
</li>
<li>
<p><code>String</code> uses <code>text/plain</code> (unless you supply an alternative).</p>
</li>
<li>
<p><code>Array[Byte]</code> does not set the content type.</p>
</li>
</ul>










<section data-type="sect3" id="data-table-nqslhptEID">
<h3>Data table</h3>

<p>In the example test shown earlier, it would be tedious to have to set up the same code repeatedly for different user agents.  Specs2's <em>Data Table</em> provides a compact way to run different example values through the same test<a data-type="indexterm" data-primary="Specs2" id="id-wqC4FPFphzt4Iw"></a><a data-type="indexterm" data-primary="Data Table (Spec2)" id="id-x1C0IBFphntEI4"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.lib</code>

<code class="k">import</code> <code class="nn">org.specs2._</code>
<code class="k">import</code> <code class="nn">matcher._</code>
<code class="k">import</code> <code class="nn">net.liftweb.mocks.MockHttpServletRequest</code>
<code class="k">import</code> <code class="nn">net.liftweb.mockweb.MockWeb</code>

<code class="k">class</code> <code class="nc">RobotDetectorSpec</code> <code class="k">extends</code> <code class="nc">Specification</code> <code class="k">with</code> <code class="nc">DataTables</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">is</code> <code class="k">=</code> <code class="s">"Can detect Google robots"</code> <code class="o">^</code> <code class="o">{</code>
    <code class="s">"Bot?"</code> <code class="o">||</code> <code class="s">"User Agent"</code> <code class="o">|</code>
    <code class="kc">true</code>   <code class="o">!!</code> <code class="s">"Mozilla/5.0 (Googlebot/2.1)"</code> <code class="o">|</code>
    <code class="kc">true</code>   <code class="o">!!</code> <code class="s">"Googlebot-Video/1.0"</code> <code class="o">|</code>
    <code class="kc">true</code>   <code class="o">!!</code> <code class="s">"Mediapartners-Google"</code> <code class="o">|</code>
    <code class="kc">true</code>   <code class="o">!!</code> <code class="s">"AdsBot-Google"</code> <code class="o">|</code>
    <code class="kc">false</code>  <code class="o">!!</code> <code class="s">"Mozilla/5.0 (KHTML, like Gecko)"</code> <code class="o">|&gt;</code> <code class="o">{</code>
    <code class="o">(</code><code class="n">expectedResult</code><code class="o">,</code> <code class="n">userAgent</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="o">{</code>
      <code class="k">val</code> <code class="n">http</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">MockHttpServletRequest</code><code class="o">()</code>
      <code class="n">http</code><code class="o">.</code><code class="n">headers</code> <code class="k">=</code> <code class="nc">Map</code><code class="o">(</code><code class="s">"User-Agent"</code> <code class="o">-&gt;</code> <code class="nc">List</code><code class="o">(</code><code class="n">userAgent</code><code class="o">))</code>
      <code class="nc">MockWeb</code><code class="o">.</code><code class="n">testReq</code><code class="o">(</code><code class="n">http</code><code class="o">)</code> <code class="o">{</code> <code class="n">r</code> <code class="k">=&gt;</code>
        <code class="nc">RobotDetector</code><code class="o">.</code><code class="n">googlebot_?</code><code class="o">(</code><code class="n">r</code><code class="o">)</code> <code class="n">must_==</code> <code class="n">expectedResult</code>
      <code class="o">}</code>
     <code class="o">}</code>
    <code class="o">}</code>

  <code class="o">}</code>

<code class="o">}</code></pre>

<p>The core of this test is essentially unchanged: we create a mock, set the user agent, and check the result of <code>googlebot_?</code>.  The difference is that Specs2 is providing a neat way to list
out the various scenarios and pipe them through a function.</p>

<p>The output from running this under SBT would be:</p>

<pre data-type="programlisting">[info] Can detect Google robots
[info] + Bot?  | User Agent
[info]   true  | Mozilla/5.0 (Googlebot/2.1)
[info]   true  | Googlebot-Video/1.0
[info]   true  | Mediapartners-Google
[info]   true  | AdsBot-Google
[info]   false | Mozilla/5.0 (KHTML, like Gecko)
[info]
[info] Total for specification RobotDetectorSpec
[info] Finished in 1 ms
[info] 1 example, 0 failure, 0 error</pre>

<p>Although the expected value appears first in our table, there’s no requirement to put it first.</p>
</section>



</section>













<section data-type="sect2" id="see-also-YmsghkIK">
<h2>See Also</h2>

<p><a href="https://www.assembla.com/spaces/liftweb/wiki/Testing_Lift_Applications">The Lift wiki</a> discusses this topic and also other approaches such as testing with <span class="keep-together">Selenium.</span></p>
</section>





</section>













<section data-type="sect1" id="Textile">
<h1>Rendering Textile Markup</h1>








<section data-type="sect2" id="problem-q8sAFptG">
<h2>Problem</h2>

<p>You want to render Textile markup in your web application.<a data-type="indexterm" data-primary="Textile markup" id="id-9nCjSvFpFNtX"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="Textile module" id="id-ZbC1FMFXFAty"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="Textile markup rendering" id="id-zdCXIGFWFrtX"></a></p>
</section>













<section data-type="sect2" id="solution-1LsEIDtM">
<h2>Solution</h2>

<p>Install the Lift Textile module in your <em>build.sbt</em> file by adding the
following to the list of dependencies:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">"net.liftmodules"</code> <code class="o">%%</code> <code class="s">"textile_2.5"</code> <code class="o">%</code> <code class="s">"1.3"</code></pre>

<p>You can then use the module to render Textile using the <code>toHtml</code> method.</p>

<p>For example, starting SBT after adding the module and running the SBT <code>console</code> command allows you to try out the module:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">import</code> <code class="nn">net.liftmodules.textile._</code>
<code class="k">import</code> <code class="nn">net.liftmodules.textile._</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="nc">TextileParser</code><code class="o">.</code><code class="n">toHtml</code><code class="o">(</code><code class="s">"""</code>
<code class="s"> | h1. Hi!</code>
<code class="s"> |</code>
<code class="s"> | The module in "Lift":http://www.liftweb.net for turning Textile markup</code>
<code class="s"> | into HTML is pretty easy to use.</code>
<code class="s"> |</code>
<code class="s"> | * As you can see.</code>
<code class="s"> | * In this example.</code>
<code class="s"> | """</code><code class="o">)</code>
<code class="n">res0</code><code class="k">:</code> <code class="kt">scala.xml.NodeSeq</code> <code class="o">=</code>
<code class="nc">NodeSeq</code><code class="o">(,</code> <code class="o">&lt;</code><code class="n">h1</code><code class="o">&gt;</code><code class="nc">Hi</code><code class="o">!&lt;/</code><code class="n">h1</code><code class="o">&gt;,</code></pre>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true">, <code class="nt">&lt;p&gt;</code>The module in <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"http://www.liftweb.net"</code><code class="nt">&gt;</code>Lift<code class="nt">&lt;/a&gt;</code> for turning Textile
  markup<code class="nt">&lt;br&gt;&lt;/br&gt;</code>into HTML is pretty easy to use.<code class="nt">&lt;/p&gt;</code>,
, <code class="nt">&lt;ul&gt;&lt;li&gt;</code> As you can see.<code class="nt">&lt;/li&gt;</code>
<code class="nt">&lt;li&gt;</code> In this example.<code class="nt">&lt;/li&gt;</code>
<code class="nt">&lt;/ul&gt;</code>,
, )</pre>

<p>It’s a little easier to see the output if we pretty print it:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">val</code> <code class="n">pp</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">PrettyPrinter</code><code class="o">(</code><code class="n">width</code><code class="k">=</code><code class="mi">35</code><code class="o">,</code> <code class="n">step</code><code class="k">=</code><code class="mi">2</code><code class="o">)</code>
<code class="n">pp</code><code class="k">:</code> <code class="kt">scala.xml.PrettyPrinter</code> <code class="o">=</code> <code class="n">scala</code><code class="o">.</code><code class="n">xml</code><code class="o">.</code><code class="nc">PrettyPrinter</code><code class="k">@</code><code class="mi">54</code><code class="n">c19de8</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="n">pp</code><code class="o">.</code><code class="n">formatNodes</code><code class="o">(</code><code class="n">res0</code><code class="o">)</code>
<code class="n">res1</code><code class="k">:</code> <code class="kt">String</code> <code class="o">=</code></pre>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;h1&gt;</code>Hi!<code class="nt">&lt;/h1&gt;&lt;p&gt;</code>
  The module in
  <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"http://www.liftweb.net"</code><code class="nt">&gt;</code>
    Lift
  <code class="nt">&lt;/a&gt;</code>
  for turning Textile markup
  <code class="nt">&lt;br&gt;&lt;/br&gt;</code>
  into HTML is pretty easy to use.
<code class="nt">&lt;/p&gt;&lt;ul&gt;</code>
  <code class="nt">&lt;li&gt;</code> As you can see.<code class="nt">&lt;/li&gt;</code>
  <code class="nt">&lt;li&gt;</code> In this example.<code class="nt">&lt;/li&gt;</code>
<code class="nt">&lt;/ul&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-YmsMtWtK">
<h2>Discussion</h2>

<p>There’s nothing special code has to do to become a Lift module, although there are common conventions: they typically are packaged as <em>net.liftmodules</em>, but don’t have to be; they usually depend on a version of Lift; they sometimes use the hooks provided by <code>LiftRules</code> to provide a particular behaviour.  Anyone can create and publish a Lift module, and anyone can contribute to existing modules. In the end, they are declared as dependencies in SBT, and pulled into your code just like any other dependency.<a data-type="indexterm" data-primary="Lift modules" id="id-VMCQIrFktktz"></a></p>

<p>The dependency name is made up of two elements: the name and the "edition" of Lift that the module is compatible with, as shown in <a data-type="xref" href="#ModuleVersioning">Figure 2-1</a>. By "edition" we just mean the first part of the Lift version number. A "2.5" edition implies the module is compatible with any Lift release that starts "2.5."<a data-type="indexterm" data-primary="dependencies, naming conventions of" id="id-VMCpFoIktktz"></a></p>

<figure id="ModuleVersioning">
<img src="images/lfcb_0201.png" alt="lfcb 0201">
<figcaption><span class="label">Figure 2-1. </span>The structure of a module version</figcaption>
</figure>

<p>This structure has been adopted because modules have their own release cycle, independent of Lift. However, modules may also depend on certain features of Lift, and Lift may change APIs between major releases, hence the need to use part of the Lift version number to identify the module.</p>
</section>













<section data-type="sect2" id="see-also-vJskhlte">
<h2>See Also</h2>

<p>There’s no real specification of what Textile is, but there are <a href="http://redcloth.org/hobix.com/textile/">references available</a> that cover the typical kinds of markup to enter and what HTML you can expect to see.</p>

<p><a href="http://bit.ly/11lwwLr">The unit tests for the Textile module</a> give you a good set of examples of what is supported.<a data-type="indexterm" data-startref="ix_LAhtml" id="id-rjCpFgIWhxtM"></a></p>

<p><a data-type="xref" href="#modules">Sharing Code in Modules</a> describes how to create modules.</p>
</section>





</section>







</section>














<section data-type="chapter" id="Forms">
<h1>Forms Processing in Lift</h1>


<p>This chapter looks at how to process form data with Lift: submitting forms, working with form elements. The end result of a form submission can be records being updated in a database, so you may also find <a data-type="xref" href="#Squeryl">Relational Database Persistence with Record and Squeryl</a> or <a data-type="xref" href="#MongoRecord">MongoDB Persistence with Record</a> useful, as they discuss relational databases and MongoDB, respectively.<a data-type="indexterm" id="ix_LWFfp" data-primary="Lift Web Framework" data-secondary="form processing in"></a></p>

<p>To the extent that form processing is passing data to a server, there are also recipes in <a data-type="xref" href="#Ajax">JavaScript, Ajax, and Comet</a> that are relevant to form processing.</p>

<p>You’ll find many of the examples from this chapter as source code at <a href="https://github.com/LiftCookbook/cookbook_forms"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_forms</em></a>.</p>






<section data-type="sect1" id="PlainFormProcessing">
<h1>Plain Old Form Processing</h1>








<section data-type="sect2" id="problem-V7spFwhr">
<h2>Problem</h2>

<p>You want to process form data in a regular, old-fashioned, non-Ajax way.<a data-type="indexterm" data-primary="forms processing" data-secondary="routine (non-Ajax) methods" id="id-KnCnSeFbFJhj"></a></p>
</section>













<section data-type="sect2" id="solution-rWseIEh0">
<h2>Solution</h2>

<p>Extract form values with <code>S.param</code>, process the values, and produce some output.<a data-type="indexterm" data-primary="S." data-secondary="param" id="id-0nCEFGFPIKhJ"></a><a data-type="indexterm" data-primary="requests" data-secondary="processing with S.param" id="id-LnCNIGFxI7hV"></a></p>

<p>For example, we can show a form, process an input value, and give a message back as a notice.  The template is a regular HTML form, with the addition of a snippet:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">data-lift=</code><code class="s">"Plain"</code> <code class="na">action=</code><code class="s">"/plain"</code> <code class="na">method=</code><code class="s">"post"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">placeholder=</code><code class="s">"What's your name?"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Go"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/form&gt;</code></pre>

<p>In the snippet, we can pick out the value of the field <code>name</code> with <code>S.param("name")</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.common.Full</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.S</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.PassThru</code>

<code class="k">object</code> <code class="nc">Plain</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="n">S</code><code class="o">.</code><code class="n">param</code><code class="o">(</code><code class="s">"name"</code><code class="o">)</code> <code class="k">match</code> <code class="o">{</code>
    <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="n">name</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="n">S</code><code class="o">.</code><code class="n">notice</code><code class="o">(</code><code class="s">"Hello "</code><code class="o">+</code><code class="n">name</code><code class="o">)</code>
      <code class="n">S</code><code class="o">.</code><code class="n">redirectTo</code><code class="o">(</code><code class="s">"/plain"</code><code class="o">)</code>
    <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code>
      <code class="nc">PassThru</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>The first time through this snippet, there will be no parameter, so we just pass back the form unchanged to the browser, which is what <code>PassThru</code> is doing. You can then enter a value into the <code>name</code> field and submit the form. This will result in Lift processing the template again, but this time, with a value for the <code>name</code> input.  The result will be your browser redirected to a page with a message set for display.<a data-type="indexterm" data-primary="S." data-secondary="notice" id="id-kVClt4cpIZhQ"></a><a data-type="indexterm" data-primary="S." data-secondary="redirectTo" id="id-4nCrhxcMIVhd"></a></p>
</section>













<section data-type="sect2" id="discussion-wPsDtehz">
<h2>Discussion</h2>

<p>Manually plucking parameters from a request isn’t making the best use of Lift, but sometimes you need to do it, and <code>S.param</code> is the way you can process request parameters.<a data-type="indexterm" data-primary="parameters, manual selection of" id="id-LnCbFGFWt7hV"></a><a data-type="indexterm" data-primary="S." data-secondary="param" id="id-AnCKIZFVtNhV"></a></p>

<p>The result of <code>S.param</code> is a <code>Box[String]</code>, and in the previous example, we pattern match on this value.  With more than one parameter, you’ve probably seen <code>S.param</code> used in this way:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>
  <code class="k">for</code> <code class="o">{</code>
    <code class="n">name</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">param</code><code class="o">(</code><code class="s">"name"</code><code class="o">)</code>
    <code class="n">pet</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">param</code><code class="o">(</code><code class="s">"petName"</code><code class="o">)</code>
  <code class="o">}</code> <code class="o">{</code>
    <code class="n">S</code><code class="o">.</code><code class="n">notice</code><code class="o">(</code><code class="s">"Hello %s and %s"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">name</code><code class="o">,</code><code class="n">pet</code><code class="o">))</code>
    <code class="n">S</code><code class="o">.</code><code class="n">redirectTo</code><code class="o">(</code><code class="s">"/plain"</code><code class="o">)</code>
  <code class="o">}</code>

 <code class="nc">PassThru</code>
<code class="o">}</code></pre>

<p>If both <code>name</code> and <code>petName</code> are provided, the body of the <code>for</code> will be evaluated.</p>

<p>Related functions on <code>S</code> include<a data-type="indexterm" data-primary="S." data-secondary="params(name)" id="id-GnCZFQTmtKhQ"></a><a data-type="indexterm" data-primary="S." data-secondary="post_?" id="id-DnCXI4Tvt4hL"></a><a data-type="indexterm" data-primary="S." data-secondary="get_?" id="id-kVCltNTDtZhQ"></a><a data-type="indexterm" data-primary="S." data-secondary="getRequestHeadter(name)" id="id-4nCrhBTNtVhd"></a><a data-type="indexterm" data-primary="S." data-secondary="getrequest" id="id-JnC0TpTDtvhn"></a>:</p>
<dl>
<dt><code>S.params(name)</code></dt>
<dd>
<p>Produces a <code>List[String]</code> for all the request parameters with the given name</p>
</dd>
<dt><code>S.post_?</code> and <code>S.get_?</code></dt>
<dd>
<p>Tells you if the request was a GET or POST</p>
</dd>
<dt><code>S.getRequestHeader(name)</code></dt>
<dd>
<p>Gives the <code>Box[String]</code> for a header in the request with the given name</p>
</dd>
<dt><code>S.request</code></dt>
<dd>
<p>Accesses the <code>Box[Req]</code>, which gives you access to further HTTP-specific information about the request</p>
</dd>
</dl>

<p>As an example of using <code>S.request</code>, we could produce a <code>List[String]</code> for the values of all request parameters that have <code>name</code> somewhere in their parameter name:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">names</code> <code class="k">=</code> <code class="k">for</code> <code class="o">{</code>
  <code class="n">req</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">toList</code>
  <code class="n">paramName</code> <code class="k">&lt;-</code> <code class="n">req</code><code class="o">.</code><code class="n">paramNames</code>
  <code class="k">if</code> <code class="n">paramName</code><code class="o">.</code><code class="n">toLowerCase</code> <code class="n">contains</code> <code class="s">"name"</code>
  <code class="n">value</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">param</code><code class="o">(</code><code class="n">paramName</code><code class="o">)</code>
<code class="o">}</code> <code class="k">yield</code> <code class="n">value</code></pre>

<p>Note that by opening up <code>S.request</code> we can access all the parameter names via the <code>paramNames</code> function on <code>Req</code>.</p>

<p>Screen or Wizard provide alternatives for form processing, but sometimes
you just want to pull values from a request, as demonstrated in this
recipe.</p>
</section>













<section data-type="sect2" id="see-also-xqsjhyhG">
<h2>See Also</h2>

<p><a href="http://simply.liftweb.net"><em>Simply Lift</em></a> covers a variety of ways of processing forms.</p>
</section>





</section>













<section data-type="sect1" id="AjaxFormProcessing">
<h1>Ajax Form Processing</h1>








<section data-type="sect2" id="problem-rWspFAT0">
<h2>Problem</h2>

<p>You want to process a form on the server via Ajax, without reloading the
whole page.<a data-type="indexterm" data-primary="forms processing" data-secondary="via Ajax" id="id-aeCvSEF2FVTj"></a><a data-type="indexterm" data-primary="Ajax" data-secondary="form processing via" id="id-0nCEFGFqFzTJ"></a></p>
</section>













<section data-type="sect2" id="solution-wPsrIoTz">
<h2>Solution</h2>

<p>Mark your form as an Ajax form with <code>data-lift="form.ajax"</code> and supply a
function to run on the server when the form is submitted.</p>

<p>Here’s an example of a form that will collect our name and submit it via Ajax to the server:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">data-lift=</code><code class="s">"form.ajax"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"EchoForm"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">placeholder=</code><code class="s">"What's your name?"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/form&gt;</code>

<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"result"</code><code class="nt">&gt;</code>Your name will be echoed here<code class="nt">&lt;/div&gt;</code></pre>

<p>The following snippet will echo back the name via Ajax:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.</code><code class="o">{</code><code class="n">text</code><code class="o">,</code><code class="n">ajaxSubmit</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmd</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.SetHtml</code>
<code class="k">import</code> <code class="nn">xml.Text</code>

<code class="k">object</code> <code class="nc">EchoForm</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">var</code> <code class="n">name</code> <code class="k">=</code> <code class="s">""</code>

    <code class="k">def</code> <code class="n">process</code><code class="o">()</code> <code class="k">:</code> <code class="kt">JsCmd</code> <code class="o">=</code> <code class="nc">SetHtml</code><code class="o">(</code><code class="s">"result"</code><code class="o">,</code> <code class="nc">Text</code><code class="o">(</code><code class="n">name</code><code class="o">))</code>

    <code class="s">"@name"</code> <code class="o">#&gt;</code> <code class="n">text</code><code class="o">(</code><code class="n">name</code><code class="o">,</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="n">name</code> <code class="k">=</code> <code class="n">s</code><code class="o">)</code> <code class="o">&amp;</code>
    <code class="s">"type=submit"</code> <code class="o">#&gt;</code> <code class="n">ajaxSubmit</code><code class="o">(</code><code class="s">"Click Me"</code><code class="o">,</code> <code class="n">process</code><code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>The <code>render</code> method is binding the <code>name</code> input field to a function that will assign whatever the user enters to the variable <code>name</code>. Note you’ll more typically see <code>s =&gt; name = s</code> written in the shorter form of <code>name = _</code>.</p>

<p>When the button is pressed, the <code>process</code> function is called, which will return the
value of the <code>name</code> back to the element in the HTML with an ID of <code>result</code>.</p>
</section>













<section data-type="sect2" id="discussion-xqs1tnTG">
<h2>Discussion</h2>

<p>The <code>data-lift="form.ajax"</code> part of this recipe ensures that Lift adds the Ajax processing mechanics to the form.  This means the <code>&lt;form&gt;</code> element in the output will end up as something like this:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">id=</code><code class="s">"F2203365740CJME2G"</code> <code class="na">action=</code><code class="s">"javascript://"</code>
  <code class="na">onsubmit=</code><code class="s">"liftAjax.lift_ajaxHandler(</code>
<code class="s">    jQuery('#'+&amp;quot;F2203365740CJME2G&amp;quot;).serialize(),</code>
<code class="s">    null, null, &amp;quot;javascript&amp;quot;);return false;"</code><code class="nt">&gt;</code>
  ...
<code class="nt">&lt;/form&gt;</code></pre>

<p>In other words, when the form is asked to submit, Lift will serialise the form via Ajax.  This means you don’t necessarily need the submit button at all.  In this example with a single text field, if you omit the submit button you can trigger serialisation by pressing Return.  This will trigger the <code>s =&gt; name = s</code> function, which was bound in our regular <code>data-lift="EchoForm"</code> snippet. In other words, the value <code>name</code> will be assigned even without a submit button.</p>

<p>Adding in a submit button gives us a way to perform actions once all the field’s functions have been executed.<a data-type="indexterm" data-primary="submit buttons" id="id-e4CzS2hQtxTQ"></a></p>

<p>Notice that Lift’s approach is to serialise the form to the server, execute the functions associated with the fields, execute the submit function (if any), then return a JavaScript result to the client.  The default serialisation process is to use jQuery’s <code>serialization</code> method on the form.  This serialises fields except submit buttons and file uploads.</p>










<section data-type="sect3" id="submit-styling-pWsNcWtKTO">
<h3>Submit styling</h3>

<p>The <code>SHtml.ajaxSubmit</code> function generates a <code>&lt;input type="submit"&gt;</code> element for the page. You may prefer to use a styled button for submit. For example, with Twitter Bootstrap, a button with an icon would require the following markup<a data-type="indexterm" data-primary="submit styling" id="id-JnCmIlFVcKtwTA"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"submit"</code> <code class="na">class=</code><code class="s">"btn btn-primary btn-large"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;i</code> <code class="na">class=</code><code class="s">"icon-white icon-ok"</code><code class="nt">&gt;&lt;/i&gt;</code> Submit
<code class="nt">&lt;/button&gt;</code></pre>

<p>Pressing a <code>&lt;button&gt;</code> inside a form triggers the submit. However, if you bound that button with <code>SHtml.ajaxSubmit</code>, the content, and therefore the styling, would be lost.</p>

<p>To fix this, you can assign a function to a hidden field. This function will be called when the form is submitted just like any other field.  The only part of our snippet that changes is the CSS selector binding<a data-type="indexterm" data-primary="hidden fields" id="id-9nCjSehmcptlTa"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.hidden</code>

<code class="s">"@name"</code> <code class="o">#&gt;</code> <code class="n">text</code><code class="o">(</code><code class="n">name</code><code class="o">,</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="n">name</code> <code class="k">=</code> <code class="n">s</code><code class="o">)</code> <code class="o">&amp;</code>
<code class="s">"button *+"</code> <code class="o">#&gt;</code> <code class="n">hidden</code><code class="o">(</code><code class="n">process</code><code class="o">)</code></pre>

<p>The <code>*+</code> replacement rule means append a value to the child node of the button. This will include a hidden field in the form, something like this<a data-type="indexterm" data-primary="replacement rules" id="id-yYCyFXcPc4tXTV"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"hidden"</code> <code class="n">name</code><code class="o">=</code><code class="s">"F11202029628285OIEC2"</code> <code class="n">value</code><code class="o">=</code><code class="s">"true"</code><code class="o">&gt;</code></pre>

<p>When the form is submitted, the hidden field is submitted, and like any field, Lift will call the function associated with it: <code>process</code>, in this case.</p>

<p>The effect is something like <code>ajaxSubmit</code>, but not exactly the same. In this instance, we’re appending a hidden field after the <code>&lt;button&gt;</code>, but you could place it anywhere on the form you find convenient. However, there’s one complication: when is <code>process</code> called? Is it before the <code>name</code> has been assigned or after? That depends on the order in which the fields are rendered.  That’s to say, in your HTML template, placing the button before the text field (and therefore moving the hidden field’s position in this example), the <code>process</code> function is called before the name has been set.<a data-type="indexterm" data-primary="functions" data-secondary="order of execution" id="id-XmCyTZUPcqtXTb"></a></p>

<p>There are a couple of ways around that.  Either, ensure your hidden fields used in this way appear late in your form, or make sure the function is called late<a data-type="indexterm" data-primary="formGroup function" id="id-wqC7S0CmcztmTy"></a> with a <code>formGroup</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.hidden</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.S</code>

<code class="s">"@name"</code> <code class="o">#&gt;</code> <code class="n">text</code><code class="o">(</code><code class="n">name</code><code class="o">,</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="n">name</code> <code class="k">=</code> <code class="n">s</code><code class="o">)</code> <code class="o">&amp;</code>
<code class="s">"button *+"</code> <code class="o">#&gt;</code> <code class="n">S</code><code class="o">.</code><code class="n">formGroup</code><code class="o">(</code><code class="mi">1000</code><code class="o">)</code> <code class="o">{</code> <code class="n">hidden</code><code class="o">(</code><code class="n">process</code><code class="o">)</code> <code class="o">}</code></pre>

<p>The <code>formGroup</code> addition manipulates the function identifier to ensure it sorts later, resulting in the function <code>process</code> being called later than fields in the default group (0).<a data-type="indexterm" data-primary="S." data-secondary="formGroup" id="id-XmCKIoHPcqtXTb"></a></p>
<div data-type="note" id="id-PPU1fLcAt1Ta"><h6>Note</h6>
<p>Lift 2.6 and 3.0 may contain <code>ajaxOnSubmit</code>, which will give the reliability of <code>ajaxSubmit</code> and the flexibility of the hidden-field approach.  If you want to try it in Lift 2.5,
Antonio Salazar Cardozo has created a <a href="http://bit.ly/ZPCR41">helper you can include in your project</a>.</p>
</div>
</section>



</section>













<section data-type="sect2" id="see-also-Pas0hZTP">
<h2>See Also</h2>

<p>Function order is discussed in the <a href="http://bit.ly/19AaP2f">Lift Cool Tips wiki page</a>.</p>

<p>For more details about the form serialisation process, take a look at <a href="http://api.jquery.com/serialize/">the jQuery <span class="keep-together">documentation</span></a>.</p>

<p><a data-type="xref" href="#AjaxFileUpload">Ajax File Upload</a> describes Ajax file uploads.</p>
</section>





</section>













<section data-type="sect1" id="JsonForms">
<h1>Ajax JSON Form Processing</h1>








<section data-type="sect2" id="problem-wPs4Fncz">
<h2>Problem</h2>

<p>You want to process a form via Ajax, sending the data in JSON format.<a data-type="indexterm" id="ix_FPajxjson" data-primary="forms processing" data-secondary="Ajax JSON format"></a><a data-type="indexterm" id="ix_JSONfp" data-primary="JSON format" data-secondary="form processing in"></a></p>
</section>













<section data-type="sect2" id="solution-xqs0IdcG">
<h2>Solution</h2>

<p>Make use of Lift’s <em>jlift.js</em> JavaScript library and <code>JsonHandler</code> class.<a data-type="indexterm" data-primary="JsonHandler class" id="id-W7CQILFBIJcO"></a><a data-type="indexterm" data-primary="jlift.js JavaScript library" id="id-e4CLtJFqImcQ"></a></p>

<p>As an example, we can create a "motto server" that will accept an institution name and the institution’s motto
and perform some action on these values. We’re just going to echo the name and motto back to the client.<a data-type="indexterm" data-primary="Motto example" id="id-AnCPS1IYIVcV"></a></p>

<p>Consider this HTML, which is not in a form, but includes <em>jlift.js</em>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;title&gt;</code>JSON Form<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>

<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>

  <code class="nt">&lt;h1&gt;</code>Json Form example<code class="nt">&lt;/h1&gt;</code>

  <code class="c">&lt;!-- Required for JSON forms processing --&gt;</code>
  <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"/classpath/jlift.js"</code> <code class="na">data-lift=</code><code class="s">"tail"</code><code class="nt">&gt;&lt;/script&gt;</code>

  <code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"JsonForm"</code> <code class="nt">&gt;</code>

    <code class="nt">&lt;script </code><code class="na">id=</code><code class="s">"jsonScript"</code> <code class="na">data-lift=</code><code class="s">"tail"</code><code class="nt">&gt;&lt;/script&gt;</code>

    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"jsonForm"</code><code class="nt">&gt;</code>

      <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"name"</code><code class="nt">&gt;</code>
        Institution
        <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"name"</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">value=</code><code class="s">"Royal Society"</code> <code class="nt">/&gt;</code>
      <code class="nt">&lt;/label&gt;</code>

      <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"motto"</code><code class="nt">&gt;</code>
        Motto
        <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"motto"</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"motto"</code> <code class="na">value=</code><code class="s">"Nullius in verba"</code> <code class="nt">/&gt;</code>
      <code class="nt">&lt;/label&gt;</code>

      <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Send"</code> <code class="nt">/&gt;</code>

    <code class="nt">&lt;/div&gt;</code>

    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"result"</code><code class="nt">&gt;</code>
      Result will appear here.
    <code class="nt">&lt;/div&gt;</code>

  <code class="nt">&lt;/div&gt;</code>

<code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>This HTML presents the user with two fields, a name and a motto, wrapped in a <code>&lt;div&gt;</code> called <code>jsonForm</code>. There’s also a placeholder for some results, and you’ll  notice a <code>jsonScript</code> placeholder for some JavaScript code. The <code>jsonForm</code> will be manipulated to ensure it is sent via Ajax, and the <code>jsonScript</code> will be replaced with Lift’s code to perform the serialisation. This happens in the snippet code:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">scala.xml.</code><code class="o">{</code><code class="nc">Text</code><code class="o">,</code> <code class="nc">NodeSeq</code><code class="o">}</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.JsonCmd</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.jsonForm</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.JsonHandler</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmd</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.</code><code class="o">{</code><code class="nc">SetHtml</code><code class="o">,</code> <code class="nc">Script</code><code class="o">}</code>

<code class="k">object</code> <code class="nc">JsonForm</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="s">"#jsonForm"</code> <code class="o">#&gt;</code> <code class="o">((</code><code class="n">ns</code><code class="k">:</code><code class="kt">NodeSeq</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">jsonForm</code><code class="o">(</code><code class="nc">MottoServer</code><code class="o">,</code> <code class="n">ns</code><code class="o">))</code> <code class="o">&amp;</code>
    <code class="s">"#jsonScript"</code> <code class="o">#&gt;</code> <code class="nc">Script</code><code class="o">(</code><code class="nc">MottoServer</code><code class="o">.</code><code class="n">jsCmd</code><code class="o">)</code>

  <code class="k">object</code> <code class="nc">MottoServer</code> <code class="k">extends</code> <code class="nc">JsonHandler</code> <code class="o">{</code>

    <code class="k">def</code> <code class="n">apply</code><code class="o">(</code><code class="n">in</code><code class="k">:</code> <code class="kt">Any</code><code class="o">)</code><code class="k">:</code> <code class="kt">JsCmd</code> <code class="o">=</code> <code class="n">in</code> <code class="k">match</code> <code class="o">{</code>
      <code class="k">case</code> <code class="nc">JsonCmd</code><code class="o">(</code><code class="s">"processForm"</code><code class="o">,</code> <code class="n">target</code><code class="o">,</code> <code class="n">params</code><code class="k">:</code> <code class="kt">Map</code><code class="o">[</code><code class="kt">String</code>, <code class="kt">String</code><code class="o">],</code> <code class="n">all</code><code class="o">)</code> <code class="k">=&gt;</code>
        <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="n">params</code><code class="o">.</code><code class="n">getOrElse</code><code class="o">(</code><code class="s">"name"</code><code class="o">,</code> <code class="s">"No Name"</code><code class="o">)</code>
        <code class="k">val</code> <code class="n">motto</code> <code class="k">=</code> <code class="n">params</code><code class="o">.</code><code class="n">getOrElse</code><code class="o">(</code><code class="s">"motto"</code><code class="o">,</code> <code class="s">"No Motto"</code><code class="o">)</code>
        <code class="nc">SetHtml</code><code class="o">(</code><code class="s">"result"</code><code class="o">,</code>
          <code class="nc">Text</code><code class="o">(</code><code class="s">"The motto of %s is %s"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">name</code><code class="o">,</code><code class="n">motto</code><code class="o">))</code> <code class="o">)</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Like many snippets, this Scala code contains a <code>render</code> method that binds to elements on the page. Specifically, <code>jsonForm</code> is being replaced with <code>SHtml.jsonForm</code>, which will take a <code>NodeSeq</code> (which are the input fields), and turns it into a form that will submit the values as JSON. The submission will be to our <code>MottoServer</code> code.<a data-type="indexterm" data-primary="SHtml." data-secondary="jsonForm method" id="id-zdCLTAipIlcw"></a></p>

<p>The <code>jsonScript</code> element is bound to JavaScript that will perform the transmission and encoding of the values to the server.</p>

<p>If you click the "Send" button and observe the network traffic, you’ll see
the following sent to the server:</p>

<pre data-type="programlisting" data-code-language="javascript" data-highlighted="true"><code class="p">{</code>
  <code class="s2">"command"</code><code class="o">:</code> <code class="s2">"processForm"</code><code class="p">,</code>
  <code class="s2">"params"</code><code class="o">:</code> <code class="p">{</code><code class="s2">"name"</code><code class="o">:</code><code class="s2">"Royal Society"</code><code class="p">,</code><code class="s2">"motto"</code><code class="o">:</code><code class="s2">"Nullius in verba"</code><code class="p">}</code>
<code class="p">}</code></pre>

<p>This is the value of the <code>all</code> parameter in the <code>JsonCmd</code> being pattern matched against in <code>MottoServer.apply</code>. Lift has taken care of the plumbing to make this happen.</p>

<p>The result of the pattern match in the example is to pick out the two field values and send back JavaScript to update the <code>results</code> <code>&lt;div&gt;</code> with:
"The motto of the Royal Society is Nullius in verba."</p>
</section>













<section data-type="sect2" id="discussion-PasetLcP">
<h2>Discussion</h2>

<p>The <code>JsonHandler</code> class and the <code>SHtml.jsonForm</code> method are together performing a lot of work for us.  The <code>jsonForm</code> method is arranging for form fields to be encoded as JSON and sent, via Ajax, to our <code>MottoServer</code> as a <code>JsonCmd</code>. In fact, it’s a <code>JsonCmd</code> with a default command name of <code>"processForm"</code>.</p>

<p>Our <code>MottoServer</code> class is looking for (matching on) this <code>JsonCmd</code>, extracting the values of the form fields, and echoing these back to the client as a <code>JsCmd</code> that updates a <code>&lt;div&gt;</code> on the page.</p>

<p>The <code>MottoServer.jsCmd</code> part is generating the JavaScript required to deliver the form fields to the server.  As we will see later, this is providing a general purpose function we can use to send different JSON values and commands to the server.</p>

<p>Notice also, from the network traffic, that the form fields sent are serialised with the names they are given on the page. There are no "F…" values sent that map to function calls on the server. A consequence of this is that any fields dynamically added to the page will also be serialised to the server, where they can be picked up in the <code>MottoServer</code>.</p>

<p>The script <em>jlift.js</em> is providing the plumbing to make much of this happen.</p>

<p>Before going on, convince yourself that we’re generating JavaScript on the server side (<code>MottoServer.jsCmd</code>), which is executed on the client side when the form is submitted, to deliver results to the server.</p>










<section data-type="sect3" id="additional-commands-g0sEiBtNcP">
<h3>Additional commands</h3>

<p>In the previous example, we match on a <code>JsonCmd</code> with a command name of <code>"processForm"</code>.  You may be wondering what other commands can be supplied, or what the meaning of the <code>target</code> value is.</p>

<p>To demonstrate how you can implement other commands, we can add two additional buttons. These buttons will just convert the motto to upper- or lowercase.  The server-side <code>render</code> method changes as follows:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
  <code class="s">"#jsonForm"</code> <code class="o">#&gt;</code> <code class="o">((</code><code class="n">ns</code><code class="k">:</code><code class="kt">NodeSeq</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">jsonForm</code><code class="o">(</code><code class="nc">MottoServer</code><code class="o">,</code> <code class="n">ns</code><code class="o">))</code> <code class="o">&amp;</code>
  <code class="s">"#jsonScript"</code> <code class="o">#&gt;</code> <code class="nc">Script</code><code class="o">(</code>
    <code class="nc">MottoServer</code><code class="o">.</code><code class="n">jsCmd</code> <code class="o">&amp;</code>
    <code class="nc">Function</code><code class="o">(</code><code class="s">"changeCase"</code><code class="o">,</code> <code class="nc">List</code><code class="o">(</code><code class="s">"direction"</code><code class="o">),</code>
      <code class="nc">MottoServer</code><code class="o">.</code><code class="n">call</code><code class="o">(</code><code class="s">"processCase"</code><code class="o">,</code> <code class="nc">JsVar</code><code class="o">(</code><code class="s">"direction"</code><code class="o">),</code>
        <code class="nc">JsRaw</code><code class="o">(</code><code class="s">"$('#motto').val()"</code><code class="o">))</code>
    <code class="o">)</code>
  <code class="o">)</code></pre>

<p>The <code>JsonForm</code> is unchanged. We still include <code>MottoServer.jsCmd</code>, and we still want to wrap the fields and submit them as before. What we’ve added
is an extra JavaScript function called <code>changeCase</code>, which takes one argument called <code>direction</code> and as a body calls the <code>MottoServer</code> with various parameters.  When it is rendered on the page, it would appear as something like this:</p>

<pre data-type="programlisting" data-code-language="javascript" data-highlighted="true"><code class="kd">function</code> <code class="nx">changeCase</code><code class="p">(</code><code class="nx">direction</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">F299202CYGIL</code><code class="p">({</code><code class="s1">'command'</code><code class="o">:</code> <code class="s2">"processCase"</code><code class="p">,</code> <code class="s1">'target'</code><code class="o">:</code> <code class="nx">direction</code><code class="p">,</code>
    <code class="s1">'params'</code><code class="o">:</code> <code class="nx">$</code><code class="p">(</code><code class="s1">'#motto'</code><code class="p">).</code><code class="nx">val</code><code class="p">()</code> <code class="p">});</code>
<code class="p">}</code></pre>

<p>The <code>F299202CYGIL</code> function (or similar name) is generated by Lift as part of <code>MottoServer.jsCmd</code>, and it is responsible for delivering data
to the server.  The data it is delivering, in this case, is a JSON structure consisting of a different command (<code>processCase</code>), a target of whatever
the JavaScript value <code>direction</code> evaluates to, and a parameter that is the result of the jQuery expression for the value
of the <code>#motto</code> form field.</p>

<p>When is the <code>changeCase</code> function called?  That’s up to us, and one very simple way to call the function would be by this addition to the HTML:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;button</code> <code class="na">onclick=</code><code class="s">"javascript:changeCase('upper')"</code><code class="nt">&gt;</code>Upper case the Motto<code class="nt">&lt;/button&gt;</code>
<code class="nt">&lt;button</code> <code class="na">onclick=</code><code class="s">"javascript:changeCase('lower')"</code><code class="nt">&gt;</code>Lower case the Motto<code class="nt">&lt;/button&gt;</code></pre>

<p>When either of these buttons are pressed, the result will be a JSON value sent to the server with the command of <code>processCase</code> and the <code>direction</code> and <code>params</code> set accordingly.  All that is left is to modify our <code>MottoServer</code> to pick up this <code>JsonCmd</code> on the server:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">MottoServer</code> <code class="k">extends</code> <code class="nc">JsonHandler</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">apply</code><code class="o">(</code><code class="n">in</code><code class="k">:</code> <code class="kt">Any</code><code class="o">)</code><code class="k">:</code> <code class="kt">JsCmd</code> <code class="o">=</code> <code class="n">in</code> <code class="k">match</code> <code class="o">{</code>

    <code class="k">case</code> <code class="nc">JsonCmd</code><code class="o">(</code><code class="s">"processForm"</code><code class="o">,</code> <code class="n">target</code><code class="o">,</code> <code class="n">params</code><code class="k">:</code> <code class="kt">Map</code><code class="o">[</code><code class="kt">String</code>, <code class="kt">String</code><code class="o">],</code> <code class="n">all</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="n">params</code><code class="o">.</code><code class="n">getOrElse</code><code class="o">(</code><code class="s">"name"</code><code class="o">,</code> <code class="s">"No Name"</code><code class="o">)</code>
      <code class="k">val</code> <code class="n">motto</code> <code class="k">=</code> <code class="n">params</code><code class="o">.</code><code class="n">getOrElse</code><code class="o">(</code><code class="s">"motto"</code><code class="o">,</code> <code class="s">"No Motto"</code><code class="o">)</code>
      <code class="nc">SetHtml</code><code class="o">(</code><code class="s">"result"</code><code class="o">,</code>
        <code class="nc">Text</code><code class="o">(</code><code class="s">"The motto of %s is %s"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">name</code><code class="o">,</code><code class="n">motto</code><code class="o">))</code> <code class="o">)</code>

    <code class="k">case</code> <code class="nc">JsonCmd</code><code class="o">(</code><code class="s">"processCase"</code><code class="o">,</code> <code class="n">direction</code><code class="o">,</code> <code class="n">motto</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">all</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="k">val</code> <code class="n">update</code> <code class="k">=</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">direction</code> <code class="o">==</code> <code class="s">"upper"</code><code class="o">)</code> <code class="n">motto</code><code class="o">.</code><code class="n">toUpperCase</code>
        <code class="k">else</code> <code class="n">motto</code><code class="o">.</code><code class="n">toLowerCase</code>
      <code class="nc">SetValById</code><code class="o">(</code><code class="s">"motto"</code><code class="o">,</code> <code class="n">update</code><code class="o">)</code>

  <code class="o">}</code>
<code class="o">}</code></pre>

<p>The first <code>JsonCmd</code> is unchanged. The second matches on the parameters sent and results in updating the form fields with an upper- or lowercase version of the motto.<a data-type="indexterm" data-startref="ix_FPajxjson" id="id-XmCpFwsviqtocb"></a><a data-type="indexterm" data-startref="ix_JSONfp" id="id-jyCjInsDiXtZc1"></a></p>
</section>



</section>













<section data-type="sect2" id="see-also-OKsGhbc4">
<h2>See Also</h2>

<p>The Lift demo site contains <a href="http://demo.liftweb.net/json_more">further examples of <code>JsonHandler</code></a>.</p>

<p>If you want to process JSON via REST, take a look at <a href="http://demo.liftweb.net/stateless_json">the stateless JSON examples</a>.</p>

<p><em>Lift in Action</em>, section 9.1.4 discusses "Using JSON forms with AJAX," as does section 10.4 of <a href="http://exploring.liftweb.net"><em>Exploring Lift</em></a>.</p>
</section>





</section>













<section data-type="sect1" id="DatePicker">
<h1>Use a Date Picker for Input</h1>








<section data-type="sect2" id="problem-xqsZFEiG">
<h2>Problem</h2>

<p>You want to provide a date picker to make it easy for users to supply
dates to your forms.<a data-type="indexterm" data-primary="forms processing" data-secondary="date picker input" id="id-LnC7SGFQFMiV"></a><a data-type="indexterm" data-primary="date pickers" id="id-AnCDFZFvFoiV"></a></p>
</section>













<section data-type="sect2" id="solution-PaskIXiP">
<h2>Solution</h2>

<p>Use a standard Lift <code>SHtml.text</code> input field and attach a JavaScript date picker to it.  In this example, we will use the jQuery UI date picker.<a data-type="indexterm" data-primary="SHtml." data-secondary="text input field" id="id-W7CoFLFBIKiO"></a><a data-type="indexterm" data-primary="jQuery UI date picker" id="id-e4CxIJFqIriQ"></a></p>

<p>Our form will include an input field called <code>birthday</code> to be used as a date picker, and also the jQuery UI JavaScript and CSS:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">content=</code><code class="s">"text/html; charset=UTF-8"</code> <code class="na">http-equiv=</code><code class="s">"content-type"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;title&gt;</code>jQuery Date Picker<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>

  <code class="nt">&lt;h3&gt;</code>When's your birthday?<code class="nt">&lt;/h3&gt;</code>

  <code class="nt">&lt;link</code> <code class="na">data-lift=</code><code class="s">"head"</code> <code class="na">type=</code><code class="s">"text/css"</code> <code class="na">rel=</code><code class="s">"stylesheet"</code>
    <code class="na">href=</code><code class="s">"//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.2/css/smoothness</code>
<code class="s">          /jquery-ui-1.10.2.custom.min.css"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/link&gt;</code>

  <code class="nt">&lt;script </code><code class="na">data-lift=</code><code class="s">"tail"</code>
    <code class="na">src=</code><code class="s">"//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/script&gt;</code>

  <code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"JqDatePicker?form=post"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">id=</code><code class="s">"birthday"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Submit"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/div&gt;</code>

<code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>This would normally produce a regular text input field, but we can change that by adding JavaScript to attach the date picker to the input field.  You could do this in the template, but in this example, we’re enhancing the text field as part of the snippet code:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">java.util.Date</code>
<code class="k">import</code> <code class="nn">java.text.SimpleDateFormat</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="n">S</code><code class="o">,</code> <code class="nc">SHtml</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.Run</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>

<code class="k">class</code> <code class="nc">JqDatePicker</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">dateFormat</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">SimpleDateFormat</code><code class="o">(</code><code class="s">"yyyy-MM-dd"</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">default</code> <code class="k">=</code> <code class="o">(</code><code class="n">dateFormat</code> <code class="n">format</code> <code class="n">now</code><code class="o">)</code>

  <code class="k">def</code> <code class="n">logDate</code><code class="o">(</code><code class="n">s</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="k">val</code> <code class="n">date</code> <code class="k">:</code> <code class="kt">Date</code> <code class="o">=</code> <code class="n">tryo</code><code class="o">(</code><code class="n">dateFormat</code> <code class="n">parse</code> <code class="n">s</code><code class="o">)</code> <code class="n">getOrElse</code> <code class="n">now</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Birthday: "</code><code class="o">+</code><code class="n">date</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>
    <code class="n">S</code><code class="o">.</code><code class="n">appendJs</code><code class="o">(</code><code class="n">enhance</code><code class="o">)</code>
    <code class="s">"#birthday"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">text</code><code class="o">(</code><code class="n">default</code><code class="o">,</code> <code class="n">logDate</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">val</code> <code class="n">enhance</code> <code class="k">=</code>
    <code class="nc">Run</code><code class="o">(</code><code class="s">"$('#birthday').datepicker({dateFormat: 'yy-mm-dd'});"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>Notice in <code>render</code> we are binding a regular <code>SHtml.text</code> field to the element with the ID of <code>birthday</code>, but also appending JavaScript to the page. JavaScript selects the <code>birthday</code> input field and attaches a configured date picker to it.<a data-type="indexterm" data-primary="S." data-secondary="appendJs" id="id-ZbCBhLckIzij"></a></p>

<p>When the field is submitted, the <code>logDate</code> method is called with the value of the text field. We parse the text into a <code>java.util.Date</code> object.  The <code>tryo</code> Lift helper will catch any <code>ParseException</code> and return a <code>Box[Date]</code>, which we open, or default to the current date if a bad date is supplied.</p>

<p>Running this code and submitting the form will produce a log message such as:</p>

<pre data-type="programlisting">INFO  code.snippet.DatePicker - Birthday: Sun Apr 21 00:00:00 BST 2013</pre>
</section>













<section data-type="sect2" id="discussion-OKsVtyi4">
<h2>Discussion</h2>

<p>The approach outlined in this recipe can be used with other date picker libraries. The key point is to configure the date picker to submit a date in a format you can parse when the value is submitted to the server. This is the "wire format" of the date, and does not have to necessarily be the same format the user sees in the browser, depending on the browser or the JavaScript library being used.<a data-type="indexterm" data-primary="wire formats, for dates" id="id-W7CESLFAtKiO"></a></p>










<section data-type="sect3" id="html5-date-pickers-jWsjIPtDi0">
<h3>HTML5 date pickers</h3>

<p>The HTML5 specification includes support for a variety of date input types: <code>datetime</code>, <code>datetime-local</code>, <code>date</code>, <code>month</code>, <code>time</code>, and <code>week</code>. For example<a data-type="indexterm" data-primary="HTML5" data-secondary="date pickers" id="id-ZbCQcMFkIrtjiM"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"date"</code> <code class="na">name=</code><code class="s">"birthday"</code> <code class="na">value=</code><code class="s">"2013-04-21"</code><code class="nt">&gt;</code></pre>

<p>This type of input field will submit a date in <em>yyyy-mm-dd</em> format, which our snippet would be able to process.</p>

<p>As more browsers implement these types, it will become possible to depend on them.  However, you can default to the HTML5 browser-native date pickers today and fall back to a JavaScript library as required.<a data-type="indexterm" data-primary="Safari, date picker format" id="id-4nCqSohMI1tdio"></a><a data-type="indexterm" data-primary="Chrome, date picker format" id="id-JnCzFLhpIKtniA"></a> The difference is shown in <a data-type="xref" href="#DatePickerScreenGrabs">Figure 3-1</a>.</p>

<figure id="DatePickerScreenGrabs">
<img src="images/lfcb_0301.png" alt="lfcb 0301">
<figcaption><span class="label">Figure 3-1. </span>An input field with the jQuery UI date picker attached, compared to the browser-native date picker in Chrome</figcaption>
</figure>

<p>To detect whether the browser supports <code>type="date"</code> inputs, we can use the <em>Modernizr</em> library.  This is an additional script in our template<a data-type="indexterm" data-primary="browsers" data-secondary="detecting features in" id="id-zdCXIecpIxtwi4"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">data-lift=</code><code class="s">"tail"</code>
  <code class="na">src=</code><code class="s">"//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/script&gt;</code></pre>

<p>We will use this in our snippet. In fact, there are  two changes we need to make to the snippet:</p>
<ol>
<li>
<p>Add the <code>type="date"</code> attribute to the input field.</p>
</li>
<li>
<p>Modify the JavaScript to only attach the jQuery UI date picker in browsers that don’t support the <code>type="date"</code> input.</p>
</li>

</ol>

<p>In code, that becomes:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>
  <code class="n">S</code><code class="o">.</code><code class="n">appendJs</code><code class="o">(</code><code class="n">enhance</code><code class="o">)</code>
  <code class="s">"#birthday"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">text</code><code class="o">(</code><code class="n">default</code><code class="o">,</code> <code class="n">logDate</code><code class="o">,</code> <code class="o">(</code><code class="s">"type"</code><code class="o">-&gt;</code><code class="s">"date"</code><code class="o">))</code>
<code class="o">}</code>

<code class="k">val</code> <code class="n">enhance</code> <code class="k">=</code> <code class="nc">Run</code><code class="o">(</code>
  <code class="s">"""</code>
<code class="s">    |if (!Modernizr.inputtypes.date) {</code>
<code class="s">    | $('input[type=date]').datepicker({dateFormat: 'yy-mm-dd'});</code>
<code class="s">    |}</code>
<code class="s">  """</code><code class="o">.</code><code class="n">stripMargin</code><code class="o">)</code></pre>

<p>The <code>"type" -&gt; "date"</code> parameter on <code>SHtml.text</code> is setting the attribute <code>type</code> to the value <code>date</code> on the resulting <code>&lt;input&gt;</code> field.</p>

<p>When this snippet runs, and the page is rendered, the jQuery UI date picker will be attached to input fields of <code>type="date"</code> only if the browser doesn’t support that type already.</p>
</section>



</section>













<section data-type="sect2" id="see-also-XQsXhGiv">
<h2>See Also</h2>

<p><a href="http://bit.ly/198JaCB"><em>Dive into HTML5</em></a> describes how to detect browser <span class="keep-together">features.</span></p>

<p><a href="http://api.jqueryui.com/datepicker/">The jQuery UI API documentation</a> lists the various configuration options for the date picker.</p>

<p>The HTML5 <code>date</code> input types submit dates in <a href="http://bit.ly/11Bl9hi">RFC 3339 format</a>.</p>
</section>





</section>













<section data-type="sect1" id="Autocomplete">
<h1>Making Suggestions with Autocomplete</h1>








<section data-type="sect2" id="problem-PasxFPuP">
<h2>Problem</h2>

<p>You want to provide an autocomplete widget, to give users suggestions as they type into a text field.<a data-type="indexterm" id="ix_FPauto" data-primary="forms processing" data-secondary="autocomplete suggestions"></a><a data-type="indexterm" id="ix_autocomp" data-primary="autocomplete suggestions"></a></p>
</section>













<section data-type="sect2" id="solution-OKsOIdu4">
<h2>Solution</h2>

<p>Use a JavaScript autocomplete widget, for example, the jQuery UI autocomplete via the <code>AutoComplete</code> class from the Lift widgets module.<a data-type="indexterm" data-primary="jQuery UI autocomplete" id="id-e4CAFJFqIguQ"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="Widgets module" id="id-GnC7IgFkIQuQ"></a><a data-type="indexterm" data-primary="Lift modules" id="id-DnCqtWFgIauL"></a><a data-type="indexterm" data-primary="autocomplete suggestions" data-secondary="jQuery UI for" id="id-kVCvhpFpIXuQ"></a></p>

<p>Start by adding the Lift widgets module to your <em>build.sbt</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">libraryDependencies</code> <code class="o">+=</code> <code class="s">"net.liftmodules"</code> <code class="o">%%</code> <code class="s">"widgets_2.5"</code> <code class="o">%</code> <code class="s">"1.3"</code></pre>

<p>To enable the autocomplete widget, initialise it in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftmodules.widgets.autocomplete.AutoComplete</code>
<code class="nc">AutoComplete</code><code class="o">.</code><code class="n">init</code><code class="o">()</code></pre>

<p>We can create a regular form snippet:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">data-lift=</code><code class="s">"ProgrammingLanguages?form=post"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"autocomplete"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/form&gt;</code></pre>

<p>Connect the <code>AutoComplete</code> class to the element with the ID of <code>autocomplete</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>

<code class="k">import</code> <code class="nn">net.liftmodules.widgets.autocomplete.AutoComplete</code>

<code class="k">class</code> <code class="nc">ProgrammingLanguages</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">languages</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code>
    <code class="s">"C"</code><code class="o">,</code> <code class="s">"C++"</code><code class="o">,</code> <code class="s">"Clojure"</code><code class="o">,</code> <code class="s">"CoffeeScript"</code><code class="o">,</code>
    <code class="s">"Java"</code><code class="o">,</code> <code class="s">"JavaScript"</code><code class="o">,</code>
    <code class="s">"POP-11"</code><code class="o">,</code> <code class="s">"Prolog"</code><code class="o">,</code> <code class="s">"Python"</code><code class="o">,</code> <code class="s">"Processing"</code><code class="o">,</code>
    <code class="s">"Scala"</code><code class="o">,</code> <code class="s">"Scheme"</code><code class="o">,</code> <code class="s">"Smalltalk"</code><code class="o">,</code> <code class="s">"SuperCollider"</code>
  <code class="o">)</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">val</code> <code class="n">default</code> <code class="k">=</code> <code class="s">""</code>

    <code class="k">def</code> <code class="n">suggest</code><code class="o">(</code><code class="n">value</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">limit</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code> <code class="k">=</code>
      <code class="n">languages</code><code class="o">.</code><code class="n">filter</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">toLowerCase</code><code class="o">.</code><code class="n">startsWith</code><code class="o">(</code><code class="n">value</code><code class="o">))</code>

    <code class="k">def</code> <code class="n">submit</code><code class="o">(</code><code class="n">value</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code>
      <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Value submitted: "</code><code class="o">+</code><code class="n">value</code><code class="o">)</code>

    <code class="s">"#autocomplete"</code> <code class="o">#&gt;</code> <code class="nc">AutoComplete</code><code class="o">(</code><code class="n">default</code><code class="o">,</code> <code class="n">suggest</code><code class="o">,</code> <code class="n">submit</code><code class="o">)</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>The last line of this snippet shows the binding of the <code>AutoComplete</code> class, which takes:</p>

<ul>
<li>
<p>A default value to show</p>
</li>
<li>
<p>A function that will produce suggestions from the text value entered—the result is a <code>Seq[String]</code> of suggestions</p>
</li>
<li>
<p>A function to call when the form is submitted</p>
</li>
</ul>

<p>Running this code renders as shown in <a data-type="xref" href="#AutoCompleteWidgetScreenGrab">Figure 3-2</a>.</p>

<figure id="AutoCompleteWidgetScreenGrab">
<img src="images/lfcb_0302.png" alt="lfcb 0302">
<figcaption><span class="label">Figure 3-2. </span>The rendering of the ProgrammingLanguages snippet</figcaption>
</figure>

<p>When the form is submitted, the <code>submit</code> function will be passed the selected value. The <code>submit</code> function is simply logging this value:</p>

<pre data-type="programlisting"> INFO  code.snippet.ProgrammingLanguages - Value submitted: Scala</pre>
</section>













<section data-type="sect2" id="discussion-XQsbtluv">
<h2>Discussion</h2>

<p>The autocomplete widget uses jQuery autocomplete. This can be seen by examining the <code>NodeSeq</code> produced by the <code>AutoComplete.apply</code> method:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"> <code class="nt">&lt;span&gt;</code>
  <code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;link</code> <code class="na">type=</code><code class="s">"text/css"</code> <code class="na">rel=</code><code class="s">"stylesheet"</code>
    <code class="na">href=</code><code class="s">"/classpath/autocomplete/jquery.autocomplete.css"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/link&gt;</code>
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code>
    <code class="na">src=</code><code class="s">"/classpath/autocomplete/jquery.autocomplete.js"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/script&gt;</code>
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>
<code class="c1">// &lt;![CDATA[</code>
  <code class="nx">jQuery</code><code class="p">(</code><code class="nb">document</code><code class="p">).</code><code class="nx">ready</code><code class="p">(</code><code class="kd">function</code><code class="p">(){</code>
    <code class="kd">var</code> <code class="nx">data</code> <code class="o">=</code> <code class="s2">"/ajax_request?F846528841915S2RBI0=foo"</code><code class="p">;</code>
    <code class="nx">jQuery</code><code class="p">(</code><code class="s2">"#F846528841916S3QZ0V"</code><code class="p">).</code>
      <code class="nx">autocomplete</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code> <code class="p">{</code><code class="nx">minChars</code><code class="o">:</code><code class="mi">0</code><code class="p">,</code><code class="nx">matchContains</code><code class="o">:</code><code class="kc">true</code><code class="p">}).</code>
      <code class="nx">result</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">event</code><code class="p">,</code> <code class="nx">dt</code><code class="p">,</code> <code class="nx">formatted</code><code class="p">)</code> <code class="p">{</code>
       <code class="nx">jQuery</code><code class="p">(</code><code class="s2">"#F846528841917CF4ZGL"</code><code class="p">).</code><code class="nx">val</code><code class="p">(</code><code class="nx">formatted</code><code class="p">);</code>
      <code class="p">}</code>
     <code class="p">);</code>
  <code class="p">});;</code>
<code class="c1">// ]]&gt;</code>
<code class="nt">&lt;/script&gt;</code>
  <code class="nt">&lt;/head&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">value=</code><code class="s">""</code> <code class="na">id=</code><code class="s">"F846528841916S3QZ0V"</code><code class="nt">&gt;&lt;/input&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">name=</code><code class="s">"F846528841917CF4ZGL"</code> <code class="na">type=</code><code class="s">"hidden"</code> <code class="na">value=</code><code class="s">""</code>
   <code class="na">id=</code><code class="s">"F846528841917CF4ZGL"</code><code class="nt">&gt;&lt;/input&gt;</code>
<code class="nt">&lt;/span&gt;</code></pre>

<p>This chunk of markup is generated from the <code>AutoComplete(default, suggest, submit)</code> call. What’s happening here is that the jQuery UI autocomplete JavaScript and CSS, which is bundled with the Lift widgets module, is being included on the page. Recall from <a data-type="xref" href="#AddToHead">Adding to the Head of a Page</a> that Lift will merge the <code>&lt;head&gt;</code> part of this markup into the <code>&lt;head&gt;</code> of the final HTML page.</p>

<p>When the page loads, the jQuery UI <code>autocomplete</code> function is bound to the input field, and configured with a URL, which will deliver the user’s input to our <code>suggest</code> function.  All <code>suggest</code> needs to do is return a <code>Seq[String]</code> of values for the jQuery autocomplete code to display to the user.</p>
<div data-type="note" id="jQuery19Migrate"><h6>Note</h6><h1>jQuery 1.9</h1>
<p>jQuery 1.9 removed the <code>$.browser</code> method that the Autocomplete
Widget needs. The work-around for this is to include the
jQuery migration package in your template:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">data-lift=</code><code class="s">"head"</code>
  <code class="na">src=</code><code class="s">"http://code.jquery.com/jquery-migrate-1.2.1.js"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/script&gt;</code></pre>
</div>










<section data-type="sect3" id="submitting-new-values-q8sBcltyuw">
<h3>Submitting new values</h3>

<p>One peculiarity of the <code>AutoComplete</code> widget is that if you type in a new value—one not suggested—and press submit, it is not sent to the server.  That is, you need to click on one of the suggestions to select it.  If that’s not the behaviour you want, you can <span class="keep-together">adjust it.</span><a data-type="indexterm" data-primary="autocomplete suggestions" data-secondary="new values and" id="id-zdCXIGFjcxteu4"></a><a data-type="indexterm" data-primary="S." data-secondary="appendJs" id="id-yYCgtpFPc4tNuV"></a></p>

<p>Inside the <code>render</code> method, we can modify the behaviour by adding JavaScript to the page:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.S</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.Run</code>
<code class="n">S</code><code class="o">.</code><code class="n">appendJs</code><code class="o">(</code><code class="nc">Run</code><code class="o">(</code>
<code class="s">"""</code>
<code class="s">  |$('#autocomplete input[type=text]').bind('blur',function() {</code>
<code class="s">  |  $(this).next().val($(this).val());</code>
<code class="s">  |});</code>
<code class="s">"""</code><code class="o">.</code><code class="n">stripMargin</code><code class="o">))</code></pre>

<p>With this in place, when the input field loses focus—for example, when the submit button is pressed—the value of the input field is stored as the value to be sent to the server.</p>
</section>













<section data-type="sect3" id="alternative-autocomplete-javascript-1LsKiJtKud">
<h3>Alternative autocomplete JavaScript</h3>

<p>Looking at the way the widget module builds autocomplete functionality may give you an insight into how you can incorporate other JavaScript autocomplete libraries into your Lift application.  The idea is to include the JavaScript library, connect it to an element on the page, and then arrange for the server to be called to generate suggestions.  Of course, if you only have a few items for the user to pick from, you could just include those items on the page, rather than making a round trip to the server.<a data-type="indexterm" data-primary="autocomplete suggestions" data-secondary="alternative libraries for" id="id-ZbCxSMFqirtBuM"></a></p>

<p>As an example of server-generated suggestions, we can look at the <em>Typeahead</em> component that is included in Twitter Bootstrap.<a data-type="indexterm" data-primary="Typeahead component" id="id-yYCyF1IKi4tNuV"></a><a data-type="indexterm" data-primary="Twitter Bootstrap" id="id-VMCQIoIriatMuM"></a><a data-type="indexterm" data-primary="Bootstrap" id="id-rjCwtgI0iYtYuP"></a></p>

<p>To incorporate Typeahead, the template needs to change to include the library and mark the input field in the way Typeahead expects<a data-type="indexterm" data-primary="autocomplete suggestions" data-secondary="Typeahead" id="id-yYCASktKi4tNuV"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="o">&lt;</code><code class="n">link</code> <code class="n">data</code><code class="o">-</code><code class="n">lift</code><code class="o">=</code><code class="s">"head"</code> <code class="n">rel</code><code class="o">=</code><code class="s">"stylesheet"</code>
  <code class="n">href</code><code class="o">=</code><code class="s">"//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/</code>
<code class="s">        bootstrap-combined.min.css"</code><code class="o">&gt;</code>

<code class="o">&lt;</code><code class="n">script</code> <code class="n">data</code><code class="o">-</code><code class="n">lift</code><code class="o">=</code><code class="s">"tail"</code>
  <code class="n">src</code><code class="o">=</code><code class="s">"//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="n">script</code><code class="o">&gt;</code>

<code class="o">&lt;</code><code class="n">form</code> <code class="n">data</code><code class="o">-</code><code class="n">lift</code><code class="o">=</code><code class="s">"ProgrammingLanguagesTypeAhead"</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">script</code> <code class="n">id</code><code class="o">=</code><code class="s">"js"</code><code class="o">&gt;&lt;/</code><code class="n">script</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">input</code> <code class="n">id</code><code class="o">=</code><code class="s">"autocomplete"</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code>
    <code class="n">data</code><code class="o">-</code><code class="n">provide</code><code class="o">=</code><code class="s">"typeahead"</code> <code class="n">autocomplete</code><code class="o">=</code><code class="s">"off"</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code></pre>

<p>We’ve included a placeholder with an ID of <code>js</code> for the JavaScript that will call back to the server. We’ll get to that in a moment.</p>

<p>The way Typeahead works is that we attach it to our input field and tell it to call a JavaScript function when it needs to make suggestions.  That JavaScript function is going to be called <code>askServer</code>, and it is given two arguments: the input the user has typed so far (<code>query</code>), and a JavaScript function to call when the suggestions are available (<code>callback</code>).  The Lift snippet needs to use the <code>query</code> value and then call the JavaScript <code>callback</code> function with whatever suggestions are made.<a data-type="indexterm" data-primary="autocomplete suggestions" data-secondary="query/callback functions" id="id-jyC9TlcDiXtKu1"></a></p>

<p>A snippet to implement this would be as follows:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.</code><code class="o">{</code><code class="nc">Full</code><code class="o">,</code> <code class="nc">Empty</code><code class="o">,</code> <code class="nc">Loggable</code><code class="o">}</code>

<code class="k">import</code> <code class="nn">net.liftweb.http._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.Run</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JE.JsVar</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.JsonAST._</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.DefaultFormats</code>

<code class="k">class</code> <code class="nc">ProgrammingLanguagesTypeAhead</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">languages</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code>
    <code class="s">"C"</code><code class="o">,</code> <code class="s">"C++"</code><code class="o">,</code> <code class="s">"Clojure"</code><code class="o">,</code> <code class="s">"CoffeeScript"</code><code class="o">,</code>
    <code class="s">"Java"</code><code class="o">,</code> <code class="s">"JavaScript"</code><code class="o">,</code>
    <code class="s">"POP-11"</code><code class="o">,</code> <code class="s">"Prolog"</code><code class="o">,</code> <code class="s">"Python"</code><code class="o">,</code> <code class="s">"Processing"</code><code class="o">,</code>
    <code class="s">"Scala"</code><code class="o">,</code> <code class="s">"Scheme"</code><code class="o">,</code> <code class="s">"Smalltalk"</code><code class="o">,</code> <code class="s">"SuperCollider"</code>
  <code class="o">)</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">implicit</code> <code class="k">val</code> <code class="n">formats</code> <code class="k">=</code> <code class="nc">DefaultFormats</code>

    <code class="k">def</code> <code class="n">suggest</code><code class="o">(</code><code class="n">value</code><code class="k">:</code> <code class="kt">JValue</code><code class="o">)</code> <code class="k">:</code> <code class="kt">JValue</code> <code class="o">=</code> <code class="o">{</code>
      <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Making suggestion for: "</code><code class="o">+</code><code class="n">value</code><code class="o">)</code>

      <code class="k">val</code> <code class="n">matches</code> <code class="k">=</code> <code class="k">for</code> <code class="o">{</code>
        <code class="n">q</code> <code class="k">&lt;-</code> <code class="n">value</code><code class="o">.</code><code class="n">extractOpt</code><code class="o">[</code><code class="kt">String</code><code class="o">].</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">toLowerCase</code><code class="o">).</code><code class="n">toList</code>
        <code class="n">lang</code> <code class="k">&lt;-</code> <code class="n">languages</code><code class="o">.</code><code class="n">filter</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">toLowerCase</code> <code class="n">startsWith</code> <code class="n">q</code><code class="o">)</code>
      <code class="o">}</code> <code class="k">yield</code> <code class="nc">JString</code><code class="o">(</code><code class="n">lang</code><code class="o">)</code>

      <code class="nc">JArray</code><code class="o">(</code><code class="n">matches</code><code class="o">)</code>
    <code class="o">}</code>

    <code class="k">val</code> <code class="n">callbackContext</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">JsonContext</code><code class="o">(</code><code class="nc">Full</code><code class="o">(</code><code class="s">"callback"</code><code class="o">),</code><code class="nc">Empty</code><code class="o">)</code>

    <code class="k">val</code> <code class="n">runSuggestion</code> <code class="k">=</code>
      <code class="nc">SHtml</code><code class="o">.</code><code class="n">jsonCall</code><code class="o">(</code><code class="nc">JsVar</code><code class="o">(</code><code class="s">"query"</code><code class="o">),</code> <code class="n">callbackContext</code><code class="o">,</code> <code class="n">suggest</code> <code class="k">_</code> <code class="o">)</code>

    <code class="n">S</code><code class="o">.</code><code class="n">appendJs</code><code class="o">(</code><code class="nc">Run</code><code class="o">(</code>
      <code class="s">"""</code>
<code class="s">        |$('#autocomplete').typeahead({</code>
<code class="s">        |  source: askServer</code>
<code class="s">        |});</code>
<code class="s">      """</code><code class="o">.</code><code class="n">stripMargin</code><code class="o">))</code>

    <code class="s">"#js *"</code> <code class="o">#&gt;</code> <code class="nc">Function</code><code class="o">(</code><code class="s">"askServer"</code><code class="o">,</code> <code class="s">"query"</code> <code class="o">::</code> <code class="s">"callback"</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code>
                  <code class="nc">Run</code><code class="o">(</code><code class="n">runSuggestion</code><code class="o">.</code><code class="n">toJsCmd</code><code class="o">))</code> <code class="o">&amp;</code>
    <code class="s">"#autocomplete"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">text</code><code class="o">(</code><code class="s">""</code><code class="o">,</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Submitted: "</code><code class="o">+</code><code class="n">s</code><code class="o">))</code>

  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Working from the bottom of the snippet, we bind a regular Lift <code>SHtml.text</code> input to the autocomplete field.  This will receive the selected value when the form is submitted.  We also bind the JavaScript placeholder to a JavaScript function definition called <code>askServer</code>.  This is the function that Typeahead will call when it wants suggestions.<a data-type="indexterm" data-primary="S." data-secondary="appendJs" id="id-jyCjIzUDiXtKu1"></a></p>

<p>The JavaScript function we’re defining takes two arguments: the <code>query</code> and <code>callback</code>. The body of <code>askServer</code> causes it to run something called <code>runSuggestion</code>, which is a <code>jsonCall</code> to the server, with the value of the <code>query</code>.</p>

<p>The suggestions are made by the <code>suggest</code> function, which expects to be able to find a <code>String</code> in the passed in JSON value. It uses this value to find matches in the list of <code>languages</code>.  These are returned as a <code>JArray</code> of <code>JString</code>, which is treated as JSON data back on the client.</p>

<p>What does the client do with the data? It calls the <code>callback</code> function with the suggestions, which results in the display updating. We specify its <code>callback</code> via <code>JsonContext</code>, which is a class that lets us specify a custom function to call on success of the request to the server.</p>

<p>It may help to understand this by looking at the JavaScript generated in the HTML page for <code>askServer</code>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">id=</code><code class="s">"js"</code><code class="nt">&gt;</code>
<code class="kd">function</code> <code class="nx">askServer</code><code class="p">(</code><code class="nx">query</code><code class="p">,</code> <code class="nx">callback</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">liftAjax</code><code class="p">.</code><code class="nx">lift_ajaxHandler</code><code class="p">(</code><code class="s1">'F268944843717UZB5J0='</code> <code class="o">+</code>
    <code class="nb">encodeURIComponent</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">query</code><code class="p">)),</code> <code class="nx">callback</code><code class="p">,</code> <code class="kc">null</code><code class="p">,</code> <code class="s2">"json"</code><code class="p">)</code>
<code class="p">}</code>
<code class="nt">&lt;/script&gt;</code></pre>

<p>As the user types into the text field, Typeahead calls <code>askServer</code> with the input supplied. Lift’s Ajax support arranges for that value, <code>query</code>, to be  serialised to our <code>suggest</code> function on the server, and for the results to be passed to <code>callback</code>. At that point, Typeahead takes over again and displays the suggestions.</p>

<p>Typing <strong><code>Scala</code></strong> to the text field and pressing submit will produce a sequence like this on the server:</p>

<pre data-type="programlisting">INFO  c.s.ProgrammingLanguagesTypeAhead - Making suggestion for: JString(Sc)
INFO  c.s.ProgrammingLanguagesTypeAhead - Making suggestion for: JString(Sca)
INFO  c.s.ProgrammingLanguagesTypeAhead - Making suggestion for: JString(Sca)
INFO  c.s.ProgrammingLanguagesTypeAhead - Making suggestion for: JString(Scal)
INFO  c.s.ProgrammingLanguagesTypeAhead - Making suggestion for: JString(Scala)
INFO  c.s.ProgrammingLanguagesTypeAhead - Submitted: Scala</pre>
</section>



</section>













<section data-type="sect2" id="see-also-jWskhjuD">
<h2>See Also</h2>

<p><a data-type="xref" href="#ButtonTriggerServerCode">Trigger Server-Side Code from a Button</a> describes <code>jsonCall</code>.</p>

<p>The behaviour of the widget module with respect to new values is described in a ticket on the <a href="http://bit.ly/144McVx">module’s GitHub page</a>. Enhancing modules is one route to get involved with Lift, and <a data-type="xref" href="#ContributingAndHelp">Contributing, Bug Reports, and Getting Help</a> describes other ways to contribute.</p>

<p><a href="http://jqueryui.com/autocomplete/">The jQuery UI Autocomplete documentation</a> describes how to configure the widget. The version included with the Lift widgets module is version 1.0.2.<a data-type="indexterm" data-startref="ix_FPauto" id="id-4nC2Fqtkh0ud"></a><a data-type="indexterm" data-startref="ix_autocomp" id="id-JnCmI7tkhyun"></a></p>

<p><a href="http://bit.ly/11FA1w1">The Typeahead widget</a> is part of Twitter Bootstrap.<a data-type="indexterm" data-primary="Typeahead component" id="id-JnCzFLhkhyun"></a></p>
</section>





</section>













<section data-type="sect1" id="Radio">
<h1>Offering Choices with Radio Buttons</h1>








<section data-type="sect2" id="problem-OKsLFlU4">
<h2>Problem</h2>

<p>You want users to select an option using radio buttons.<a data-type="indexterm" id="ix_FPradbut" data-primary="forms processing" data-secondary="radio buttons"></a><a data-type="indexterm" id="ix_radbut" data-primary="radio buttons"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKIZUv">
<h2>Solution</h2>

<p>Use <code>SHtml.radioElem</code> to present the options as radio buttons.</p>

<p>To illustrate this, let’s create a form to allow a user to indicate his gender:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">BirthGender</code> <code class="k">extends</code> <code class="nc">Enumeration</code> <code class="o">{</code>
  <code class="k">type</code> <code class="kt">BirthGender</code> <code class="o">=</code> <code class="nc">Value</code>
  <code class="k">val</code> <code class="nc">Male</code> <code class="k">=</code> <code class="nc">Value</code><code class="o">(</code><code class="s">"Male"</code><code class="o">)</code>
  <code class="k">val</code> <code class="nc">Female</code> <code class="k">=</code> <code class="nc">Value</code><code class="o">(</code><code class="s">"Female"</code><code class="o">)</code>
  <code class="k">val</code> <code class="nc">NotSpecified</code> <code class="k">=</code> <code class="nc">Value</code><code class="o">(</code><code class="s">"Rather Not Say"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>We’re using an enumeration, but it could be any class. The <code>toString</code> of the class will be used as the label shown to the user.</p>

<p>To present these options and handle the selection of an option, we use this enumeration in a snippet:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.common._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.ChoiceHolder</code>

<code class="k">object</code> <code class="nc">Radio</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">import</code> <code class="nn">BirthGender._</code>

  <code class="k">val</code> <code class="n">options</code> <code class="k">:</code> <code class="kt">Seq</code><code class="o">[</code><code class="kt">BirthGender</code><code class="o">]</code> <code class="k">=</code> <code class="nc">BirthGender</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">toSeq</code>

  <code class="k">val</code> <code class="n">default</code> <code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">BirthGender</code><code class="o">]</code> <code class="k">=</code> <code class="nc">Empty</code>

  <code class="k">val</code> <code class="n">radio</code> <code class="k">:</code> <code class="kt">ChoiceHolder</code><code class="o">[</code><code class="kt">BirthGender</code><code class="o">]</code> <code class="k">=</code>
    <code class="nc">SHtml</code><code class="o">.</code><code class="n">radioElem</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">default</code><code class="o">)</code> <code class="o">{</code> <code class="n">selected</code> <code class="k">=&gt;</code>
      <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Choice: "</code><code class="o">+</code><code class="n">selected</code><code class="o">)</code>
    <code class="o">}</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">".options"</code> <code class="o">#&gt;</code> <code class="n">radio</code><code class="o">.</code><code class="n">toForm</code>
<code class="o">}</code></pre>

<p>Rather than generate the radio buttons in one expression on the <code>render</code> method, we’ve pulled out the intermediate values to show their types. The <code>radio.toForm</code> call is generating the radio buttons, and we’re binding them to the CSS selector <code>.option</code> in the following template:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"Radio?form=post"</code><code class="nt">&gt;</code>

  <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"options"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"radio"</code><code class="nt">&gt;</code>Option 1<code class="nt">&lt;/input&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"radio"</code><code class="nt">&gt;</code>Option 2<code class="nt">&lt;/input&gt;</code>
  <code class="nt">&lt;/span&gt;</code>

  <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Submit"</code><code class="nt">&gt;</code>

<code class="nt">&lt;/div&gt;</code></pre>

<p>The <code>class="options"</code> span will be replaced with the radio buttons from the code, and when the form is submitted, the function supplied to <code>SHtml.radioElem</code> will be called, resulting in the selected value being logged. For example, if no radio button is selected:</p>

<pre data-type="programlisting">INFO  code.snippet.Radio - Choice: Empty</pre>

<p>or if the third button was selected:</p>

<pre data-type="programlisting">INFO  code.snippet.Radio - Choice: Full(Rather Not Say)</pre>
</section>













<section data-type="sect2" id="discussion-jWsvtzUD">
<h2>Discussion</h2>

<p>Many of the Lift <code>SHtml</code> methods return a <code>NodeSeq</code>, which can be directly bound into our HTML. However, <code>radioElem</code> is different in that it gives us a <code>ChoiceHolder[T]</code>, and to generate a <code>NodeSeq</code> from that, we’re calling <code>toForm</code>.  This has implications for how you customise radio buttons, as we’ll see later.</p>

<p>The <code>radioElem</code> method expects three parameters:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">SHtml</code><code class="o">.</code><code class="n">radioElem</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">default</code><code class="o">)</code> <code class="o">{</code> <code class="n">selected</code> <code class="k">=&gt;</code>
  <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Choice: "</code><code class="o">+</code><code class="n">selected</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>The first is the set of options to show, as a <code>Seq[T]</code>. The second is the value to be preselected, as a <code>Box[T]</code>.  In the example, we have no preselected value, which is represented as <code>Empty</code>.  Finally, there’s the function to run when the form is submitted, of type <code>Box[T] =&gt; Any</code>.</p>

<p>Note that even if the user selects no value, your function will be called, and it will be passed the value <code>Empty</code>.</p>

<p>To understand a little more of what’s happening, take a look at the default HTML produced by <code>radioElem</code>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;span&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">value=</code><code class="s">"F317293945993CDMQZ"</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"F317293946030HYAFP"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">name=</code><code class="s">"F317293946030HYAFP"</code> <code class="na">type=</code><code class="s">"hidden"</code> <code class="na">value=</code><code class="s">"F317293946022HCGEG"</code><code class="nt">&gt;</code>
 Male<code class="nt">&lt;br&gt;</code>
<code class="nt">&lt;/span&gt;</code>
<code class="nt">&lt;span&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">value=</code><code class="s">"F31729394600RIE253"</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"F317293946030HYAFP"</code><code class="nt">&gt;</code>
 Female<code class="nt">&lt;br&gt;</code>
<code class="nt">&lt;/span&gt;</code>
<code class="nt">&lt;span&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">value=</code><code class="s">"F317293946011OMEMM"</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"F317293946030HYAFP"</code><code class="nt">&gt;</code>
 Rather Not Say<code class="nt">&lt;br&gt;</code>
<code class="nt">&lt;/span&gt;</code></pre>

<p>Notice that:</p>

<ul>
<li>
<p>All the input fields have the same randomly generated name.</p>
</li>
<li>
<p>The input fields have randomly generated values.</p>
</li>
<li>
<p>There’s a hidden field added to the first item.</p>
</li>
</ul>

<p>This might be a surprise if you were just expecting something like this:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"gender"</code> <code class="na">value=</code><code class="s">"Male"</code><code class="nt">&gt;</code>Male<code class="nt">&lt;br&gt;</code>
<code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"gender"</code> <code class="na">value=</code><code class="s">"Female"</code><code class="nt">&gt;</code>Female<code class="nt">&lt;br&gt;</code>
<code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"gender"</code> <code class="na">value=</code><code class="s">"NotSpecified"</code><code class="nt">&gt;</code>Rather Not Say<code class="nt">&lt;br&gt;</code></pre>

<p>By using random values, Lift has helped us by protecting against a range of form-based attacks, such as submitting values we’re not expected, or setting values on fields we don’t want set.<a data-type="indexterm" data-primary="security" data-secondary="form-based attacks" id="id-wqC7S7HBtQUJ"></a></p>

<p>Each of the random radio button values is associated, on the server, with a <code>BirthGender</code> value from our <code>options</code> sequence. When the form is submitted, Lift picks out the selected value (if any), looks up the corresponding <code>BirthGender</code> value, and calls our function.</p>

<p>The hidden field ensures that the function will be called even if no radio button is selected. This is because the browser will at least submit the hidden field, and this is enough to trigger the server-side function.<a data-type="indexterm" data-primary="hidden fields" id="id-PnCpS0SAtMUa"></a></p>










<section data-type="sect3" id="customising-the-html-BVsXFJtLUY">
<h3>Customising the HTML</h3>

<p>The default HTML wraps each radio button in a <code>&lt;span&gt;</code> and separates them with a <code>&lt;br&gt;</code>.  Let’s change that to make it work well with the <em>Twitter Bootstrap</em> framework, and put each choice in a <code>&lt;label&gt;</code> and give it a class.</p>

<p>To customise the HTML, you need to understand that the <code>ChoiceHolder</code> is a container for a sequence of items.  Each item is a <code>ChoiceItem</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">final</code> <code class="k">case</code> <code class="k">class</code> <code class="nc">ChoiceItem</code><code class="o">[</code><code class="kt">T</code><code class="o">](</code><code class="n">key</code><code class="k">:</code> <code class="kt">T</code><code class="o">,</code> <code class="n">xhtml</code><code class="k">:</code> <code class="kt">NodeSeq</code><code class="o">)</code></pre>

<p>The <code>key</code> in our example is a <code>BirthGender</code> instance, and the <code>xhtml</code> is the radio button input field (plus the hidden field for the first option).  With this knowledge, we can write a helper to generate a <code>NodeSeq</code> in the style we want:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">scala.xml.NodeSeq</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.ChoiceItem</code>

<code class="k">object</code> <code class="nc">LabelStyle</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">htmlize</code><code class="o">[</code><code class="kt">T</code><code class="o">](</code><code class="n">item</code><code class="k">:</code> <code class="kt">ChoiceItem</code><code class="o">[</code><code class="kt">T</code><code class="o">])</code> <code class="k">:</code> <code class="kt">NodeSeq</code> <code class="o">=</code>
   <code class="o">&lt;</code><code class="n">label</code> <code class="n">class</code><code class="o">=</code><code class="s">"radio"</code><code class="o">&gt;{</code><code class="n">item</code><code class="o">.</code><code class="n">xhtml</code><code class="o">}</code> <code class="o">{</code><code class="n">item</code><code class="o">.</code><code class="n">key</code><code class="o">.</code><code class="n">toString</code><code class="o">}&lt;/</code><code class="n">label</code><code class="o">&gt;</code>

  <code class="k">def</code> <code class="n">toForm</code><code class="o">[</code><code class="kt">T</code><code class="o">](</code><code class="n">holder</code><code class="k">:</code> <code class="kt">ChoiceHolder</code><code class="o">[</code><code class="kt">T</code><code class="o">])</code> <code class="k">:</code> <code class="kt">NodeSeq</code> <code class="o">=</code>
   <code class="n">holder</code><code class="o">.</code><code class="n">items</code><code class="o">.</code><code class="n">flatMap</code><code class="o">(</code><code class="n">htmlize</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>The <code>htmlize</code> method produces a <code>&lt;label&gt;</code> element with the class we want, and it contains the radio input (<code>item.xhtml</code>) and the text of the label (<code>item.key.toString</code>).  The <code>toForm</code> is applying the <code>htmlize</code> function to all the choices.</p>

<p>We can apply this in our snippet:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">".options"</code> <code class="o">#&gt;</code> <code class="nc">LabelStyle</code><code class="o">.</code><code class="n">toForm</code><code class="o">(</code><code class="n">radio</code><code class="o">)</code></pre>

<p>and the result would be the following:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"radio"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">value=</code><code class="s">"F234668654428LWW305"</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"F234668654432WS5LWK"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">name=</code><code class="s">"F234668654432WS5LWK"</code> <code class="na">type=</code><code class="s">"hidden"</code> <code class="na">value=</code><code class="s">"F234668654431KYJB3S"</code><code class="nt">&gt;</code>
 Male
<code class="nt">&lt;/label&gt;</code>
<code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"radio"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">value=</code><code class="s">"F234668654429MB5RF3"</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"F234668654432WS5LWK"</code><code class="nt">&gt;</code>
 Female
<code class="nt">&lt;/label&gt;</code>
<code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"radio"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">value=</code><code class="s">"F234668654430YULGC1"</code> <code class="na">type=</code><code class="s">"radio"</code> <code class="na">name=</code><code class="s">"F234668654432WS5LWK"</code><code class="nt">&gt;</code>
 Rather Not Say
<code class="nt">&lt;/label&gt;</code></pre>

<p>The <code>toForm</code> method could be wrapping the choices in some other HTML, such as a <code>&lt;ul&gt;</code>. But in this case, it’s not: it’s just applying <code>htmlize</code> to each <code>ChoiceItem</code>. As a consequence of this, we could make <code>LabelStyle</code> the default across our Lift application:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">ChoiceHolder</code><code class="o">.</code><code class="n">htmlize</code> <code class="k">=</code> <code class="n">c</code> <code class="k">=&gt;</code> <code class="nc">LabelStyle</code><code class="o">.</code><code class="n">htmlize</code><code class="o">(</code><code class="n">c</code><code class="o">)</code></pre>

<p>This works because <code>toForm</code> on <code>ChoiceHolder</code> defers to <code>ChoiceHolder.htmlize</code>, and <code>ChoiceHolder.htmlize</code> is a variable you can assign to.</p>
</section>













<section data-type="sect3" id="string-values-MQsKIgtmUq">
<h3>String values</h3>

<p>If you want to work directly with <code>String</code> values for options, you can use <code>SHtml.radio</code>.  Although it too produces a <code>ChoiceHolder</code>, it differs from <code>radioElem</code> in that it uses the same <code>String</code> as both the label and the value. The function associated with each option is called only if a value is selected by the user.</p>

<p>An <code>SHtml.radio</code> version of our example would look like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">SHtml</code><code class="o">.</code><code class="n">radio</code><code class="o">(</code>
  <code class="s">"Male"</code> <code class="o">::</code> <code class="s">"Female"</code> <code class="o">::</code> <code class="s">"Rather Not Say"</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code>
  <code class="nc">Empty</code><code class="o">,</code>
  <code class="n">selected</code> <code class="k">=&gt;</code> <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Choice: "</code><code class="o">+</code><code class="n">selected</code><code class="o">)</code>
<code class="o">)</code></pre>

<p>This is a similar structure to <code>radioElem</code>: there’s a list of options, a default, a function to call, and it produces a <code>ChoiceHolder[String]</code>.  When a form is submitted, our function is passed the <code>String</code> value of the selected option. If no radio buttons are selected, the function is not called.<a data-type="indexterm" data-startref="ix_FPradbut" id="id-1nCwtBhrIktPUv"></a><a data-type="indexterm" data-startref="ix_radbut" id="id-YQCghxhjIrtMU8"></a></p>
</section>



</section>





</section>













<section data-type="sect1" id="DisableCheckbox">
<h1>Conditionally Disable a Checkbox</h1>








<section data-type="sect2" id="problem-XQspFdCv">
<h2>Problem</h2>

<p>You want to add the <code>disabled</code> attribute to a <code>SHtml.checkbox</code> based on
a conditional check.<a data-type="indexterm" data-primary="forms processing" data-secondary="conditional disablement" id="id-DnCXIWFwFnCL"></a><a data-type="indexterm" data-primary="checkboxes" data-secondary="conditional disablement of" id="id-kVCltpFLFPCQ"></a><a data-type="indexterm" data-primary="conditional checks" id="id-4nCrhYFVFlCd"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="CSS selector transforms" id="id-JnC0TlFNF2Cn"></a><a data-type="indexterm" data-primary="CSS selectors" data-secondary="and disabled attribute" id="id-9nCNcvFpF0Cr"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjI9CD">
<h2>Solution</h2>

<p>Create a CSS selector transform to add the disabled attribute, and apply
it to your checkbox transform.</p>

<p>For example, suppose you have a simple checkbox:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">Likes</code> <code class="o">{</code>
  <code class="k">var</code> <code class="n">likeTurtles</code> <code class="k">=</code> <code class="kc">false</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="s">"#like"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">checkbox</code><code class="o">(</code><code class="n">likeTurtles</code><code class="o">,</code> <code class="n">likeTurtles</code> <code class="k">=</code> <code class="k">_</code> <code class="o">)</code>
<code class="o">}</code></pre>

<p>and a corresponding template:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">content=</code><code class="s">"text/html; charset=UTF-8"</code> <code class="na">http-equiv=</code><code class="s">"content-type"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;title&gt;</code>Disable Checkboxes<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>

  <code class="nt">&lt;div&gt;</code>Select the things you like:<code class="nt">&lt;/div&gt;</code>

  <code class="nt">&lt;form</code> <code class="na">data-lift=</code><code class="s">"Likes"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"like"</code><code class="nt">&gt;</code>Do you like turtles?<code class="nt">&lt;/label&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"like"</code> <code class="na">type=</code><code class="s">"checkbox"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/form&gt;</code>

<code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>Further, suppose you want to disable it roughly 50% of the time. We could do that
by adjusting the <code>NodeSeq</code> generated from <code>SHtml.checkbox</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.PassThru</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>

<code class="k">class</code> <code class="nc">Likes</code> <code class="o">{</code>
  <code class="k">var</code> <code class="n">likesTurtles</code> <code class="k">=</code> <code class="kc">false</code>

  <code class="k">def</code> <code class="n">disable</code> <code class="k">=</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">math</code><code class="o">.</code><code class="n">random</code> <code class="o">&gt;</code> <code class="mf">0.5d</code><code class="o">)</code> <code class="s">"* [disabled]"</code> <code class="o">#&gt;</code> <code class="s">"disabled"</code>
    <code class="k">else</code> <code class="nc">PassThru</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="s">"#like"</code> <code class="o">#&gt;</code> <code class="n">disable</code><code class="o">(</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">checkbox</code><code class="o">(</code><code class="n">likesTurtles</code><code class="o">,</code> <code class="n">likesTurtles</code> <code class="k">=</code> <code class="k">_</code><code class="o">)</code> <code class="o">)</code>
<code class="o">}</code></pre>

<p>When the checkbox is rendered, it will be disabled roughly half the time.</p>
</section>













<section data-type="sect2" id="discussion-2ksLtzCY">
<h2>Discussion</h2>

<p>The <code>disable</code> method returns a <code>NodeSeq =&gt; NodeSeq</code> function, meaning
when we apply it, we need to give it a
<code>NodeSeq</code>, which is exactly what <code>SHtml.checkbox</code> provides.</p>

<p>The <code>[disabled]</code> part of the CSS selector is selecting the disabled
attribute and replacing it with the value on the right of the <code>#&gt;</code>,
which is "disabled" in this example.</p>

<p>What this combination means is that half the time the disabled attribute
will be set on the checkbox, and half the time the checkbox <code>NodeSeq</code>
will be left untouched because <code>PassThru</code> does not change the <code>NodeSeq</code>.</p>
</section>













<section data-type="sect2" id="see-also-pWsJhpCm">
<h2>See Also</h2>

<p><a data-type="xref" href="#PassThru">Returning Snippet Markup Unchanged</a> describes the <code>PassThru</code> function.</p>
</section>





</section>













<section data-type="sect1" id="MultiSelectBox">
<h1>Use a Select Box with Multiple Options</h1>








<section data-type="sect2" id="problem-jWslFnsD">
<h2>Problem</h2>

<p>You want to show a number of options in a select box, and allow
the user to select multiple values.<a data-type="indexterm" id="ix_FPmulval" data-primary="forms processing" data-secondary="multiple selections"></a><a data-type="indexterm" data-primary="multiple selections" id="id-DnCaFWFwFxsL"></a><a data-type="indexterm" data-primary="select boxes" id="id-kVCAIpFLF2sQ"></a><a data-type="indexterm" data-primary="checkboxes" data-secondary="multiple options" id="id-4nCPtYFVF2sd"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIMsY">
<h2>Solution</h2>

<p>Use <code>SHtml.multiSelect(options, default, selection)</code>.  Here’s an example where a user can select up to three options:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>

<code class="k">class</code> <code class="nc">MultiSelect</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">case</code> <code class="k">class</code> <code class="nc">Item</code><code class="o">(</code><code class="n">id</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">name</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">inventory</code> <code class="k">=</code>
    <code class="nc">Item</code><code class="o">(</code><code class="s">"a"</code><code class="o">,</code> <code class="s">"Coffee"</code><code class="o">)</code> <code class="o">::</code>
    <code class="nc">Item</code><code class="o">(</code><code class="s">"b"</code><code class="o">,</code> <code class="s">"Milk"</code><code class="o">)</code> <code class="o">::</code>
    <code class="nc">Item</code><code class="o">(</code><code class="s">"c"</code><code class="o">,</code> <code class="s">"Sugar"</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">val</code> <code class="n">options</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">String</code>,<code class="kt">String</code><code class="o">)]</code> <code class="k">=</code>
    <code class="n">inventory</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">i</code> <code class="k">=&gt;</code> <code class="o">(</code><code class="n">i</code><code class="o">.</code><code class="n">id</code> <code class="o">-&gt;</code> <code class="n">i</code><code class="o">.</code><code class="n">name</code><code class="o">))</code>

  <code class="k">val</code> <code class="n">default</code> <code class="k">=</code> <code class="n">inventory</code><code class="o">.</code><code class="n">head</code><code class="o">.</code><code class="n">id</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">def</code> <code class="n">selection</code><code class="o">(</code><code class="n">ids</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">String</code><code class="o">])</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
      <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Selected: "</code><code class="o">+</code><code class="n">ids</code><code class="o">)</code>
    <code class="o">}</code>

    <code class="s">"#opts *"</code> <code class="o">#&gt;</code>
      <code class="nc">SHtml</code><code class="o">.</code><code class="n">multiSelect</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">default</code><code class="o">,</code> <code class="n">selection</code><code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>In this example, the user is being presented with a list of three items, with the first one selected, as shown in <a data-type="xref" href="#MultiSelectExample">Figure 3-3</a>.  When the form is submitted, the <code>selection</code> function is called, with a list of the selected option values.</p>

<figure id="MultiSelectExample">
<img src="images/lfcb_0303.png" alt="lfcb 0303">
<figcaption><span class="label">Figure 3-3. </span>Selecting from multiple options</figcaption>
</figure>

<p>The template to go with the snippet could be:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"MultiSelect?form=post"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;p&gt;</code>What can I get you?<code class="nt">&lt;/p&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"opts"</code><code class="nt">&gt;</code>options go here<code class="nt">&lt;/div&gt;</code>
   <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Place Order"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>This will render as something like:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"/"</code> <code class="na">method=</code><code class="s">"post"</code><code class="nt">&gt;&lt;div&gt;</code>
  <code class="nt">&lt;p&gt;</code>What can I get you?<code class="nt">&lt;/p&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"opts"</code><code class="nt">&gt;</code>
   <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"F25749422319ALP1BW"</code> <code class="na">multiple=</code><code class="s">"true"</code><code class="nt">&gt;</code>
     <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"a"</code> <code class="na">selected=</code><code class="s">"selected"</code><code class="nt">&gt;</code>Coffee<code class="nt">&lt;/option&gt;</code>
     <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"b"</code><code class="nt">&gt;</code>Milk<code class="nt">&lt;/option&gt;</code>
     <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"c"</code><code class="nt">&gt;</code>Sugar<code class="nt">&lt;/option&gt;</code>
   <code class="nt">&lt;/select&gt;</code>
  <code class="nt">&lt;/div&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">value=</code><code class="s">"Place Order"</code> <code class="na">type=</code><code class="s">"submit"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/form&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-pWswtDsm">
<h2>Discussion</h2>

<p>Recall that an HTML select consists of a set of options, each of which
has a value and a name. To reflect this, the previous example takes our
<code>inventory</code> of objects and turns it into a list of string
pairs, called <code>options</code>.</p>

<p>The function given to <code>SHtml.multiSelect</code> will receive the values (IDs), not
the names, of the options. That is, if you ran the code, and
selected "Coffee" and "Milk," the function would see <code>List("a", "b")</code>.</p>










<section data-type="sect3" id="selecting-no-options-q8svtltLsw">
<h3>Selecting no options</h3>

<p>Be aware that if no options are selected, your handling function is
not called. This is described in <a href="https://github.com/lift/framework/issues/1139">issue 1139</a>.</p>

<p>One way to work around this is to add a hidden function to reset the list. For example, we
could modify the previous code to be a stateful snippet and remember the
values we selected<a data-type="indexterm" data-primary="hidden functions" id="id-ZbCxSmIMtrt2sM"></a><a data-type="indexterm" data-primary="functions" data-secondary="hidden" id="id-zdCkFzIDtxtns4"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="nc">StatefulSnippet</code><code class="o">,</code> <code class="nc">SHtml</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>

<code class="k">class</code> <code class="nc">MultiSelectStateful</code> <code class="k">extends</code> <code class="nc">StatefulSnippet</code> <code class="k">with</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">dispatch</code> <code class="k">=</code> <code class="o">{</code>
    <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="n">render</code>
  <code class="o">}</code>

  <code class="k">case</code> <code class="k">class</code> <code class="nc">Item</code><code class="o">(</code><code class="n">id</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">name</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">inventory</code> <code class="k">=</code>
    <code class="nc">Item</code><code class="o">(</code><code class="s">"a"</code><code class="o">,</code> <code class="s">"Coffee"</code><code class="o">)</code> <code class="o">::</code>
    <code class="nc">Item</code><code class="o">(</code><code class="s">"b"</code><code class="o">,</code> <code class="s">"Milk"</code><code class="o">)</code> <code class="o">::</code>
    <code class="nc">Item</code><code class="o">(</code><code class="s">"c"</code><code class="o">,</code> <code class="s">"Sugar"</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code></pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true">  <code class="k">val</code> <code class="n">options</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">String</code>,<code class="kt">String</code><code class="o">)]</code> <code class="k">=</code>
    <code class="n">inventory</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">i</code> <code class="k">=&gt;</code> <code class="o">(</code><code class="n">i</code><code class="o">.</code><code class="n">id</code> <code class="o">-&gt;</code> <code class="n">i</code><code class="o">.</code><code class="n">name</code><code class="o">))</code>

  <code class="k">var</code> <code class="n">current</code> <code class="k">=</code> <code class="n">inventory</code><code class="o">.</code><code class="n">head</code><code class="o">.</code><code class="n">id</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">def</code> <code class="n">logSelected</code><code class="o">()</code> <code class="k">=</code>
      <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Values selected: "</code><code class="o">+</code><code class="n">current</code><code class="o">)</code>

    <code class="s">"#opts *"</code> <code class="o">#&gt;</code> <code class="o">(</code>
      <code class="nc">SHtml</code><code class="o">.</code><code class="n">hidden</code><code class="o">(</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="n">current</code> <code class="k">=</code> <code class="nc">Nil</code><code class="o">)</code> <code class="o">++</code>
      <code class="nc">SHtml</code><code class="o">.</code><code class="n">multiSelect</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">current</code><code class="o">,</code> <code class="n">current</code> <code class="k">=</code> <code class="k">_</code><code class="o">)</code>
    <code class="o">)</code> <code class="o">&amp;</code>
    <code class="s">"type=submit"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">onSubmitUnit</code><code class="o">(</code><code class="n">logSelected</code><code class="o">)</code>

  <code class="o">}</code>

<code class="o">}</code></pre>

<p>The template is unchanged, and the snippet has been modified to introduce a <code>current</code> value and a hidden function to reset the value.  We’ve bound the submit button to simply log the selected values when the form is submitted.</p>

<p>Each time the form is submitted the <code>current</code> list of IDs is set to
whatever you have selected in the browser. But note that we have started
with a hidden function that resets <code>current</code> to the empty list. This means
that if the receiving function in <code>multiSelect</code> is never called, because nothing is selected, the value stored in <code>current</code> would reflect this and be <code>Nil</code>.</p>

<p>That may be useful, depending on what behaviour you need in your application.</p>
</section>













<section data-type="sect3" id="type-safe-options-1Ls9hJtxsd">
<h3>Type-safe options</h3>

<p>If you don’t want to work in terms of <code>String</code> values for an option, you
can use <code>multiSelectObj</code>. In this variation, the list of options still
provides a text name, but the value is in terms of a class. Likewise,
the list of default values will be a list of class instances.<a data-type="indexterm" data-primary="type-safe options" id="id-yYCrIpFnh4tysV"></a></p>

<p>The only changes to the code are to produce a <code>List[(Item,String)]</code> for the options, and use an <code>Item</code> as a default:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">options</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">Item</code>,<code class="kt">String</code><code class="o">)]</code> <code class="k">=</code>
  <code class="n">inventory</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">i</code> <code class="k">=&gt;</code> <code class="o">(</code><code class="n">i</code> <code class="o">-&gt;</code> <code class="n">i</code><code class="o">.</code><code class="n">name</code><code class="o">))</code>

<code class="k">val</code> <code class="n">default</code> <code class="k">=</code> <code class="n">inventory</code><code class="o">.</code><code class="n">head</code> <code class="o">::</code> <code class="nc">Nil</code></pre>

<p>The call to generate the multiselect from this data is similar, but
note our <code>selection</code> function now receives a list of <code>Item</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">selection</code><code class="o">(</code><code class="n">items</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">Item</code><code class="o">])</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Selected: "</code><code class="o">+</code><code class="n">items</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="s">"#opts *"</code> <code class="o">#&gt;</code>
    <code class="nc">SHtml</code><code class="o">.</code><code class="n">multiSelectObj</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">default</code><code class="o">,</code> <code class="n">selection</code><code class="o">)</code>
  <code class="o">}</code></pre>
</section>













<section data-type="sect3" id="enumerations-YmsbT1tDsP">
<h3>Enumerations</h3>

<p>You can use <code>multiSelectObj</code> with enumerations<a data-type="indexterm" data-primary="enumerations" id="id-yYCyFpFrT4tysV"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>

<code class="k">class</code> <code class="nc">MultiSelectEnum</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">object</code> <code class="nc">Item</code> <code class="k">extends</code> <code class="nc">Enumeration</code> <code class="o">{</code>
    <code class="k">type</code> <code class="kt">Item</code> <code class="o">=</code> <code class="nc">Value</code>
    <code class="k">val</code> <code class="nc">Coffee</code><code class="o">,</code> <code class="nc">Milk</code><code class="o">,</code> <code class="nc">Sugar</code> <code class="k">=</code> <code class="nc">Value</code>
  <code class="o">}</code>

  <code class="k">import</code> <code class="nn">Item._</code>

  <code class="k">val</code> <code class="n">options</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">Item</code>,<code class="kt">String</code><code class="o">)]</code> <code class="k">=</code>
    <code class="nc">Item</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">toList</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">i</code> <code class="k">=&gt;</code> <code class="o">(</code><code class="n">i</code> <code class="o">-&gt;</code> <code class="n">i</code><code class="o">.</code><code class="n">toString</code><code class="o">))</code>

  <code class="k">val</code> <code class="n">default</code> <code class="k">=</code> <code class="nc">Item</code><code class="o">.</code><code class="nc">Coffee</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">def</code> <code class="n">selection</code><code class="o">(</code><code class="n">items</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">Item</code><code class="o">])</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
      <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Selected: "</code><code class="o">+</code><code class="n">items</code><code class="o">)</code>
    <code class="o">}</code>

    <code class="s">"#opts *"</code> <code class="o">#&gt;</code>
      <code class="nc">SHtml</code><code class="o">.</code><code class="n">multiSelectObj</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">default</code><code class="o">,</code> <code class="n">selection</code><code class="o">)</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>The enumeration version works in the same way as the type-safe version.</p>
</section>



</section>













<section data-type="sect2" id="see-also-o8sNh2sz">
<h2>See Also</h2>

<p>The "Submit styling" discussion in <a data-type="xref" href="#AjaxFormProcessing">Ajax Form Processing</a> discusses the use of hidden fields as function calls.</p>

<p><a data-type="xref" href="#SelectOptionChange">Call Server When Select Option Changes</a> describes how to trigger a server-side action when a selection changes in the browser.</p>

<p><a href="http://exploring.liftweb.net/">Chapter 6 of <em>Exploring Lift</em></a>, "Forms in Lift," discusses multiselect and other types of form elements.<a data-type="indexterm" data-startref="ix_FPmulval" id="id-ZbC1FltahJsj"></a></p>
</section>





</section>













<section data-type="sect1" id="FileUpload">
<h1>File Upload</h1>








<section data-type="sect2" id="problem-2kslFgHY">
<h2>Problem</h2>

<p>You want a snippet to allow users to upload a file to your Lift application.<a data-type="indexterm" data-primary="files" data-secondary="uploading" id="id-DnC1SWFwFjHL"></a><a data-type="indexterm" data-primary="forms processing" data-secondary="file upload" id="id-kVCEFpFLFwHQ"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIYHm">
<h2>Solution</h2>

<p>Use a <code>FileParamHolder</code> in your snippet, and extract file information from it when the form is submitted.</p>

<p>Start with a form that is marked as <code>multipart=true</code>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;title&gt;</code>File Upload<code class="nt">&lt;/title&gt;</code>
  <code class="nt">&lt;script </code><code class="na">id=</code><code class="s">"jquery"</code> <code class="na">src=</code><code class="s">"/classpath/jquery.js"</code> <code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/script&gt;</code>
  <code class="nt">&lt;script </code><code class="na">id=</code><code class="s">"json"</code> <code class="na">src=</code><code class="s">"/classpath/json.js"</code> <code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;&lt;/script&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>
<code class="nt">&lt;form</code> <code class="na">data-lift=</code><code class="s">"FileUploadSnippet?form=post;multipart=true"</code><code class="nt">&gt;</code>
   <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"file"</code><code class="nt">&gt;</code>
     Select a file: <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"file"</code><code class="nt">&gt;&lt;/input&gt;</code>
   <code class="nt">&lt;/label&gt;</code>
   <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Submit"</code><code class="nt">&gt;&lt;/input&gt;</code>
<code class="nt">&lt;/form&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>We bind the file input to <code>SHtml.fileUpload</code> and the submit button to a function to process the uploaded file:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.FileParamHolder</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.</code><code class="o">{</code><code class="nc">Loggable</code><code class="o">,</code> <code class="nc">Full</code><code class="o">,</code> <code class="nc">Empty</code><code class="o">,</code> <code class="nc">Box</code><code class="o">}</code>


<code class="k">class</code> <code class="nc">FileUploadSnippet</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">var</code> <code class="n">upload</code> <code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">FileParamHolder</code><code class="o">]</code> <code class="k">=</code> <code class="nc">Empty</code>

    <code class="k">def</code> <code class="n">processForm</code><code class="o">()</code> <code class="k">=</code> <code class="n">upload</code> <code class="k">match</code> <code class="o">{</code>
      <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="nc">FileParamHolder</code><code class="o">(</code><code class="k">_</code><code class="o">,</code> <code class="n">mimeType</code><code class="o">,</code> <code class="n">fileName</code><code class="o">,</code> <code class="n">file</code><code class="o">))</code> <code class="k">=&gt;</code>
        <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"%s of type %s is %d bytes long"</code> <code class="n">format</code> <code class="o">(</code>
         <code class="n">fileName</code><code class="o">,</code> <code class="n">mimeType</code><code class="o">,</code> <code class="n">file</code><code class="o">.</code><code class="n">length</code><code class="o">)</code> <code class="o">)</code>

      <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="n">logger</code><code class="o">.</code><code class="n">warn</code><code class="o">(</code><code class="s">"No file?"</code><code class="o">)</code>
    <code class="o">}</code>

    <code class="s">"#file"</code> <code class="o">#&gt;</code> <code class="n">fileUpload</code><code class="o">(</code><code class="n">f</code> <code class="k">=&gt;</code> <code class="n">upload</code> <code class="k">=</code> <code class="nc">Full</code><code class="o">(</code><code class="n">f</code><code class="o">))</code> <code class="o">&amp;</code>
      <code class="s">"type=submit"</code> <code class="o">#&gt;</code> <code class="n">onSubmitUnit</code><code class="o">(</code><code class="n">processForm</code><code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>The <code>fileUpload</code> binding ensures that the file is assigned to the <code>upload</code> variable. This allows us to access the <code>Array[Byte]</code> of the file in the <code>processForm</code> method when the form is submitted.</p>
</section>













<section data-type="sect2" id="discussion-o8sytWHz">
<h2>Discussion</h2>

<p>HTTP includes an encoding type of <code>multipart/form-data</code> that was introduced to support binary data uploads.  The <code>?form=post;multipart=true</code> parameters in the template mark the form with this encoding, and the HTML generated will look
like this<a data-type="indexterm" data-primary="binary data uploads" id="id-9nCrIvF4tqHr"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">enctype=</code><code class="s">"multipart/form-data"</code> <code class="na">method=</code><code class="s">"post"</code> <code class="na">action=</code><code class="s">"/fileupload"</code><code class="nt">&gt;</code></pre>

<p>When the browser submits the form, Lift detects the <code>multipart/form-data</code> encoding and extracts any files from the request.  These are available as <code>uploadedFiles</code> on a <code>Req</code> object, for example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">files</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">FileParamHolder</code><code class="o">]</code> <code class="k">=</code> <code class="n">S</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">uploadedFiles</code><code class="o">)</code> <code class="n">openOr</code> <code class="nc">Nil</code></pre>

<p>However, as we’re dealing with a form with a single upload field, it’s easier to use <code>SHtml.fileUpload</code> to bind the input to our <code>upload</code> variable.  Lift arranges for the function <code>f =&gt; upload = Full(f)</code> to be called when a file is selected and uploaded via this field. If the file is zero length, the function is not called.<a data-type="indexterm" data-primary="S." data-secondary="request.map" id="id-rjCwtATxtKHA"></a></p>

<p>The default behaviour for Lift is to read the file into memory and present it as a <code>FileParamHolder</code>.  In this recipe, we’re pattern matching on the fields of the <code>FileParamHolder</code> and simply printing out what we know about the file.  We’re ignoring the first parameter, which will be Lift’s generated name for the field, but capturing the mime type, original filename, and the raw data that was in the file.</p>

<p>You probably don’t want to use this method for very large files.  In fact, <code>LiftRules</code> provides a number of size restrictions that you can control:</p>
<dl>
<dt><code>LiftRules.maxMimeFileSize</code></dt>
<dd>
<p>The maximum size of any single file uploaded (7 MB by default)</p>
</dd>
<dt><code>LiftRules.maxMimeSize</code></dt>
<dd>
<p>The maximum size of the multipart upload in total (8 MB by default)</p>
</dd>
</dl>

<p>Why two settings?  Because when the form is submitted, there may be a number of fields on the form.  For example, in the recipe, the value of the submit button is sent as one of the parts, and the file is sent as another. Hence, you might want to limit file size, but allow for some field values, or multiple files, to be submitted.</p>

<p>If you hit the size limit, an exception will be thrown from the underlying file upload library. You can catch the exception, as described in <a data-type="xref" href="#CatchException">Catch Any Exception</a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">exceptionHandler</code><code class="o">.</code><code class="n">prepend</code> <code class="o">{</code>
  <code class="k">case</code> <code class="o">(</code><code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">,</code> <code class="n">x</code> <code class="k">:</code> <code class="kt">FileUploadIOException</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="nc">ResponseWithReason</code><code class="o">(</code><code class="nc">BadResponse</code><code class="o">(),</code> <code class="s">"Unable to process file. Too large?"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>Be aware that the container (Jetty, Tomcat) or any web server (Apache, Nginx) may also have limits on file upload sizes.</p>

<p id="UploadToDisk">Uploading a file into memory may be fine for some situations, but you may want to upload larger items to disk and then process them in Lift as a stream.  Lift supports this via the following setting:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">handleMimeFile</code> <code class="k">=</code> <code class="nc">OnDiskFileParamHolder</code><code class="o">.</code><code class="n">apply</code></pre>

<p>The <code>handleMimeFile</code> variable expects to be given a function that takes a field name, mime type, filename, and <code>InputStream</code> and returns a <code>FileParamHolder</code>.  The default implementation of this is the <code>InMemFileParamHolder</code>, but changing to <code>OnDiskFileParamHolder</code> means Lift will write the file to disk first. You can of course implement your own handler in addition to using <code>OnDiskFileParamHolder</code> or <code>InMemFileParamHolder</code>.</p>

<p>With <code>OnDiskFileParamHolder</code>, the file will be written to a temporary location (<code>System.getProperty("java.io.tmpdir")</code>), but it’s up to you to remove it when you’re done with the file. For example, our snippet could change to:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">processForm</code><code class="o">()</code> <code class="k">=</code> <code class="n">upload</code> <code class="k">match</code> <code class="o">{</code>

  <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="n">content</code> <code class="k">:</code> <code class="kt">OnDiskFileParamHolder</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"File: "</code><code class="o">+</code><code class="n">content</code><code class="o">.</code><code class="n">localFile</code><code class="o">.</code><code class="n">getAbsolutePath</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">in</code><code class="k">:</code> <code class="kt">InputStream</code> <code class="o">=</code> <code class="n">content</code><code class="o">.</code><code class="n">fileStream</code>
    <code class="c1">// ...do something with the stream here...</code>
    <code class="k">val</code> <code class="n">wasDeleted_?</code> <code class="k">=</code> <code class="n">content</code><code class="o">.</code><code class="n">localFile</code><code class="o">.</code><code class="n">delete</code><code class="o">()</code>

  <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="n">logger</code><code class="o">.</code><code class="n">warn</code><code class="o">(</code><code class="s">"No file?"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>Be aware that <code>OnDiskFileParamHolder</code> implements <code>FileParamHolder</code>, so would match the original <code>FileParamHolder</code> pattern used in the recipe. However, if you access the <code>file</code> field of <code>OnDiskFileParamHolder</code>, you’ll bring the file into memory, which would defeat the point of storing it on disk to process it as a stream.</p>

<p>If you want to monitor the progress of the upload on the server side, you can. There’s a hook in <code>LiftRules</code> that is called as the upload is running:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">progressPrinter</code><code class="o">(</code><code class="n">bytesRead</code><code class="k">:</code> <code class="kt">Long</code><code class="o">,</code> <code class="n">contentLength</code><code class="k">:</code> <code class="kt">Long</code><code class="o">,</code> <code class="n">fieldIndex</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">println</code><code class="o">(</code><code class="s">"Read %d of %d for %d"</code> <code class="n">format</code> <code class="o">(</code><code class="n">bytesRead</code><code class="o">,</code> <code class="n">contentLength</code><code class="o">,</code> <code class="n">fieldIndex</code><code class="o">))</code>
<code class="o">}</code>

<code class="nc">LiftRules</code><code class="o">.</code><code class="n">progressListener</code> <code class="k">=</code> <code class="n">progressPrinter</code></pre>

<p>This is the progress of the whole multipart upload, not just the file being uploaded.  In particular, the <code>contentLength</code> may not be known (in which case, it will be <code>-1</code>), but if it is known, it is the size of the complete multipart upload. In the example in this recipe, that would include the size of the file, but also the submit button value.  This also explains the <code>fieldIndex</code>, which is a counter as to which part is being processed. It will take on the values of 0 and 1 for the two parts in this example.</p>
</section>













<section data-type="sect2" id="see-also-g0sxhwHB">
<h2>See Also</h2>

<p>The HTTP file upload mechanics are described in <a href="http://tools.ietf.org/html/rfc1867">RFC 1867, <em>Form-based File Upload in HTML</em></a>.</p>

<p><a data-type="xref" href="#RestBinaryData">Accept Binary Data in a REST Service</a> discusses file upload in the context of a REST service.</p>

<p>See <a data-type="xref" href="#AjaxFileUpload">Ajax File Upload</a> for an example of an Ajax file upload through integration with a JavaScript library, providing progress indicators and drag-and-drop support.<a data-type="indexterm" data-startref="ix_LWFfp" id="id-zdCkFvtJhJHw"></a></p>
</section>





</section>













<section data-type="sect1" id="DRYFormsWithLayout">
<h1>DRY Forms with Layout</h1>








<section data-type="sect2" id="problem-pWsqFrfm">
<h2>Problem</h2>

<p>You want to use DRY declarative forms, like <code>LiftScreen</code>, but you want to be able
to completely control how the form is rendered, instead of a linear
layout of fields. <a data-type="indexterm" data-primary="LiftScreen" data-secondary="custom layout" id="id-4nC2FYFVFYfd"></a><a data-type="indexterm" data-primary="LiftScreen" data-secondary="CssBoundLiftScreen" id="id-JnCmIlFNFrfn"></a></p>
</section>













<section data-type="sect2" id="solution-o8seIOfz">
<h2>Solution</h2>

<p>Use <code>CssBoundLiftScreen</code>, with field bindings for naming placements, and optionally
override the layout of specific individual field
elements.</p>

<p>Here’s an example snippet:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">scala.xml.NodeSeq</code>
<code class="k">import</code> <code class="nn">net.liftweb.http._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.FieldBinding.Self</code>

<code class="k">object</code> <code class="nc">AccountInfoEditor</code> <code class="k">extends</code> <code class="nc">CssBoundLiftScreen</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">formName</code> <code class="k">=</code> <code class="s">"accountedit"</code>

  <code class="k">override</code> <code class="k">def</code> <code class="n">allTemplate</code> <code class="k">=</code> <code class="n">savedDefaultXml</code>
  <code class="k">protected</code> <code class="k">def</code> <code class="n">defaultAllTemplate</code> <code class="k">=</code> <code class="k">super</code><code class="o">.</code><code class="n">allTemplate</code>

  <code class="c1">// Pull the definition of the "normal" field from a template, if it exists</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">defaultFieldNodeSeq</code><code class="k">:</code> <code class="kt">NodeSeq</code> <code class="o">=</code>
    <code class="nc">Templates</code><code class="o">(</code><code class="s">"accounts"</code> <code class="o">::</code> <code class="s">"account_edit_field"</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">).</code><code class="n">openOr</code><code class="o">(</code>
    <code class="o">&lt;</code><code class="n">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="n">label</code> <code class="n">class</code><code class="o">=</code><code class="s">"label field"</code><code class="o">&gt;&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="n">span</code> <code class="n">class</code><code class="o">=</code><code class="s">"value fieldValue"</code><code class="o">&gt;&lt;/</code><code class="n">span</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="n">span</code> <code class="n">class</code><code class="o">=</code><code class="s">"help"</code><code class="o">&gt;&lt;/</code><code class="n">span</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="n">div</code> <code class="n">class</code><code class="o">=</code><code class="s">"errors"</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="n">div</code> <code class="n">class</code><code class="o">=</code><code class="s">"error"</code><code class="o">&gt;&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
      <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;)</code>

  <code class="k">override</code> <code class="k">def</code> <code class="n">finish</code><code class="o">()</code> <code class="o">{</code>
    <code class="n">println</code><code class="o">(</code><code class="s">"Account Edited for: "</code><code class="o">+</code><code class="n">firstName</code><code class="o">)</code>
    <code class="n">S</code><code class="o">.</code><code class="n">notice</code><code class="o">(</code><code class="s">"Done."</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="c1">// An example source of an account:</code>
  <code class="k">case</code> <code class="k">class</code> <code class="nc">Account</code><code class="o">(</code><code class="n">firstName</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">lastName</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">address</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code>
  <code class="k">def</code> <code class="n">accountToEdit</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">Account</code><code class="o">(</code><code class="s">"Ada"</code><code class="o">,</code> <code class="s">"Lovelace"</code><code class="o">,</code> <code class="s">"Ockham Park, Surrey"</code><code class="o">)</code>

  <code class="c1">// Fields:</code>
  <code class="k">val</code> <code class="n">firstName</code> <code class="k">=</code> <code class="n">field</code><code class="o">(</code><code class="s">"First Name"</code><code class="o">,</code> <code class="n">accountToEdit</code><code class="o">.</code><code class="n">firstName</code><code class="o">,</code>
    <code class="n">trim</code><code class="o">,</code> <code class="n">valMinLen</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="s">"First name is required"</code><code class="o">),</code>
    <code class="nc">FieldBinding</code><code class="o">(</code><code class="s">"firstName"</code><code class="o">))</code>

  <code class="k">val</code> <code class="n">lastName</code> <code class="k">=</code> <code class="n">field</code><code class="o">(</code><code class="s">"Last Name"</code><code class="o">,</code> <code class="n">accountToEdit</code><code class="o">.</code><code class="n">lastName</code><code class="o">,</code>
    <code class="n">trim</code><code class="o">,</code> <code class="n">valMinLen</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="s">"Last name is required"</code><code class="o">),</code>
    <code class="nc">FieldBinding</code><code class="o">(</code><code class="s">"lastName"</code><code class="o">))</code>

  <code class="k">val</code> <code class="n">address</code> <code class="k">=</code> <code class="n">textarea</code><code class="o">(</code><code class="s">"Address"</code><code class="o">,</code> <code class="n">accountToEdit</code><code class="o">.</code><code class="n">address</code><code class="o">,</code>
    <code class="n">trim</code><code class="o">,</code> <code class="n">valMinLen</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="s">"Address is required"</code><code class="o">),</code> <code class="n">valMaxLen</code><code class="o">(</code><code class="mi">255</code><code class="o">,</code> <code class="s">"Address too long"</code><code class="o">),</code>
    <code class="nc">FieldBinding</code><code class="o">(</code><code class="s">"address"</code><code class="o">,</code> <code class="nc">Self</code><code class="o">))</code>

<code class="o">}</code></pre>

<p>This snippet will present a (hypothetical) user account record, allowing a user to
edit three fields.  The fields have validation, and will be bound into a template.</p>

<p>A corresponding template might be called <em>webapp/accountinfo.html</em>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">content=</code><code class="s">"text/html; charset=UTF-8"</code> <code class="na">http-equiv=</code><code class="s">"content-type"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;title&gt;</code>Custom CSS Binding Screen<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>

  <code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"AccountInfoEditor"</code><code class="nt">&gt;</code>

    <code class="nt">&lt;div&gt;</code>
      <code class="c">&lt;!--</code>
<code class="c">      Drop regular Lift Screen elements where you want them.</code>
<code class="c">      Here we're putting the Next (or Finish) button at the top.</code>
<code class="c">      --&gt;</code>
      <code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"next"</code><code class="nt">&gt;&lt;/button&gt;</code>
    <code class="nt">&lt;/div&gt;</code>

    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"fields"</code><code class="nt">&gt;</code>

      <code class="nt">&lt;h2&gt;</code>Account Details<code class="nt">&lt;/h2&gt;</code>

      <code class="c">&lt;!--</code>
<code class="c">        The template applied to each field is taken from</code>
<code class="c">        accounts/account_edit_field.html</code>
<code class="c">      --&gt;</code>
      <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"accountedit_firstName_field"</code> <code class="na">class=</code><code class="s">"large"</code><code class="nt">&gt;&lt;/div&gt;</code>
      <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"accountedit_lastName_field"</code> <code class="na">class=</code><code class="s">"large"</code><code class="nt">&gt;&lt;/div&gt;</code>

      <code class="c">&lt;!--</code>
<code class="c">      The code binds this field with Self, meaning the</code>
<code class="c">      field template is inline in this template and will</code>
<code class="c">      be different:</code>
<code class="c">      --&gt;</code>
      <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"accountedit_address_field"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"large"</code><code class="nt">&gt;</code>The address where you like gifts sent:<code class="nt">&lt;/div&gt;</code>
        <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"errors"</code><code class="nt">&gt;</code>
          <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"error"</code><code class="nt">&gt;&lt;/div&gt;</code>
        <code class="nt">&lt;/div&gt;</code>
        <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"value fieldValue"</code> <code class="na">style=</code><code class="s">"width:10em; height:5em"</code><code class="nt">&gt;&lt;/span&gt;</code>
      <code class="nt">&lt;/div&gt;</code>

    <code class="nt">&lt;/div&gt;</code>

  <code class="nt">&lt;/div&gt;</code>

<code class="nt">&lt;/div&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>Running the snippet will cause <code>CssBoundLiftScreen</code> to apply the <code>defaultFieldNodeSeq</code> layout
to each field, with the exception of the "address" field that we have customised inside the template.</p>

<p>Pressing the "Finish" button triggers validations, presents errors (if any), or completes the edit via the <code>finish</code> method.</p>
</section>













<section data-type="sect2" id="discussion-g0s1tvfB">
<h2>Discussion</h2>

<p><code>CssBoundLiftScreen</code> uses the same model (by default) as <code>LiftScreen</code>, but with
CSS classes to identify elements in the default template (e.g.,
<em>wizard-all.html</em>). This powerful mechanism eliminates repetition in both
code and HTML; however, <code>LiftScreen</code> sacrifices flexibility in that there
is no way to make highly customized forms.</p>

<p>This restriction is removed in <code>CssBoundLiftScreen</code> by allowing you to control every
element of the form rendering. You can control everything form field placement to the layout of a
single field. You do so by embedding the custom template at the snippet usage site:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"AccountInfoEditor"</code><code class="nt">&gt;</code>
   <code class="c">&lt;!-- template for Screen goes here --&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>and supply some additional binding hints. The form is still very minimal, while
being completely under the control of the designer.</p>

<p>The example in the solution section demonstrates the most important aspects. In
particular, you should note that you must still supply a source for the
template, and that you can designate alternatives for sub-portions of the
template. In the example, we allow the HTML designer direct access to the field
template for this screen by making it possible to put the layout in a custom
template file <em>accounts/account_edit_field.html</em>.</p>

<p>The rest is very easy. You must supply a <code>formName</code> declaration (in Scala) for
<code>CssBoundLiftScreen</code>, and a <code>FieldBinding</code> as an argument to each field. This,
combined with an internal function (that you can override), will generate unique
(but known) names that can be used in the template. The default pattern
is: "formName_fieldName_field". So, if you name your form
"myform", and bind a field to "address", then your
HTML template should include a div with the ID "myform_address_field". That is
all you need for normal bindings that use your field template.</p>

<p>To tweak the field layout for a particular field, you may
specify <code>Self</code> in the Scala field binding. This indicates the template for
that particular field should be sourced from the field’s div.</p>

<p>If you want to get even fancier there are additional field bindings, such as
<code>Dynamic(() =&gt; NodeSeq)</code>, which uses the supplied function to generate a template
for the field each time it is rendered.</p>
</section>













<section data-type="sect2" id="see-also-q8sZhyfW">
<h2>See Also</h2>

<p>Further examples can be found in:</p>

<ul>
<li>
<p>The <a href="http://www.assembla.com/spaces/liftweb/wiki/CssBoundLiftScreen_and_Custom_Form_Layouts">Lift Wiki entry on CSSBoundLiftScreen</a>.</p>
</li>
<li>
<p>Peter Brant’s <a href="https://github.com/pbrant/lift-liftscreen-css-binding">Lift Screen CSS Binding GitHub repository</a>.</p>
</li>
</ul>

<p><code>LiftScreen</code> is described <a href="https://www.assembla.com/spaces/liftweb/wiki/LiftScreen">on the Lift Wiki</a> and in <a href="http://simply.liftweb.net/">Simply Lift</a>.</p>
</section>





</section>







</section>














<section data-type="chapter" id="REST">
<h1>REST</h1>


<p>This chapter looks at recipes around REST web services, via Lift’s <code>RestHelper</code> trait. For an introduction, take a look at the <a href="http://bit.ly/11Bm810">Lift wiki page</a> and <a href="http://simply.liftweb.net">Chapter 5 of <em>Simply Lift</em></a>.<a data-type="indexterm" id="ix_REST" data-primary="REST web services"></a><a data-type="indexterm" data-primary="RestHelper" id="id-KnCBheFj"></a></p>

<p>The sample code from this chapter is at <a href="https://github.com/LiftCookbook/cookbook_rest"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_rest</em></a>.</p>






<section data-type="sect1" id="DRYURLs">
<h1>DRY URLs</h1>








<section data-type="sect2" id="problem-V7spFjtb">
<h2>Problem</h2>

<p>You find yourself repeating parts of URL paths in your <code>RestHelper</code> and
you Don’t want to Repeat Yourself (DRY).<a data-type="indexterm" data-primary="REST web services" data-secondary="avoiding URL repeats" id="id-aeCdFEF2FOtb"></a><a data-type="indexterm" data-primary="URLs" data-secondary="avoiding repeats" id="id-0nClIGFqFMtV"></a><a data-type="indexterm" data-primary="DRY URLs" id="id-LnCvtGFQF0tv"></a></p>
</section>













<section data-type="sect2" id="solution-rWseINtw">
<h2>Solution</h2>

<p>Use <code>prefix</code> in your <code>RestHelper</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.LiftRules</code>

<code class="k">object</code> <code class="nc">IssuesService</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">IssuesService</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="n">serve</code><code class="o">(</code><code class="s">"issues"</code> <code class="o">/</code> <code class="s">"by-state"</code> <code class="n">prefix</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"open"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">XmlGet</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code><code class="nc">None</code> <code class="n">open</code><code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
    <code class="k">case</code> <code class="s">"closed"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">XmlGet</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code><code class="nc">None</code> <code class="n">closed</code><code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
    <code class="k">case</code> <code class="s">"closed"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">XmlDelete</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code><code class="nc">All</code> <code class="n">deleted</code><code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
  <code class="o">})</code>
<code class="o">}</code></pre>

<p>This service responds to URLs of <em>/issues/by-state/open</em> and <em>/issues/by-state/closed</em> and we have
factored out the common part as a <code>prefix</code>.</p>

<p>Wire this into <em>Boot.scala</em> with:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">code.rest.IssuesService</code>
<code class="nc">IssuesService</code><code class="o">.</code><code class="n">init</code><code class="o">()</code></pre>

<p>We can test the service with cURL:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true">$ curl -H 'Content-Type: application/xml'
    http://localhost:8080/issues/by-state/open
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
<code class="nt">&lt;p&gt;</code>None open<code class="nt">&lt;/p&gt;</code>

$ curl -X DELETE -H 'Content-Type: application/xml'
    http://localhost:8080/issues/by-state/closed
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
<code class="nt">&lt;p&gt;</code>All deleted<code class="nt">&lt;/p&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-wPsDt9tg">
<h2>Discussion</h2>

<p>You can have many <code>serve</code> blocks in your <code>RestHelper</code>, which helps give
your REST service structure.</p>

<p>In this example, we’ve arbitrarily decided to return XML and to match on an XML request using <code>XmlGet</code> and <code>XmlDelete</code>.  The test for an XML request requires a content type of <em>text/xml</em> or <em>application/xml</em>, or a request for a path that ends with <em>.xml</em>.   This is why the cURL request includes a header with with the <code>-H</code> flag.  If we hadn’t included that, the request would not match any of our patterns, and the result would be a 404 response.</p>
</section>













<section data-type="sect2" id="see-also-xqsjh7tQ">
<h2>See Also</h2>

<p><a data-type="xref" href="#JSONREST">Returning JSON</a> gives an example of accepting and returning JSON.</p>
</section>





</section>













<section data-type="sect1" id="MissingSuffix">
<h1>Missing File Suffix</h1>








<section data-type="sect2" id="problem-rWspFEhw">
<h2>Problem</h2>

<p>Your <code>RestHelper</code> expects a filename as part of the URL, but the suffix
(extension) is missing, and you need it.<a data-type="indexterm" data-primary="REST web services" data-secondary="recovering filename suffixes" id="id-0nCEFGFqFKhV"></a><a data-type="indexterm" data-primary="names/naming" data-secondary="recovering filename suffixes" id="id-LnCNIGFQF7hv"></a><a data-type="indexterm" data-primary="files" data-secondary="recovering filename suffixes" id="id-AnCVtZFvFNhv"></a></p>
</section>













<section data-type="sect2" id="solution-wPsrIehg">
<h2>Solution</h2>

<p>Access <code>req.path.suffix</code> to recover the suffix.</p>

<p>For example, when
processing <em>/download/123.png</em>, you want to be able to reconstruct
<em>123.png</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.LiftRules</code>
<code class="k">import</code> <code class="nn">xml.Text</code>

<code class="k">object</code> <code class="nc">Reunite</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="k">private</code> <code class="k">def</code> <code class="n">reunite</code><code class="o">(</code><code class="n">name</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">suffix</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">=</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">suffix</code><code class="o">.</code><code class="n">isEmpty</code><code class="o">)</code> <code class="n">name</code> <code class="k">else</code> <code class="n">name</code><code class="o">+</code><code class="s">"."</code><code class="o">+</code><code class="n">suffix</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"download"</code> <code class="o">::</code> <code class="n">file</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="nc">Text</code><code class="o">(</code><code class="s">"You requested "</code><code class="o">+</code><code class="n">reunite</code><code class="o">(</code><code class="n">file</code><code class="o">,</code> <code class="n">req</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">suffix</code><code class="o">))</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">Reunite</code><code class="o">)</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>We are matching on <em>download</em> but rather than using the <code>file</code> value directly, we pass it through the <code>reunite</code> function first to attach the suffix back on (if any).</p>

<p>Requesting this URL with a command like cURL will show you the filename
as expected:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true">$ curl http://127.0.0.1:8080/download/123.png
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
You requested 123.png</pre>
</section>













<section data-type="sect2" id="discussion-xqs1tyhQ">
<h2>Discussion</h2>

<p>When Lift parses a request, it splits the request into constituent parts
(e.g., turning the path into a <code>List[String]</code>). This includes a
separation of <em>some</em> suffixes. This is good for pattern matching when you
want to change behaviour based on the suffix, but a hindrance in this
particular situation.</p>

<p>Only those suffixes defined in <code>LiftRules.explicitlyParsedSuffixes</code> are
split from the filename. This includes many of the common file suffixes
(such as <em>.png</em>, <em>.atom</em>, <em>.json</em>) and also some you may not be so familiar
with, such as <em>.com</em>.</p>

<p>Note that if the suffix is not in <code>explicitlyParsedSuffixes</code>, the suffix
will be an empty string and the <code>name</code> (in the previous example) will be
the filename with the suffix still attached.</p>

<p>Depending on your needs, you could alternatively add a guard condition to check for the file suffix:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">case</code> <code class="s">"download"</code> <code class="o">::</code> <code class="n">file</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">if</code> <code class="n">req</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">suffix</code> <code class="o">==</code> <code class="s">"png"</code> <code class="k">=&gt;</code>
  <code class="nc">Text</code><code class="o">(</code><code class="s">"You requested PNG file called "</code><code class="o">+</code><code class="n">file</code><code class="o">)</code></pre>

<p>Or rather than simply attaching the suffix back on, you could take the opportunity to do some computation and decide what to send back.  For example, if the client supports the WebP image format, you might prefer to send that:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.LiftRules</code>
<code class="k">import</code> <code class="nn">xml.Text</code>

<code class="k">object</code> <code class="nc">Reunite</code> <code class="k">extends</code> <code class="nc">RestHelper</code>  <code class="o">{</code>

  <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">Reunite</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"negotiate"</code> <code class="o">::</code> <code class="n">file</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="k">val</code> <code class="n">toSend</code> <code class="k">=</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">req</code><code class="o">.</code><code class="n">header</code><code class="o">(</code><code class="s">"Accept"</code><code class="o">).</code><code class="n">exists</code><code class="o">(</code><code class="k">_</code> <code class="o">==</code> <code class="s">"image/webp"</code><code class="o">))</code> <code class="n">file</code><code class="o">+</code><code class="s">".webp"</code>
        <code class="k">else</code> <code class="n">file</code><code class="o">+</code><code class="s">".png"</code>

      <code class="nc">Text</code><code class="o">(</code><code class="s">"You requested "</code><code class="o">+</code><code class="n">file</code><code class="o">+</code><code class="s">", would send "</code><code class="o">+</code><code class="n">toSend</code><code class="o">)</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>Calling this service would check the HTTP <code>Accept</code> header before deciding what resource to send:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true">$ curl http://localhost:8080/negotiate/123
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
You requested 123, would send 123.png

$ curl http://localhost:8080/negotiate/123 -H "Accept: image/webp"
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
You requested 123, would send 123.webp</pre>
</section>













<section data-type="sect2" id="see-also-Pas0hwh8">
<h2>See Also</h2>

<p><a data-type="xref" href="#MissingDotCom">Missing .com from Email Addresses</a> shows how to remove items from <code>explicitlyParsedSuffixes</code>.</p>

<p><a href="http://bit.ly/120TCpl">The source for <code>HttpHelpers.scala</code></a> contains the <code>explicitlyParsedSuffixes</code> list, which is the default list of suffixes that Lift parses from a URL.</p>
</section>





</section>













<section data-type="sect1" id="MissingDotCom">
<h1>Missing .com from Email Addresses</h1>

<p>When submitting an email address to a REST service, a domain ending <em>.com</em> is stripped before your REST service can handle the request.<a data-type="indexterm" data-primary="REST web services" data-secondary="preserving .com URL endings" id="id-0nCEFGFBTO"></a><a data-type="indexterm" data-primary="URLs" data-secondary="preserving .com endings" id="id-LnCNIGFYTe"></a><a data-type="indexterm" data-primary="email" data-secondary=".com missing from address" id="id-AnCVtZFAT9"></a></p>








<section data-type="sect2" id="solution-xqs0InTQ">
<h2>Solution</h2>

<p>Modify <code>LiftRules.explicitlyParsedSuffixes</code> so that Lift doesn’t change URLs that end with <em>.com</em>.</p>

<p>In <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.Helpers</code>
<code class="nc">LiftRules</code><code class="o">.</code><code class="n">explicitlyParsedSuffixes</code> <code class="k">=</code> <code class="nc">Helpers</code><code class="o">.</code><code class="n">knownSuffixes</code> <code class="o">-</code> <code class="s">"com"</code></pre>
</section>













<section data-type="sect2" id="discussion-PasetZT8">
<h2>Discussion</h2>

<p>By default, Lift will strip off file suffixes from URLs to make it easy to match on suffixes. An example would be needing to match on all requests ending in <em>.xml</em> or <em>.pdf</em>.  However, <em>.com</em> is also registered as one of those suffixes, but this is inconvenient if you have URLs that end with email addresses.</p>

<p>Note that this doesn’t impact email addresses in the middle of URLs.  For example, consider the following REST service:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.LiftRules</code>
<code class="k">import</code> <code class="nn">xml.Text</code>

<code class="k">object</code> <code class="nc">Suffix</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">Suffix</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"email"</code> <code class="o">::</code> <code class="n">e</code> <code class="o">::</code> <code class="s">"send"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="nc">Text</code><code class="o">(</code><code class="s">"In middle: "</code><code class="o">+</code><code class="n">e</code><code class="o">)</code>

    <code class="k">case</code> <code class="s">"email"</code> <code class="o">::</code> <code class="n">e</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="nc">Text</code><code class="o">(</code><code class="s">"At end: "</code><code class="o">+</code><code class="n">e</code><code class="o">)</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>With this service <code>init</code> method called in <em>Boot.scala</em>, we could then make requests and observe the issue:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true">$ curl http://localhost:8080/email/you@example.com/send
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
In middle: you@example.com

$ curl http://localhost:8080/email/you@example.com
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
At end: you@example</pre>

<p>The <em>.com</em> is being treated as a file suffix, which is why the solution of removing it from the list of suffixes will resolve this problem.</p>

<p>Note that because other top-level domains, such as <em>.uk</em>, <em>.nl</em>, <em>.gov</em>, are not in <code>explicitlyParsedSuffixes</code>, those email addresses are left untouched.</p>
</section>













<section data-type="sect2" id="see-also-OKsGhrTY">
<h2>See Also</h2>

<p><a data-type="xref" href="#MissingSuffix">Missing File Suffix</a> describes the suffix processing in more detail.</p>
</section>





</section>













<section data-type="sect1" id="SuffixMatchFail">
<h1>Failing to Match on a File Suffix</h1>








<section data-type="sect2" id="problem-xqsZFdcQ">
<h2>Problem</h2>

<p>You’re trying to match on a file suffix (extension), but your match is
failing.<a data-type="indexterm" data-primary="REST web services" data-secondary="file suffix matching" id="id-LnC7SGFQF8cv"></a><a data-type="indexterm" data-primary="files" data-secondary="suffix matching" id="id-AnCDFZFvFVcv"></a></p>
</section>













<section data-type="sect2" id="solution-PaskILc8">
<h2>Solution</h2>

<p>Ensure the suffix you’re matching on is included in
<code>LiftRules.explicitlyParsedSuffixes</code>.</p>

<p>As an example, perhaps you want to match anything ending in <em>.csv</em> at
your <em>/reports/</em> URL:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">case</code> <code class="nc">Req</code><code class="o">(</code><code class="s">"reports"</code> <code class="o">::</code> <code class="n">name</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code> <code class="s">"csv"</code><code class="o">,</code> <code class="nc">GetRequest</code><code class="o">)</code> <code class="k">=&gt;</code>
  <code class="nc">Text</code><code class="o">(</code><code class="s">"Here's your CSV report for "</code><code class="o">+</code><code class="n">name</code><code class="o">)</code></pre>

<p>You’re expecting <em>/reports/foo.csv</em> to produce "Here’s your CSV report
for foo," but you get a 404.</p>

<p>To resolve this, include <code>"csv"</code> as a file suffix that Lift knows to split from URLs.  In <em>Boot.scala</em>, call:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">explicitlyParsedSuffixes</code> <code class="o">+=</code> <code class="s">"csv"</code></pre>

<p>The pattern will now match.</p>
</section>













<section data-type="sect2" id="discussion-OKsVtbcY">
<h2>Discussion</h2>

<p>Without adding <code>"csv"</code> to the <code>explicitlyParsedSuffixes</code>, the example URL
would match with:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">case</code> <code class="nc">Req</code><code class="o">(</code><code class="s">"reports"</code> <code class="o">::</code> <code class="n">name</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code> <code class="s">""</code><code class="o">,</code> <code class="nc">GetRequest</code><code class="o">)</code> <code class="k">=&gt;</code>
  <code class="nc">Text</code><code class="o">(</code><code class="s">"Here's your CSV report for "</code><code class="o">+</code><code class="n">name</code><code class="o">)</code></pre>

<p>Here we’re matching on no suffix (<code>""</code>). In this case, <code>name</code> would be set to <code>"foo.csv"</code>.  This is because Lift separates file suffixes from the end of URLs only for file suffixes that are registered with <code>explicitlyParsedSuffixes</code>.  Because <code>"csv"</code> is not one of the default registered suffixes, <code>"foo.csv"</code> is not split. That’s why <code>"csv"</code> in the suffix position of <code>Req</code> pattern match won’t match the request, but an empty string in that position will.</p>
</section>













<section data-type="sect2" id="see-also-XQsXhpcp">
<h2>See Also</h2>

<p><a data-type="xref" href="#MissingSuffix">Missing File Suffix</a> explains more about the suffix removal in Lift.</p>
</section>





</section>













<section data-type="sect1" id="RestBinaryData">
<h1>Accept Binary Data in a REST Service</h1>








<section data-type="sect2" id="problem-PasxFXi8">
<h2>Problem</h2>

<p>You want to accept an image upload, or other binary data, in your RESTful
service.<a data-type="indexterm" data-primary="REST web services" data-secondary="image uploads" id="id-AnCPSZFvFoiv"></a><a data-type="indexterm" data-primary="files" data-secondary="uploading" id="id-W7CoFLFYFKiz"></a><a data-type="indexterm" data-primary="images" data-secondary="uploading" id="id-e4CxIJFZFrir"></a><a data-type="indexterm" data-primary="binary data uploads" id="id-GnCPtgFbFeiK"></a></p>
</section>













<section data-type="sect2" id="solution-OKsOIyiY">
<h2>Solution</h2>

<p>Access the request body in your REST helper:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.LiftRules</code>

<code class="k">object</code> <code class="nc">Upload</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">Upload</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"upload"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Post</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="k">for</code> <code class="o">{</code>
        <code class="n">bodyBytes</code> <code class="k">&lt;-</code> <code class="n">req</code><code class="o">.</code><code class="n">body</code>
      <code class="o">}</code> <code class="k">yield</code> <code class="o">&lt;</code><code class="n">info</code><code class="o">&gt;</code><code class="nc">Received</code> <code class="o">{</code><code class="n">bodyBytes</code><code class="o">.</code><code class="n">length</code><code class="o">}</code> <code class="n">bytes</code><code class="o">&lt;/</code><code class="n">info</code><code class="o">&gt;</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>Wire this into your application in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">code.rest.Upload</code>
<code class="nc">Upload</code><code class="o">.</code><code class="n">init</code><code class="o">()</code></pre>

<p>Test this service using a tool like cURL:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true">$ curl -X POST --data-binary "@dog.jpg" -H 'Content-Type: image/jpg'
    http://127.0.0.1:8080/upload
<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
<code class="nt">&lt;info&gt;</code>Received 1365418 bytes<code class="nt">&lt;/info&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-XQsbtGip">
<h2>Discussion</h2>

<p>In this example, the binary data is accessed via the <code>req.body</code>, which returns
 a <code>Box[Array[Byte]]</code>.  We turn this into a <code>Box[Elem]</code> to send back to the client.
 Implicits in <code>RestHelper</code> turn this into an <code>XmlResponse</code> for Lift to handle.</p>

<p>Note that web containers, such as Jetty and Tomcat, may place limits on
the size of an upload. You will recognise this situation by an error
such as <code>java.lang.IllegalStateException: Form too large705784&gt;200000</code>.
Check with documentation for the container for changing these limits.<a data-type="indexterm" data-primary="containers" data-secondary="upload size limits" id="id-DnCaFbIvtziQ"></a><a data-type="indexterm" data-primary="Jetty" id="id-kVCAI2IDt7iL"></a><a data-type="indexterm" data-primary="Tomcat" id="id-4nCPtAINt7ix"></a></p>

<p>To restrict the type of image you accept, you could add a <em>guard condition</em> to the match, but you may find you have more readable code by moving the logic into an <code>unapply</code> method on an object.  For example, to restrict an upload to just a JPEG you could say<a data-type="indexterm" data-primary="guard conditions" id="id-4nCkIqtNt7ix"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">serve</code> <code class="o">{</code>
  <code class="k">case</code> <code class="s">"jpg"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Post</code> <code class="nc">JPeg</code><code class="o">(</code><code class="n">req</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="k">for</code> <code class="o">{</code>
      <code class="n">bodyBytes</code> <code class="k">&lt;-</code> <code class="n">req</code><code class="o">.</code><code class="n">body</code>
    <code class="o">}</code> <code class="k">yield</code> <code class="o">&lt;</code><code class="n">info</code><code class="o">&gt;</code><code class="nc">Jpeg</code> <code class="nc">Received</code> <code class="o">{</code><code class="n">bodyBytes</code><code class="o">.</code><code class="n">length</code><code class="o">}</code> <code class="n">bytes</code><code class="o">&lt;/</code><code class="n">info</code><code class="o">&gt;</code>
  <code class="o">}</code>

<code class="k">object</code> <code class="nc">JPeg</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">unapply</code><code class="o">(</code><code class="n">req</code><code class="k">:</code> <code class="kt">Req</code><code class="o">)</code><code class="k">:</code> <code class="kt">Option</code><code class="o">[</code><code class="kt">Req</code><code class="o">]</code> <code class="k">=</code>
    <code class="n">req</code><code class="o">.</code><code class="n">contentType</code><code class="o">.</code><code class="n">filter</code><code class="o">(</code><code class="k">_</code> <code class="o">==</code> <code class="s">"image/jpg"</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="k">_</code> <code class="k">=&gt;</code> <code class="n">req</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>We have defined an extractor called <code>JPeg</code> that returns <code>Some[Req]</code> if the content type of the upload is <em>image/jpg</em>; otherwise, the result will be <code>None</code>.  This is used in the REST pattern match as <code>JPeg(req)</code>.  Note that the <code>unapply</code> needs to return <code>Option[Req]</code> as this is what’s expected by the <code>Post</code> extractor.</p>
</section>













<section data-type="sect2" id="see-also-jWskhvia">
<h2>See Also</h2>

<p><a href="http://www.artima.com/pins1ed/extractors.html">Odersky, <em>et al.</em>, (2008), <em>Programming in Scala</em>, Chapter 24</a>, discusses extractors in detail.</p>

<p><a data-type="xref" href="#FileUpload">File Upload</a> describes form-based (multipart) file uploads</p>
</section>





</section>













<section data-type="sect1" id="ServingVideo">
<h1>Serving Videos</h1>








<section data-type="sect2" id="problem-OKsLFduY">
<h2>Problem</h2>

<p>You want to use the HTML5 <code>video</code> tag to serve videos.</p>
</section>













<section data-type="sect2" id="solution-XQsKIlup">
<h2>Solution</h2>

<p>Use a <code>RestHelper</code> to return a chunked <code>StreamingResponse</code> of a video.<a data-type="indexterm" data-primary="streaming content" id="id-DnCXIWFgIauQ"></a><a data-type="indexterm" data-primary="video streaming" id="id-kVCltpFpIXuL"></a></p>

<p>A short example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.StreamingResponse</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>

<code class="k">object</code> <code class="nc">Streamer</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>
 <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="n">req</code><code class="nd">@Req</code><code class="o">((</code><code class="s">"video"</code> <code class="o">::</code> <code class="n">id</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">),</code> <code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="k">val</code> <code class="n">fis</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">FileInputStream</code><code class="o">(</code><code class="k">new</code> <code class="nc">File</code><code class="o">(</code><code class="n">id</code><code class="o">))</code>
      <code class="k">val</code> <code class="n">size</code> <code class="k">=</code> <code class="n">file</code><code class="o">.</code><code class="n">length</code> <code class="o">-</code> <code class="mi">1</code>
      <code class="k">val</code> <code class="n">content_type</code> <code class="k">=</code> <code class="s">"Content-Type"</code> <code class="o">-&gt;</code> <code class="s">"video/mp4"</code> <code class="c1">// replace with appropriate format</code>

      <code class="k">val</code> <code class="n">start</code> <code class="k">=</code> <code class="mi">0L</code>
      <code class="k">val</code> <code class="n">end</code> <code class="k">=</code> <code class="n">size</code>

      <code class="k">val</code> <code class="n">headers</code> <code class="k">=</code>
        <code class="o">(</code><code class="s">"Connection"</code> <code class="o">-&gt;</code> <code class="s">"close"</code><code class="o">)</code> <code class="o">::</code>
        <code class="o">(</code><code class="s">"Transfer-Encoding"</code> <code class="o">-&gt;</code> <code class="s">"chunked"</code><code class="o">)</code> <code class="o">::</code>
        <code class="n">content_type</code> <code class="o">::</code>
        <code class="o">(</code><code class="s">"Content-Range"</code> <code class="o">-&gt;</code> <code class="o">(</code><code class="s">"bytes "</code> <code class="o">+</code> <code class="n">start</code><code class="o">.</code><code class="n">toString</code> <code class="o">+</code> <code class="s">"-"</code> <code class="o">+</code> <code class="n">end</code><code class="o">.</code><code class="n">toString</code> <code class="o">+</code> <code class="s">"/"</code> <code class="o">+</code> <code class="n">file</code><code class="o">.</code><code class="n">length</code><code class="o">.</code><code class="n">toString</code><code class="o">))</code> <code class="o">::</code>
        <code class="nc">Nil</code>

      <code class="o">()</code> <code class="k">=&gt;</code> <code class="nc">StreamingResponse</code><code class="o">(</code>
        <code class="n">data</code> <code class="k">=</code> <code class="n">fis</code><code class="o">,</code>
        <code class="n">onEnd</code> <code class="k">=</code> <code class="n">fis</code><code class="o">.</code><code class="n">close</code><code class="o">,</code>
        <code class="n">size</code><code class="o">,</code>
        <code class="n">headers</code><code class="o">,</code>
        <code class="n">cookies</code> <code class="k">=</code> <code class="nc">Nil</code><code class="o">,</code>
        <code class="n">code</code> <code class="k">=</code> <code class="mi">206</code>
    <code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="discussion-jWsvtjua">
<h2>Discussion</h2>

<p>The above example doesn’t allow the client to skip ahead in the file. The <code>Range</code> header must be parsed in order to facilitate this. It specifies what part of the file the client wishes to receive. Request headers are contained within the <code>req@Req(urlParams, _, _)</code> pattern in the previous example. The start and end can be extracted like so:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="o">(</code><code class="n">start</code><code class="o">,</code><code class="n">end</code><code class="o">)</code> <code class="k">=</code>
  <code class="n">req</code><code class="o">.</code><code class="n">header</code><code class="o">(</code><code class="s">"Range"</code><code class="o">)</code> <code class="k">match</code> <code class="o">{</code>
    <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="n">r</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="o">{</code>
      <code class="o">(</code>
         <code class="n">parseNumber</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">substring</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">indexOf</code><code class="o">(</code><code class="s">"bytes="</code><code class="o">)</code> <code class="o">+</code> <code class="mi">6</code><code class="o">)),</code>
         <code class="o">{</code>
           <code class="k">if</code> <code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">endsWith</code><code class="o">(</code><code class="s">"-"</code><code class="o">))</code>
             <code class="n">file</code><code class="o">.</code><code class="n">length</code> <code class="o">-</code> <code class="mi">1</code>
           <code class="k">else</code>
             <code class="n">parseNumber</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">substring</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">indexOf</code><code class="o">(</code><code class="s">"-"</code><code class="o">)</code> <code class="o">+</code> <code class="mi">1</code><code class="o">))</code>
         <code class="o">}</code>
       <code class="o">)</code>
    <code class="o">}</code>
    <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="o">(</code><code class="mi">0L</code><code class="o">,</code> <code class="n">file</code><code class="o">.</code><code class="n">length</code> <code class="o">-</code> <code class="mi">1</code><code class="o">)</code>
  <code class="o">}</code></pre>

<p>Next, the response must skip ahead to the location in the video where the client wishes to begin. This is done by doing the following:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">fis</code><code class="k">:</code> <code class="kt">FileInputStream</code> <code class="o">=</code> <code class="o">...</code> <code class="c1">// Shown in the first example</code>
<code class="n">fis</code><code class="o">.</code><code class="n">skip</code><code class="o">(</code><code class="n">start</code><code class="o">)</code></pre>
</section>













<section data-type="sect2" id="see-also-2ksZhEuQ">
<h2>See Also</h2>

<p>This recipe is based on the <a href="https://www.assembla.com/wiki/show/liftweb/StreamingResponse">Streaming Response wiki</a> article.</p>

<p><a href="https://github.com/marvelm/ObeseRabbit">ObeseRabbit</a> is a small application showcasing this feature.</p>

<p><a data-type="xref" href="#RestStreamContent">Streaming Content</a> describes <code>StreamingResponse</code> and similar types of response, such as <code>OutputStreamResponse</code> and <code>InMemoryResponse</code>.</p>
</section>





</section>













<section data-type="sect1" id="JSONREST">
<h1>Returning JSON</h1>








<section data-type="sect2" id="problem-XQspFZUp">
<h2>Problem</h2>

<p>You want to return JSON from a REST call.<a data-type="indexterm" data-primary="REST web services" data-secondary="returning JSON" id="id-e4CzSJFZFOUr"></a><a data-type="indexterm" data-primary="JSON format" data-secondary="returning from REST calls" id="id-GnCZFgFbFyUK"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjIzUa">
<h2>Solution</h2>

<p>Use the Lift JSON domain-specific language (DSL).<a data-type="indexterm" data-primary="Lift JSON domain-specific language (DSL)" id="id-GnCJSgFkIyUK"></a><a data-type="indexterm" data-primary="JSON DSL" id="id-DnCaFWFgIwUQ"></a> For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.LiftRules</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.JsonAST._</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.JsonDSL._</code>

<code class="k">object</code> <code class="nc">QuotationsAPI</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">QuotationsAPI</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"quotation"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">JsonGet</code> <code class="n">req</code> <code class="k">=&gt;</code>
     <code class="o">(</code><code class="s">"text"</code> <code class="o">-&gt;</code> <code class="s">"A beach house isn't just real estate. It's a state of mind."</code><code class="o">)</code> <code class="o">~</code>
     <code class="o">(</code><code class="s">"by"</code> <code class="o">-&gt;</code> <code class="s">"Douglas Adams"</code><code class="o">)</code> <code class="k">:</code> <code class="kt">JValue</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>Wire this into <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">code.rest.QuotationsAPI</code>
<code class="nc">QuotationsAPI</code><code class="o">.</code><code class="n">init</code><code class="o">()</code></pre>

<p>Running this example produces:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="err">$</code> <code class="err">curl</code> <code class="err">-H</code> <code class="err">'Content-type:</code> <code class="err">text/json'</code> <code class="err">http://</code><code class="mf">127.0</code><code class="err">.</code><code class="mf">0.1</code><code class="err">:</code><code class="mi">8080</code><code class="err">/quotation</code>
<code class="p">{</code>
 <code class="nt">"text"</code><code class="p">:</code><code class="s2">"A beach house isn't just real estate. It's a state of mind."</code><code class="p">,</code>
 <code class="nt">"by"</code><code class="p">:</code><code class="s2">"Douglas Adams"</code>
<code class="p">}</code></pre>
</section>













<section data-type="sect2" id="discussion-2ksLtGUQ">
<h2>Discussion</h2>

<p>The <em>type ascription</em> at the end of the JSON expression (<code>: JValue</code>)
tells the compiler that the expression is expected to be of type
<code>JValue</code>. This is required to allow the DSL to apply. It would not be
required if, for example, you were calling a function that was defined
to return a <code>JValue</code>.<a data-type="indexterm" data-primary="type ascription" id="id-9nCxhvF4tdUM"></a></p>

<p>The JSON DSL allows you to create nested structures, lists, and
everything else you expect of JSON.</p>

<p>In addition to the DSL, you can create JSON from a case class by using the <code>Extraction.decompose</code> method:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.json.Extraction</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.DefaultFormats</code>

<code class="k">case</code> <code class="k">class</code> <code class="nc">Quote</code><code class="o">(</code><code class="n">text</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">by</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code>
<code class="k">val</code> <code class="n">quote</code> <code class="k">=</code> <code class="nc">Quote</code><code class="o">(</code>
  <code class="s">"A beach house isn't just real estate. It's a state of mind."</code><code class="o">,</code>
  <code class="s">"Douglas Adams"</code><code class="o">)</code>

<code class="k">implicit</code> <code class="k">val</code> <code class="n">formats</code> <code class="k">=</code> <code class="nc">DefaultFormats</code>
<code class="k">val</code> <code class="n">json</code> <code class="k">:</code> <code class="kt">JValue</code> <code class="o">=</code> <code class="nc">Extraction</code> <code class="n">decompose</code> <code class="n">quote</code></pre>

<p>This will also produce a <code>JValue</code>, which when printed will be:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="o">{</code>
 <code class="s">"text"</code><code class="k">:</code><code class="err">"</code><code class="kt">A</code> <code class="kt">beach</code> <code class="kt">house</code> <code class="kt">isn</code><code class="err">'</code><code class="kt">t</code> <code class="kt">just</code> <code class="kt">real</code> <code class="kt">estate.</code> <code class="kt">It</code><code class="err">'</code><code class="kt">s</code> <code class="kt">a</code> <code class="kt">state</code> <code class="kt">of</code> <code class="kt">mind.</code><code class="err">"</code><code class="o">,</code>
 <code class="s">"by"</code><code class="k">:</code><code class="err">"</code><code class="kt">Douglas</code> <code class="kt">Adams</code><code class="err">"</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="see-also-pWsJhoUz">
<h2>See Also</h2>

<p><a href="https://github.com/lift/framework/tree/master/core/json">The README file for the <em>lift-json</em> project</a> is a great source of examples for using the JSON DSL.</p>
</section>





</section>













<section data-type="sect1" id="GoogleSitemap">
<h1>Google Sitemap</h1>








<section data-type="sect2" id="problem-jWslF9Ca">
<h2>Problem</h2>

<p>You want to make a Google Sitemap using Lift’s rendering capabilities.<a data-type="indexterm" data-primary="REST web services" data-secondary="Google Sitemaps" id="id-GnCJSgFbFkCK"></a><a data-type="indexterm" data-primary="Google Sitemaps" id="id-DnCaFWFwFnCQ"></a><a data-type="indexterm" data-primary="templates" data-secondary="using Google Sitemaps with" id="id-kVCAIpFLFPCL"></a><a data-type="indexterm" data-primary="sitemap structure" id="id-4nCPtYFVFlCx"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIzCQ">
<h2>Solution</h2>

<p>Create the Google site map structure, and bind to it as you would for any template in Lift.  Then deliver it as XML content.</p>

<p>Start with a <em>sitemap.html</em> in your <em>webapp</em> folder containing valid XML-Sitemap markup:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true"><code class="cp">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</code>
<code class="nt">&lt;urlset</code> <code class="na">xmlns=</code><code class="s">"http://www.sitemaps.org/schemas/sitemap/0.9"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;url</code> <code class="na">data-lift=</code><code class="s">"SitemapContent.base"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;loc&gt;&lt;/loc&gt;</code>
        <code class="nt">&lt;changefreq&gt;</code>daily<code class="nt">&lt;/changefreq&gt;</code>
        <code class="nt">&lt;priority&gt;</code>1.0<code class="nt">&lt;/priority&gt;</code>
        <code class="nt">&lt;lastmod&gt;&lt;/lastmod&gt;</code>
    <code class="nt">&lt;/url&gt;</code>
    <code class="nt">&lt;url</code> <code class="na">data-lift=</code><code class="s">"SitemapContent.list"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;loc&gt;&lt;/loc&gt;</code>
        <code class="nt">&lt;lastmod&gt;&lt;/lastmod&gt;</code>
    <code class="nt">&lt;/url&gt;</code>
<code class="nt">&lt;/urlset&gt;</code></pre>

<p>Make a snippet to fill the required gaps:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">org.joda.time.DateTime</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.CssSel</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.S</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="k">class</code> <code class="nc">SitemapContent</code> <code class="o">{</code>

  <code class="k">case</code> <code class="k">class</code> <code class="nc">Post</code><code class="o">(</code><code class="n">url</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">date</code><code class="k">:</code> <code class="kt">DateTime</code><code class="o">)</code>

  <code class="k">lazy</code> <code class="k">val</code> <code class="n">entries</code> <code class="k">=</code>
    <code class="nc">Post</code><code class="o">(</code><code class="s">"/welcome"</code><code class="o">,</code> <code class="k">new</code> <code class="nc">DateTime</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Post</code><code class="o">(</code><code class="s">"/about"</code><code class="o">,</code> <code class="k">new</code> <code class="nc">DateTime</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code>

  <code class="k">val</code> <code class="n">siteLastUdated</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">DateTime</code>

  <code class="k">def</code> <code class="n">base</code><code class="k">:</code> <code class="kt">CssSel</code> <code class="o">=</code>
    <code class="s">"loc *"</code> <code class="o">#&gt;</code> <code class="s">"http://%s/"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">S</code><code class="o">.</code><code class="n">hostName</code><code class="o">)</code> <code class="o">&amp;</code>
      <code class="s">"lastmod *"</code> <code class="o">#&gt;</code> <code class="n">siteLastUpdated</code><code class="o">.</code><code class="n">toString</code><code class="o">(</code><code class="s">"yyyy-MM-dd'T'HH:mm:ss.SSSZZ"</code><code class="o">)</code>

  <code class="k">def</code> <code class="n">list</code><code class="k">:</code> <code class="kt">CssSel</code> <code class="o">=</code>
    <code class="s">"url *"</code> <code class="o">#&gt;</code> <code class="n">entries</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">post</code> <code class="k">=&gt;</code>
      <code class="s">"loc *"</code> <code class="o">#&gt;</code> <code class="s">"http://%s%s"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">S</code><code class="o">.</code><code class="n">hostName</code><code class="o">,</code> <code class="n">post</code><code class="o">.</code><code class="n">url</code><code class="o">)</code> <code class="o">&amp;</code>
        <code class="s">"lastmod *"</code> <code class="o">#&gt;</code> <code class="n">post</code><code class="o">.</code><code class="n">date</code><code class="o">.</code><code class="n">toString</code><code class="o">(</code><code class="s">"yyyy-MM-dd'T'HH:mm:ss.SSSZZ"</code><code class="o">))</code>

<code class="o">}</code></pre>

<p>This example is using canned data for two pages.<a data-type="indexterm" data-primary="S." data-secondary="hostName" id="id-ZbCxSLckIZCB"></a><a data-type="indexterm" data-primary="S." data-secondary="render" id="id-zdCkFecpI2Ce"></a></p>

<p>Apply the template and snippet in a REST service at <em>/sitemap</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>

<code class="k">object</code> <code class="nc">Sitemap</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>
  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"sitemap"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="nc">XmlResponse</code><code class="o">(</code>
        <code class="n">S</code><code class="o">.</code><code class="n">render</code><code class="o">(&lt;</code><code class="n">lift</code><code class="k">:</code><code class="kt">embed</code> <code class="kt">what</code><code class="o">=</code><code class="s">"sitemap"</code> <code class="o">/&gt;,</code> <code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">).</code><code class="n">head</code>
      <code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Wire this into your application in <em>Boot.scala</em>, and force Lift to process <em>/sitemap</em> as XML:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="n">code</code><code class="o">.</code><code class="n">rest</code><code class="o">.</code><code class="nc">Sitemap</code><code class="o">)</code>

<code class="nc">LiftRules</code><code class="o">.</code><code class="n">htmlProperties</code><code class="o">.</code><code class="n">default</code><code class="o">.</code><code class="n">set</code><code class="o">({</code> <code class="n">request</code><code class="k">:</code> <code class="kt">Req</code> <code class="o">=&gt;</code>
  <code class="n">request</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">partPath</code> <code class="k">match</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"sitemap"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="k">=&gt;</code> <code class="nc">OldHtmlProperties</code><code class="o">(</code><code class="n">request</code><code class="o">.</code><code class="n">userAgent</code><code class="o">)</code>
    <code class="k">case</code> <code class="k">_</code>                <code class="k">=&gt;</code> <code class="nc">Html5Properties</code><code class="o">(</code><code class="n">request</code><code class="o">.</code><code class="n">userAgent</code><code class="o">)</code>
  <code class="o">}</code>
<code class="o">})</code></pre>

<p>Test this service using a tool like cURL:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true">$ curl http://127.0.0.1:8080/sitemap

<code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
<code class="nt">&lt;urlset</code> <code class="na">xmlns=</code><code class="s">"http://www.sitemaps.org/schemas/sitemap/0.9"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;url&gt;</code>
    <code class="nt">&lt;loc&gt;</code>http://127.0.0.1/<code class="nt">&lt;/loc&gt;</code>
      <code class="nt">&lt;changefreq&gt;</code>daily<code class="nt">&lt;/changefreq&gt;</code>
      <code class="nt">&lt;priority&gt;</code>1.0<code class="nt">&lt;/priority&gt;</code>
      <code class="nt">&lt;lastmod&gt;</code>2013-02-10T19:16:12.433+00:00<code class="nt">&lt;/lastmod&gt;</code>
  <code class="nt">&lt;/url&gt;</code>
  <code class="nt">&lt;url&gt;</code>
      <code class="nt">&lt;loc&gt;</code>http://127.0.0.1/welcome<code class="nt">&lt;/loc&gt;</code>
      <code class="nt">&lt;lastmod&gt;</code>2013-02-10T19:16:12.434+00:00<code class="nt">&lt;/lastmod&gt;</code>
  <code class="nt">&lt;/url&gt;&lt;url&gt;</code>
      <code class="nt">&lt;loc&gt;</code>http://127.0.0.1/about<code class="nt">&lt;/loc&gt;</code>
      <code class="nt">&lt;lastmod&gt;</code>2013-02-10T19:16:12.434+00:00<code class="nt">&lt;/lastmod&gt;</code>
  <code class="nt">&lt;/url&gt;</code>
<code class="nt">&lt;/urlset&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-pWswtpCz">
<h2>Discussion</h2>

<p>You may be wondering why we’ve used REST here when we could have used a regular HTML template and snippet. The reason is that we want XML rather than HTML output.  We use the same mechanism, but invoke it and wrap it in an <code>XmlResponse</code>.</p>

<p>Using Lift’s regular snippet mechanism for rendering this XML is convenient. But although we are working with XML, Lift will be parsing <em>sitemap.html</em> using the default HTML5 parser. The behaviour of the parser follows the HTML5 specification and this is not the same as the behaviour you might expect from a parser for XML. For example, recognized HTML tags in an invalid position are moved by the HTML parser.  To avoid these situations we have modified <em>Boot.scala</em> to use an XML parser for <em>/sitemap</em>.</p>

<p>The <code>S.render</code> method takes a <code>NodeSeq</code> and an <code>HTTPRequest</code>. The first we supply by running the <em>sitemap.html</em> snippet; the second is simply the current request.  <code>XmlResponse</code> requires a <code>Node</code> rather than a <code>NodeSeq</code>, which is why we call <code>head</code>—as there’s only one node in the response, this does what we need.</p>

<p>Note that Google Sitemaps needs dates to be in ISO 8601 format. The built-in <code>java.text.SimpleDateFormat</code> does not support this format prior to Java 7. If you are using Java 6, you need to use <code>org.joda.time.DateTime</code> as we are in this example.</p>
</section>













<section data-type="sect2" id="see-also-o8sNhyC7">
<h2>See Also</h2>

<p>You’ll find an explanation of the Sitemap Protocol on Google’s <a href="http://bit.ly/163CV1h">Webmaster Tools site</a>.</p>
</section>





</section>













<section data-type="sect1" id="iOSNativePost">
<h1>Calling REST Service from a Native iOS Application</h1>








<section data-type="sect2" id="problem-2kslFMsQ">
<h2>Problem</h2>

<p>You want to make an HTTP POST from a native iOS device to a Lift REST service.<a data-type="indexterm" data-primary="REST web services" data-secondary="native iOS applications and" id="id-DnC1SWFwFxsQ"></a><a data-type="indexterm" data-primary="HTTP" data-secondary="POSTs from iOS devices" id="id-kVCEFpFLF2sL"></a><a data-type="indexterm" data-primary="iOS applications, HTTP POSTs from" id="id-4nCkIYFVF2sx"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIDsz">
<h2>Solution</h2>

<p>Use <code>NSURLConnection</code>, ensuring you set the <code>content-type</code> to <code>application/json</code>.</p>

<p>For example, suppose we want to call this service:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.JsonDSL._</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.JsonAST._</code>

<code class="k">object</code> <code class="nc">Shouty</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">greet</code><code class="o">(</code><code class="n">name</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">:</code> <code class="kt">JValue</code> <code class="o">=</code>
    <code class="s">"greeting"</code> <code class="o">-&gt;</code> <code class="o">(</code><code class="s">"HELLO "</code><code class="o">+</code><code class="n">name</code><code class="o">.</code><code class="n">toUpperCase</code><code class="o">)</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"shout"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">JsonPost</code> <code class="n">json</code><code class="o">-&gt;</code><code class="n">request</code> <code class="k">=&gt;</code>
      <code class="k">for</code> <code class="o">{</code> <code class="nc">JString</code><code class="o">(</code><code class="n">name</code><code class="o">)</code> <code class="k">&lt;-</code> <code class="o">(</code><code class="n">json</code> <code class="o">\\</code> <code class="s">"name"</code><code class="o">).</code><code class="n">toOpt</code> <code class="o">}</code>
      <code class="k">yield</code> <code class="n">greet</code><code class="o">(</code><code class="n">name</code><code class="o">)</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>The service expects a JSON post with a parameter of <code>name</code>, and it returns a greeting as a JSON object.  To demonstrate the data to and from the service, we can include the service in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessDispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">Shouty</code><code class="o">)</code></pre>

<p>Call it from the command line:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="err">$</code> <code class="err">curl</code> <code class="err">-d</code> <code class="err">'</code><code class="p">{</code> <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"World"</code> <code class="p">}</code><code class="err">'</code> <code class="err">-X</code> <code class="err">POST</code> <code class="err">-H</code> <code class="err">'Content-type:</code> <code class="err">application/json'</code>
   <code class="err">http://</code><code class="mf">127.0</code><code class="err">.</code><code class="mf">0.1</code><code class="err">:</code><code class="mi">8080</code><code class="err">/shout</code>
<code class="p">{</code>
  <code class="nt">"greeting"</code><code class="p">:</code><code class="s2">"HELLO WORLD"</code>
<code class="p">}</code></pre>

<p>We can implement the POST request using <code>NSURLConnection</code>:</p>

<pre data-type="programlisting" data-code-language="objc" data-highlighted="true"><code class="k">static</code> <code class="bp">NSString</code> <code class="o">*</code><code class="n">url</code> <code class="o">=</code> <code class="s">@"http://localhost:8080/shout"</code><code class="p">;</code>

<code class="p">-(</code><code class="kt">void</code><code class="p">)</code> <code class="nf">postAction</code> <code class="p">{</code>
  <code class="c1">// JSON data:</code>
  <code class="bp">NSDictionary</code><code class="o">*</code> <code class="n">dic</code> <code class="o">=</code> <code class="l">@{</code><code class="s">@"name"</code><code class="o">:</code> <code class="s">@"World"</code><code class="l">}</code><code class="p">;</code>
  <code class="bp">NSData</code><code class="o">*</code> <code class="n">jsonData</code> <code class="o">=</code>
    <code class="p">[</code><code class="bp">NSJSONSerialization</code> <code class="nl">dataWithJSONObject</code><code class="p">:</code><code class="n">dic</code> <code class="nl">options</code><code class="p">:</code><code class="mi">0</code> <code class="nl">error</code><code class="p">:</code><code class="nb">nil</code><code class="p">];</code>
  <code class="bp">NSMutableURLRequest</code> <code class="o">*</code><code class="n">request</code> <code class="o">=</code> <code class="p">[</code>
    <code class="bp">NSMutableURLRequest</code> <code class="nl">requestWithURL</code><code class="p">:[</code><code class="bp">NSURL</code> <code class="nl">URLWithString</code><code class="p">:</code><code class="n">url</code><code class="p">]</code>
    <code class="nl">cachePolicy</code><code class="p">:</code><code class="n">NSURLRequestUseProtocolCachePolicy</code> <code class="nl">timeoutInterval</code><code class="p">:</code><code class="mf">60.0</code><code class="p">];</code>

  <code class="c1">// Construct HTTP request:</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setHTTPMethod</code><code class="p">:</code><code class="s">@"POST"</code><code class="p">];</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setValue</code><code class="p">:</code><code class="s">@"application/json"</code> <code class="nl">forHTTPHeaderField</code><code class="p">:</code><code class="s">@"Content-Type"</code><code class="p">];</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setValue</code><code class="p">:[</code><code class="bp">NSString</code> <code class="nl">stringWithFormat</code><code class="p">:</code><code class="s">@"%d"</code><code class="p">,</code> <code class="p">[</code><code class="n">jsonData</code> <code class="n">length</code><code class="p">]]</code>
    <code class="nl">forHTTPHeaderField</code><code class="p">:</code><code class="s">@"Content-Length"</code><code class="p">];</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setHTTPBody</code><code class="p">:</code> <code class="n">jsonData</code><code class="p">];</code>

  <code class="c1">// Send the request:</code>
  <code class="bp">NSURLConnection</code> <code class="o">*</code><code class="n">con</code> <code class="o">=</code> <code class="p">[[</code><code class="bp">NSURLConnection</code> <code class="n">alloc</code><code class="p">]</code>
    <code class="nl">initWithRequest</code><code class="p">:</code><code class="n">request</code> <code class="nl">delegate</code><code class="p">:</code><code class="nb">self</code><code class="p">];</code>
<code class="p">}</code>

<code class="p">-</code> <code class="p">(</code><code class="kt">void</code><code class="p">)</code><code class="nf">connection:</code><code class="p">(</code><code class="bp">NSURLConnection</code> <code class="o">*</code><code class="p">)</code><code class="nv">connection</code>
  <code class="nf">didReceiveResponse:</code><code class="p">(</code><code class="bp">NSURLResponse</code> <code class="o">*</code><code class="p">)</code><code class="nv">response</code> <code class="p">{</code>
   <code class="c1">// Start off with new, empty, response data</code>
   <code class="nb">self</code><code class="p">.</code><code class="n">receivedJSONData</code> <code class="o">=</code> <code class="p">[</code><code class="bp">NSMutableData</code> <code class="n">data</code><code class="p">];</code>
<code class="p">}</code>

<code class="p">-</code> <code class="p">(</code><code class="kt">void</code><code class="p">)</code><code class="nf">connection:</code><code class="p">(</code><code class="bp">NSURLConnection</code> <code class="o">*</code><code class="p">)</code><code class="nv">connection</code>
  <code class="nf">didReceiveData:</code><code class="p">(</code><code class="bp">NSData</code> <code class="o">*</code><code class="p">)</code><code class="nv">data</code> <code class="p">{</code>
   <code class="c1">// append incoming data</code>
   <code class="p">[</code><code class="nb">self</code><code class="p">.</code><code class="n">receivedJSONData</code> <code class="nl">appendData</code><code class="p">:</code><code class="n">data</code><code class="p">];</code>
<code class="p">}</code>

<code class="p">-</code> <code class="p">(</code><code class="kt">void</code><code class="p">)</code><code class="nf">connection:</code><code class="p">(</code><code class="bp">NSURLConnection</code> <code class="o">*</code><code class="p">)</code><code class="nv">connection</code>
  <code class="nf">didFailWithError:</code><code class="p">(</code><code class="bp">NSError</code> <code class="o">*</code><code class="p">)</code><code class="nv">error</code> <code class="p">{</code>
   <code class="n">NSLog</code><code class="p">(</code><code class="s">@"Error occurred "</code><code class="p">);</code>
<code class="p">}</code>

<code class="p">-</code> <code class="p">(</code><code class="kt">void</code><code class="p">)</code><code class="nf">connectionDidFinishLoading:</code><code class="p">(</code><code class="bp">NSURLConnection</code> <code class="o">*</code><code class="p">)</code><code class="nv">connection</code> <code class="p">{</code>
  <code class="bp">NSError</code> <code class="o">*</code><code class="n">e</code> <code class="o">=</code> <code class="nb">nil</code><code class="p">;</code>
  <code class="bp">NSDictionary</code> <code class="o">*</code><code class="n">JSON</code> <code class="o">=</code>
    <code class="p">[</code><code class="bp">NSJSONSerialization</code> <code class="nl">JSONObjectWithData</code><code class="p">:</code> <code class="nb">self</code><code class="p">.</code><code class="n">receivedJSONData</code>
    <code class="nl">options</code><code class="p">:</code> <code class="n">NSJSONReadingMutableContainers</code> <code class="nl">error</code><code class="p">:</code> <code class="o">&amp;</code><code class="n">e</code><code class="p">];</code>
  <code class="n">NSLog</code><code class="p">(</code><code class="s">@"Return result: %@"</code><code class="p">,</code> <code class="p">[</code><code class="n">JSON</code> <code class="nl">objectForKey</code><code class="p">:</code><code class="s">@"greeting"</code><code class="p">]);</code>
<code class="p">}</code></pre>

<p>Obviously in this example we’ve used hardcoded values and URLs, but this will hopefully
be a starting point for use in your application.</p>
</section>













<section data-type="sect2" id="discussion-o8syt2s7">
<h2>Discussion</h2>

<p>There are many ways to do HTTP POST from iOS, and it can be confusing to identify the correct way that works, especially without the aid of an external library. The previous example uses the iOS native API.</p>

<p>Another way is to use <em>AFNetworking</em>. This is a popular external library for iOS development, can cope with many scenarios, and is simple to use<a data-type="indexterm" data-primary="AFNetworking" id="id-9nCdFBI4tzsM"></a>:</p>

<pre data-type="programlisting" data-code-language="objc" data-highlighted="true"><code class="cp">#import "AFHTTPClient.h"</code>
<code class="cp">#import "AFNetworking.h"</code>
<code class="cp">#import "JSONKit.h"</code>

<code class="k">static</code> <code class="bp">NSString</code> <code class="o">*</code><code class="n">url</code> <code class="o">=</code> <code class="s">@"http://localhost:8080/shout"</code><code class="p">;</code>

<code class="p">-(</code><code class="kt">void</code><code class="p">)</code> <code class="nf">postAction</code> <code class="p">{</code>
  <code class="c1">// JSON data:</code>
  <code class="bp">NSDictionary</code><code class="o">*</code> <code class="n">dic</code> <code class="o">=</code> <code class="l">@{</code><code class="s">@"name"</code><code class="o">:</code> <code class="s">@"World"</code><code class="l">}</code><code class="p">;</code>
  <code class="bp">NSData</code><code class="o">*</code> <code class="n">jsonData</code> <code class="o">=</code>
   <code class="p">[</code><code class="bp">NSJSONSerialization</code> <code class="nl">dataWithJSONObject</code><code class="p">:</code><code class="n">dic</code> <code class="nl">options</code><code class="p">:</code><code class="mi">0</code> <code class="nl">error</code><code class="p">:</code><code class="nb">nil</code><code class="p">];</code>

  <code class="c1">// Construct HTTP request:</code>
  <code class="bp">NSMutableURLRequest</code> <code class="o">*</code><code class="n">request</code> <code class="o">=</code>
   <code class="p">[</code><code class="bp">NSMutableURLRequest</code> <code class="nl">requestWithURL</code><code class="p">:[</code><code class="bp">NSURL</code> <code class="nl">URLWithString</code><code class="p">:</code><code class="n">url</code><code class="p">]</code>
    <code class="nl">cachePolicy</code><code class="p">:</code><code class="n">NSURLRequestUseProtocolCachePolicy</code> <code class="nl">timeoutInterval</code><code class="p">:</code><code class="mf">60.0</code><code class="p">];</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setHTTPMethod</code><code class="p">:</code><code class="s">@"POST"</code><code class="p">];</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setValue</code><code class="p">:</code><code class="s">@"application/json"</code> <code class="nl">forHTTPHeaderField</code><code class="p">:</code><code class="s">@"Content-Type"</code><code class="p">];</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setValue</code><code class="p">:[</code><code class="bp">NSString</code> <code class="nl">stringWithFormat</code><code class="p">:</code><code class="s">@"%d"</code><code class="p">,</code> <code class="p">[</code><code class="n">jsonData</code> <code class="n">length</code><code class="p">]]</code>
    <code class="nl">forHTTPHeaderField</code><code class="p">:</code><code class="s">@"Content-Length"</code><code class="p">];</code>
  <code class="p">[</code><code class="n">request</code> <code class="nl">setHTTPBody</code><code class="p">:</code> <code class="n">jsonData</code><code class="p">];</code>

  <code class="c1">// Send the request:</code>
  <code class="n">AFJSONRequestOperation</code> <code class="o">*</code><code class="n">operation</code> <code class="o">=</code>
    <code class="p">[[</code><code class="n">AFJSONRequestOperation</code> <code class="n">alloc</code><code class="p">]</code> <code class="nl">initWithRequest</code><code class="p">:</code> <code class="n">request</code><code class="p">];</code>
  <code class="p">[</code><code class="n">operation</code> <code class="nl">setCompletionBlockWithSuccess</code><code class="p">:</code><code class="o">^</code><code class="p">(</code><code class="n">AFHTTPRequestOperation</code> <code class="o">*</code><code class="n">operation</code><code class="p">,</code>
    <code class="kt">id</code> <code class="n">responseObject</code><code class="p">)</code>
  <code class="p">{</code>
     <code class="bp">NSString</code> <code class="o">*</code><code class="n">response</code> <code class="o">=</code> <code class="p">[</code><code class="n">operation</code> <code class="n">responseString</code><code class="p">];</code>

     <code class="c1">// Use JSONKit to deserialize the response into NSDictionary</code>
     <code class="bp">NSDictionary</code> <code class="o">*</code><code class="n">deserializedJSON</code> <code class="o">=</code> <code class="p">[</code><code class="n">response</code> <code class="n">objectFromJSONString</code><code class="p">];</code>
     <code class="p">[</code><code class="n">deserializedJSON</code> <code class="n">count</code><code class="p">];</code>

     <code class="c1">// The response object can be a NSDicionary or a NSArray:</code>
      <code class="k">if</code><code class="p">([</code><code class="n">deserializedJSON</code> <code class="n">count</code><code class="p">]</code><code class="o">&gt;</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>
         <code class="n">NSLog</code><code class="p">(</code><code class="s">@"Return value: %@"</code><code class="p">,[</code><code class="n">deserializedJSON</code> <code class="nl">objectForKey</code><code class="p">:</code><code class="s">@"greeting"</code><code class="p">]);</code>
      <code class="p">}</code>
      <code class="k">else</code> <code class="p">{</code>
        <code class="bp">NSArray</code> <code class="o">*</code><code class="n">deserializedJSONArray</code> <code class="o">=</code> <code class="p">[</code><code class="n">response</code> <code class="n">objectFromJSONString</code><code class="p">];</code>
        <code class="n">NSLog</code><code class="p">(</code><code class="s">@"Return array value: %@"</code><code class="p">,</code> <code class="n">deserializedJSONArray</code> <code class="p">);</code>
      <code class="p">}</code>
  <code class="p">}</code><code class="nl">failure</code><code class="p">:</code><code class="o">^</code><code class="p">(</code><code class="n">AFHTTPRequestOperation</code> <code class="o">*</code><code class="n">operation</code><code class="p">,</code> <code class="bp">NSError</code> <code class="o">*</code><code class="n">error</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="n">NSLog</code><code class="p">(</code><code class="s">@"Error: %@"</code><code class="p">,</code><code class="n">error</code><code class="p">);</code>
  <code class="p">}];</code>
  <code class="p">[</code><code class="n">operation</code> <code class="n">start</code><code class="p">];</code>
<code class="p">}</code></pre>

<p>The <code>NSURLConnection</code> approach is more versatile and gives you a starting point to craft your own solution, such as by making the content type more specific. However, <code>AFNetworking</code> is popular and you may prefer that route.</p>
</section>













<section data-type="sect2" id="see-also-g0sxhms4">
<h2>See Also</h2>

<p>You may find the <a href="http://simply.liftweb.net/index-5.4.html">"Complete REST Example" in <em>Simply Lift</em></a> to be a good test ground for your calls to Lift.<a data-type="indexterm" data-startref="ix_REST" id="id-9nCdFvFKhzsM"></a></p>
</section>





</section>







</section>














<section data-type="chapter" id="Ajax">
<h1>JavaScript, Ajax, and Comet</h1>


<p>Lift is known for its great Ajax and Comet support, and in this chapter, we’ll explore these.</p>

<p>For an introduction to Lift’s Ajax and Comet features, see <a href="http://simply.liftweb.net"><em>Simply Lift</em></a>, Chapter 9 of <em>Lift in Action</em> (Perrett, 2012, Manning Publications, Co.), or watch <a href="http://bit.ly/12unDnJ">Diego Medina’s video presentation</a>.</p>

<p>The source code for this chapter is at <a href="https://github.com/LiftCookbook/cookbook_ajax"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_ajax</em></a>.</p>






<section data-type="sect1" id="ButtonTriggerServerCode">
<h1>Trigger Server-Side Code from a Button</h1>








<section data-type="sect2" id="problem-wPs4FehP">
<h2>Problem</h2>

<p>You want to trigger some server-side code when the user presses a
button.<a data-type="indexterm" id="ix_AJssc" data-primary="Ajax" data-secondary="server-side code triggering"></a><a data-type="indexterm" id="ix_AIssc" data-primary="ajaxInvoke"></a><a data-type="indexterm" data-primary="radio buttons" id="id-AnCKIZFvFNhG"></a><a data-type="indexterm" data-primary="server-side code" data-secondary="triggering with buttons" id="id-W7CetLFYFzh8"></a></p>
</section>













<section data-type="sect2" id="solution-xqs0IyhW">
<h2>Solution</h2>

<p>Use <code>ajaxInvoke</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.</code><code class="o">{</code><code class="nc">JsCmd</code><code class="o">,</code> <code class="nc">JsCmds</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>

<code class="k">object</code> <code class="nc">AjaxInvoke</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">callback</code><code class="o">()</code> <code class="k">:</code> <code class="kt">JsCmd</code> <code class="o">=</code> <code class="o">{</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"The button was pressed"</code><code class="o">)</code>
    <code class="nc">JsCmds</code><code class="o">.</code><code class="nc">Alert</code><code class="o">(</code><code class="s">"You clicked it"</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">button</code> <code class="k">=</code> <code class="s">"button [onclick]"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">ajaxInvoke</code><code class="o">(</code><code class="n">callback</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>In this snippet, we are binding the click event of a button to an <code>ajaxInvoke</code>: when the button is pressed, Lift
arranges for the function you gave <code>ajaxInvoke</code> to be executed.</p>

<p>That function, <code>callback</code>, is just logging a message and returning a JavaScript alert to the browser. The corresponding HTML might include:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"AjaxInvoke.button"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;button&gt;</code>Click Me<code class="nt">&lt;/button&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-Pasetwhz">
<h2>Discussion</h2>

<p>The signature of the function you pass to <code>ajaxInvoke</code> is
<code>Unit =&gt; JsCmd</code>, meaning you can trigger a range of behaviours: from
returning <code>Noop</code> if you want nothing to happen, through changing DOM
elements, all the way up to executing arbitrary JavaScript.</p>

<p>The previous example uses a button but will work on any element that
has an event you can bind to.  We’re binding to <code>onclick</code> but it could be any event
the DOM exposes.</p>

<p>Related to <code>ajaxInvoke</code> are the following functions:</p>
<dl>
<dt><code>SHtml.onEvent</code></dt>
<dd>
<p>Calls a function with the signature <code>String =&gt; JsCmd</code> because it
is passed the <code>value</code> of the node it is attached to. In the previous
example, this would be the empty string, as the button has no value.</p>
</dd>
<dt><code>SHtml.ajaxCall</code></dt>
<dd>
<p>This is more general than <code>onEvent</code>, as you give it the expression you want passed to your server-side code.<a data-type="indexterm" data-primary="SHtml." data-secondary="ajaxCall" id="id-JnCzFGSDtvh2tYhD"></a><a data-type="indexterm" data-primary="ajaxCall" id="id-9nCrIDS4t2h1tPhg"></a></p>
</dd>
<dt><code>SHtml.jsonCall</code></dt>
<dd>
<p>This is even more general still: you give it a function
that will return a JSON object when executed on the client, and this
object will be passed to your server-side function.<a data-type="indexterm" data-primary="SHtml." data-secondary="jsonCall" id="id-9nCjSDS7T2h1tPhg"></a><a data-type="indexterm" data-primary="jsonCall" id="id-ZbC1FDSyTYhDtdhJ"></a></p>
</dd>
</dl>

<p>Let’s look at each of these in turn.</p>










<section data-type="sect3" id="onevent-receiving-the-value-of-a-dom-element-o8svc1t2hk">
<h3>onEvent: receiving the value of a DOM element</h3>

<p>You can use <code>onEvent</code> with any element that has a <code>value</code> attribute and responds to the event you choose to bind to. The function you supply to <code>onEvent</code> is called with the element’s value. As an example, we can write a snippet that presents a challenge to the user and validates the response<a data-type="indexterm" data-primary="SHtml." data-secondary="onEvent" id="id-ZbCPtMFpcrtOhK"></a><a data-type="indexterm" data-primary="onEvent" id="id-zdCrhGFjcxtdhn"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">scala.util.Random</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.Alert</code>

<code class="k">object</code> <code class="nc">OnEvent</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>
    <code class="k">val</code> <code class="n">x</code><code class="o">,</code> <code class="n">y</code> <code class="k">=</code> <code class="nc">Random</code><code class="o">.</code><code class="n">nextInt</code><code class="o">(</code><code class="mi">10</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">sum</code> <code class="k">=</code> <code class="n">x</code> <code class="o">+</code> <code class="n">y</code>

    <code class="s">"p *"</code> <code class="o">#&gt;</code> <code class="s">"What is %d + %d?"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">x</code><code class="o">,</code><code class="n">y</code><code class="o">)</code> <code class="o">&amp;</code>
    <code class="s">"input [onchange]"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">onEvent</code><code class="o">(</code> <code class="n">answer</code> <code class="k">=&gt;</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">answer</code> <code class="o">==</code> <code class="n">sum</code><code class="o">.</code><code class="n">toString</code><code class="o">)</code> <code class="nc">Alert</code><code class="o">(</code><code class="s">"Correct!"</code><code class="o">)</code>
      <code class="k">else</code> <code class="nc">Alert</code><code class="o">(</code><code class="s">"Try again"</code><code class="o">)</code>
     <code class="o">)</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>This snippet prompts the user to add the two random numbers presented in the <code>&lt;p&gt;</code> tag, and binds a validation function to the <code>&lt;input&gt;</code> on the page:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"OnEvent"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;p&gt;</code>Problem appears here<code class="nt">&lt;/p&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">placeholder=</code><code class="s">"Type your answer"</code><code class="nt">&gt;&lt;/input&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>When <code>onchange</code> is triggered (by pressing Return or the Tab key, for example), the text entered is sent to our <code>onEvent</code> function as a <code>String</code>. On the server-side, we check the answer and send back "Correct!" or "Try again" as a JavaScript alert.</p>
</section>













<section data-type="sect3" id="ajaxcall-receiving-an-arbitrary-client-side-string-g0sEiBtPhp">
<h3>ajaxCall: receiving an arbitrary client-side string</h3>

<p>Where <code>onEvent</code> sends <code>this.value</code> to your server-side code, <code>ajaxCall</code> allows you to specify the client-side expression used to produce a value.<a data-type="indexterm" data-primary="ajaxCall" id="id-zdCbtGFeixtdhn"></a><a data-type="indexterm" data-primary="SHtml." data-secondary="ajaxCall" id="id-yYCYhpFKi4toh1"></a></p>

<p>To demonstrate this, we can create a template that includes two elements: a button and a text field.  We’ll bind our function to the button, but read a value from the input field:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"AjaxCall"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"num"</code> <code class="na">value=</code><code class="s">"41"</code><code class="nt">&gt;&lt;/input&gt;</code>
  <code class="nt">&lt;button&gt;</code>Increment<code class="nt">&lt;/button&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>We want to arrange for the button to read the <code>num</code> field, increment it, and return it back to the input field:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JE.ValById</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds._</code>

<code class="k">object</code> <code class="nc">AjaxCall</code> <code class="o">{</code>

 <code class="k">def</code> <code class="n">increment</code><code class="o">(</code><code class="n">in</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">:</code> <code class="kt">String</code> <code class="o">=</code>
  <code class="n">asInt</code><code class="o">(</code><code class="n">in</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="k">_</code> <code class="o">+</code> <code class="mi">1</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">toString</code><code class="o">)</code> <code class="n">openOr</code> <code class="n">in</code>

 <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"button [onclick]"</code> <code class="o">#&gt;</code>
   <code class="nc">SHtml</code><code class="o">.</code><code class="n">ajaxCall</code><code class="o">(</code><code class="nc">ValById</code><code class="o">(</code><code class="s">"num"</code><code class="o">),</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="nc">SetValById</code><code class="o">(</code><code class="s">"num"</code><code class="o">,</code> <code class="n">increment</code><code class="o">(</code><code class="n">s</code><code class="o">))</code> <code class="o">)</code>

 <code class="o">}</code></pre>

<p>The first argument to <code>ajaxCall</code> is the expression that will produce a value for our function. It can be any <code>JsExp</code>, and we’ve
used <code>ValById</code>, which looks up the value of an element by the ID attribute.  We could have used a regular jQuery expression to achieve the same effect with <code>JsRaw("$('#num').val()")</code>.</p>

<p>Our second argument to <code>ajaxCall</code> takes the value of the <code>JsExp</code> expression as a <code>String</code>. We’re using one of Lift’s JavaScript commands to replace the value with a new value. The new value is the result of incrementing the number (providing it is a number).</p>

<p>The end result is that you press the button and the number updates. It should go without saying that these are simple illustrations, and you probably don’t want a server round-trip to add one to a number. The techniques come into their own when there is some action of value to perform on the server.</p>

<p>You may have guessed that <code>onEvent</code> is implemented as an <code>ajaxCall</code> for <code>JsRaw("this.value")</code>.</p>
</section>













<section data-type="sect3" id="jsoncall-receiving-a-json-value-q8sJultEh9">
<h3>jsonCall: receiving a JSON value</h3>

<p>Both <code>ajaxCall</code> and <code>onEvent</code> end up evaluating a <code>String =&gt; JsCmd</code> function. By contrast, <code>jsonCall</code> has the signature <code>JValue =&gt; JsCmd</code>, meaning you can pass more complex data structures from JavaScript to your Lift application.<a data-type="indexterm" data-primary="SHtml." data-secondary="jsonCall" id="id-rjCJTYFwuYtbh9"></a><a data-type="indexterm" data-primary="jsonCall" id="id-wqC1cPFguztVh9"></a></p>

<p>To demonstrate this, we’ll create a template that asks for input, has a function to convert the input into JSON, and a button to send the JSON to the server:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"JsonCall"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;p&gt;</code>Enter an addition question:<code class="nt">&lt;/p&gt;</code>
  <code class="nt">&lt;div&gt;</code>
    <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"x"</code><code class="nt">&gt;</code> + <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"y"</code><code class="nt">&gt;</code> = <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"z"</code><code class="nt">&gt;</code>.
  <code class="nt">&lt;/div&gt;</code>
  <code class="nt">&lt;button&gt;</code>Check<code class="nt">&lt;/button&gt;</code>
<code class="nt">&lt;/div&gt;</code>

<code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>
// <code class="cp">&lt;![CDATA[</code>
<code class="cp">function currentQuestion() {</code>
<code class="cp">  return {</code>
<code class="cp">    first:  parseInt($('#x').val()),</code>
<code class="cp">    second: parseInt($('#y').val()),</code>
<code class="cp">    answer: parseInt($('#z').val())</code>
<code class="cp">  };</code>
<code class="cp">}</code>
<code class="cp">// ]]&gt;</code></pre>

<p>The <code>currentQuestion</code> function is creating an object, which will be turned into a JSON string when sent to the server. On the server, we’ll check that this JSON represents a valid integer addition problem:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.</code><code class="o">{</code><code class="nc">JsCmd</code><code class="o">,</code> <code class="nc">JE</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.JsonAST._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.Alert</code>
<code class="k">import</code> <code class="nn">net.liftweb.json.DefaultFormats</code>

<code class="k">object</code> <code class="nc">JsonCall</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">implicit</code> <code class="k">val</code> <code class="n">formats</code> <code class="k">=</code> <code class="nc">DefaultFormats</code>

  <code class="k">case</code> <code class="k">class</code> <code class="nc">Question</code><code class="o">(</code><code class="n">first</code><code class="k">:</code> <code class="kt">Int</code><code class="o">,</code> <code class="n">second</code><code class="k">:</code> <code class="kt">Int</code><code class="o">,</code> <code class="n">answer</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">def</code> <code class="n">valid_?</code> <code class="k">=</code> <code class="n">first</code> <code class="o">+</code> <code class="n">second</code> <code class="o">==</code> <code class="n">answer</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">def</code> <code class="n">validate</code><code class="o">(</code><code class="n">value</code><code class="k">:</code> <code class="kt">JValue</code><code class="o">)</code> <code class="k">:</code> <code class="kt">JsCmd</code> <code class="o">=</code> <code class="o">{</code>
      <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="n">value</code><code class="o">)</code>
      <code class="n">value</code><code class="o">.</code><code class="n">extractOpt</code><code class="o">[</code><code class="kt">Question</code><code class="o">].</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">valid_?</code><code class="o">)</code> <code class="k">match</code> <code class="o">{</code>
        <code class="k">case</code> <code class="nc">Some</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="nc">Alert</code><code class="o">(</code><code class="s">"Looks good"</code><code class="o">)</code>
        <code class="k">case</code> <code class="nc">Some</code><code class="o">(</code><code class="kc">false</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="nc">Alert</code><code class="o">(</code><code class="s">"That doesn't add up"</code><code class="o">)</code>
        <code class="k">case</code> <code class="nc">None</code> <code class="k">=&gt;</code> <code class="nc">Alert</code><code class="o">(</code><code class="s">"That doesn't make sense"</code><code class="o">)</code>
      <code class="o">}</code>
    <code class="o">}</code>

    <code class="s">"button [onclick]"</code> <code class="o">#&gt;</code>
      <code class="nc">SHtml</code><code class="o">.</code><code class="n">jsonCall</code><code class="o">(</code> <code class="nc">JE</code><code class="o">.</code><code class="nc">Call</code><code class="o">(</code><code class="s">"currentQuestion"</code><code class="o">),</code> <code class="n">validate</code> <code class="k">_</code> <code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Working from the bottom of this snippet up, we see a binding of the <code>&lt;button&gt;</code> to the <code>jsonCall</code>. The value we’ll be working on is the value provided by the JavaScript function called <code>currentQuestion</code>.  This was defined on the template page.  When the button is clicked, the JavaScript function is called and the resulting value will be presented to <code>validate</code>, which is our <code>JValue =&gt; JsCmd</code> function.</p>

<p>All <code>validate</code> does is log the JSON data and alert back if the question looks correct or not.  To do this, we use the Lift JSON ability to extract JSON to a case class and call the <code>valid_?</code> test to see if the numbers add up.  This will evaluate to <code>Some(true)</code> if the addition works, <code>Some(false)</code> if the addition isn’t correct, or <code>None</code> if the input is missing or not a valid integer.</p>

<p>Running the code and entering 1, 2, and 3 into the text fields will produce the following in the server log:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">JObject</code><code class="o">(</code><code class="nc">List</code><code class="o">(</code><code class="nc">JField</code><code class="o">(</code><code class="n">first</code><code class="o">,</code><code class="nc">JInt</code><code class="o">(</code><code class="mi">1</code><code class="o">)),</code> <code class="nc">JField</code><code class="o">(</code><code class="n">second</code><code class="o">,</code><code class="nc">JInt</code><code class="o">(</code><code class="mi">2</code><code class="o">)),</code>
  <code class="nc">JField</code><code class="o">(</code><code class="n">answer</code><code class="o">,</code><code class="nc">JInt</code><code class="o">(</code><code class="mi">3</code><code class="o">))))</code></pre>

<p>This is the <code>JValue</code> representation of the JSON.</p>
</section>



</section>













<section data-type="sect2" id="see-also-OKsGh9ho">
<h2>See Also</h2>

<p><a data-type="xref" href="#SelectOptionChange">Call Server When Select Option Changes</a> includes an example of <code>SHtml.onEvents</code>, which will bind a function to a number of events on a <code>NodeSeq</code>.</p>

<p><a href="http://exploring.liftweb.net/master/index-10.html"><em>Exploring Lift</em>, Chapter 10</a>, lists various <code>JsExp</code> classes you can use for <code>ajaxCall</code>.</p>

<p><a data-type="xref" href="#JsonForms">Ajax JSON Form Processing</a> using <code>JsonHandler</code> to send JSON data from a form to the server.<a data-type="indexterm" data-startref="ix_AJssc" id="id-kVCAIntQhZh8"></a><a data-type="indexterm" data-startref="ix_AIssc" id="id-4nCPtqtkhVhb"></a></p>
</section>





</section>













<section data-type="sect1" id="SelectOptionChange">
<h1>Call Server When Select Option Changes</h1>








<section data-type="sect2" id="problem-xqsZFnTW">
<h2>Problem</h2>

<p>When an HTML select option is selected, you want to trigger a function on the server.<a data-type="indexterm" data-primary="functions" data-secondary="triggering with HTML select option" id="id-LnC7SGFQFkT2"></a><a data-type="indexterm" data-primary="server-side code" data-secondary="triggering with HTML select option" id="id-AnCDFZFvFjTG"></a><a data-type="indexterm" data-primary="HTML" data-secondary="select options" id="id-W7CQILFYFQT8"></a></p>
</section>













<section data-type="sect2" id="solution-PaskIZTz">
<h2>Solution</h2>

<p>Register a <code>String =&gt; JsCmd</code> function with <code>SHtml.ajaxSelect</code>.<a data-type="indexterm" data-primary="SHtml." data-secondary="ajaxSelect" id="id-e4CxIJFqIxTe"></a><a data-type="indexterm" data-primary="ajaxSelect" id="id-GnCPtgFkIgTg"></a><a data-type="indexterm" data-primary="JavaScript" data-secondary="server-side function triggering with" id="id-DnCGhWFgIATA"></a></p>

<p>In this example, we will look up the distance from Earth to the planet a user selects.  This lookup will
happen on the server and update the browser with the result. The <span class="keep-together">interface is:</span></p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"HtmlSelectSnippet"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;div&gt;</code>
    <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"dropdown"</code><code class="nt">&gt;</code>Planet:<code class="nt">&lt;/label&gt;</code>
    <code class="nt">&lt;select</code> <code class="na">id=</code><code class="s">"dropdown"</code><code class="nt">&gt;&lt;/select&gt;</code>
  <code class="nt">&lt;/div&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"distance"</code><code class="nt">&gt;</code>Distance will appear here<code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>The snippet code binds the <code>&lt;select&gt;</code> element to send the selected value to the server:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.common.Empty</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.ajaxSelect</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmd</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.SetHtml</code>
<code class="k">import</code> <code class="nn">xml.Text</code>

<code class="k">class</code> <code class="nc">HtmlSelectSnippet</code> <code class="o">{</code>

  <code class="c1">// Our "database" maps planet names to distances:</code>
  <code class="k">type</code> <code class="kt">Planet</code> <code class="o">=</code> <code class="nc">String</code>
  <code class="k">type</code> <code class="kt">LightYears</code> <code class="o">=</code> <code class="nc">Double</code>

  <code class="k">val</code> <code class="n">database</code> <code class="k">=</code> <code class="nc">Map</code><code class="o">[</code><code class="kt">Planet</code>,<code class="kt">LightYears</code><code class="o">](</code>
    <code class="s">"Alpha Centauri Bb"</code> <code class="o">-&gt;</code> <code class="mf">4.23</code><code class="o">,</code>
    <code class="s">"Tau Ceti e"</code> <code class="o">-&gt;</code> <code class="mf">11.90</code><code class="o">,</code>
    <code class="s">"Tau Ceti f"</code> <code class="o">-&gt;</code> <code class="mf">11.90</code><code class="o">,</code>
    <code class="s">"Gliese 876 d"</code> <code class="o">-&gt;</code> <code class="mf">15.00</code><code class="o">,</code>
    <code class="s">"82 G Eridani b"</code> <code class="o">-&gt;</code> <code class="mf">19.71</code>
  <code class="o">)</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="c1">// To show the user a blank label and blank value option:</code>
    <code class="k">val</code> <code class="n">blankOption</code> <code class="k">=</code> <code class="o">(</code><code class="s">""</code> <code class="o">-&gt;</code> <code class="s">""</code><code class="o">)</code>

    <code class="c1">// The complete list of options includes everything in our database:</code>
    <code class="k">val</code> <code class="n">options</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">String</code>,<code class="kt">String</code><code class="o">)]</code> <code class="k">=</code>
      <code class="n">blankOption</code> <code class="o">::</code>
      <code class="n">database</code><code class="o">.</code><code class="n">keys</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">p</code> <code class="k">=&gt;</code> <code class="o">(</code><code class="n">p</code><code class="o">,</code><code class="n">p</code><code class="o">)).</code><code class="n">toList</code>

    <code class="c1">// Nothing is selected by default:</code>
    <code class="k">val</code> <code class="n">default</code> <code class="k">=</code> <code class="nc">Empty</code>

    <code class="c1">// The function to call when an option is picked:</code>
    <code class="k">def</code> <code class="n">handler</code><code class="o">(</code><code class="n">selected</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">:</code> <code class="kt">JsCmd</code> <code class="o">=</code> <code class="o">{</code>
      <code class="nc">SetHtml</code><code class="o">(</code><code class="s">"distance"</code><code class="o">,</code> <code class="nc">Text</code><code class="o">(</code><code class="n">database</code><code class="o">(</code><code class="n">selected</code><code class="o">)</code> <code class="o">+</code> <code class="s">" light years"</code><code class="o">))</code>
    <code class="o">}</code>

    <code class="c1">// Bind the &lt;select&gt; tag:</code>
    <code class="s">"select"</code> <code class="o">#&gt;</code> <code class="n">ajaxSelect</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">default</code><code class="o">,</code> <code class="n">handler</code><code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>The last line of the code is doing the work for us.  It is generating the options and binding
the selection to a function called <code>handler</code>.  The <code>handler</code> function is called with the value
of the selected item.</p>

<p>We’re using the same <code>String</code> (the planet name) for the option label and value, but they could be
different.</p>
</section>













<section data-type="sect2" id="discussion-OKsVtrTo">
<h2>Discussion</h2>

<p>To understand what’s going on here, take a look at the HTML that Lift produces:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;select</code> <code class="na">id=</code><code class="s">"dropdown"</code>
  <code class="na">onchange=</code><code class="s">"liftAjax.lift_ajaxHandler('F470183993611Y15ZJU=' +</code>
<code class="s">    this.options[this.selectedIndex].value, null, null, null)"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">""</code><code class="nt">&gt;&lt;/option&gt;</code>
  <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"Tau Ceti e"</code><code class="nt">&gt;</code>Tau Ceti e<code class="nt">&lt;/option&gt;</code>
  ...
<code class="nt">&lt;/select&gt;</code></pre>

<p>The <code>handler</code> function has been stored by Lift under the identifier of <code>F470183993611Y15ZJU</code> (in this particular rendering). An <code>onchange</code> event handler is attached to the <code>&lt;select&gt;</code> element and is responsible for transporting the selected value to the server, and bringing a value back. The <code>lift_ajaxHandler</code> JavaScript function is defined in <em>liftAjax.js</em>, which is automatically added to your page.</p>










<section data-type="sect3" id="collecting-the-value-on-form-submission-pWsJhWtKTB">
<h3>Collecting the value on form submission</h3>

<p>If you need to additionally capture the selected value on a regular form submission, you can make use of <code>SHtml.onEvents</code>.  This attaches event listeners to a <code>NodeSeq</code>, triggering a server-side function when the event occurs.  We can use this with a regular form with a regular select box, but wire in Ajax calls to the server when the select changes.<a data-type="indexterm" data-primary="forms processing" data-secondary="collecting values from" id="id-JnCmIlFkhKtwTn"></a><a data-type="indexterm" data-primary="SHtml." data-secondary="onEvent" id="id-9nCDtvFKhptlTq"></a><a data-type="indexterm" data-primary="onEvent" id="id-ZbCBhMFahrtXTK"></a><a data-type="indexterm" data-primary="values" data-secondary="collecting upon form submission" id="id-zdCLTGFJhxtMTn"></a><a data-type="indexterm" data-primary="S." data-secondary="notice" id="id-yYClcpFnh4tXT1"></a></p>

<p>To make use of this, our snippet changes very little:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">var</code> <code class="n">selectedValue</code> <code class="k">:</code> <code class="kt">String</code> <code class="o">=</code> <code class="s">""</code>

<code class="s">"select"</code> <code class="o">#&gt;</code> <code class="n">onEvents</code><code class="o">(</code><code class="s">"onchange"</code><code class="o">)(</code><code class="n">handler</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">select</code><code class="o">(</code><code class="n">options</code><code class="o">,</code> <code class="n">default</code><code class="o">,</code> <code class="n">selectedValue</code> <code class="k">=</code> <code class="k">_</code><code class="o">)</code>
<code class="o">}</code> <code class="o">&amp;</code>
<code class="s">"type=submit"</code> <code class="o">#&gt;</code> <code class="n">onSubmitUnit</code><code class="o">(</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="n">S</code><code class="o">.</code><code class="n">notice</code><code class="o">(</code><code class="s">"Destination "</code><code class="o">+</code><code class="n">selectedValue</code><code class="o">))</code></pre>

<p>We are arranging for the same <code>handler</code> function to be called when an <code>onchange</code> event is triggered.  This event binding is applied to a regular <code>SHtml.select</code>, which is storing the <code>selectedValue</code> when the form is submitted. We also bind a submit button to a function that generates a notice of which planet was selected.</p>

<p>The corresponding HTML also changes little.  We need to add a button and make sure the snippet is marked as a form with <code>?form</code>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"HtmlSelectFormSnippet?form=post"</code><code class="nt">&gt;</code>

  <code class="nt">&lt;div&gt;</code>
    <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"dropdown"</code><code class="nt">&gt;</code>Planet:<code class="nt">&lt;/label&gt;</code>
    <code class="nt">&lt;select</code> <code class="na">id=</code><code class="s">"dropdown"</code><code class="nt">&gt;&lt;/select&gt;</code>
  <code class="nt">&lt;/div&gt;</code>

  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"distance"</code><code class="nt">&gt;</code>Distance will appear here<code class="nt">&lt;/div&gt;</code>

  <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Book Ticket"</code><code class="nt">/&gt;</code>

<code class="nt">&lt;/div&gt;</code></pre>

<p>Now when you change a selected value, you see the dynamically updated distance calculation, but pressing the "Book Ticket" button also delivers the value to the server.</p>
</section>



</section>













<section data-type="sect2" id="see-also-XQsXhBTe">
<h2>See Also</h2>

<p><a data-type="xref" href="#MultiSelectBox">Use a Select Box with Multiple Options</a> describes how to use classes rather than <code>String</code> values for select boxes.</p>
</section>





</section>













<section data-type="sect1" id="ClientSideOnlyActions">
<h1>Creating Client-Side Actions in Your Scala Code</h1>








<section data-type="sect2" id="problem-PasxFLcz">
<h2>Problem</h2>

<p>In your Lift code you want to set up an action that is run purely in
client-side JavaScript.<a data-type="indexterm" data-primary="JavaScript" data-secondary="client-side function triggering with" id="id-AnCPSZFvFVcG"></a><a data-type="indexterm" data-primary="functions" data-secondary="server-side code and" id="id-W7CoFLFYFJc8"></a><a data-type="indexterm" data-primary="Scala" data-secondary="client-side actions and" id="id-e4CxIJFZFmce"></a><a data-type="indexterm" data-primary="submit buttons" data-seealso="radio buttons" id="id-GnCPtgFbFEcg"></a></p>
</section>













<section data-type="sect2" id="solution-OKsOIbco">
<h2>Solution</h2>

<p>Bind your JavaScript directly to the event handler you want to run.</p>

<p>Here’s an example where we make a button slowly fade away when you press it, but notice
that we’re setting up this binding in our server-side Lift code:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="k">object</code> <code class="nc">ClientSide</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"button [onclick]"</code> <code class="o">#&gt;</code> <code class="s">"$(this).fadeOut()"</code>
<code class="o">}</code></pre>

<p>In the template, we’d perhaps say:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"ClientSide"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;button&gt;</code>Click Me<code class="nt">&lt;/button&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>Lift will render the page as:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;button</code> <code class="na">onclick=</code><code class="s">"$(this).fadeOut()"</code><code class="nt">&gt;</code>Click Me<code class="nt">&lt;/button&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-XQsbtpce">
<h2>Discussion</h2>

<p>Lift includes a JavaScript abstraction that you can use to build up
more elaborate expressions for the client-side. For example, you can
combine basic commands:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.</code><code class="o">{</code><code class="nc">Alert</code><code class="o">,</code> <code class="nc">RedirectTo</code><code class="o">}</code>

<code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"button [onclick]"</code> <code class="o">#&gt;</code>
  <code class="o">(</code><code class="nc">Alert</code><code class="o">(</code><code class="s">"Here we go..."</code><code class="o">)</code> <code class="o">&amp;</code> <code class="nc">RedirectTo</code><code class="o">(</code><code class="s">"http://liftweb.net"</code><code class="o">))</code></pre>

<p>This pops up an alert dialog<a data-type="indexterm" data-primary="alert dialog boxes" id="id-DnC1SmtvtQcA"></a><a data-type="indexterm" data-primary="dialog boxes" id="id-kVCEFntDtqc8"></a> and then sends you to <em><a href="http://liftweb.net"><em class="hyperlink">http://liftweb.net</em></a></em>. The HTML would be rendered as:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;button</code> <code class="na">onclick=</code><code class="s">"alert(&amp;quot;Here we go...&amp;quot;);</code>
<code class="s">window.location = &amp;quot;http://liftweb.net&amp;quot;;"</code><code class="nt">&gt;</code>Click Me<code class="nt">&lt;/button&gt;</code></pre>

<p>Another option is to use <code>JE.Call</code> to execute a JavaScript function with
parameters. Suppose we have this function defined:</p>

<pre data-type="programlisting" data-code-language="javascript" data-highlighted="true"><code class="kd">function</code> <code class="nx">greet</code><code class="p">(</code><code class="nx">who</code><code class="p">,</code> <code class="nx">times</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">for</code><code class="p">(</code><code class="nx">i</code><code class="o">=</code><code class="mi">0</code><code class="p">;</code> <code class="nx">i</code><code class="o">&lt;</code><code class="nx">times</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code>
    <code class="nx">alert</code><code class="p">(</code><code class="s2">"Hello "</code><code class="o">+</code><code class="nx">who</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>We could bind a client-side button press to this client-side function
like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.js.JE</code>

<code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
  <code class="s">"button [onclick]"</code> <code class="o">#&gt;</code> <code class="nc">JE</code><code class="o">.</code><code class="nc">Call</code><code class="o">(</code><code class="s">"greet"</code><code class="o">,</code> <code class="s">"World!"</code><code class="o">,</code> <code class="mi">3</code><code class="o">)</code></pre>

<p>On the client-side, we’d see:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;button</code> <code class="na">onclick=</code><code class="s">"greet(&amp;quot;World!&amp;quot;,3)"</code><code class="nt">&gt;</code>Click Me For Greeting<code class="nt">&lt;/button&gt;</code></pre>

<p>Note that the types <code>String</code> and <code>Int</code> have been preserved in the JavaScript syntax of the call. This has happened because <code>JE.Call</code> takes a variable number of <code>JsExp</code> arguments after the JavaScript function name. There are wrappers for JavaScript primitive types (<code>JE.Str</code>, <code>JE.Num</code>, <code>JsTrue</code>, <code>JsFalse</code>) and implicit conversions to save you having to wrap the Scala values yourself.</p>
</section>













<section data-type="sect2" id="see-also-jWskhlcj">
<h2>See Also</h2>

<p><a href="http://exploring.liftweb.net/">Chapter 10 of <em>Exploring Lift</em></a> gives a list of <code>JsCmds</code> and <code>JE</code> expressions.</p>
</section>





</section>













<section data-type="sect1" id="FocusOnLoad">
<h1>Focus on a Field on Page Load</h1>








<section data-type="sect2" id="problem-OKsLFyio">
<h2>Problem</h2>

<p>When a page loads, you want the browser to select a particular field for
input from the keyboard.<a data-type="indexterm" data-primary="JavaScript" data-secondary="field focus with" id="id-W7CESLFYFKi8"></a><a data-type="indexterm" data-primary="FocusOnLoad command" id="id-e4CAFJFZFrie"></a><a data-type="indexterm" data-primary="browsers" data-secondary="field focus in" id="id-GnC7IgFbFeig"></a><a data-type="indexterm" data-primary="field focus" id="id-DnCqtWFwFziA"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKIGie">
<h2>Solution</h2>

<p>Wrap the input with a <code>FocusOnLoad</code> command:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.FocusOnLoad</code>

<code class="k">class</code> <code class="nc">Focus</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"name=username"</code> <code class="o">#&gt;</code> <code class="nc">FocusOnLoad</code><code class="o">(&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code><code class="o">/&gt;)</code>
<code class="o">}</code></pre>

<p>The CSS transform in <code>render</code> will match against a <code>name="username"</code> element in the HTML and
replace it with a text input field that will be focused on automatically
when the page loads.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="CSS selector transforms" id="id-4nCkIqtMI7ib"></a></p>

<p>Although we’re focusing on inline HTML, this could be any <code>NodeSeq</code>, such as the one produced by <code>SHtml.text</code>.</p>
</section>













<section data-type="sect2" id="discussion-jWsvtvij">
<h2>Discussion</h2>

<p><code>FocusOnLoad</code> is an example of a <code>NodeSeq =&gt; NodeSeq</code> transformation. It appends to the <code>NodeSeq</code> with the
JavaScript required to set focus on that field.</p>

<p>The JavaScript that performs the focus simply looks up the node in the DOM by ID and calls <code>focus</code> on it. Although the previous example code doesn’t specify an ID, the command <code>FocusOn</code> is smart enough to add one automatically for us.</p>

<p>There are two related <code>JsCmd</code> choices:</p>
<dl>
<dt><code>Focus</code></dt>
<dd>
<p>Takes an element ID and sets focus on the element</p>
</dd>
<dt><code>SetValueAndFocus</code></dt>
<dd>
<p>Similar to <code>Focus</code>, but takes an additional
<code>String</code> value to populate the element with</p>
</dd>
</dl>

<p>These two are useful if you need to set focus from Ajax or Comet
components <span class="keep-together">dynamically.</span></p>
</section>













<section data-type="sect2" id="see-also-2ksZhaiN">
<h2>See Also</h2>

<p><a href="http://bit.ly/198KMMS">The source for <code>FocusOnLoad</code></a> is worth checking out to understand how it and related commands are constructed.  This may help you package your own JavaScript functionality up into commands that can be used in CSS binding <span class="keep-together">expressions.</span></p>

<p id="CSSClassOnAjaxForm">Add a CSS Class to an Ajax Form
<sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub>~~</p>
</section>













<section data-type="sect2" id="problem-pWsBT2i0">
<h2>Problem</h2>

<p>You want to set the CSS class of an Ajax form.<a data-type="indexterm" data-primary="Ajax" data-secondary="setting CSS class" id="id-kVCkSpFnT7i8"></a><a data-type="indexterm" data-primary="CSS classes, setting on Ajax forms" id="id-4nC2FYFGT7ib"></a><a data-type="indexterm" data-primary="query parameters" id="id-JnCmIlF2TAij"></a></p>
</section>













<section data-type="sect2" id="solution-o8svcGib">
<h2>Solution</h2>

<p>Name the class via <code>?class=</code> query parameter:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">data-lift=</code><code class="s">"form.ajax?class=boxed"</code><code class="nt">&gt;</code>
...
<code class="nt">&lt;/form&gt;</code></pre>
</section>













<section data-type="sect2" id="discussion-g0sEipio">
<h2>Discussion</h2>

<p>If you need to set multiple CSS classes, encode a space between the
class names (e.g., <code>class=boxed+primary</code>).</p>

<p>The <code>form.ajax</code> construction is a regular snippet call: the <code>Form</code> snippet is one of the handful of built-in snippets, and in this case, we’re calling the <code>ajax</code> method on that object.  However, normally snippet calls do not copy attributes into the resulting markup, but this snippet is implemented to do exactly that.</p>
</section>













<section data-type="sect2" id="see-also-q8sJuQib">
<h2>See Also</h2>

<p>For an example of accessing these query parameters in your own snippets, see <a data-type="xref" href="#ConditionalIncludes">HTML Conditional Comments</a>.</p>

<p><a href="http://simply.liftweb.net/"><em>Simply Lift</em>, Chapter 4</a>, introduces Ajax forms.</p>
</section>





</section>













<section data-type="sect1" id="DynamicTemplateLoading">
<h1>Running a Template via JavaScript</h1>








<section data-type="sect2" id="problem-XQspFlue">
<h2>Problem</h2>

<p>You want to load an entire page—a template with snippets—inside of the current page (i.e., without a browser refresh).<a data-type="indexterm" data-primary="templates" data-secondary="loading without browser refresh" id="id-e4CzSJFZFgue"></a><a data-type="indexterm" data-primary="browsers" data-secondary="loading pages without refresh" id="id-GnCZFgFbFQug"></a><a data-type="indexterm" data-primary="JavaScript" data-secondary="running a template with" id="id-DnCXIWFwFauA"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjIjuj">
<h2>Solution</h2>

<p>Use <code>Template</code> to load the template and <code>SetHtml</code> to place the content
on the page.<a data-type="indexterm" data-primary="SetHtml" id="id-kVCAIpFpIXu8"></a></p>

<p>Let’s populate a <code>&lt;div&gt;</code> with the site home page when a button is pressed:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"TemplateLoad"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"inject"</code><code class="nt">&gt;</code>Content will appear here<code class="nt">&lt;/div&gt;</code>
  <code class="nt">&lt;button&gt;</code>Load Template<code class="nt">&lt;/button&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>The corresponding snippet would be:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="nc">SHtml</code><code class="o">,</code> <code class="nc">Templates</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.</code><code class="o">{</code><code class="nc">SetHtml</code><code class="o">,</code> <code class="nc">Noop</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmd</code>

<code class="k">object</code> <code class="nc">TemplateLoad</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">content</code> <code class="k">:</code> <code class="kt">JsCmd</code> <code class="o">=</code>
    <code class="nc">Templates</code><code class="o">(</code><code class="s">"index"</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="n">ns</code> <code class="k">=&gt;</code> <code class="nc">SetHtml</code><code class="o">(</code><code class="s">"inject"</code><code class="o">,</code> <code class="n">ns</code><code class="o">))</code> <code class="n">openOr</code> <code class="nc">Noop</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"button [onclick]"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">ajaxInvoke</code><code class="o">(</code><code class="n">content</code> <code class="k">_</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>Clicking the button will cause the content of <em>/index.html</em> to be
loaded into the <code>inject</code> element.</p>
</section>













<section data-type="sect2" id="discussion-2ksLtEuN">
<h2>Discussion</h2>

<p><code>Templates</code> produces a <code>Box[NodeSeq]</code>.  In the previous example, we map this content into a <code>JsCmd</code> that will populate the <code>inject</code> <code>&lt;div&gt;</code>.</p>

<p>If you write unit tests to access templates, be aware that you may need to modify your development or testing environment to include the <em>webapps</em> folder.  To do this for SBT, add the following to <em>build.sbt</em>:<a data-type="indexterm" data-primary="build.sbt, contents" id="id-JnCmIjIDtyuj"></a></p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">unmanagedResourceDirectories</code> <code class="n">in</code> <code class="nc">Test</code> <code class="o">&lt;+=</code> <code class="o">(</code><code class="n">baseDirectory</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">_</code> <code class="o">/</code> <code class="s">"src/main/webapp"</code>
<code class="o">}</code></pre>

<p>For this to work in your IDE, you’ll need to add <em>webapp</em> as a source folder to locate templates.</p>
</section>













<section data-type="sect2" id="see-also-pWsJhvu0">
<h2>See Also</h2>

<p><a data-type="xref" href="#ButtonTriggerServerCode">Trigger Server-Side Code from a Button</a> describes <code>ajaxInvoke</code> and related methods.</p>
</section>





</section>













<section data-type="sect1" id="JavaScriptTail">
<h1>Move JavaScript to End of Page</h1>








<section data-type="sect2" id="problem-jWslFzUj">
<h2>Problem</h2>

<p>You want the JavaScript created in your snippet to be included at the end of the HTML page.<a data-type="indexterm" data-primary="JavaScript" data-secondary="moving to page end" id="id-GnCJSgFbFyUg"></a><a data-type="indexterm" data-primary="S." data-secondary="appendJs" id="id-DnCaFWFwFwUA"></a><a data-type="indexterm" data-primary="HTML" data-secondary="moving JavaScript to end of pages" id="id-kVCAIpFLFrU8"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIGUN">
<h2>Solution</h2>

<p>Use <code>S.appendJs</code>, which places your JavaScript just before the closing <code>&lt;/body&gt;</code> tag, along with other JavaScript produced by Lift.<a data-type="indexterm" data-primary="S." data-secondary="appendJs" id="id-4nCkIYFMImUb"></a></p>

<p>In this HTML, we have placed a <code>&lt;script&gt;</code> tag in the middle of the page and marked it with a snippet called <code>JavaScriptTail</code>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">content=</code><code class="s">"text/html; charset=UTF-8"</code> <code class="na">http-equiv=</code><code class="s">"content-type"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;title&gt;</code>JavaScript in Tail<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;h2&gt;</code>JavaScript in the tail of the page<code class="nt">&lt;/h2&gt;</code>

  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code> <code class="na">data-lift=</code><code class="s">"JavaScriptTail"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/script&gt;</code>

  <code class="nt">&lt;p&gt;</code>
    The JavaScript about to be run will have been moved
    to the end of this page, just before the closing
    body tag.
  <code class="nt">&lt;/p&gt;</code>
<code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>The <code>&lt;script&gt;</code> content will be generated by a snippet.
It doesn’t need to be a <code>&lt;script&gt;</code> tag; the snippet just replaces the content with nothing, but
hanging the snippet on the <code>&lt;script&gt;</code> tag is a reminder of the purpose of the snippet:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.Alert</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.S</code>
<code class="k">import</code> <code class="nn">xml.NodeSeq</code>

<code class="k">class</code> <code class="nc">JavaScriptTail</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>
    <code class="n">S</code><code class="o">.</code><code class="n">appendJs</code><code class="o">(</code><code class="nc">Alert</code><code class="o">(</code><code class="s">"Hi"</code><code class="o">))</code>
    <code class="s">"*"</code> <code class="o">#&gt;</code> <code class="nc">NodeSeq</code><code class="o">.</code><code class="nc">Empty</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Although the snippet is rendering nothing, it calls <code>S.appendJs</code> with a <code>JsCmd</code>.  This will produce the following in the page just before the end of the body:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>
<code class="c1">// &lt;![CDATA[</code>
<code class="nx">jQuery</code><code class="p">(</code><code class="nb">document</code><code class="p">).</code><code class="nx">ready</code><code class="p">(</code><code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
  <code class="nx">alert</code><code class="p">(</code><code class="s2">"Hi"</code><code class="p">);</code>
<code class="p">});</code>
<code class="c1">// ]]&gt;</code>
<code class="nt">&lt;/script&gt;</code></pre>

<p>Observe that the snippet was in the middle of the template, but the JavaScript appears at the end of the rendered page.</p>
</section>













<section data-type="sect2" id="discussion-pWswtoU0">
<h2>Discussion</h2>

<p>There are three other ways you could tackle this problem.  The first is to move your JavaScript to an external file, and simply include it on the page where you want it.  For substantial JavaScript code, this might make sense.</p>

<p>The second is a variation on <code>S.appendJs</code>: <code>S.appendGlobalJs</code> works in the same way but does not include the jQuery <code>ready</code> around your JavaScript.  This means you have no guarantee the DOM has loaded when your function is called.</p>

<p>A third option is wrap your JavaScript in a <code>&lt;lift:tail&gt;</code> snippet:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">JavascriptTail</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="s">"*"</code> <code class="o">#&gt;</code> <code class="o">&lt;</code><code class="n">lift</code><code class="k">:</code><code class="kt">tail&gt;</code><code class="o">{</code><code class="kt">Script</code><code class="o">(</code><code class="kt">OnLoad</code><code class="o">(</code><code class="kt">Alert</code><code class="o">(</code><code class="err">"</code><code class="kt">Hi</code><code class="err">"</code><code class="o">)))}</code><code class="kt">&lt;/lift:tail&gt;</code>
<code class="o">}</code></pre>

<p>Note that <code>lift:tail</code> is a general purpose Lift snippet and can be used to move various kinds of content to the end of the page, not just JavaScript.</p>
</section>













<section data-type="sect2" id="see-also-o8sNhNUb">
<h2>See Also</h2>

<p><a data-type="xref" href="#AddToHead">Adding to the Head of a Page</a> discusses a related Lift snippet for moving content to the head of the page.</p>

<p><a data-type="xref" href="#SnippetNotFound">Snippet Not Found When Using HTML5</a> describes the different ways of invoking a snippet, such as <code>&lt;lift:tail&gt;</code> versus <code>data-lift="tail"</code>.</p>
</section>





</section>













<section data-type="sect1" id="CometSessionLossJS">
<h1>Run JavaScript on Comet Session Loss</h1>








<section data-type="sect2" id="problem-2kslFzCN">
<h2>Problem</h2>

<p>You’re using a Comet actor and you want to arrange for some JavaScript to be executed in the event of the session being lost.<a data-type="indexterm" data-primary="Comet" data-secondary="executing JavaScript with" id="id-DnC1SWFwFnCA"></a><a data-type="indexterm" data-primary="JavaScript" data-secondary="executing with Comet actor" id="id-kVCEFpFLFPC8"></a><a data-type="indexterm" data-primary="browsers" data-secondary="handling session loss" id="id-4nCkIYFVFlCb"></a><a data-type="indexterm" data-primary="session loss" id="id-JnCvtlFNF2Cj"></a><a data-type="indexterm" data-primary="chat sessions" id="id-9nCxhvFpF0C8"></a><a data-type="indexterm" data-primary="LiftRules" data-secondary=".noCometSessionCmd" id="id-ZbC9TMFXFZCb"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIpC0">
<h2>Solution</h2>

<p>Configure your JavaScript via <code>LiftRules.noCometSessionCmd</code>.</p>

<p>As an example, we can modify the standard Lift chat demo to save the message being typed in the event of the session loss.  In the style of the demo, we would have an Ajax form for entering a message and the Comet chat area for displaying messages received:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;form</code> <code class="na">data-lift=</code><code class="s">"form.ajax"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">data-lift=</code><code class="s">"ChatSnippet"</code> <code class="na">id=</code><code class="s">"message"</code>
    <code class="na">placeholder=</code><code class="s">"Type a message"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code>

<code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"comet?type=ChatClient"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;ul&gt;</code>
    <code class="nt">&lt;li&gt;</code>A message<code class="nt">&lt;/li&gt;</code>
  <code class="nt">&lt;/ul&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>To this we can add a function, <code>stash</code>, which we want to be called in the event of a Comet session being lost:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>
<code class="c1">// &lt;![CDATA[</code>
<code class="kd">function</code> <code class="nx">stash</code><code class="p">()</code> <code class="p">{</code>
  <code class="nx">saveCookie</code><code class="p">(</code><code class="s2">"stashed"</code><code class="p">,</code> <code class="nx">$</code><code class="p">(</code><code class="s1">'#message'</code><code class="p">).</code><code class="nx">val</code><code class="p">());</code>
  <code class="nx">location</code><code class="p">.</code><code class="nx">reload</code><code class="p">();</code>
<code class="p">}</code>

<code class="nx">jQuery</code><code class="p">(</code><code class="nb">document</code><code class="p">).</code><code class="nx">ready</code><code class="p">(</code><code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">stashedValue</code> <code class="o">=</code> <code class="nx">readCookie</code><code class="p">(</code><code class="s2">"stashed"</code><code class="p">)</code> <code class="o">||</code> <code class="s2">""</code><code class="p">;</code>
  <code class="nx">$</code><code class="p">(</code><code class="s1">'#message'</code><code class="p">).</code><code class="nx">val</code><code class="p">(</code><code class="nx">stashedValue</code><code class="p">);</code>
  <code class="nx">deleteCookie</code><code class="p">(</code><code class="s2">"stashed"</code><code class="p">);</code>
<code class="p">});</code>

<code class="c1">// Definition of saveCookie, readCookie, deleteCookie omitted.</code>

<code class="nt">&lt;/script&gt;</code></pre>

<p>Our <code>stash</code> function will save the current value of the input field in a cookie called <code>stashed</code>.  We arrange, on page load, to check for that cookie and insert the value into our message field.<a data-type="indexterm" data-primary="cookies" id="id-VMCQIlc9IZCw"></a><a data-type="indexterm" data-primary="stash function" id="id-rjCwtqcQIECa"></a></p>

<p>The final part is to modify <em>Boot.scala</em> to register our <code>stash</code> function:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds.Run</code>

<code class="nc">LiftRules</code><code class="o">.</code><code class="n">noCometSessionCmd</code><code class="o">.</code><code class="n">default</code><code class="o">.</code><code class="n">set</code><code class="o">(</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="nc">Run</code><code class="o">(</code><code class="s">"stash()"</code><code class="o">)</code> <code class="o">)</code></pre>

<p>In this way, if a session is lost while composing a chat message, the browser will stash the message, and when the page reloads the message will be recovered.</p>

<p>To test the example, type a message into the message field, then restart your Lift application.  Wait 10 seconds, and you’ll see the effect.</p>
</section>













<section data-type="sect2" id="discussion-o8sytyCb">
<h2>Discussion</h2>

<p>Without changing <code>noCometSessionCmd</code>, the default behaviour of Lift is to arrange for the browser to load the home page, which is controlled by the <code>LiftRules.noCometSessionPage</code> setting. This is carried out via the JavaScript function <code>lift_sessionLost</code> in the file <em>cometAjax.js</em>.</p>

<p>By providing our own <code>() =&gt; JsCmd</code> function to <code>LiftRules.noCometSessionCmd</code>, Lift arranges to call this function and deliver the <code>JsCmd</code>  to the browser, rather than <code>lift_sessionLost</code>.  If you watch the HTTP traffic between your browser and Lift, you’ll see the <code>stash</code> function call being returned in response to a Comet request.<a data-type="indexterm" data-primary="dependency injection" id="id-VMCvToIktZCw"></a><a data-type="indexterm" data-primary="LiftRules" data-secondary=".noCometSessionCmd" id="id-rjCNcgIxtECa"></a></p>
<aside data-type="sidebar" id="factory-lkS8tztkC7">
<h5>Factory</h5>
<p>The <code>noCometSessionCmd.default.set</code> call is making use of Lift’s <a href="http://bit.ly/16nYJVY">dependency injection</a>. Specifically, it’s setting up the supply side of the dependency. Although we’re setting a default here, it’s possible in Lift to supply different behaviours with different scopes: request or session.</p>
</aside>

<p>This recipe has focused on the handling of loss of session for Comet; for Ajax, there’s a corresponding <code>LiftRules.noAjaxSessionCmd</code> setting.</p>
</section>













<section data-type="sect2" id="see-also-g0sxhxCo">
<h2>See Also</h2>

<p>You’ll find the <em>The ubiquitous Chat app</em> in <a href="http://simply.liftweb.net/"><em>Simply Lift</em></a>.</p>

<p>Being able to debug HTTP traffic is a useful way to understand how your Comet or Ajax application is performing.  There are many plugins and products to help with this, such as the <a href="http://mzl.la/14BkhyC"><em>HttpFox</em> plugin for Firefox</a>.</p>
</section>





</section>













<section data-type="sect1" id="AjaxFileUpload">
<h1>Ajax File Upload</h1>








<section data-type="sect2" id="problem-pWsqFDs0">
<h2>Problem</h2>

<p>You want to offer your users an Ajax file upload tool, with progress bars and drag-and-drop support.<a data-type="indexterm" data-primary="Ajax" data-secondary="file upload tool" id="id-kVCkSpFLF2s8"></a><a data-type="indexterm" data-primary="files" data-secondary="uploading" id="id-4nC2FYFVF2sb"></a><a data-type="indexterm" data-primary="progress bars" id="id-JnCmIlFNF4sj"></a><a data-type="indexterm" data-primary="drag-and-drop support" id="id-9nCDtvFpFzs8"></a><a data-type="indexterm" data-primary="Tschan, Sebastian" id="id-ZbCBhMFXFJsb"></a><a data-type="indexterm" data-primary="jQuery File Upload widget" id="id-zdCLTGFWFdsJ"></a><a data-type="indexterm" data-primary="REST web services" data-secondary="file uploads" id="id-yYClcpF9FWsW"></a></p>
</section>













<section data-type="sect2" id="solution-o8seI2sb">
<h2>Solution</h2>

<p>Add Sebastian Tschan’s <a href="http://bit.ly/1ac2yAj"><em>jQuery File Upload</em> widget</a> to your project, and implement a REST end point to receive files.</p>

<p>The first step is to download the widget and drag the <em>js</em> folder into your application as <em>src/main/webapp/js</em>.  We can then use the JavaScript in a template:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="cp">&lt;!DOCTYPE HTML&gt;</code>
<code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;title&gt;</code>jQuery File Upload Example<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>

<code class="nt">&lt;h1&gt;</code>Drag files onto this page<code class="nt">&lt;/h1&gt;</code>

<code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"fileupload"</code> <code class="na">type=</code><code class="s">"file"</code> <code class="na">name=</code><code class="s">"files[]"</code> <code class="na">data-url=</code><code class="s">"/upload"</code> <code class="na">multiple</code><code class="nt">&gt;</code>

<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"progress"</code> <code class="na">style=</code><code class="s">"width:20em; border: 1pt solid silver; display: none"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"progress-bar"</code> <code class="na">style=</code><code class="s">"background: green; height: 1em; width:0%"</code><code class="nt">&gt;&lt;/div&gt;</code>
<code class="nt">&lt;/div&gt;</code>

<code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/script&gt;</code>
<code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"js/vendor/jquery.ui.widget.js"</code><code class="nt">&gt;&lt;/script&gt;</code>
<code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"js/jquery.iframe-transport.js"</code><code class="nt">&gt;&lt;/script&gt;</code>
<code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"js/jquery.fileupload.js"</code><code class="nt">&gt;&lt;/script&gt;</code>

<code class="nt">&lt;script&gt;</code>
  <code class="nx">$</code><code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">$</code><code class="p">(</code><code class="s1">'#fileupload'</code><code class="p">).</code><code class="nx">fileupload</code><code class="p">({</code>
      <code class="nx">dataType</code><code class="o">:</code> <code class="s1">'json'</code><code class="p">,</code>
      <code class="nx">add</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">e</code><code class="p">,</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">$</code><code class="p">(</code><code class="s1">'#progress-bar'</code><code class="p">).</code><code class="nx">css</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code> <code class="s1">'0%'</code><code class="p">);</code>
        <code class="nx">$</code><code class="p">(</code><code class="s1">'#progress'</code><code class="p">).</code><code class="nx">show</code><code class="p">();</code>
        <code class="nx">data</code><code class="p">.</code><code class="nx">submit</code><code class="p">();</code>
      <code class="p">},</code>
      <code class="nx">progressall</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">e</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
        <code class="kd">var</code> <code class="nx">progress</code> <code class="o">=</code> <code class="nb">parseInt</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">loaded</code> <code class="o">/</code> <code class="nx">data</code><code class="p">.</code><code class="nx">total</code> <code class="o">*</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">10</code><code class="p">)</code> <code class="o">+</code> <code class="s1">'%'</code><code class="p">;</code>
        <code class="nx">$</code><code class="p">(</code><code class="s1">'#progress-bar'</code><code class="p">).</code><code class="nx">css</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code> <code class="nx">progress</code><code class="p">);</code>
      <code class="p">},</code>
      <code class="nx">done</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">e</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">$</code><code class="p">.</code><code class="nx">each</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">files</code><code class="p">,</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">index</code><code class="p">,</code> <code class="nx">file</code><code class="p">)</code> <code class="p">{</code>
          <code class="nx">$</code><code class="p">(</code><code class="s1">'&lt;p/&gt;'</code><code class="p">).</code><code class="nx">text</code><code class="p">(</code><code class="nx">file</code><code class="p">.</code><code class="nx">name</code><code class="p">).</code><code class="nx">appendTo</code><code class="p">(</code><code class="nb">document</code><code class="p">.</code><code class="nx">body</code><code class="p">);</code>
        <code class="p">});</code>
        <code class="nx">$</code><code class="p">(</code><code class="s1">'#progress'</code><code class="p">).</code><code class="nx">fadeOut</code><code class="p">();</code>
      <code class="p">}</code>
    <code class="p">});</code>
  <code class="p">});</code>
<code class="nt">&lt;/script&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>This template provides an input field for files, an area to use as a progress indicator, and configures the widget when the page loads in a jQuery <code>$( ... )</code> block.  This is just regular usage of the JavaScript widget, and nothing particularly Lift-specific.</p>

<p>The final part is to implement a Lift REST service to receive the file or files.  The URL of the service, <em>/upload</em>, is set in <code>data-url</code> on the <code>input</code> field, and that’s the address we match on:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.OkResponse</code>

<code class="k">object</code> <code class="nc">AjaxFileUpload</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="n">serve</code> <code class="o">{</code>

    <code class="k">case</code> <code class="s">"upload"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Post</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="k">for</code> <code class="o">(</code><code class="n">file</code> <code class="k">&lt;-</code> <code class="n">req</code><code class="o">.</code><code class="n">uploadedFiles</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">println</code><code class="o">(</code><code class="s">"Received: "</code><code class="o">+</code><code class="n">file</code><code class="o">.</code><code class="n">fileName</code><code class="o">)</code>
      <code class="o">}</code>
      <code class="nc">OkResponse</code><code class="o">()</code>

  <code class="o">}</code>

<code class="o">}</code></pre>

<p>This implementation simply logs the name of the file received and acknowledges successful delivery with a 200 status code back to the widget.</p>

<p>As with all REST services, it needs to be registered in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">dispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="n">code</code><code class="o">.</code><code class="n">rest</code><code class="o">.</code><code class="nc">AjaxFileUpload</code><code class="o">)</code></pre>

<p>By default, the widget makes the whole HTML page a drop-target for files, meaning you can drag a file onto the page and it will immediately be uploaded to your Lift application.</p>
</section>













<section data-type="sect2" id="discussion-g0s1tmso">
<h2>Discussion</h2>

<p>In this recipe, we’ve shown just the basic integration of the widget with a Lift application. <a href="http://blueimp.github.com/jQuery-File-Upload/">The demo site for the widget</a> shows other capabilities, and provides documentation on how to integrate them.</p>

<p>Many of the features just require JavaScript configuration.  For example, we’ve used the widget’s <code>add</code>, <code>progressall</code>, and <code>done</code> handlers to show, update, and then fade out a progress bar.  When the upload is completed, the name of the uploaded file is appended to the page.</p>

<p>In the REST service, the uploaded files are available via the <code>uploadedFiles</code> method on the request. When Lift receives a multipart form, it automatically extracts files as <span class="keep-together"><code>uploadedFiles</code>,</span> each of which is a <code>FileParamHolder</code> that gives us access to the <code>fileName</code>, <code>length</code>, <code>mimeType</code>, and <code>fileStream</code>.</p>

<p>By default, uploaded files are held in memory, but that can be changed (see <a data-type="xref" href="#UploadToDisk">undefined '3-203'</a> in <a data-type="xref" href="#FileUpload">File Upload</a>).</p>

<p>In this recipe, we return a 200 (<code>OkResponse</code>).  If we wanted to signal to the widget that a file was rejected, we can return another code. For example, perhaps we want to reject all files except PNG images.  On the server-side we can do that by replacing the <code>OkResponse</code> with a test:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="nc">ResponseWithReason</code><code class="o">,</code> <code class="nc">BadResponse</code><code class="o">,</code> <code class="nc">OkResponse</code><code class="o">}</code>

<code class="k">if</code> <code class="o">(</code><code class="n">req</code><code class="o">.</code><code class="n">uploadedFiles</code><code class="o">.</code><code class="n">exists</code><code class="o">(</code> <code class="k">_</code><code class="o">.</code><code class="n">mimeType</code> <code class="o">!=</code> <code class="s">"image/png"</code> <code class="o">))</code>
  <code class="nc">ResponseWithReason</code><code class="o">(</code><code class="nc">BadResponse</code><code class="o">(),</code> <code class="s">"Only PNGs"</code><code class="o">)</code>
<code class="k">else</code>
  <code class="nc">OkResponse</code><code class="o">()</code></pre>

<p>We would mirror this with a <code>fail</code> handler in the client JavaScript:</p>

<pre data-type="programlisting" data-code-language="javascript" data-highlighted="true"><code class="nx">fail</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">e</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">alert</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">errorThrown</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>If we uploaded, say, a JPEG, the browser would show an alert dialog reporting "Only PNGs."</p>
</section>













<section data-type="sect2" id="see-also-q8sZhPsb">
<h2>See Also</h2>

<p>Diego Medina has posted a <a href="http://bit.ly/lift-restupload">Gist of Lift REST code</a> to integrate more fully with the image upload and image reviewing features of the widget, specifically implementing the JSON response that the widget expects for that <span class="keep-together">functionality.</span></p>

<p><a data-type="xref" href="#FileUpload">File Upload</a> describes the basic file upload behaviour of Lift and how to control where files are stored.</p>

<p>Antonio Salazar Cardozo has posted <a href="http://bit.ly/lift-ajaxupload">example code</a> for performing Ajax file upload using Lift’s Ajax mechanisms. This avoids external JavaScript libraries.</p>
</section>





</section>













<section data-type="sect1" id="FormatWiring">
<h1>Format a Wired Cell</h1>








<section data-type="sect2" id="problem-o8skFWHb">
<h2>Problem</h2>

<p>You want a wired UI element to have a different format than plain conversion to a string. For example, you’d like to display a floating-point value as a currency.<a data-type="indexterm" data-primary="wired cells, formatting" id="id-4nCqSYFVFqHb"></a><a data-type="indexterm" data-primary="UI elements, wired" id="id-JnCzFlFNFlHj"></a><a data-type="indexterm" data-primary="floating-point values" id="id-9nCrIvFpFqH8"></a><a data-type="indexterm" data-primary="currency" id="id-ZbCPtMFXFGHb"></a><a data-type="indexterm" data-primary="WiringUI.toNode method" id="id-zdCrhGFWFJHJ"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2IwHo">
<h2>Solution</h2>

<p>Use the <code>WiringUI.toNode</code> method to create a wiring node that can render the output formatted as you desire.</p>

<p>As an example, consider an HTML template to display the quantity of an item being purchased and the subtotal:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"Wiring"</code><code class="nt">&gt;</code>

<code class="nt">&lt;table&gt;</code>
  <code class="nt">&lt;tbody&gt;</code>
    <code class="nt">&lt;tr&gt;&lt;td&gt;</code>Quantity<code class="nt">&lt;/td&gt;&lt;td</code> <code class="na">id=</code><code class="s">"quantity"</code><code class="nt">&gt;</code>?<code class="nt">&lt;/td&gt;&lt;/tr&gt;</code>
    <code class="nt">&lt;tr&gt;&lt;td&gt;</code>Subtotal<code class="nt">&lt;/td&gt;&lt;td</code> <code class="na">id=</code><code class="s">"subtotal"</code><code class="nt">&gt;</code>?<code class="nt">&lt;/td&gt;&lt;/tr&gt;</code>
  <code class="nt">&lt;/tbody&gt;</code>
<code class="nt">&lt;/table&gt;</code>

<code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"add"</code><code class="nt">&gt;</code>Add Another One<code class="nt">&lt;/button&gt;</code>

<code class="nt">&lt;/div&gt;</code></pre>

<p>We’d like the subtotal to display as US dollars.  The snippet would be:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">java.text.NumberFormat</code>
<code class="k">import</code> <code class="nn">java.util.Locale</code>

<code class="k">import</code> <code class="nn">scala.xml.</code><code class="o">{</code><code class="nc">NodeSeq</code><code class="o">,</code> <code class="nc">Text</code><code class="o">}</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.</code><code class="o">{</code><code class="nc">Cell</code><code class="o">,</code> <code class="nc">ValueCell</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="n">S</code><code class="o">,</code> <code class="nc">WiringUI</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml.ajaxInvoke</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmd</code>

<code class="k">class</code> <code class="nc">Wiring</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">cost</code> <code class="k">=</code> <code class="nc">ValueCell</code><code class="o">(</code><code class="mf">1.99</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">quantity</code> <code class="k">=</code> <code class="nc">ValueCell</code><code class="o">(</code><code class="mi">1</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">subtotal</code> <code class="k">=</code> <code class="n">cost</code><code class="o">.</code><code class="n">lift</code><code class="o">(</code><code class="n">quantity</code><code class="o">)(</code><code class="k">_</code> <code class="o">*</code> <code class="k">_</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">formatter</code> <code class="k">=</code> <code class="nc">NumberFormat</code><code class="o">.</code><code class="n">getCurrencyInstance</code><code class="o">(</code><code class="nc">Locale</code><code class="o">.</code><code class="nc">US</code><code class="o">)</code>

  <code class="k">def</code> <code class="n">currency</code><code class="o">(</code><code class="n">cell</code><code class="k">:</code> <code class="kt">Cell</code><code class="o">[</code><code class="kt">Double</code><code class="o">])</code><code class="k">:</code> <code class="kt">NodeSeq</code> <code class="o">=&gt;</code> <code class="nc">NodeSeq</code> <code class="k">=</code>
    <code class="nc">WiringUI</code><code class="o">.</code><code class="n">toNode</code><code class="o">(</code><code class="n">cell</code><code class="o">)((</code><code class="n">value</code><code class="o">,</code> <code class="n">ns</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="nc">Text</code><code class="o">(</code><code class="n">formatter</code> <code class="n">format</code> <code class="n">value</code><code class="o">))</code>

  <code class="k">def</code> <code class="n">increment</code><code class="o">()</code><code class="k">:</code> <code class="kt">JsCmd</code>  <code class="o">=</code> <code class="o">{</code>
    <code class="n">quantity</code><code class="o">.</code><code class="n">atomicUpdate</code><code class="o">(</code><code class="k">_</code> <code class="o">+</code> <code class="mi">1</code><code class="o">)</code>
    <code class="n">S</code><code class="o">.</code><code class="n">notice</code><code class="o">(</code><code class="s">"Added One"</code><code class="o">)</code>
  <code class="o">}</code></pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true">  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="s">"#add [onclick]"</code> <code class="o">#&gt;</code> <code class="n">ajaxInvoke</code><code class="o">(</code><code class="n">increment</code><code class="o">)</code> <code class="o">&amp;</code>
    <code class="s">"#quantity *"</code> <code class="o">#&gt;</code> <code class="nc">WiringUI</code><code class="o">.</code><code class="n">asText</code><code class="o">(</code><code class="n">quantity</code><code class="o">)</code> <code class="o">&amp;</code>
    <code class="s">"#subtotal *"</code> <code class="o">#&gt;</code> <code class="n">currency</code><code class="o">(</code><code class="n">subtotal</code><code class="o">)</code>

<code class="o">}</code></pre>

<p>We have defined a <code>currency</code> method to format the <code>subtotal</code> not as a <code>Double</code> but as a currency amount using the Java number-formatting capabilities.  This will result in values like "$19.90" being shown rather than "19.9."<a data-type="indexterm" data-primary="S." data-secondary="notice" id="id-PnCetXiXIYHV"></a></p>
</section>













<section data-type="sect2" id="discussion-q8svtBHb">
<h2>Discussion</h2>

<p>The primary <code>WiringUI</code> class makes it easy to bind a cell as text. The <code>asText</code> method works by converting a value to a <code>String</code> and wrapping it in a <code>Text</code> node. This is done via <code>toNode</code>, however, we can use the <code>toNode</code> method directly
to generate a transform function that is both hooked into the wiring UI and
uses our code for the translation of the item.</p>

<p>The mechanism is type-safe. In this example, <code>cost</code> is a <code>Double</code> cell, <code>quantity</code> is an <code>Int</code> cell, and <code>subtotal</code> is inferred as a <code>Cell[Double]</code>.  This is why our formatting function is passed <code>value</code> as a <code>Double</code>.<a data-type="indexterm" data-primary="type-safe options" id="id-OnCDuVIytkHY"></a></p>

<p>Note that the function passed to <code>toNode</code> must return a <code>NodeSeq</code>. This gives a great deal of flexibility as you can return any kind of markup in a <code>NodeSeq</code>. Our example complies with this signature by wrapping a text value in a <code>Text</code> object.</p>

<p>The <code>WiringUI.toNode</code> requires a <code>(T, NodeSeq) =&gt; NodeSeq</code>.  In the previous example, we ignore the <code>NodeSeq</code>, but the value would be the contents of the element we’ve bound to.  Given the input:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;td</code> <code class="na">id=</code><code class="s">"subtotal"</code><code class="nt">&gt;</code>?<code class="nt">&lt;/td&gt;</code></pre>

<p>this would mean the <code>NodeSeq</code> passed to us would just be the text node representing "?".  With a richer template we can use CSS selectors. For example, we can modify the <span class="keep-together">template:</span></p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;td&gt;</code>Subtotal<code class="nt">&lt;/td&gt;&lt;td</code> <code class="na">id=</code><code class="s">"subtotal"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;i&gt;</code>The value is <code class="nt">&lt;b</code> <code class="na">class=</code><code class="s">"amount"</code><code class="nt">&gt;</code>?<code class="nt">&lt;/b&gt;&lt;/i&gt;</code>
<code class="nt">&lt;/td&gt;</code></pre>

<p>Now we can apply a CSS selector to change just the <code>amount</code> element:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="o">(</code><code class="n">value</code><code class="o">,</code> <code class="n">ns</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="o">(</code><code class="s">".amount *"</code> <code class="o">#&gt;</code> <code class="nc">Text</code><code class="o">(</code><code class="n">formatter</code> <code class="n">format</code> <code class="n">value</code><code class="o">))</code> <code class="n">apply</code> <code class="n">ns</code><code class="o">)</code></pre>
</section>













<section data-type="sect2" id="see-also-1Ls9hGHg">
<h2>See Also</h2>

<p><a href="http://simply.liftweb.net/">Chapter 6 of <em>Simply Lift</em></a> describes Lift’s Wiring mechanism, and gives a detailed shopping example.</p>
</section>





</section>







</section>














<section data-type="chapter" id="Pipeline">
<h1>Request Pipeline</h1>


<p>When a request reaches Lift, there are a number of points where you can jump in and control what Lift does,  sending back a different kind of response or controlling access.  This chapter looks at the pipeline through examples of different kinds of
<code>LiftResponse</code>s and configurations.<a data-type="indexterm" data-primary="request pipeline" data-secondary="controlling" id="id-bGCgF2Fk"></a></p>

<p>You can get a great overview of the pipeline, including diagrams, from the <a href="http://www.assembla.com/spaces/liftweb/wiki/HTTP_Pipeline">Lift pipeline wiki page</a>.<a data-type="indexterm" data-primary="request pipeline" data-secondary="diagrams of" id="id-KnCdF1IV"></a></p>

<p>See <a href="https://github.com/LiftCookbook/cookbook_pipeline"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_pipeline</em></a> for the source code that accompanies this chapter.</p>






<section data-type="sect1" id="DebugRequest">
<h1>Debugging a Request</h1>








<section data-type="sect2" id="problem-xqsZFyhA">
<h2>Problem</h2>

<p>You want to debug a request and see what’s arriving to your Lift application.<a data-type="indexterm" data-primary="request pipeline" data-secondary="debugging requests" id="id-LnC7SGFQF7hl"></a><a data-type="indexterm" data-primary="debugging requests" id="id-AnCDFZFvFNhA"></a><a data-type="indexterm" data-primary="requests" data-secondary="debugging" id="id-W7CQILFYFzhy"></a></p>
</section>













<section data-type="sect2" id="solution-PaskIwha">
<h2>Solution</h2>

<p>Add an <code>onBeginServicing</code> function in <em>Boot.scala</em> to log the request.<a data-type="indexterm" data-primary="onBeginServicing function" id="id-e4CxIJFqIvhd"></a><a data-type="indexterm" data-primary="LiftRules" data-secondary=".onBeginServicing" id="id-GnCPtgFkIKhD"></a>
For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">onBeginServicing</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="n">r</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="s">"Received: "</code><code class="o">+</code><code class="n">r</code><code class="o">)</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="discussion-OKsVt9hJ">
<h2>Discussion</h2>

<p>The <code>onBeginServicing</code> call is called quite early in the Lift pipeline, before
<code>S</code> is set up, and before Lift has the chance to 404 your request.  The function signature it expects is <code>Req =&gt; Unit</code>.
We’re just logging, but the functions could be used for other purposes.</p>

<p>If you want to select only certain paths, you can. For example, to track
all requests starting <em>/paypal</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">onBeginServicing</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="n">r</code> <code class="k">@</code> <code class="nc">Req</code><code class="o">(</code><code class="s">"paypal"</code> <code class="o">::</code> <code class="k">_</code><code class="o">),</code> <code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="n">r</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>This pattern will match any request starting <em>/paypal</em>, and we’re ignoring the suffix on the request, if any, and the type of request (e.g., GET, POST, or so on).</p>

<p>There’s also <code>LiftRules.early</code>, which is called before <code>onBeginServicing</code>.  It expects an <code>HTTPRequest =&gt; Unit</code> function, so is a little lower-level than the <code>Req</code> used in <code>onBeginServicing</code>.  However, it will be called by all requests that pass through Lift. To see the difference, you could mark a request as something that the container should handle by itself<a data-type="indexterm" data-primary="LiftRules" data-secondary=".early" id="id-zdCLTpTDt7hj"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">liftRequest</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Req</code><code class="o">(</code><code class="s">"robots"</code> <code class="o">::</code> <code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="kc">false</code>
<code class="o">}</code></pre>

<p>With this in place, a request for <em>robots.txt</em> will be logged by <code>LiftRules.early</code> but won’t make it to any of the other methods described in this recipe.</p>

<p>If you need access to state (e.g., <code>S</code>), use <code>earlyInStateful</code>, which is based on a <code>Box[Req]</code> not a <code>Req</code>:<a data-type="indexterm" data-primary="LiftRules" data-secondary=".earlyInStateful" id="id-VMCohkuktzhr"></a></p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">earlyInStateful</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="n">r</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="c1">// access S here</code>
  <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code>
<code class="o">}</code></pre>

<p>It’s possible for your <code>earlyInStateful</code> function to be called twice. This will happen when a new session is being set up.  You can prevent this by only matching on requests in a running Lift session:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">earlyInStateful</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="n">r</code><code class="o">)</code> <code class="k">if</code> <code class="nc">LiftRules</code><code class="o">.</code><code class="n">getLiftSession</code><code class="o">(</code><code class="n">r</code><code class="o">).</code><code class="n">running_?</code> <code class="k">=&gt;</code> <code class="c1">// access S here</code>
  <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code>
<code class="o">}</code></pre>

<p>Finally, there’s also <code>earlyInStateless</code>, which like <code>earlyInStateful</code>, works on a <code>Box[Req]</code> but in other respects is the same as <code>onBeginServicing</code>. It is triggered after <code>early</code> and before <code>earlyInStateful</code>.<a data-type="indexterm" data-primary="LiftRules" data-secondary=".earlyInStateless" id="id-XmClcoHytEhK"></a></p>

<p>As a summary, the functions described in this recipe are called in this order:</p>
<ol>
<li>
<p><code>LiftRules.early</code></p>
</li>
<li>
<p><code>LiftRules.onBeginServicing</code></p>
</li>
<li>
<p><code>LiftRules.earlyInStateless</code></p>
</li>
<li>
<p><code>LiftRules.earlyInStateful</code></p>
</li>

</ol>
</section>













<section data-type="sect2" id="see-also-XQsXhMhm">
<h2>See Also</h2>

<p>If you need to catch the end of a request, there is also an <code>onEndServicing</code> that can be given functions of type
<code>(Req, Box[LiftResponse]) =&gt; Unit</code>.</p>

<p><a data-type="xref" href="#RunningStateless">Running Stateless</a> describes how to force requests to be stateless.</p>
</section>





</section>













<section data-type="sect1" id="OnSession">
<h1>Running Code When Sessions Are Created (or Destroyed)</h1>








<section data-type="sect2" id="problem-PasxFZTa">
<h2>Problem</h2>

<p>You want to carry out actions when a session is created or destroyed.<a data-type="indexterm" data-primary="session hooks" id="id-AnCPSZFvFjTA"></a><a data-type="indexterm" data-primary="browsers" data-secondary="running code on session creation/destruction" id="id-W7CoFLFYFQTy"></a><a data-type="indexterm" data-primary="hooks" id="id-e4CxIJFZFxTd"></a><a data-type="indexterm" data-primary="request pipeline" data-secondary="code execution on session creation/destruction" id="id-GnCPtgFbFgTD"></a></p>
</section>













<section data-type="sect2" id="solution-OKsOIrTJ">
<h2>Solution</h2>

<p>Make use of the hooks in <code>LiftSession</code>. For example, in <em>Boot.scala</em>:<a data-type="indexterm" data-primary="LiftSession hooks" id="id-GnC7IgFkIgTD"></a></p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftSession</code><code class="o">.</code><code class="n">afterSessionCreate</code> <code class="o">::=</code>
 <code class="o">(</code> <code class="o">(</code><code class="n">s</code><code class="k">:</code><code class="kt">LiftSession</code><code class="o">,</code> <code class="n">r</code><code class="k">:</code><code class="kt">Req</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="s">"Session created"</code><code class="o">)</code> <code class="o">)</code>

<code class="nc">LiftSession</code><code class="o">.</code><code class="n">onBeginServicing</code> <code class="o">::=</code>
 <code class="o">(</code> <code class="o">(</code><code class="n">s</code><code class="k">:</code><code class="kt">LiftSession</code><code class="o">,</code> <code class="n">r</code><code class="k">:</code><code class="kt">Req</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="s">"Processing request"</code><code class="o">)</code> <code class="o">)</code>

<code class="nc">LiftSession</code><code class="o">.</code><code class="n">onShutdownSession</code> <code class="o">::=</code>
 <code class="o">(</code> <code class="o">(</code><code class="n">s</code><code class="k">:</code><code class="kt">LiftSession</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="s">"Session going away"</code><code class="o">)</code> <code class="o">)</code></pre>

<p>If the request path is marked as being stateless via
<code>LiftRules.statelessReqTest</code>, this example would only execute the
<code>onBeginServicing</code> functions.</p>
</section>













<section data-type="sect2" id="discussion-XQsbtBTm">
<h2>Discussion</h2>

<p>The hooks in <code>LiftSession</code> allow you to insert code at various points in
the session life cycle: when the session is created, at the start of
servicing the request, after servicing, when the session is about to
shut down, at shutdown, etc. The pipeline diagrams mentioned at the start of this chapter
are a useful guide to these stages.</p>

<p>The list of session hooks follows:</p>
<dl>
<dt><code>onSetupSession</code></dt>
<dd>
<p>This will be the first hook called when a session is created.</p>
</dd>
<dt><code>afterSessionCreate</code></dt>
<dd>
<p>This will be called after all <code>onSetupSession</code> functions have been called.</p>
</dd>
<dt><code>onBeginServicing</code></dt>
<dd>
<p>This will be called at the start of request processing.</p>
</dd>
<dt><code>onEndServicing</code></dt>
<dd>
<p>This will be called at the end of request processing.</p>
</dd>
<dt><code>onAboutToShutdownSession</code></dt>
<dd>
<p>This will be called just before a session is shut down (for example, when a session expires or the Lift application is being shut down).</p>
</dd>
<dt><code>onShutdownSession</code></dt>
<dd>
<p>This will be called after all <code>onAboutToShutdownSession</code> functions have been run.</p>
</dd>
</dl>

<p>If you are testing these hooks, you might want to make the session expire faster than the 30 minutes of inactivity used by default in Lift.  To do this, supply a millisecond value to <code>LiftRules.sessionInactivityTimeout</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="c1">// 30 second inactivity timeout</code>
<code class="nc">LiftRules</code><code class="o">.</code><code class="n">sessionInactivityTimeout</code><code class="o">.</code><code class="n">default</code><code class="o">.</code><code class="n">set</code><code class="o">(</code><code class="nc">Full</code><code class="o">(</code><code class="mi">1000L</code> <code class="o">*</code> <code class="mi">30</code><code class="o">))</code></pre>

<p>There are two other hooks in <code>LiftSession</code>: <code>onSessionActivate</code> and <code>onSessionPassivate</code>. These may be of use if you are working with a servlet container in distributed mode and want to be notified when the servlet HTTP session is about to be serialised (passivated) and deserialised (activated) between container instances. These hooks are rarely used.</p>

<p>Note that the Lift session is not the same as the HTTP session. Lift bridges from the HTTP session to its own session management.  This is described in some detail in <em>Exploring Lift</em>.</p>
</section>













<section data-type="sect2" id="see-also-jWskh4TV">
<h2>See Also</h2>

<p>Session management is discussed in section 9.5 of <a href="http://exploring.liftweb.net/"><em>Exploring Lift</em></a>.</p>

<p><a data-type="xref" href="#RunningStateless">Running Stateless</a> shows how to run without state.</p>
</section>





</section>













<section data-type="sect1" id="ShutdownHooks">
<h1>Run Code When Lift Shuts Down</h1>








<section data-type="sect2" id="problem-OKsLFbcJ">
<h2>Problem</h2>

<p>You want to have some code executed when your Lift application is
shutting down.<a data-type="indexterm" data-primary="Lift applications" data-secondary="code execution at shutdown of" id="id-W7CESLFYFJcy"></a><a data-type="indexterm" data-primary="shutdown, code execution at" id="id-e4CAFJFZFmcd"></a><a data-type="indexterm" data-primary="hooks" id="id-GnC7IgFbFEcD"></a><a data-type="indexterm" data-primary="unload hooks" id="id-DnCqtWFwFQc7"></a><a data-type="indexterm" data-primary="request pipeline" data-secondary="code execution at shutdown" id="id-kVCvhpFLFqcO"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKIpcm">
<h2>Solution</h2>

<p>Append to <code>LiftRules.unloadHooks</code>:<a data-type="indexterm" data-primary="LiftRules" data-secondary=".unloadHooks" id="id-GnCZFgFkIEcD"></a></p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">unloadHooks</code><code class="o">.</code><code class="n">append</code><code class="o">(</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="s">"Shutting down"</code><code class="o">)</code> <code class="o">)</code></pre>
</section>













<section data-type="sect2" id="discussion-jWsvtlcV">
<h2>Discussion</h2>

<p>You append functions of type <code>() =&gt; Unit</code> to <code>unloadHooks</code>, and these functions are run
right at the end of the Lift handler, after sessions have been
destroyed, Lift actors have been shut down, and requests have finished
being handled.</p>

<p>This is triggered, in the words of the Java servlet
specification, "by the web container to indicate to a filter that it is
being taken out of service."</p>
</section>













<section data-type="sect2" id="see-also-2ksZhBcr">
<h2>See Also</h2>

<p><a data-type="xref" href="#RunTasksPeriodically">Run Tasks Periodically</a> includes an example of using an unload hook.</p>
</section>





</section>













<section data-type="sect1" id="RunningStateless">
<h1>Running Stateless</h1>








<section data-type="sect2" id="problem-XQspFGim">
<h2>Problem</h2>

<p>You want to force your application to be stateless at the HTTP level.<a data-type="indexterm" data-primary="Lift applications" data-secondary="forced to be stateless" id="id-e4CzSJFZFrid"></a><a data-type="indexterm" data-primary="stateless mode" id="id-GnCZFgFbFeiD"></a><a data-type="indexterm" data-primary="request pipeline" data-secondary="stateless mode" id="id-DnCXIWFwFzi7"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjIviV">
<h2>Solution</h2>

<p>In <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">enableContainerSessions</code> <code class="k">=</code> <code class="kc">false</code>
<code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessReqTest</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code> <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="kc">true</code> <code class="o">}</code></pre>

<p>All requests will now be treated as stateless. Any attempt to use state,
such as via <code>SessionVar</code> for example, will trigger a warning in
developer mode: "Access to Lift’s statefull features from Stateless mode.
The operation on state will not complete."<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="stateful features of" id="id-4nC2FqtMI7iN"></a></p>
</section>













<section data-type="sect2" id="discussion-2ksLtair">
<h2>Discussion</h2>

<p>HTTP session creation is controlled via <code>enableContainerSessions</code>, and
applies for all requests. Leaving this value at the default (<code>true</code>)
allows more fine-grained control over which requests are stateless.</p>

<p>Using <code>statelessReqTest</code> allows you to decide, based on the
<code>StatelessReqTest</code> case class, if a request should be stateless (<code>true</code>) or not (<code>false</code>).
For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">asset</code><code class="o">(</code><code class="n">file</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">=</code>
  <code class="nc">List</code><code class="o">(</code><code class="s">".js"</code><code class="o">,</code> <code class="s">".gif"</code><code class="o">,</code> <code class="s">".css"</code><code class="o">).</code><code class="n">exists</code><code class="o">(</code><code class="n">file</code><code class="o">.</code><code class="n">endsWith</code><code class="o">)</code>

<code class="nc">LiftRules</code><code class="o">.</code><code class="n">statelessReqTest</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">StatelessReqTest</code><code class="o">(</code><code class="s">"index"</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code> <code class="n">httpReq</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="kc">true</code>
  <code class="k">case</code> <code class="nc">StatelessReqTest</code><code class="o">(</code><code class="nc">List</code><code class="o">(</code><code class="k">_</code><code class="o">,</code> <code class="n">file</code><code class="o">),</code>  <code class="k">_</code><code class="o">)</code> <code class="k">if</code> <code class="n">asset</code><code class="o">(</code><code class="n">file</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="kc">true</code>
<code class="o">}</code></pre>

<p>This example would only make the index page and any GIFs, JavaScript, and
CSS files stateless. The <code>httpReq</code> part is an <code>HTTPRequest</code> instance,
allowing you to base the decision on the content of the request
(cookies, user agent, etc.).</p>

<p>Another option is <code>LiftRules.statelessDispatch</code>, which allows you to
register a function that returns a <code>LiftResponse</code>. This will be
executed without a session, and is convenient for REST-based services.</p>

<p>If you just need to mark an entry in <code>SiteMap</code> as being stateless, you can:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"Stateless Page"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"demo"</code> <code class="o">&gt;&gt;</code> <code class="nc">Stateless</code></pre>

<p>A request for <em>/demo</em> would be processed without state.</p>
</section>













<section data-type="sect2" id="see-also-pWsJh2iL">
<h2>See Also</h2>

<p><a data-type="xref" href="#REST">REST</a> contains recipes for REST-based services in Lift.</p>

<p><a href="http://www.assembla.com/wiki/show/liftweb/Stateless_Requests">The Lift wiki</a> gives further details on the processing of stateless requests.</p>

<p>This stateless request control was introduced in Lift 2.2. <a href="http://bit.ly/lift-stateless">The announcement on the mailing list</a> gives more details.</p>
</section>





</section>













<section data-type="sect1" id="CatchException">
<h1>Catch Any Exception</h1>








<section data-type="sect2" id="problem-jWslFjuV">
<h2>Problem</h2>

<p>You want a wrapper around all requests to catch exceptions and display
something to the user.<a data-type="indexterm" data-primary="request pipeline" data-secondary="catching exceptions" id="id-GnCJSgFbFQuD"></a><a data-type="indexterm" data-primary="exceptions, catching" id="id-DnCaFWFwFau7"></a><a data-type="indexterm" data-primary="exception handlers" id="id-kVCAIpFLFXuO"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIEur">
<h2>Solution</h2>

<p>Declare an exception handler in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">exceptionHandler</code><code class="o">.</code><code class="n">prepend</code> <code class="o">{</code>
  <code class="k">case</code> <code class="o">(</code><code class="n">runMode</code><code class="o">,</code> <code class="n">request</code><code class="o">,</code> <code class="n">exception</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">error</code><code class="o">(</code><code class="s">"Failed at: "</code><code class="o">+</code><code class="n">request</code><code class="o">.</code><code class="n">uri</code><code class="o">)</code>
    <code class="nc">InternalServerErrorResponse</code><code class="o">()</code>
<code class="o">}</code></pre>

<p>In this example, all exceptions for all requests at all run modes
are being matched, causing an error to be logged and a 500 (internal
server) error to be returned to the browser.<a data-type="indexterm" data-primary="error messages" data-secondary="500 (internal server)" id="id-4nCqSqtMI0uN"></a><a data-type="indexterm" data-primary="500 (internal server) error" id="id-JnCzF7tpIyuN"></a><a data-type="indexterm" data-primary="internal server (500) error messages" id="id-9nCrIOtlIXup"></a></p>
</section>













<section data-type="sect2" id="discussion-pWswtvuL">
<h2>Discussion</h2>

<p>The partial function you add to <code>exceptionHandler</code> needs to return a
<code>LiftResponse</code> (i.e., something to send to the browser). The default
behaviour is to return an <code>XhtmlResponse</code>, which in
<code>Props.RunModes.Development</code> gives details of the exception, and in all
other run modes simply says: "Something unexpected happened."</p>

<p>You can return any kind of <code>LiftResponse</code>, including <code>RedirectResponse</code>,
<code>JsonResponse</code>, <code>XmlResponse</code>, <code>JavaScriptResponse</code>, and so on.</p>

<p>The previous example just sends a standard 500 error. That won’t be very helpful to your users.
An alternative is to render a custom message but retain the 500 status code that will be
useful for external site-monitoring services, if you use them:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">exceptionHandler</code><code class="o">.</code><code class="n">prepend</code> <code class="o">{</code>
  <code class="k">case</code> <code class="o">(</code><code class="n">runMode</code><code class="o">,</code> <code class="n">req</code><code class="o">,</code> <code class="n">exception</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">error</code><code class="o">(</code><code class="s">"Failed at: "</code><code class="o">+</code><code class="n">req</code><code class="o">.</code><code class="n">uri</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">content</code> <code class="k">=</code> <code class="n">S</code><code class="o">.</code><code class="n">render</code><code class="o">(&lt;</code><code class="n">lift</code><code class="k">:</code><code class="kt">embed</code> <code class="kt">what</code><code class="o">=</code><code class="s">"500"</code> <code class="o">/&gt;,</code> <code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">)</code>
    <code class="nc">XmlResponse</code><code class="o">(</code><code class="n">content</code><code class="o">.</code><code class="n">head</code><code class="o">,</code> <code class="mi">500</code><code class="o">,</code> <code class="s">"text/html"</code><code class="o">,</code> <code class="n">req</code><code class="o">.</code><code class="n">cookies</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>Here we are sending back a response with a 500 status code, but the content is the
<code>Node</code> that results from running <em>src/main/webapp/template-hidden/500.html</em>.  Create that
file with the message you want to show to users<a data-type="indexterm" data-primary="S." data-secondary="render" id="id-yYCrIYTvtVu1"></a>:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;title&gt;</code>500<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;h1&gt;</code>Something is wrong!<code class="nt">&lt;/h1&gt;</code>
  <code class="nt">&lt;p&gt;</code>It's our fault - sorry<code class="nt">&lt;/p&gt;</code>
<code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>You can also control what to send to clients when processing Ajax requests.  In the
following example, we’re matching just on Ajax POST requests, and returning
custom JavaScript to the browser<a data-type="indexterm" data-primary="JavaScript" data-secondary="custom messages" id="id-yYCAS7ivtVu1"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.js.JsCmds._</code>

<code class="k">val</code> <code class="n">ajax</code> <code class="k">=</code> <code class="nc">LiftRules</code><code class="o">.</code><code class="n">ajaxPath</code>

<code class="nc">LiftRules</code><code class="o">.</code><code class="n">exceptionHandler</code><code class="o">.</code><code class="n">prepend</code> <code class="o">{</code>
  <code class="k">case</code> <code class="o">(</code><code class="n">mode</code><code class="o">,</code> <code class="nc">Req</code><code class="o">(</code><code class="n">ajax</code> <code class="o">::</code> <code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">,</code> <code class="nc">PostRequest</code><code class="o">),</code> <code class="n">ex</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">error</code><code class="o">(</code><code class="s">"Error handing ajax"</code><code class="o">)</code>
    <code class="nc">JavaScriptResponse</code><code class="o">(</code><code class="nc">Alert</code><code class="o">(</code><code class="s">"Boom!"</code><code class="o">))</code>
<code class="o">}</code></pre>

<p>You could test out this handling code by creating an Ajax button that always produces
an exception:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.SHtml</code>

<code class="k">class</code> <code class="nc">ThrowsException</code> <code class="o">{</code>
  <code class="k">private</code> <code class="k">def</code> <code class="n">fail</code> <code class="k">=</code> <code class="k">throw</code> <code class="k">new</code> <code class="nc">Error</code><code class="o">(</code><code class="s">"not implemented"</code><code class="o">)</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="s">"*"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">ajaxButton</code><code class="o">(</code><code class="s">"Press Me"</code><code class="o">,</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="n">fail</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>This Ajax example will jump in before Lift’s default behaviour for Ajax
errors. The default is to retry the Ajax command three times
(<code>LiftRules.ajaxRetryCount</code>), and then execute
<code>LiftRules.ajaxDefaultFailure</code>, which will pop up a dialog saying: "The
server cannot be contacted at this time."</p>
</section>













<section data-type="sect2" id="see-also-o8sNhku1">
<h2>See Also</h2>

<p><a data-type="xref" href="#Custom404">Custom 404 Page</a> describes how to create a custom 404 (not found) page.</p>
</section>





</section>













<section data-type="sect1" id="RestStreamContent">
<h1>Streaming Content</h1>








<section data-type="sect2" id="problem-2kslFGUr">
<h2>Problem</h2>

<p>You want to stream content back to the web client.<a data-type="indexterm" data-primary="request pipeline" data-secondary="streaming content" id="id-DnC1SWFwFwU7"></a><a data-type="indexterm" data-primary="streaming content" id="id-kVCEFpFLFrUO"></a><a data-type="indexterm" data-primary="OutputSteamResponse" id="id-4nCkIYFVFmUN"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIoUL">
<h2>Solution</h2>

<p>Use <code>OutputStreamResponse</code>, passing it a function that will write to the
<code>OutputStream</code> that Lift supplies.</p>

<p>In this example, we’ll stream all the integers from one, via a REST service:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="nc">Req</code><code class="o">,</code><code class="nc">OutputStreamResponse</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.rest._</code>

<code class="k">object</code> <code class="nc">Numbers</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="c1">// Convert a number to a String, and then to UTF-8 bytes</code>
  <code class="c1">// to send down the output stream.</code>
  <code class="k">def</code> <code class="n">num2bytes</code><code class="o">(</code><code class="n">x</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code> <code class="k">=</code> <code class="o">(</code><code class="n">x</code> <code class="o">+</code> <code class="s">"\n"</code><code class="o">)</code> <code class="n">getBytes</code><code class="o">(</code><code class="s">"utf-8"</code><code class="o">)</code>

  <code class="c1">// Generate numbers using a Scala stream:</code>
  <code class="k">def</code> <code class="n">infinite</code> <code class="k">=</code> <code class="nc">Stream</code><code class="o">.</code><code class="n">from</code><code class="o">(</code><code class="mi">1</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="n">num2bytes</code><code class="o">)</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="nc">Req</code><code class="o">(</code><code class="s">"numbers"</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code> <code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="nc">OutputStreamResponse</code><code class="o">(</code> <code class="n">out</code> <code class="k">=&gt;</code> <code class="n">infinite</code><code class="o">.</code><code class="n">foreach</code><code class="o">(</code><code class="n">out</code><code class="o">.</code><code class="n">write</code><code class="o">)</code> <code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Scala’s <code>Stream</code> class is a way to generate a sequence with lazy evaluation. The values being
produced by <code>infinite</code> are used as example data to stream back to the client.<a data-type="indexterm" data-primary="Scala" data-secondary="Stream class" id="id-zdCXIyhpIkUj"></a></p>

<p>Wire this into Lift in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">dispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">Numbers</code><code class="o">)</code></pre>

<p>Visiting <em><a href="http://127.0.0.1:8080/numbers"><em class="hyperlink">http://127.0.0.1:8080/numbers</em></a></em> will generate a 200 status code
and start producing the integers from 1. The numbers are produced quite quickly, so you
probably don’t want to try that in your web browser, but instead from something that
is easier to stop, such as cURL.<a data-type="indexterm" data-primary="200 status code" id="id-VMCpFJi9I8Ur"></a></p>
</section>













<section data-type="sect2" id="discussion-o8sytNU1">
<h2>Discussion</h2>

<p><code>OutputStreamResponse</code> expects a function of type <code>OutputStream =&gt; Unit</code>. The
<code>OutputStream</code> argument is the output stream to the client.  This means the bytes
we write to the stream are written to the client. The relevant line from the example is:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">OutputStreamResponse</code><code class="o">(</code><code class="n">out</code> <code class="k">=&gt;</code> <code class="n">infinite</code><code class="o">.</code><code class="n">foreach</code><code class="o">(</code><code class="n">out</code><code class="o">.</code><code class="n">write</code><code class="o">))</code></pre>

<p>We are making use of the <code>write(byte[])</code> method on <code>out</code>, a Java <code>OutputStream</code>, and sending it
the <code>Array[Byte]</code> being generated from our <code>infinite</code> stream.</p>

<p>Be aware that <code>OutputStreamResponse</code> is executed outside of the scope of <code>S</code>. This means if you need to access anything in the session, do so outside of the function you pass to <code>OutputStreamResponse</code>.</p>

<p>For more control over status codes, headers, and cookies, there are a
variety of signatures for the <code>OutputStreamResponse</code> object. For the
most control, create an instance of the <code>OutputStreamResponse</code> class:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">case</code> <code class="k">class</code> <code class="nc">OutputStreamResponse</code><code class="o">(</code>
  <code class="n">out</code><code class="k">:</code> <code class="o">(</code><code class="kt">OutputStream</code><code class="o">)</code> <code class="o">=&gt;</code> <code class="nc">Unit</code><code class="o">,</code>
  <code class="n">size</code><code class="k">:</code> <code class="kt">Long</code><code class="o">,</code>
  <code class="n">headers</code><code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">String</code>, <code class="kt">String</code><code class="o">)],</code>
  <code class="n">cookies</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">HTTPCookie</code><code class="o">],</code>
  <code class="n">code</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code></pre>

<p>Note that
setting <code>size</code> to <code>-1</code> causes the <code>Content-Length</code> header to be skipped.</p>

<p>There are two related types of response: <code>InMemoryResponse</code> and
<code>StreamingResponse</code>.</p>










<section data-type="sect3" id="inmemoryresponse-8kskUQtWUB">
<h3>InMemoryResponse</h3>

<p><code>InMemoryResponse</code> is useful if you have already assembled the full
content to send to the client. The signature is straightforward<a data-type="indexterm" data-primary="InMemoryResponse" id="id-PnCxF7FzUKtVUa"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">case</code> <code class="k">class</code> <code class="nc">InMemoryResponse</code><code class="o">(</code>
  <code class="n">data</code><code class="k">:</code> <code class="kt">Array</code><code class="o">[</code><code class="kt">Byte</code><code class="o">],</code>
  <code class="n">headers</code><code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">String</code>, <code class="kt">String</code><code class="o">)],</code>
  <code class="n">cookies</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">HTTPCookie</code><code class="o">],</code>
  <code class="n">code</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code></pre>

<p>As an example, we can modify the recipe and force our <code>infinite</code> sequence of numbers to produce the first few numbers as an <code>Array[Byte]</code> in memory:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="n">serve</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Req</code><code class="o">(</code><code class="nc">AsInt</code><code class="o">(</code><code class="n">n</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code><code class="o">,</code> <code class="k">_</code><code class="o">,</code> <code class="k">_</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="nc">InMemoryResponse</code><code class="o">(</code><code class="n">infinite</code><code class="o">.</code><code class="n">take</code><code class="o">(</code><code class="n">n</code><code class="o">).</code><code class="n">toArray</code><code class="o">.</code><code class="n">flatten</code><code class="o">,</code> <code class="nc">Nil</code><code class="o">,</code> <code class="nc">Nil</code><code class="o">,</code> <code class="mi">200</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>The <code>AsInt</code> helper in Lift matches on an integer, meaning that a request starting with a number matches, and we’ll return that many numbers from the infinite sequence. We’re not setting headers or cookies, and this request produces what you’d expect:</p>

<pre data-type="programlisting">$ curl http://127.0.0.1:8080/3
1
2
3</pre>
</section>













<section data-type="sect3" id="streamingresponse-m8sWCQtyUE">
<h3>StreamingResponse</h3>

<p><code>StreamingResponse</code> pulls bytes into the output stream. This contrasts
with <code>OutputStreamResponse</code>, where you are pushing data to the client.<a data-type="indexterm" data-primary="StreamingResponse" id="id-XmCKIOFmCqtkUg"></a></p>

<p>Construct this type of response by providing a class with a <code>read</code> method that can be read
from:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">case</code> <code class="k">class</code> <code class="nc">StreamingResponse</code><code class="o">(</code>
  <code class="n">data</code><code class="k">:</code> <code class="o">{</code><code class="kt">def</code> <code class="kt">read</code><code class="o">(</code><code class="kt">buf:</code> <code class="kt">Array</code><code class="o">[</code><code class="kt">Byte</code><code class="o">])</code><code class="kt">:</code> <code class="kt">Int</code><code class="o">},</code>
  <code class="n">onEnd</code><code class="k">:</code> <code class="o">()</code> <code class="o">=&gt;</code> <code class="nc">Unit</code><code class="o">,</code>
  <code class="n">size</code><code class="k">:</code> <code class="kt">Long</code><code class="o">,</code>
  <code class="n">headers</code><code class="k">:</code> <code class="kt">List</code><code class="o">[(</code><code class="kt">String</code>, <code class="kt">String</code><code class="o">)],</code>
  <code class="n">cookies</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">HTTPCookie</code><code class="o">],</code>
  <code class="n">code</code><code class="k">:</code> <code class="kt">Int</code><code class="o">)</code></pre>

<p>Notice the use of a structural type for the <code>data</code> parameter. Anything
with a matching <code>read</code> method can be given here, including
<code>java.io.InputStream</code> objects, meaning <code>StreamingResponse</code> can act
as a pipe from input to output. Lift pulls 8 K chunks from your
<code>StreamingResponse</code> to send to the client.</p>

<p>Your <code>data</code> <code>read</code> function should follow the semantics of Java IO and
return "the total number of bytes read into the buffer, or –1 if there
is no more data because the end of the stream has been reached."</p>
</section>



</section>













<section data-type="sect2" id="see-also-g0sxhbUL">
<h2>See Also</h2>

<p><a data-type="xref" href="#ServingVideo">Serving Videos</a> gives an example of streaming video data via REST.</p>

<p><a href="http://docs.oracle.com/javase/7/docs/api/java/io/InputStream.html">The JavaDoc for <code>InputStream</code></a> gives the full contract for the <code>read</code> method.</p>
</section>





</section>













<section data-type="sect1" id="DiskAccessControl">
<h1>Serving a File with Access Control</h1>








<section data-type="sect2" id="problem-pWsqFpCL">
<h2>Problem</h2>

<p>You have a file on disk and you want to allow users to download it, but
only if they are allowed to. If they are not allowed to, you
want to explain why.<a data-type="indexterm" data-primary="request pipeline" data-secondary="access-controlled files" id="id-kVCkSpFLFPCO"></a><a data-type="indexterm" data-primary="files" data-secondary="access control to" id="id-4nC2FYFVFlCN"></a><a data-type="indexterm" data-primary="controlled access" id="id-JnCmIlFNF2CN"></a><a data-type="indexterm" data-primary="access control" id="id-9nCDtvFpF0Cp"></a><a data-type="indexterm" data-primary="security" data-secondary="file access control" id="id-ZbCBhMFXFZCJ"></a></p>
</section>













<section data-type="sect2" id="solution-o8seIyC1">
<h2>Solution</h2>

<p>Use <code>RestHelper</code> to serve the file or an explanation page.<a data-type="indexterm" data-primary="RestHelper" id="id-JnCzFlFpI2CN"></a><a data-type="indexterm" data-primary="error messages" data-secondary="file access" id="id-9nCrIvFlI0Cp"></a><a data-type="indexterm" data-primary="explanation pages" id="id-ZbCPtMFkIZCJ"></a></p>

<p>For example,
suppose we have the file <em>/tmp/important</em> and we only want selected
requests to download that file from the <em>/download/important</em> URL. The
structure for that would be:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.rest</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.rest.RestHelper</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="nc">StreamingResponse</code><code class="o">,</code> <code class="nc">LiftResponse</code><code class="o">,</code> <code class="nc">RedirectResponse</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.</code><code class="o">{</code><code class="nc">Box</code><code class="o">,</code> <code class="nc">Full</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">java.io.</code><code class="o">{</code><code class="nc">FileInputStream</code><code class="o">,</code> <code class="nc">File</code><code class="o">}</code>

<code class="k">object</code> <code class="nc">DownloadService</code> <code class="k">extends</code> <code class="nc">RestHelper</code> <code class="o">{</code>

  <code class="c1">// (code explained below to go here)</code>

  <code class="n">serve</code> <code class="o">{</code>
    <code class="k">case</code> <code class="s">"download"</code> <code class="o">::</code> <code class="nc">Known</code><code class="o">(</code><code class="n">fileId</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">=&gt;</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">permitted</code><code class="o">)</code> <code class="n">fileResponse</code><code class="o">(</code><code class="n">fileId</code><code class="o">)</code>
      <code class="k">else</code> <code class="nc">Full</code><code class="o">(</code><code class="nc">RedirectResponse</code><code class="o">(</code><code class="s">"/sorry"</code><code class="o">))</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>We are allowing users to download "known" files. That is, files we
approve of for access. We do this because opening up the filesystem to
any unfiltered end user input pretty much means your server will be
compromised.</p>

<p>For our example, <code>Known</code> is checking a static list of names:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">knownFiles</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code><code class="s">"important"</code><code class="o">)</code>

<code class="k">object</code> <code class="nc">Known</code> <code class="o">{</code>
 <code class="k">def</code> <code class="n">unapply</code><code class="o">(</code><code class="n">fileId</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code><code class="k">:</code> <code class="kt">Option</code><code class="o">[</code><code class="kt">String</code><code class="o">]</code> <code class="k">=</code> <code class="n">knownFiles</code><code class="o">.</code><code class="n">find</code><code class="o">(</code><code class="k">_</code> <code class="o">==</code> <code class="n">fileId</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>For requests to these known resources, we convert the REST request into
a <code>Box[LiftResponse]</code>. For permitted access we serve up the file:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">private</code> <code class="k">def</code> <code class="n">permitted</code> <code class="k">=</code> <code class="n">scala</code><code class="o">.</code><code class="n">math</code><code class="o">.</code><code class="n">random</code> <code class="o">&lt;</code> <code class="mf">0.5d</code>

<code class="k">private</code> <code class="k">def</code> <code class="n">fileResponse</code><code class="o">(</code><code class="n">fileId</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code><code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">LiftResponse</code><code class="o">]</code> <code class="k">=</code> <code class="k">for</code> <code class="o">{</code>
    <code class="n">file</code> <code class="k">&lt;-</code> <code class="nc">Box</code> <code class="o">!!</code> <code class="k">new</code> <code class="nc">File</code><code class="o">(</code><code class="s">"/tmp/"</code><code class="o">+</code><code class="n">fileId</code><code class="o">)</code>
    <code class="n">input</code> <code class="k">&lt;-</code> <code class="n">tryo</code><code class="o">(</code><code class="k">new</code> <code class="nc">FileInputStream</code><code class="o">(</code><code class="n">file</code><code class="o">))</code>
 <code class="o">}</code> <code class="k">yield</code> <code class="nc">StreamingResponse</code><code class="o">(</code><code class="n">input</code><code class="o">,</code>
    <code class="o">()</code> <code class="k">=&gt;</code> <code class="n">input</code><code class="o">.</code><code class="n">close</code><code class="o">,</code>
    <code class="n">file</code><code class="o">.</code><code class="n">length</code><code class="o">,</code>
    <code class="n">headers</code><code class="k">=</code><code class="nc">Nil</code><code class="o">,</code>
    <code class="n">cookies</code><code class="k">=</code><code class="nc">Nil</code><code class="o">,</code>
    <code class="mi">200</code><code class="o">)</code></pre>

<p>If no permission is given, the user is redirected to <em>/sorry.html</em>.</p>

<p>All of this is wired into Lift in <em>Boot.scala</em> with:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">dispatch</code><code class="o">.</code><code class="n">append</code><code class="o">(</code><code class="nc">DownloadService</code><code class="o">)</code></pre>
</section>













<section data-type="sect2" id="discussion-g0s1txCL">
<h2>Discussion</h2>

<p>By turning the request into a <code>Box[LiftResponse]</code>, we are able to serve
up the file, send the user to a different page, and also allow Lift to
handle the 404 (<code>Empty</code>) cases.<a data-type="indexterm" data-primary="404 (Empty) pages" id="id-ZbCnIMFMtZCJ"></a><a data-type="indexterm" data-primary="error messages" data-secondary="404 (Empty) pages" id="id-zdCbtGFDt2Cj"></a></p>

<p>If we added a test to see if the file existed on disk in <code>fileResponse</code>,
that would cause the method to evaluate to <code>Empty</code> for missing files,
which triggers a 404. As the code stands, if the file does not exist,
the <code>tryo</code> would give us a <code>Failure</code> that would turn into a 404 error
with a body of "/tmp/important (No such file or directory)."</p>

<p>Because we are testing for known resources via the <code>Known</code> extractor as
part of the pattern for <em>/download/</em>, unknown resources will not be
passed through to our <code>File</code> access code. Again, Lift will return a 404
for these.</p>

<p>Guard expressions can also be useful for these kinds of situations<a data-type="indexterm" data-primary="guard conditions" id="id-zdCxSyhDt2Cj"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">serve</code> <code class="o">{</code>
  <code class="k">case</code> <code class="s">"download"</code> <code class="o">::</code> <code class="nc">Known</code><code class="o">(</code><code class="n">id</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="nc">Get</code> <code class="k">_</code> <code class="k">if</code> <code class="n">permitted</code> <code class="k">=&gt;</code> <code class="n">fileResponse</code><code class="o">(</code><code class="n">id</code><code class="o">)</code>
  <code class="k">case</code> <code class="s">"download"</code> <code class="o">::</code> <code class="k">_</code> <code class="nc">Get</code> <code class="n">req</code> <code class="k">=&gt;</code> <code class="nc">RedirectResponse</code><code class="o">(</code><code class="s">"/sorry"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>You can mix and match extractors, guards, and conditions in your response
to best fit the way you want the code to look and work.</p>
</section>













<section data-type="sect2" id="see-also-q8sZhLCA">
<h2>See Also</h2>

<p><a href="http://bit.ly/179b986">Chapter 24: <em>Extractors</em></a> from <em>Programming in Scala</em>.</p>
</section>





</section>













<section data-type="sect1" id="RestrictByHeader">
<h1>Access Restriction by HTTP Header</h1>








<section data-type="sect2" id="problem-o8skF2s1">
<h2>Problem</h2>

<p>You need to control access to a page based on the value of an HTTP
header.<a data-type="indexterm" data-primary="request pipeline" data-secondary="HTTP header access restriction" id="id-4nCqSYFVF2sN"></a><a data-type="indexterm" data-primary="HTTP" data-secondary="header access restriction" id="id-JnCzFlFNF4sN"></a><a data-type="indexterm" data-primary="SiteMap" id="id-9nCrIvFpFzsp"></a><a data-type="indexterm" data-primary="S." data-secondary="request.map" id="id-ZbCPtMFXFJsJ"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2ImsL">
<h2>Solution</h2>

<p>Use a custom <code>If</code> in <code>SiteMap</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="nc">HeaderRequired</code> <code class="k">=</code> <code class="nc">If</code><code class="o">(</code>
  <code class="o">()</code> <code class="k">=&gt;</code> <code class="n">S</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">header</code><code class="o">(</code><code class="s">"ALLOWED"</code><code class="o">)</code> <code class="o">==</code> <code class="nc">Full</code><code class="o">(</code><code class="s">"YES"</code><code class="o">))</code> <code class="n">openOr</code> <code class="kc">false</code><code class="o">,</code>
  <code class="s">"Access not allowed"</code>
<code class="o">)</code>

<code class="c1">// Build SiteMap</code>
<code class="k">val</code> <code class="n">entries</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code>
  <code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"Header Required"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"header-required"</code> <code class="o">&gt;&gt;</code> <code class="nc">HeaderRequired</code>
<code class="o">)</code></pre>

<p>In this example, <em>header-required.html</em> can only be viewed if the request
includes an HTTP header called <code>ALLOWED</code> with a value of <code>YES</code>. Any other
request for the page will be redirected with a Lift error notice of
"Access not allowed."</p>

<p>This can be tested from the command line using a tool like cURL:</p>

<pre data-type="programlisting">$ curl http://127.0.0.1:8080/header-required.html -H "ALLOWED:YES"</pre>
</section>













<section data-type="sect2" id="discussion-q8svtPsA">
<h2>Discussion</h2>

<p>The <code>If</code> test ensures the <code>() =&gt; Boolean</code> function you supply as a first
argument returns <code>true</code> before the page it applies to is shown. In this example,
we’ll get <code>true</code> if the request contains a header called <code>ALLOWED</code>, and the optional
value of that header is <code>Full("YES")</code>.  This is a <code>LocParam</code> (location parameter)<a data-type="indexterm" data-primary="Location Parameters" id="id-x1C2iBFYtysr"></a><a data-type="indexterm" data-primary="locparam" id="id-PnCQu7FAtZsZ"></a> that
modifies the <code>SiteMap</code> item. It can be appended to any menu items you want using the <code>&gt;&gt;</code> method.</p>

<p>Note that without the header, the test will be false. This will mean links to the page will not appear in the
menu generated by <code>Menu.builder</code>.</p>

<p>The second argument to the <code>If()</code> is what Lift does if the test isn’t true when the user tries to access the page.  It’s
a <code>() =&gt; LiftResponse</code> function.  This means you can return whatever you
like, including redirects to other pages.  In the example, we are making use of a convenient implicit conversation
from a <code>String</code> ("Access not allowed") to a notice with a redirection that will take
the user to the home page.<a data-type="indexterm" data-primary="error messages" data-secondary="access not allowed" id="id-rjCwtNtxt9sm"></a><a data-type="indexterm" data-primary="access not allowed error message" id="id-wqCjh9tBtMsW"></a></p>

<p>If you visit the page without a header, you’ll
see a notice saying "Access not allowed." This will be the home page of the site, but
that’s just the default. You can request that Lift show a different page by setting <code>LiftRules.siteMapFailRedirectLocation</code> in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">siteMapFailRedirectLocation</code> <code class="k">=</code> <code class="s">"static"</code> <code class="o">::</code> <code class="s">"permission"</code> <code class="o">::</code> <code class="nc">Nil</code></pre>

<p>If you then try to access <em>header-required.html</em> without the header set, you’ll be redirected to <em>/static/permission</em> and shown the content of
whatever you put in that page.</p>
</section>













<section data-type="sect2" id="see-also-1Ls9hXsN">
<h2>See Also</h2>

<p><a href="https://www.assembla.com/wiki/show/liftweb/SiteMap">The Lift wiki</a> gives a summary of Lift’s <code>SiteMap</code> and the tests you can include in site map entries.</p>

<p>There are further details in <a href="http://exploring.liftweb.net">Chapter 7 of <em>Exploring Lift</em></a>, and "SiteMap and access control," Chapter 7 of <em>Lift in Action</em> (Perrett, 2012, Manning Publications, Co.).</p>

<p id="HttpServletRequest">Accessing HttpServletRequest
<sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub></p>
</section>













<section data-type="sect2" id="problem-YmsbTqsA">
<h2>Problem</h2>

<p>You have an API to call that requires access to the <code>HttpServletRequest</code>.<a data-type="indexterm" data-primary="request pipeline" data-secondary="HttpServletRequest access" id="id-yYCyFpFrTWs1"></a><a data-type="indexterm" data-primary="HttpServletRequest access" id="id-VMCQIrFmTBsr"></a><a data-type="indexterm" data-primary="S." data-secondary="request" id="id-rjCwtYFOT9sm"></a></p>
</section>













<section data-type="sect2" id="solution-vJsoc8sW">
<h2>Solution</h2>

<p>Cast <code>S.request</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.S</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.provider.servlet.HTTPRequestServlet</code>
<code class="k">import</code> <code class="nn">javax.servlet.http.HttpServletRequest</code>

<code class="k">def</code> <code class="n">servletRequest</code><code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">HttpServletRequest</code><code class="o">]</code> <code class="k">=</code> <code class="k">for</code> <code class="o">{</code>
  <code class="n">req</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">request</code>
  <code class="n">inner</code> <code class="k">&lt;-</code> <code class="nc">Box</code><code class="o">.</code><code class="n">asA</code><code class="o">[</code><code class="kt">HTTPRequestServlet</code><code class="o">](</code><code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">)</code>
<code class="o">}</code> <code class="k">yield</code> <code class="n">inner</code><code class="o">.</code><code class="n">req</code></pre>

<p>You can then make your API call:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">servletRequest</code><code class="o">.</code><code class="n">foreach</code> <code class="o">{</code> <code class="n">r</code> <code class="k">=&gt;</code> <code class="n">yourApiCall</code><code class="o">(</code><code class="n">r</code><code class="o">)</code> <code class="o">}</code></pre>
</section>













<section data-type="sect2" id="discussion-lqsDiwsk">
<h2>Discussion</h2>

<p>Lift abstracts away from the low-level HTTP request, and from the details of the
servlet container your application is running in.  However, it’s reassuring to know, if you
absolutely need it, there is a way to get back down to the low level.</p>

<p>Note that the results of <code>servletRequest</code> is a <code>Box</code>, because there might not be a request
when you evaluate <code>servletRequest</code>—or you might one day port to a
different deployment environment and not be running on a standard Java
servlet container.</p>

<p>As your code will have a direct dependency on the Java Servlet API,
you’ll need to include this dependency in your SBT build:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">"javax.servlet"</code> <code class="o">%</code> <code class="s">"servlet-api"</code> <code class="o">%</code> <code class="s">"2.5"</code> <code class="o">%</code> <code class="s">"provided"</code></pre>
</section>





</section>













<section data-type="sect1" id="RewriteForHttps">
<h1>Force HTTPS Requests</h1>








<section data-type="sect2" id="problem-g0swFwHL">
<h2>Problem</h2>

<p>You want to ensure clients are using HTTPS.<a data-type="indexterm" data-primary="request pipeline" data-secondary="forcing HTTPS use" id="id-JnCDSlFNFlHN"></a><a data-type="indexterm" data-primary="HTTPS use, forcing" id="id-9nCdFvFpFqHp"></a><a data-type="indexterm" data-primary="earlyResponse function" id="id-ZbCnIMFXFGHJ"></a></p>
</section>













<section data-type="sect2" id="solution-q8sGIBHA">
<h2>Solution</h2>

<p>Add an <code>earlyResponse</code> function in <em>Boot.scala</em> redirecting HTTP requests to HTTPS
equivalents. For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">earlyResponse</code><code class="o">.</code><code class="n">append</code> <code class="o">{</code> <code class="o">(</code><code class="n">req</code><code class="k">:</code> <code class="kt">Req</code><code class="o">)</code> <code class="k">=&gt;</code>
  <code class="k">if</code> <code class="o">(</code><code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">scheme</code> <code class="o">!=</code> <code class="s">"https"</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">val</code> <code class="n">uriAndQuery</code> <code class="k">=</code> <code class="n">req</code><code class="o">.</code><code class="n">uri</code> <code class="o">+</code>
     <code class="o">(</code><code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">queryString</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">s</code> <code class="k">=&gt;</code> <code class="s">"?"</code><code class="o">+</code><code class="n">s</code><code class="o">)</code> <code class="n">openOr</code> <code class="s">""</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">uri</code> <code class="k">=</code> <code class="s">"https://%s%s"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">serverName</code><code class="o">,</code> <code class="n">uriAndQuery</code><code class="o">)</code>
    <code class="nc">Full</code><code class="o">(</code><code class="nc">PermRedirectResponse</code><code class="o">(</code><code class="n">uri</code><code class="o">,</code> <code class="n">req</code><code class="o">,</code> <code class="n">req</code><code class="o">.</code><code class="n">cookies</code><code class="k">:</code> <code class="k">_</code><code class="kt">*</code><code class="o">))</code>
  <code class="o">}</code>
  <code class="k">else</code> <code class="nc">Empty</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="discussion-1LswtGHN">
<h2>Discussion</h2>

<p>The <code>earlyResponse</code> call is called early on in the Lift pipeline. It is
used to execute code before a request is handled and, if required, exit the
pipeline and return a response. The function signature expected is
<code>Req =&gt; Box[LiftResponse]</code>.</p>

<p>In this example, we are testing for a request that is not "https", and then
formulating a new URL that starts "https" and appends to it the rest of the
original URL and any query parameters. With this created, we return a redirection
to the new URL, along with any cookies that were set.</p>

<p>By evaluating to <code>Empty</code> for other requests (i.e., HTTPS requests), Lift will continue passing the request
through the pipeline as usual.</p>

<p>The ideal method to ensure requests are served using the correct scheme
would be via web server configuration, such as Apache or Nginx. This
isn’t possible in some cases, such as when your application is deployed
to a Platform as a Service (PaaS) such as CloudBees.</p>










<section data-type="sect3" id="amazon-load-balancer-NbsQT9t8HM">
<h3>Amazon Load Balancer</h3>

<p>For Amazon Elastic Load Balancer, note that you need to use an
<code>X-Forwarded-Proto</code> header to detect HTTPS. As mentioned in their
<a href="http://bit.ly/198LFoy"><em>Overview of Elastic Load Balancing</em> document</a>, "Your server access logs
contain only the protocol used between the server and the load balancer;
they contain no information about the protocol used between the client
and the load balancer."<a data-type="indexterm" data-primary="Amazon Elastic Load Balancer" id="id-PnCkI7F0TKtwHa"></a><a data-type="indexterm" data-primary="load balancers" id="id-OnCVtmFbTWtgHO"></a></p>

<p>In this situation, modify the test from
<code>req.request.scheme != "https"</code> to:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">req</code><code class="o">.</code><code class="n">header</code><code class="o">(</code><code class="s">"X-Forwarded-Proto"</code><code class="o">)</code> <code class="o">!=</code> <code class="nc">Full</code><code class="o">(</code><code class="s">"https"</code><code class="o">)</code></pre>
</section>













<section data-type="sect3" id="via-sitemap-8ksXcQtrHB">
<h3>Via SiteMap</h3>

<p>So far we’ve looked at redirecting all requests to HTTPS. If you only have a handful of pages to worry about, you can use a <em>custom location parameter</em><a data-type="indexterm" data-primary="Location Parameters" id="id-PnCxF7FxcKtwHa"></a><a data-type="indexterm" data-primary="locparam" id="id-OnCOImF7cWtgHO"></a> in <code>SiteMap</code> as an alternative:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">entries</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code>
  <code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"Home"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"index"</code><code class="o">,</code>
  <code class="nc">Menu</code><code class="o">.</code><code class="n">i</code><code class="o">(</code><code class="s">"Login"</code><code class="o">)</code> <code class="o">/</code> <code class="s">"login"</code> <code class="o">&gt;&gt;</code> <code class="nc">HttpsOnly</code>
<code class="o">)</code></pre>

<p>We have two locations and we’ve marked the login page as having to be over HTTPS.
<code>HttpsOnly</code> is the location parameter. It’s not built-in, but we can define it from the building
blocks included with Lift and the code we’ve already written:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="c1">// Given a request, turn it into a redirect to the HTTPS version of the page</code>
<code class="k">def</code> <code class="n">redirection</code><code class="o">(</code><code class="n">req</code><code class="k">:</code> <code class="kt">Req</code><code class="o">)</code> <code class="k">:</code> <code class="kt">LiftResponse</code> <code class="o">=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">uriAndQuery</code> <code class="k">=</code> <code class="n">req</code><code class="o">.</code><code class="n">uri</code> <code class="o">+</code>
    <code class="o">(</code><code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">queryString</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="n">s</code> <code class="k">=&gt;</code> <code class="s">"?"</code><code class="o">+</code><code class="n">s</code><code class="o">)</code> <code class="n">openOr</code> <code class="s">""</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">uri</code> <code class="k">=</code> <code class="s">"https://%s%s"</code><code class="o">.</code><code class="n">format</code><code class="o">(</code><code class="n">req</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">serverName</code><code class="o">,</code> <code class="n">uriAndQuery</code><code class="o">)</code>

  <code class="nc">PermRedirectResponse</code><code class="o">(</code><code class="n">uri</code><code class="o">,</code> <code class="n">req</code><code class="o">,</code> <code class="n">req</code><code class="o">.</code><code class="n">cookies</code><code class="k">:</code> <code class="k">_</code><code class="kt">*</code><code class="o">)</code>
<code class="o">}</code>

<code class="c1">// If the request is HTTP, give us a redirect to HTTPS</code>
<code class="k">def</code> <code class="n">httpsRedirect</code> <code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">LiftResponse</code><code class="o">]</code> <code class="k">=</code>
  <code class="k">for</code> <code class="o">{</code>
    <code class="n">req</code> <code class="k">&lt;-</code> <code class="n">S</code><code class="o">.</code><code class="n">request</code>
    <code class="n">scheme</code> <code class="k">&lt;-</code> <code class="n">req</code><code class="o">.</code><code class="n">header</code><code class="o">(</code><code class="s">"X-Forwarded-Proto"</code><code class="o">)</code>
    <code class="k">if</code> <code class="n">scheme</code> <code class="o">==</code> <code class="s">"http"</code>
  <code class="o">}</code> <code class="k">yield</code> <code class="n">redirection</code><code class="o">(</code><code class="n">req</code><code class="o">)</code>


<code class="k">val</code> <code class="nc">HttpsOnly</code> <code class="k">=</code> <code class="nc">TestAccess</code><code class="o">(</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="n">httpsRedirect</code> <code class="o">)</code></pre>

<p>A recap of what we want to happen: any menu item marked as <code>HttpsOnly</code> should redirect itself to HTTPS unless it already is HTTPS. We can use <code>TestAccess</code> to achieve this.  The function given to <code>TestAccess</code> must evaluate to a <code>Box[LiftResponse]</code>: if it’s <code>Empty</code>, the request carries on as normal; if it’s <code>Full</code>, the request is redirected to the contents of the box.</p>

<p>Our <code>HttpsOnly</code> implementation is to call <code>httpsRedirect</code>, where the for comprehension picks out the request, checks the scheme and only if it is "http" does it yield a <code>Full[LiftResponse]</code>.  That’s how HTTPS requests are allowed through (<code>httpsRedirect</code> evaluates to <code>Empty</code>) but HTTP request are turned into <code>Full[PermRedirectResponse]</code> and <code>TestAccess</code> performs the redirect.</p>

<p>It’s worth noting that this also works out conveniently for local development. If locally there’s no <code>X-Forwarded-Proto</code> header in the request, the HTTPS redirect won’t be triggered.  Of course that assumes the <code>X-Forwarded-Proto</code> checking works for you. If instead you’re using the <code>req.request.scheme</code> check, you might also want to make an exception for running in development mode (<code>Props.devMode</code> evaluates to <code>true</code> in development mode).</p>
</section>



</section>





</section>







</section>














<section data-type="chapter" id="Squeryl">
<h1>Relational Database Persistence with Record and Squeryl</h1>


<p>Squeryl is an object-relational mapping library.  It converts Scala classes into tables, rows, and columns in a relational database, and provides a way to write SQL-like queries that are type-checked by the Scala compiler. The Lift Squeryl Record module integrates Squeryl with Record, meaning your Lift application can use Squeryl to store and fetch data while making use of the features of Record, such as data validation.<a data-type="indexterm" data-primary="Squeryl Record module" id="id-bGCmS2FV"></a><a data-type="indexterm" data-primary="object-relational mapping" id="id-KnCdFeF7"></a><a data-type="indexterm" data-primary="Scala" data-secondary="relational database conversion" id="id-aeCNIEFN"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="Squeryl Record module" id="id-0nCbtGFd"></a><a data-type="indexterm" data-primary="SQL-like queries" id="id-LnCYhGFb"></a><a data-type="indexterm" data-primary="Record, configuration of" id="id-AnC1TZFl"></a><a data-type="indexterm" data-primary="Squeryl, configuring" id="id-W7CLcLFw"></a><a data-type="indexterm" id="ix_DBsrm" data-primary="database persistence" data-secondary="with Squeryl Record module"></a></p>

<p>The code in this chapter can be found at <a href="https://github.com/LiftCookbook/cookbook_squeryl"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_squeryl</em></a>.</p>






<section data-type="sect1" id="ConfiguringSqueryl">
<h1>Configuring Squeryl and Record</h1>








<section data-type="sect2" id="problem-xqsZF7tP">
<h2>Problem</h2>

<p>You want to configure your Lift application to use Squeryl and Record.<a data-type="indexterm" data-primary="Lift applications" data-secondary="Squeryl-Record configuration" data-seealso="Record-Squeryl Lift applications" id="id-LnC7SGFQF0tx"></a><a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="configuring" id="id-AnCDFZFvFXt9"></a></p>
</section>













<section data-type="sect2" id="solution-PaskIptK">
<h2>Solution</h2>

<p>Include the Squeryl-Record dependency in your build, and in <em>Boot.scala</em>, provide a database connection function to <code>SquerylRecord.initWithSquerylSession</code>.</p>

<p>For example, to configure Squeryl with PostgreSQL, modify <em>build.sbt</em> to add two dependencies, one for Squeryl-Record and one for the database driver:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">libraryDependencies</code> <code class="o">++=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="s">"2.5"</code>
  <code class="nc">Seq</code><code class="o">(</code>
    <code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-webkit"</code> <code class="o">%</code> <code class="n">liftVersion</code><code class="o">,</code>
    <code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-squeryl-record"</code> <code class="o">%</code> <code class="n">liftVersion</code><code class="o">,</code>
    <code class="s">"postgresql"</code> <code class="o">%</code> <code class="s">"postgresql"</code> <code class="o">%</code> <code class="s">"9.1-901.jdbc4"</code>
    <code class="o">...</code>
    <code class="o">)</code>
<code class="o">}</code></pre>

<p>In <em>Boot.scala</em>, we define a connection and register it with Squeryl:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Class</code><code class="o">.</code><code class="n">forName</code><code class="o">(</code><code class="s">"org.postgresql.Driver"</code><code class="o">)</code>

<code class="k">def</code> <code class="n">connection</code> <code class="k">=</code> <code class="nc">DriverManager</code><code class="o">.</code><code class="n">getConnection</code><code class="o">(</code>
  <code class="s">"jdbc:postgresql://localhost/mydb"</code><code class="o">,</code>
  <code class="s">"username"</code><code class="o">,</code> <code class="s">"password"</code><code class="o">)</code>

<code class="nc">SquerylRecord</code><code class="o">.</code><code class="n">initWithSquerylSession</code><code class="o">(</code>
  <code class="nc">Session</code><code class="o">.</code><code class="n">create</code><code class="o">(</code><code class="n">connection</code><code class="o">,</code> <code class="k">new</code> <code class="nc">PostgreSqlAdapter</code><code class="o">)</code> <code class="o">)</code></pre>

<p>All Squeryl queries need to run in the context of a transaction.  One way to provide a transaction is to configure
a transaction around all HTTP requests. This is also configured in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.RecordTypeMode._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.S</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.LoanWrapper</code>

<code class="n">S</code><code class="o">.</code><code class="n">addAround</code><code class="o">(</code><code class="k">new</code> <code class="nc">LoanWrapper</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">apply</code><code class="o">[</code><code class="kt">T</code><code class="o">](</code><code class="n">f</code><code class="k">:</code> <code class="o">=&gt;</code> <code class="n">T</code><code class="o">)</code><code class="k">:</code> <code class="kt">T</code> <code class="o">=</code> <code class="o">{</code>
    <code class="k">val</code> <code class="n">result</code> <code class="k">=</code> <code class="n">inTransaction</code> <code class="o">{</code>
      <code class="k">try</code> <code class="o">{</code>
        <code class="nc">Right</code><code class="o">(</code><code class="n">f</code><code class="o">)</code>
      <code class="o">}</code> <code class="k">catch</code> <code class="o">{</code>
        <code class="k">case</code> <code class="n">e</code><code class="k">:</code> <code class="kt">LiftFlowOfControlException</code> <code class="o">=&gt;</code> <code class="nc">Left</code><code class="o">(</code><code class="n">e</code><code class="o">)</code>
      <code class="o">}</code>
    <code class="o">}</code>

    <code class="n">result</code> <code class="k">match</code> <code class="o">{</code>
      <code class="k">case</code> <code class="nc">Right</code><code class="o">(</code><code class="n">r</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">r</code>
      <code class="k">case</code> <code class="nc">Left</code><code class="o">(</code><code class="n">exception</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="k">throw</code> <code class="n">exception</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">})</code></pre>

<p>This arranges for requests to be handled in the <code>inTransaction</code> scope. As Lift uses an exception for redirects, we catch this exception and throw it after the transaction completes, avoiding rollbacks after an <code>S.redirectTo</code> or similar.<a data-type="indexterm" data-primary="S." data-secondary="addAround" id="id-ZbCnIPukIrt2"></a><a data-type="indexterm" data-primary="S." data-secondary="redirectTo" id="id-zdCbtOupIxtn"></a></p>
</section>













<section data-type="sect2" id="discussion-OKsVtJtm">
<h2>Discussion</h2>

<p>You can use any JVM persistence mechanism with Lift. What Lift Record provides is a light interface around persistence with bindings to Lift’s CSS transforms, screens, and wizards. Squeryl-Record is a concrete implementation to connect Record with Squeryl.  This means you can use standard Record objects, which are effectively your schema, with Squeryl and write queries that are validated at compile time.<a data-type="indexterm" data-primary="JVM persistence mechanisms" id="id-W7CESLFAtXtQ"></a></p>

<p>Plugging into Squeryl means initialising Squeryl’s session management, which allows us to wrap queries in Squeryl’s <code>transaction</code> and <code>inTransaction</code> functions.  The difference between these two calls is that <code>inTransaction</code> will start a new transaction if one doesn’t exist, whereas <code>transaction</code> always creates a new transaction.</p>

<p>By ensuring a transaction is available for all HTTP requests via <code>addAround</code>, we can write queries in Lift, and for the most part, do not have to establish transactions ourselves unless we want to. For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.RecordTypeMode._</code>
<code class="k">val</code> <code class="n">r</code> <code class="k">=</code> <code class="n">myTable</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">MyRecord</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">myField</code><code class="o">(</code><code class="n">aValue</code><code class="o">))</code></pre>

<p>In this recipe, the <code>PostgreSqlAdapter</code> is used. Squeryl also supports: <code>OracleAdapter</code>, <code>MySQLInnoDBAdapter</code> and <code>MySQLAdapter</code>, <code>MSSQLServer</code>, <code>H2Adapter</code>, <code>DB2Adapter</code>, and <code>DerbyAdapter</code>.</p>
</section>













<section data-type="sect2" id="see-also-XQsXhLtq">
<h2>See Also</h2>

<p><a href="http://squeryl.org/getting-started.html">The Squeryl <em>Getting Started Guide</em></a> links to more information about session management and configuration.</p>

<p>See <a data-type="xref" href="#SquerylJNDI">Using a JNDI DataSource</a> for configuring connections via Java Naming and Directory Interface (JNDI).</p>
</section>





</section>













<section data-type="sect1" id="SquerylJNDI">
<h1>Using a JNDI DataSource</h1>








<section data-type="sect2" id="problem-PasxFwhK">
<h2>Problem</h2>

<p>You want to use a <em>Java Naming and Directory Interface</em> (JNDI) data source for your Record-Squeryl Lift
application.<a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="JNDI data sources for" id="id-W7CoFLFYFzhQ"></a><a data-type="indexterm" data-primary="Java Naming and Directory Interface (JNDI)" id="id-e4CxIJFZFvhp"></a></p>
</section>













<section data-type="sect2" id="solution-OKsOI9hm">
<h2>Solution</h2>

<p>In <em>Boot.scala</em>, call <code>initWithSquerylSession</code> with a <code>DataSource</code> looked up from the JNDI context<a data-type="indexterm" data-primary="initWithSquerylSession" id="id-DnCqtWFgI4hD"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">javax.sql.DataSource</code>
<code class="k">val</code> <code class="n">ds</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">InitialContext</code><code class="o">().</code>
  <code class="n">lookup</code><code class="o">(</code><code class="s">"java:comp/env/jdbc/mydb"</code><code class="o">).</code><code class="n">asInstanceOf</code><code class="o">[</code><code class="kt">DataSource</code><code class="o">]</code>

<code class="nc">SquerylRecord</code><code class="o">.</code><code class="n">initWithSquerylSession</code><code class="o">(</code>
  <code class="nc">Session</code><code class="o">.</code><code class="n">create</code><code class="o">(</code><code class="n">ds</code><code class="o">.</code><code class="n">getConnection</code><code class="o">(),</code> <code class="k">new</code> <code class="nc">MySQLAdapter</code><code class="o">)</code> <code class="o">)</code></pre>

<p>Replace <code>mydb</code> with the name given to your database in your JNDI
configuration, and replace <code>MySQLAdapter</code> with the appropriate adapter
for the database you are using.</p>
</section>













<section data-type="sect2" id="discussion-XQsbtMhq">
<h2>Discussion</h2>

<p>JNDI is a service provided by
the web container (e.g., Jetty, Tomcat) that allows you to
configure a database connection in the container and then refer to the
connection by name in your application. One advantage of this is that
you can avoid including database credentials to your Lift source base.<a data-type="indexterm" data-primary="web containers" id="id-e4CzSJFQtvhp"></a><a data-type="indexterm" data-primary="Jetty" id="id-GnCZFgFmtKhx"></a><a data-type="indexterm" data-primary="Tomcat" id="id-DnCXIWFvt4hD"></a><a data-type="indexterm" data-primary="databases" data-secondary="configuring connections to" id="id-kVCltpFDtZhb"></a></p>

<p>The configuration of JNDI is different for each container, and may vary
with versions of the container you use. The "See Also" section next includes
links to the documentation pages for popular containers.</p>

<p>Some environments may also require that you to reference the JNDI resource
in your <em>src/main/webapp/WEB-INF/web.xml</em> file:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true"><code class="nt">&lt;resource-ref&gt;</code>
 <code class="nt">&lt;res-ref-name&gt;</code>jdbc/mydb<code class="nt">&lt;/res-ref-name&gt;</code>
 <code class="nt">&lt;res-type&gt;</code>javax.sql.DataSource<code class="nt">&lt;/res-type&gt;</code>
 <code class="nt">&lt;res-auth&gt;</code>Container<code class="nt">&lt;/res-auth&gt;</code>
<code class="nt">&lt;/resource-ref&gt;</code></pre>
</section>













<section data-type="sect2" id="see-also-jWskhAhM">
<h2>See Also</h2>

<p>Resources for JNDI configuration include:</p>

<ul>
<li>
<p><a href="http://bit.ly/17MFWXB">An example on the Lift wiki</a> for Apache and Jetty configuration.</p>
</li>
<li>
<p><a href="http://bit.ly/11NjLfK">The documentation for Jetty</a> gives examples for various databases.</p>
</li>
<li>
<p>For Tomcat, see the <a href="http://bit.ly/19AhF7F">JNDI configuration guide</a>.</p>
</li>
</ul>
</section>





</section>













<section data-type="sect1" id="SquerylOneToMany">
<h1>One-to-Many Relationship</h1>








<section data-type="sect2" id="problem-OKsLFrTm">
<h2>Problem</h2>

<p>You want to model a one-to-many relationship, such as a satellite belonging to a single planet, but a planet possibly having many satellites.<a data-type="indexterm" id="ix_RSLAotmr" data-primary="Record-Squeryl Lift applications" data-secondary="one-to-many relationships in"></a><a data-type="indexterm" id="ix_otmr" data-primary="one-to-many relationships"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKIBTq">
<h2>Solution</h2>

<p>Use Squeryl’s <code>oneToManyRelation</code> in your schema, and on your Lift model, include a reference from the satellite to the planet.</p>

<p>The objective is to model the relationship as shown in <a data-type="xref" href="#SquerylPlanetOneToManyFigure">Figure 7-1</a>.</p>

<figure id="SquerylPlanetOneToManyFigure">
<img src="images/lfcb_0701.png" alt="lfcb 0701">
<figcaption><span class="label">Figure 7-1. </span>One planet may have many satellites, but a satellite orbits just one planet</figcaption>
</figure>

<p>In code:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.model</code>

<code class="k">import</code> <code class="nn">org.squeryl.Schema</code>
<code class="k">import</code> <code class="nn">net.liftweb.record.</code><code class="o">{</code><code class="nc">MetaRecord</code><code class="o">,</code> <code class="nc">Record</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.KeyedRecord</code>
<code class="k">import</code> <code class="nn">net.liftweb.record.field.</code><code class="o">{</code><code class="nc">StringField</code><code class="o">,</code> <code class="nc">LongField</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.RecordTypeMode._</code>

<code class="k">object</code> <code class="nc">MySchema</code> <code class="k">extends</code> <code class="nc">Schema</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">planets</code> <code class="k">=</code> <code class="n">table</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code>
  <code class="k">val</code> <code class="n">satellites</code> <code class="k">=</code> <code class="n">table</code><code class="o">[</code><code class="kt">Satellite</code><code class="o">]</code>

  <code class="k">val</code> <code class="n">planetToSatellites</code> <code class="k">=</code> <code class="n">oneToManyRelation</code><code class="o">(</code><code class="n">planets</code><code class="o">,</code> <code class="n">satellites</code><code class="o">).</code>
    <code class="n">via</code><code class="o">((</code><code class="n">p</code><code class="o">,</code><code class="n">s</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">p</code><code class="o">.</code><code class="n">id</code> <code class="o">===</code> <code class="n">s</code><code class="o">.</code><code class="n">planetId</code><code class="o">)</code>

  <code class="n">on</code><code class="o">(</code><code class="n">satellites</code><code class="o">)</code> <code class="o">{</code> <code class="n">s</code> <code class="k">=&gt;</code>
    <code class="n">declare</code><code class="o">(</code><code class="n">s</code><code class="o">.</code><code class="n">planetId</code> <code class="n">defineAs</code> <code class="n">indexed</code><code class="o">(</code><code class="s">"planet_idx"</code><code class="o">))</code>
  <code class="o">}</code>

  <code class="k">class</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Planet</code>
    <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code>
    <code class="k">lazy</code> <code class="k">val</code> <code class="n">satellites</code> <code class="k">=</code> <code class="nc">MySchema</code><code class="o">.</code><code class="n">planetToSatellites</code><code class="o">.</code><code class="n">left</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">object</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Planet</code> <code class="k">with</code> <code class="nc">MetaRecord</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code>

  <code class="k">class</code> <code class="nc">Satellite</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Satellite</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
     <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Satellite</code>
     <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
     <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code>
     <code class="k">val</code> <code class="n">planetId</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
     <code class="k">lazy</code> <code class="k">val</code> <code class="n">planet</code> <code class="k">=</code> <code class="nc">MySchema</code><code class="o">.</code><code class="n">planetToSatellites</code><code class="o">.</code><code class="n">right</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">object</code> <code class="nc">Satellite</code> <code class="k">extends</code> <code class="nc">Satellite</code> <code class="k">with</code> <code class="nc">MetaRecord</code><code class="o">[</code><code class="kt">Satellite</code><code class="o">]</code>
<code class="o">}</code></pre>

<p>This schema defines the two tables based on the Record classes, as <code>table[Planet]</code> and <code>table[Satellite]</code>. It establishes a <code>oneToManyRelation</code> based on (<code>via</code>) the <code>planetId</code> in the satellite table.</p>

<p>This gives Squeryl the information it needs to produce a foreign key to constrain the <code>planetId</code> to reference an existing record in the planet table. This can be seen in the schema generated by Squeryl.  We can print the schema in <em>Boot.scala</em> with:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">inTransaction</code> <code class="o">{</code>
  <code class="n">code</code><code class="o">.</code><code class="n">model</code><code class="o">.</code><code class="nc">MySchema</code><code class="o">.</code><code class="n">printDdl</code>
<code class="o">}</code></pre>

<p>which will print:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="c1">-- table declarations :</code>
<code class="k">create</code> <code class="k">table</code> <code class="n">Planet</code> <code class="p">(</code>
    <code class="n">name</code> <code class="nb">varchar</code><code class="p">(</code><code class="mi">256</code><code class="p">)</code> <code class="k">not</code> <code class="k">null</code><code class="p">,</code>
    <code class="n">idField</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code> <code class="k">primary</code> <code class="k">key</code> <code class="n">auto_increment</code>
  <code class="p">);</code>
<code class="k">create</code> <code class="k">table</code> <code class="n">Satellite</code> <code class="p">(</code>
    <code class="n">name</code> <code class="nb">varchar</code><code class="p">(</code><code class="mi">256</code><code class="p">)</code> <code class="k">not</code> <code class="k">null</code><code class="p">,</code>
    <code class="n">idField</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code> <code class="k">primary</code> <code class="k">key</code> <code class="n">auto_increment</code><code class="p">,</code>
    <code class="n">planetId</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code>
  <code class="p">);</code>
<code class="c1">-- indexes on Satellite</code>
<code class="k">create</code> <code class="k">index</code> <code class="n">planet_idx</code> <code class="k">on</code> <code class="n">Satellite</code> <code class="p">(</code><code class="n">planetId</code><code class="p">);</code>
<code class="c1">-- foreign key constraints :</code>
<code class="k">alter</code> <code class="k">table</code> <code class="n">Satellite</code> <code class="k">add</code> <code class="k">constraint</code> <code class="n">SatelliteFK1</code> <code class="k">foreign</code> <code class="k">key</code> <code class="p">(</code><code class="n">planetId</code><code class="p">)</code>
  <code class="k">references</code> <code class="n">Planet</code><code class="p">(</code><code class="n">idField</code><code class="p">);</code></pre>

<p>An index called <code>planet_idx</code> is declared on the <code>planetId</code> field to improve query performance during joins.</p>

<p>Finally, we make use of the <code>planetToSatellites.left</code> and <code>right</code> methods to establish lookup queries as <code>Planet.satellites</code> and <code>Satellite.planet</code>.  We can demonstrate their use by inserting example data and running the queries:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">inTransaction</code> <code class="o">{</code>
  <code class="n">code</code><code class="o">.</code><code class="n">model</code><code class="o">.</code><code class="nc">MySchema</code><code class="o">.</code><code class="n">create</code>

  <code class="k">import</code> <code class="nn">code.model.MySchema._</code>

  <code class="k">val</code> <code class="n">earth</code> <code class="k">=</code> <code class="n">planets</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Earth"</code><code class="o">))</code>
  <code class="k">val</code> <code class="n">mars</code> <code class="k">=</code> <code class="n">planets</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Mars"</code><code class="o">))</code>

  <code class="c1">// .save as a short-hand for satellite.insert when we don't need</code>
  <code class="c1">// to immediately reference the record (save returns Unit).</code>
  <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"The Moon"</code><code class="o">).</code><code class="n">planetId</code><code class="o">(</code><code class="n">earth</code><code class="o">.</code><code class="n">idField</code><code class="o">.</code><code class="n">is</code><code class="o">).</code><code class="n">save</code>
  <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Phobos"</code><code class="o">).</code><code class="n">planetId</code><code class="o">(</code><code class="n">mars</code><code class="o">.</code><code class="n">idField</code><code class="o">.</code><code class="n">is</code><code class="o">).</code><code class="n">save</code>

  <code class="k">val</code> <code class="n">deimos</code> <code class="k">=</code> <code class="n">satellites</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code>
    <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Deimos"</code><code class="o">).</code><code class="n">planetId</code><code class="o">(</code><code class="n">mars</code><code class="o">.</code><code class="n">idField</code><code class="o">.</code><code class="n">is</code><code class="o">)</code> <code class="o">)</code>

  <code class="n">println</code><code class="o">(</code><code class="s">"Deimos orbits: "</code><code class="o">+</code><code class="n">deimos</code><code class="o">.</code><code class="n">planet</code><code class="o">.</code><code class="n">single</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">is</code><code class="o">)</code>
  <code class="n">println</code><code class="o">(</code><code class="s">"Moons of Mars are: "</code><code class="o">+</code><code class="n">mars</code><code class="o">.</code><code class="n">satellites</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">is</code><code class="o">))</code>

<code class="o">}</code></pre>

<p>Running this code produces the output:</p>

<pre data-type="programlisting">Deimos orbits: Mars
Moons of Mars are: List(Phobos, Deimos)</pre>

<p>In this example code, we’re calling <code>deimos.planet.single</code>, which returns one result or will throw an exception if the associated planet was not found. <code>headOption</code> is the safer way if there’s a chance the record will not be found, as it will evaluate to <code>None</code> or <code>Some[Planet]</code>.</p>
</section>













<section data-type="sect2" id="discussion-jWsvt4TM">
<h2>Discussion</h2>

<p>The <code>planetToSatellites.left</code> method is not a simple collection of <code>Satellite</code> objects.  It’s a Squeryl <code>Query[Satellite]</code>, meaning you can treat it like any other kind of <code>Queryable[Satellite]</code>.  For example, we could ask for those satellites of a planet that are alphabetically after "E," which for Mars would match "Phobos":</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">mars</code><code class="o">.</code><code class="n">satellites</code><code class="o">.</code><code class="n">where</code><code class="o">(</code><code class="n">s</code> <code class="k">=&gt;</code> <code class="n">s</code><code class="o">.</code><code class="n">name</code> <code class="n">gt</code> <code class="s">"E"</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">name</code><code class="o">)</code></pre>

<p>The <code>left</code> method result is also a <code>OneToMany[Satellite]</code> that adds the following <span class="keep-together">methods:</span></p>
<dl>
<dt><code>assign</code></dt>
<dd>
<p>Adds a new relationship, but does not update the database</p>
</dd>
<dt><code>associate</code></dt>
<dd>
<p>Similar to <code>assign</code>, but updates the database</p>
</dd>
<dt><code>deleteAll</code></dt>
<dd>
<p>Removes the relationships</p>
</dd>
</dl>

<p>The <code>assign</code> call gives the satellite the relationship to the planet:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">express</code> <code class="k">=</code> <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Mars Express"</code><code class="o">)</code>
<code class="n">mars</code><code class="o">.</code><code class="n">satellites</code><code class="o">.</code><code class="n">assign</code><code class="o">(</code><code class="n">express</code><code class="o">)</code>
<code class="n">express</code><code class="o">.</code><code class="n">save</code></pre>

<p>The next time we query <code>mars.satellites</code>, we will find the <em>Mars Express</em> orbiter.</p>

<p>A call to <code>associate</code> would go one step further for us, making Squeryl insert or update the satellite automatically:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">express</code> <code class="k">=</code> <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Mars Express"</code><code class="o">)</code>
<code class="n">mars</code><code class="o">.</code><code class="n">satellites</code><code class="o">.</code><code class="n">associate</code><code class="o">(</code><code class="n">express</code><code class="o">)</code></pre>

<p>The third method, <code>deleteAll</code>, does what it sounds like it should do. It would execute the following SQL and return the number of rows removed:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="k">delete</code> <code class="k">from</code> <code class="n">Satellite</code></pre>

<p>The right side of the one-to-many also has additional methods added by <code>ManyToOne[Planet]</code> of <code>assign</code> and <code>delete</code>.  Be aware that to delete the "one" side of a many-to-one, anything assigned to the record will need to have been deleted already to avoid a database constraint error that would arise from, for example, leaving satellites referencing nonexistent planets.<a data-type="indexterm" data-primary="database constraint errors" id="id-OnCVtXHytPTO"></a><a data-type="indexterm" data-primary="error messages" data-secondary="database constraint errors" id="id-XmCXhoHytvTO"></a></p>

<p>As <code>left</code> and <code>right</code> are queries, it means each time you use them you’ll be sending a new query to the database.  Squeryl refers to these forms as <em>stateless relations</em>.</p>

<p>The <em>stateful</em> versions of <code>left</code> and <code>right</code> look like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
 <code class="o">...</code>
 <code class="k">lazy</code> <code class="k">val</code> <code class="n">satellites</code> <code class="k">:</code> <code class="kt">StatefulOneToMany</code><code class="o">[</code><code class="kt">Satellite</code><code class="o">]</code> <code class="k">=</code>
   <code class="nc">MySchema</code><code class="o">.</code><code class="n">planetToSatellites</code><code class="o">.</code><code class="n">leftStateful</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">class</code> <code class="nc">Satellite</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Satellite</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
  <code class="o">...</code>
  <code class="k">lazy</code> <code class="k">val</code> <code class="n">planet</code> <code class="k">:</code> <code class="kt">StatefulManyToOne</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="k">=</code>
    <code class="nc">MySchema</code><code class="o">.</code><code class="n">planetToSatellites</code><code class="o">.</code><code class="n">rightStateful</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>This change means the results of <code>mars.satellites</code> will be cached. Subsequent calls on that instance of a <code>Planet</code> won’t trigger a round trip to the database. You can still <code>associate</code> new records or <code>deleteAll</code> records, which will work as you expect, but if a relationship is added or changed elsewhere you’ll need to call <code>refresh</code> on the relation to see the change.</p>

<p>Which version should you use? That will depend on your application, but you can use both in the same record if you need to.</p>
</section>













<section data-type="sect2" id="see-also-2ksZhrT8">
<h2>See Also</h2>

<p><a href="http://bit.ly/163FgJv">The Squeryl Relations page</a> provides additional details.<a data-type="indexterm" data-startref="ix_otmr" id="id-kVCEFpFQh4Tb"></a><a data-type="indexterm" data-startref="ix_RSLAotmr" id="id-4nCkIYFkhXTD"></a></p>
</section>





</section>













<section data-type="sect1" id="SquerylManyToMany">
<h1>Many-to-Many Relationship</h1>








<section data-type="sect2" id="problem-XQspFpcq">
<h2>Problem</h2>

<p>You want to model a many-to-many relationship, such as a planet being visited by many space probes, but a space probe also visiting many planets.</p>
</section>













<section data-type="sect2" id="solution-jWsjIlcM">
<h2>Solution</h2>

<p>Use Squeryl’s <code>manyToManyRelation</code> in your schema, and implement a record to hold the join between the two sides of the relationship. <a data-type="xref" href="#SquerylPlanetManyToManyFigure">Figure 7-2</a> shows the structure we will create in this recipe, where <code>Visit</code> is the record that will connect each many to the other many.<a data-type="indexterm" id="ix_RSLAmtmr" data-primary="Record-Squeryl Lift applications" data-secondary="many-to-many relationships in"></a><a data-type="indexterm" id="ix_mtmr" data-primary="many-to-many relationships"></a></p>

<figure id="SquerylPlanetManyToManyFigure">
<img src="images/lfcb_0702.png" alt="lfcb 0702">
<figcaption><span class="label">Figure 7-2. </span>Many-to-many: Jupiter was visited by Juno and Voyager 1; Saturn was only visited by Voyager 1</figcaption>
</figure>

<p>The schema is defined in terms of two tables, one for planets and one for space probes, plus a relationship between the two based on a third class, called <code>Visit</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.model</code>

<code class="k">import</code> <code class="nn">org.squeryl.Schema</code>
<code class="k">import</code> <code class="nn">net.liftweb.record.</code><code class="o">{</code><code class="nc">MetaRecord</code><code class="o">,</code> <code class="nc">Record</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.KeyedRecord</code>
<code class="k">import</code> <code class="nn">net.liftweb.record.field.</code><code class="o">{</code><code class="nc">IntField</code><code class="o">,</code> <code class="nc">StringField</code><code class="o">,</code> <code class="nc">LongField</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.RecordTypeMode._</code>
<code class="k">import</code> <code class="nn">org.squeryl.dsl.ManyToMany</code>

<code class="k">object</code> <code class="nc">MySchema</code> <code class="k">extends</code> <code class="nc">Schema</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">planets</code> <code class="k">=</code> <code class="n">table</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code>
  <code class="k">val</code> <code class="n">probes</code> <code class="k">=</code> <code class="n">table</code><code class="o">[</code><code class="kt">Probe</code><code class="o">]</code>

  <code class="k">val</code> <code class="n">probeVisits</code> <code class="k">=</code> <code class="n">manyToManyRelation</code><code class="o">(</code><code class="n">probes</code><code class="o">,</code> <code class="n">planets</code><code class="o">).</code><code class="n">via</code><code class="o">[</code><code class="kt">Visit</code><code class="o">]</code> <code class="o">{</code>
    <code class="o">(</code><code class="n">probe</code><code class="o">,</code> <code class="n">planet</code><code class="o">,</code> <code class="n">visit</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="o">(</code><code class="n">visit</code><code class="o">.</code><code class="n">probeId</code> <code class="o">===</code> <code class="n">probe</code><code class="o">.</code><code class="n">id</code><code class="o">,</code> <code class="n">visit</code><code class="o">.</code><code class="n">planetId</code> <code class="o">===</code> <code class="n">planet</code><code class="o">.</code><code class="n">id</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">class</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Planet</code>
    <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code>
    <code class="k">lazy</code> <code class="k">val</code> <code class="n">probes</code> <code class="k">:</code> <code class="kt">ManyToMany</code><code class="o">[</code><code class="kt">Probe</code>,<code class="kt">Visit</code><code class="o">]</code> <code class="k">=</code>
      <code class="nc">MySchema</code><code class="o">.</code><code class="n">probeVisits</code><code class="o">.</code><code class="n">right</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">object</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Planet</code> <code class="k">with</code> <code class="nc">MetaRecord</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code>

  <code class="k">class</code> <code class="nc">Probe</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Probe</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Probe</code>
    <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code>
    <code class="k">lazy</code> <code class="k">val</code> <code class="n">planets</code> <code class="k">:</code> <code class="kt">ManyToMany</code><code class="o">[</code><code class="kt">Planet</code>,<code class="kt">Visit</code><code class="o">]</code> <code class="k">=</code>
      <code class="nc">MySchema</code><code class="o">.</code><code class="n">probeVisits</code><code class="o">.</code><code class="n">left</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">object</code> <code class="nc">Probe</code> <code class="k">extends</code> <code class="nc">Probe</code> <code class="k">with</code> <code class="nc">MetaRecord</code><code class="o">[</code><code class="kt">Probe</code><code class="o">]</code>

  <code class="k">class</code> <code class="nc">Visit</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Visit</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Visit</code>
    <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">planetId</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
    <code class="k">val</code> <code class="n">probeId</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="o">}</code>

  <code class="k">object</code> <code class="nc">Visit</code> <code class="k">extends</code> <code class="nc">Visit</code> <code class="k">with</code> <code class="nc">MetaRecord</code><code class="o">[</code><code class="kt">Visit</code><code class="o">]</code>
<code class="o">}</code></pre>

<p>In <em>Boot.scala</em>, we can print out this schema:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">inTransaction</code> <code class="o">{</code>
  <code class="n">code</code><code class="o">.</code><code class="n">model</code><code class="o">.</code><code class="nc">MySchema</code><code class="o">.</code><code class="n">printDdl</code>
<code class="o">}</code></pre>

<p>which will produce something like this, depending on the database in use:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="c1">-- table declarations :</code>
<code class="k">create</code> <code class="k">table</code> <code class="n">Planet</code> <code class="p">(</code>
    <code class="n">name</code> <code class="nb">varchar</code><code class="p">(</code><code class="mi">256</code><code class="p">)</code> <code class="k">not</code> <code class="k">null</code><code class="p">,</code>
    <code class="n">idField</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code> <code class="k">primary</code> <code class="k">key</code> <code class="n">auto_increment</code>
  <code class="p">);</code>
<code class="k">create</code> <code class="k">table</code> <code class="n">Probe</code> <code class="p">(</code>
    <code class="n">name</code> <code class="nb">varchar</code><code class="p">(</code><code class="mi">256</code><code class="p">)</code> <code class="k">not</code> <code class="k">null</code><code class="p">,</code>
    <code class="n">idField</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code> <code class="k">primary</code> <code class="k">key</code> <code class="n">auto_increment</code>
  <code class="p">);</code>
<code class="k">create</code> <code class="k">table</code> <code class="n">Visit</code> <code class="p">(</code>
    <code class="n">idField</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code> <code class="k">primary</code> <code class="k">key</code> <code class="n">auto_increment</code><code class="p">,</code>
    <code class="n">planetId</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code><code class="p">,</code>
    <code class="n">probeId</code> <code class="nb">bigint</code> <code class="k">not</code> <code class="k">null</code>
  <code class="p">);</code>
<code class="c1">-- foreign key constraints :</code>
<code class="k">alter</code> <code class="k">table</code> <code class="n">Visit</code> <code class="k">add</code> <code class="k">constraint</code> <code class="n">VisitFK1</code> <code class="k">foreign</code> <code class="k">key</code> <code class="p">(</code><code class="n">probeId</code><code class="p">)</code>
  <code class="k">references</code> <code class="n">Probe</code><code class="p">(</code><code class="n">idField</code><code class="p">);</code>
<code class="k">alter</code> <code class="k">table</code> <code class="n">Visit</code> <code class="k">add</code> <code class="k">constraint</code> <code class="n">VisitFK2</code> <code class="k">foreign</code> <code class="k">key</code> <code class="p">(</code><code class="n">planetId</code><code class="p">)</code>
  <code class="k">references</code> <code class="n">Planet</code><code class="p">(</code><code class="n">idField</code><code class="p">);</code></pre>

<p>Notice that the <code>visit</code> table will hold a row for each relationship between a <code>planetId</code> and <code>probeId</code>.</p>

<p><code>Planet.probes</code> and <code>Probe.planets</code> provide an <code>associate</code> method to establish a new relationship. For example, we can establish a set of planets and probes:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">jupiter</code> <code class="k">=</code> <code class="n">planets</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Jupiter"</code><code class="o">))</code>
<code class="k">val</code> <code class="n">saturn</code> <code class="k">=</code> <code class="n">planets</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Saturn"</code><code class="o">))</code>
<code class="k">val</code> <code class="n">juno</code> <code class="k">=</code> <code class="n">probes</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Probe</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Juno"</code><code class="o">))</code>
<code class="k">val</code> <code class="n">voyager1</code> <code class="k">=</code> <code class="n">probes</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Probe</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Voyager 1"</code><code class="o">))</code></pre>

<p>and then connect them:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">juno</code><code class="o">.</code><code class="n">planets</code><code class="o">.</code><code class="n">associate</code><code class="o">(</code><code class="n">jupiter</code><code class="o">)</code>
<code class="n">voyager1</code><code class="o">.</code><code class="n">planets</code><code class="o">.</code><code class="n">associate</code><code class="o">(</code><code class="n">jupiter</code><code class="o">)</code>
<code class="n">voyager1</code><code class="o">.</code><code class="n">planets</code><code class="o">.</code><code class="n">associate</code><code class="o">(</code><code class="n">saturn</code><code class="o">)</code></pre>

<p>We can also use <code>Probe.planets</code> and <code>Planet.probes</code> as a query to look up the associations.  To access all the probes that had visited each planet in a snippet, we can write this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">class</code> <code class="nc">ManyToManySnippet</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code>
    <code class="s">"#planet-visits"</code> <code class="o">#&gt;</code> <code class="n">planets</code><code class="o">.</code><code class="n">map</code> <code class="o">{</code> <code class="n">planet</code> <code class="k">=&gt;</code>
      <code class="s">".planet-name *"</code> <code class="o">#&gt;</code> <code class="n">planet</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">is</code> <code class="o">&amp;</code>
      <code class="s">".probe-name *"</code> <code class="o">#&gt;</code> <code class="n">planet</code><code class="o">.</code><code class="n">probes</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">is</code><code class="o">)</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>The snippet could be combined with a template like this:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"ManyToManySnippet"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;h1&gt;</code>Planet facts<code class="nt">&lt;/h1&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"planet-visits"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;p&gt;</code>
      <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"planet-name"</code><code class="nt">&gt;</code>Name will be here<code class="nt">&lt;/span&gt;</code> was visited by:
    <code class="nt">&lt;/p&gt;</code>
    <code class="nt">&lt;ul&gt;</code>
      <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"probe-name"</code><code class="nt">&gt;</code>Probe name goes here<code class="nt">&lt;/li&gt;</code>
    <code class="nt">&lt;/ul&gt;</code>
  <code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>The top half of <a data-type="xref" href="#SquerylManyToManyScreengrab">Figure 7-3</a> gives an example of the output from this snippet and template.</p>
</section>













<section data-type="sect2" id="discussion-2ksLtBc8">
<h2>Discussion</h2>

<p>The Squeryl DSL <code>manyToManyRelation(probes, planets).via[Visit]</code> is the core element here connecting our <code>Planet</code>, <code>Probe</code>, and <code>Visit</code> records together. It allows us to access the "left" and "right" sides of the relationship in our model as <code>Probe.planets</code> and <code>Planet.probes</code>.</p>

<p>As with <a data-type="xref" href="#SquerylOneToMany">One-to-Many Relationship</a> for one-to-many relationships, the left and right sides are queries. When you ask for <code>Planet.probes</code>, the database is queried appropriately with a join on the <code>Visit</code> records:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="k">Select</code>
  <code class="n">Probe</code><code class="p">.</code><code class="n">name</code><code class="p">,</code>
  <code class="n">Probe</code><code class="p">.</code><code class="n">idField</code>
<code class="k">From</code>
  <code class="n">Visit</code><code class="p">,</code>
  <code class="n">Probe</code>
<code class="k">Where</code>
  <code class="p">(</code><code class="n">Visit</code><code class="p">.</code><code class="n">probeId</code> <code class="o">=</code> <code class="n">Probe</code><code class="p">.</code><code class="n">idField</code><code class="p">)</code> <code class="k">and</code> <code class="p">(</code><code class="n">Visit</code><code class="p">.</code><code class="n">planetId</code> <code class="o">=</code> <code class="o">?</code><code class="p">)</code></pre>

<p>Also as described in <a data-type="xref" href="#SquerylOneToMany">One-to-Many Relationship</a>, there are stateful variants of <code>left</code> and <code>right</code> to cache the query results.</p>

<p>In the data we inserted into the database, we did not have to mention <code>Visit</code>. The Squeryl <code>manyToManyRelation</code> has enough information to know how to insert a visit as the relationship.  Incidentally, it doesn’t matter which way round we make the calls in a many-to-many relationship.  The following two expressions are equivalent and result in the same database structure:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">juno</code><code class="o">.</code><code class="n">planets</code><code class="o">.</code><code class="n">associate</code><code class="o">(</code><code class="n">jupiter</code><code class="o">)</code>
<code class="c1">// ..or..</code>
<code class="n">jupiter</code><code class="o">.</code><code class="n">probes</code><code class="o">.</code><code class="n">associate</code><code class="o">(</code><code class="n">juno</code><code class="o">)</code></pre>

<p>You might even wonder why we had to bother with defining a <code>Visit</code> record at all, but there are benefits in doing so. For example, you can attach additional information onto the join table, such as the year the probe visited a planet.</p>

<p>To do this, we modify the record to include the additional field:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">Visit</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Visit</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Visit</code>
  <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">planetId</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">probeId</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">year</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">IntField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
<code class="o">}</code></pre>

<p><code>Visit</code> is still a container for the <code>planetId</code> and <code>probeId</code> references, but we also have a plain integer holder for the year of the visit.</p>

<p>To record a visit year, we need the <code>assign</code> method provided by <code>ManyToMany[T]</code>.  This will establish the relationship but not change the database. Instead, it returns the instance <code>Visit</code>, which we can change and then store in the database:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">probeVisits</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="n">voyager1</code><code class="o">.</code><code class="n">planets</code><code class="o">.</code><code class="n">assign</code><code class="o">(</code><code class="n">saturn</code><code class="o">).</code><code class="n">year</code><code class="o">(</code><code class="mi">1980</code><code class="o">))</code></pre>

<p>The return type of <code>assign</code> in this case is <code>Visit</code>, and <code>Visit</code> has a <code>year</code> field. Inserting the <code>Visit</code> record via <code>probeVisits</code> will create a row in the table for visits.</p>

<p>To access this extra information on the <code>Visit</code> object, you can make use of a couple of methods provided by <code>ManyToMany[T]</code>:</p>
<dl>
<dt><code>associations</code></dt>
<dd>
<p>A query returning the <code>Visit</code> objects related to the <code>Planet.probes</code> or <code>Probe.planets</code></p>
</dd>
<dt><code>associationMap</code></dt>
<dd>
<p>A query returning pairs of <code>(Planet,Visit)</code> or <code>(Probe,Visit)</code>, depending on which side of the join you call it on (<code>probes</code> or <code>planets</code>)</p>
</dd>
</dl>

<p>For example, in a snippet, we could list all the space probes and, for each probe, show the planet it visited and what year it was there.  The snippet would look like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">"#probe-visits"</code> <code class="o">#&gt;</code> <code class="n">probes</code><code class="o">.</code><code class="n">map</code> <code class="o">{</code> <code class="n">probe</code> <code class="k">=&gt;</code>
  <code class="s">".probe-name *"</code> <code class="o">#&gt;</code> <code class="n">probe</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">is</code> <code class="o">&amp;</code>
  <code class="s">".visit"</code> <code class="o">#&gt;</code> <code class="n">probe</code><code class="o">.</code><code class="n">planets</code><code class="o">.</code><code class="n">associationMap</code><code class="o">.</code><code class="n">collect</code> <code class="o">{</code>
    <code class="k">case</code> <code class="o">(</code><code class="n">planet</code><code class="o">,</code> <code class="n">visit</code><code class="o">)</code> <code class="k">=&gt;</code>
      <code class="s">".planet-name *"</code> <code class="o">#&gt;</code> <code class="n">planet</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">is</code> <code class="o">&amp;</code>
      <code class="s">".year"</code> <code class="o">#&gt;</code> <code class="n">visit</code><code class="o">.</code><code class="n">year</code><code class="o">.</code><code class="n">is</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>We are using <code>collect</code> here rather than <code>map</code> just to match the <code>(Planet,Visit)</code> tuple and give the values meaningful names. You could also use <code>(for { (planet, visit) &lt;- probe.planets.associationMap } yield ...)</code> if you prefer.</p>

<p>The lower half of <a data-type="xref" href="#SquerylManyToManyScreengrab">Figure 7-3</a> demonstrates how this snippet would render when combined with the following template:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;h1&gt;</code>Probe facts<code class="nt">&lt;/h1&gt;</code>

<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"probe-visits"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;p&gt;&lt;span</code> <code class="na">class=</code><code class="s">"probe-name"</code><code class="nt">&gt;</code>Space craft name<code class="nt">&lt;/span&gt;</code> visited:<code class="nt">&lt;/p&gt;</code>
  <code class="nt">&lt;ul&gt;</code>
    <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"visit"</code><code class="nt">&gt;</code>
      <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"planet-name"</code><code class="nt">&gt;</code>Name here<code class="nt">&lt;/span&gt;</code> in <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"year"</code><code class="nt">&gt;</code>n<code class="nt">&lt;/span&gt;</code>
    <code class="nt">&lt;/li&gt;</code>
  <code class="nt">&lt;/ul&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<figure id="SquerylManyToManyScreengrab">
<img src="images/lfcb_0703.png" alt="lfcb 0703">
<figcaption><span class="label">Figure 7-3. </span>Example output from using the many-to-many features in this recipe</figcaption>
</figure>

<p>To remove an association, use the <code>dissociate</code> or <code>dissociateAll</code> methods on the <code>left</code> or <code>right</code> queries. To remove a single association<a data-type="indexterm" data-primary="associations, removing" id="id-nxClhGuxtDcM"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">numRowsChanged</code> <code class="k">=</code> <code class="n">juno</code><code class="o">.</code><code class="n">planets</code><code class="o">.</code><code class="n">dissociate</code><code class="o">(</code><code class="n">jupiter</code><code class="o">)</code></pre>

<p>This would be executed in SQL as:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="k">delete</code> <code class="k">from</code> <code class="n">Visit</code>
<code class="k">where</code>
  <code class="n">probeId</code> <code class="o">=</code> <code class="o">?</code> <code class="k">and</code> <code class="n">planetId</code> <code class="o">=</code> <code class="o">?</code></pre>

<p>To remove all the associations:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">numRowsChanged</code> <code class="k">=</code> <code class="n">jupiter</code><code class="o">.</code><code class="n">probes</code><code class="o">.</code><code class="n">dissociateAll</code></pre>

<p>The SQL for this is:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="k">delete</code> <code class="k">from</code> <code class="n">Visit</code>
<code class="k">where</code>
  <code class="n">Visit</code><code class="p">.</code><code class="n">planetId</code> <code class="o">=</code> <code class="o">?</code></pre>

<p>What you cannot do is delete a <code>Planet</code> or <code>Probe</code> if that record still has associations in the <code>Visit</code> relationship.  What you’d get is a referential integrity exception thrown.  Instead, you’ll need to <code>dissociateAll</code> first<a data-type="indexterm" data-primary="referential integrity exception" id="id-EnCxhzImtycp"></a><a data-type="indexterm" data-primary="error messages" data-secondary="referential integrity exception" id="id-QnCNT2IytvcO"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">jupiter</code><code class="o">.</code><code class="n">probes</code><code class="o">.</code><code class="n">dissociateAll</code>
<code class="n">planets</code><code class="o">.</code><code class="n">delete</code><code class="o">(</code><code class="n">jupiter</code><code class="o">.</code><code class="n">id</code><code class="o">)</code></pre>

<p>However, if you do want <em>cascading deletes</em>, you can achieve this by overriding the default behaviour in your schema:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="c1">// To automatically remove probes when we remove planets:</code>
<code class="n">probeVisits</code><code class="o">.</code><code class="n">rightForeignKeyDeclaration</code><code class="o">.</code><code class="n">constrainReference</code><code class="o">(</code><code class="n">onDelete</code> <code class="n">cascade</code><code class="o">)</code>

<code class="c1">// To automatically remove planets when we remove probes:</code>
<code class="n">probeVisits</code><code class="o">.</code><code class="n">leftForeignKeyDeclaration</code><code class="o">.</code><code class="n">constrainReference</code><code class="o">(</code><code class="n">onDelete</code> <code class="n">cascade</code><code class="o">)</code></pre>

<p>This is part of the schema, in that it will change the table constraints, with <code>printDdl</code> producing this (depending on the database you use)<a data-type="indexterm" data-startref="ix_RSLAmtmr" id="id-QnCPFqcytvcO"></a><a data-type="indexterm" data-startref="ix_mtmr" id="id-bGCrIncotpcl"></a>:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="k">alter</code> <code class="k">table</code> <code class="n">Visit</code> <code class="k">add</code> <code class="k">constraint</code> <code class="n">VisitFK1</code> <code class="k">foreign</code> <code class="k">key</code> <code class="p">(</code><code class="n">probeId</code><code class="p">)</code>
  <code class="k">references</code> <code class="n">Probe</code><code class="p">(</code><code class="n">idField</code><code class="p">)</code> <code class="k">on</code> <code class="k">delete</code> <code class="k">cascade</code><code class="p">;</code>

<code class="k">alter</code> <code class="k">table</code> <code class="n">Visit</code> <code class="k">add</code> <code class="k">constraint</code> <code class="n">VisitFK2</code> <code class="k">foreign</code> <code class="k">key</code> <code class="p">(</code><code class="n">planetId</code><code class="p">)</code>
  <code class="k">references</code> <code class="n">Planet</code><code class="p">(</code><code class="n">idField</code><code class="p">)</code> <code class="k">on</code> <code class="k">delete</code> <code class="k">cascade</code><code class="p">;</code></pre>
</section>













<section data-type="sect2" id="see-also-pWsJhKcj">
<h2>See Also</h2>

<p><a data-type="xref" href="#SquerylOneToMany">One-to-Many Relationship</a>, on one-to-many relationships, discusses <code>leftStateful</code> and <code>rightStateful</code> relations, which are also applicable for many-to-many relationships.</p>

<p>Foreign keys and cascading deletes are described on the <a href="http://squeryl.org/relations.html">Squeryl Relations page</a>.</p>
</section>





</section>













<section data-type="sect1" id="FieldValidation">
<h1>Adding Validation to a Field</h1>








<section data-type="sect2" id="problem-jWslFviM">
<h2>Problem</h2>

<p>You want to add validation to a field in your model, so that users are informed of missing fields or fields that aren’t acceptable to your application.<a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="field validation in" id="id-GnCJSgFbFeix"></a><a data-type="indexterm" data-primary="validation" id="id-DnCaFWFwFziD"></a><a data-type="indexterm" data-primary="field validation" id="id-kVCAIpFLF7ib"></a><a data-type="indexterm" data-primary="forms processing" data-secondary="field validation" id="id-4nCPtYFVF7iD"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIai8">
<h2>Solution</h2>

<p>Override the <code>validations</code> method on your field and provide one or more validation functions.</p>

<p>As an example, imagine we have a database of planets and we want to ensure any new planets entered by users have names of at least five characters.  We add this as a validation on our record:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"> <code class="k">class</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code>   <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Planet</code>
    <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>

    <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code> <code class="o">{</code>
      <code class="k">override</code> <code class="k">def</code> <code class="n">validations</code> <code class="k">=</code>
        <code class="n">valMinLen</code><code class="o">(</code><code class="mi">5</code><code class="o">,</code> <code class="s">"Name too short"</code><code class="o">)</code> <code class="k">_</code> <code class="o">::</code> <code class="k">super</code><code class="o">.</code><code class="n">validations</code>
    <code class="o">}</code>
  <code class="o">}</code></pre>

<p>To check the validation, in our snippet we call <code>validate</code> on the record, which will return all the errors for the record:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code</code>
<code class="k">package</code> <code class="nn">snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="n">S</code><code class="o">,</code><code class="nc">SHtml</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="k">import</code> <code class="nn">model.MySchema._</code>

<code class="k">class</code> <code class="nc">ValidateSnippet</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>

    <code class="k">val</code> <code class="n">newPlanet</code> <code class="k">=</code> <code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code>

    <code class="k">def</code> <code class="n">validateAndSave</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="n">newPlanet</code><code class="o">.</code><code class="n">validate</code> <code class="k">match</code> <code class="o">{</code>
      <code class="k">case</code> <code class="nc">Nil</code> <code class="k">=&gt;</code>
        <code class="n">planets</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="n">newPlanet</code><code class="o">)</code>
        <code class="n">S</code><code class="o">.</code><code class="n">notice</code><code class="o">(</code><code class="s">"Planet '%s' saved"</code> <code class="n">format</code> <code class="n">newPlanet</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">is</code><code class="o">)</code>

      <code class="k">case</code> <code class="n">errors</code> <code class="k">=&gt;</code>
        <code class="n">S</code><code class="o">.</code><code class="n">error</code><code class="o">(</code><code class="n">errors</code><code class="o">)</code>
    <code class="o">}</code>

    <code class="s">"#planetName"</code> <code class="o">#&gt;</code> <code class="n">newPlanet</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">toForm</code> <code class="o">&amp;</code>
    <code class="s">"type=submit"</code> <code class="o">#&gt;</code> <code class="nc">SHtml</code><code class="o">.</code><code class="n">onSubmitUnit</code><code class="o">(</code><code class="n">validateAndSave</code><code class="o">)</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>When the snippet runs, we render the <code>Planet.name</code> field and wire up a submit button to call the <code>validateAndSave</code> method.<a data-type="indexterm" data-primary="S." data-secondary="notice" id="id-yYCrIXcaIOiy"></a><a data-type="indexterm" data-primary="S." data-secondary="error" id="id-VMC2tlc9IQiY"></a></p>

<p>If the <code>newPlanet.validate</code> call indicates there are no errors (<code>Nil</code>), we can save the record and inform the user via a notice.  If there are errors, we render all of them with <code>S.error</code>.</p>

<p>The corresponding template could be:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;</code>
  <code class="nt">&lt;title&gt;</code>Planet Name Validation<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">data-lift-content-id=</code><code class="s">"main"</code><code class="nt">&gt;</code>
<code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"main"</code> <code class="na">data-lift=</code><code class="s">"surround?with=default;at=content"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;h1&gt;</code>Add a planet<code class="nt">&lt;/h1&gt;</code>

  <code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"Msgs?showAll=false"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;lift:notice_class&gt;</code>noticeBox<code class="nt">&lt;/lift:notice_class&gt;</code>
  <code class="nt">&lt;/div&gt;</code>

  <code class="nt">&lt;p&gt;</code>
    Planet names need to be at least 5 characters long.
  <code class="nt">&lt;/p&gt;</code>

  <code class="nt">&lt;form</code> <code class="na">class=</code><code class="s">"ValidateSnippet?form"</code><code class="nt">&gt;</code>

    <code class="nt">&lt;div&gt;</code>
      <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"planetName"</code><code class="nt">&gt;</code>Planet name:<code class="nt">&lt;/label&gt;</code>
      <code class="nt">&lt;input</code> <code class="na">id=</code><code class="s">"planetName"</code> <code class="na">type=</code><code class="s">"text"</code><code class="nt">&gt;&lt;/input&gt;</code>
      <code class="nt">&lt;span</code> <code class="na">data-lift=</code><code class="s">"Msg?id=name_id&amp;errorClass=error"</code><code class="nt">&gt;</code>
        Msg to appear here
      <code class="nt">&lt;/span&gt;</code>
    <code class="nt">&lt;/div&gt;</code>

    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code><code class="nt">&gt;&lt;/input&gt;</code>

  <code class="nt">&lt;/form&gt;</code>

<code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>In this template, the error message is shown next to the <code>input</code> field, styled with a CSS class of <code>errorClass</code>. The success notice
is shown near the top of the page, just below the <code>&lt;h1&gt;</code> heading, using a style called <code>noticeBox</code>.</p>
</section>













<section data-type="sect2" id="discussion-pWswt2ij">
<h2>Discussion</h2>

<p>The built-in validations are<a data-type="indexterm" data-primary="minimum/maximum length validation" id="id-kVCkSpFDt7ib"></a>:</p>
<dl>
<dt><code>valMinLen</code></dt>
<dd>
<p>Validates that a string is at least a given length, as shown previously</p>
</dd>
<dt><code>valMaxLen</code></dt>
<dd>
<p>Validates that a string is not above a given length</p>
</dd>
<dt><code>valRegex</code></dt>
<dd>
<p>Validates that a string matches the given pattern</p>
</dd>
</dl>

<p>An example of regular expression validation on a field would be<a data-type="indexterm" data-primary="regular expression validation" id="id-JnCDS7tDtAiA"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">java.util.regex.Pattern</code>

<code class="k">val</code> <code class="n">url</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">1024</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">validations</code> <code class="k">=</code>
    <code class="n">valRegex</code><code class="o">(</code> <code class="nc">Pattern</code><code class="o">.</code><code class="n">compile</code><code class="o">(</code><code class="s">"^https?://.*"</code><code class="o">),</code>
              <code class="s">"URLs should start http:// or https://"</code><code class="o">)</code> <code class="k">_</code> <code class="o">::</code>
    <code class="k">super</code><code class="o">.</code><code class="n">validations</code>
<code class="o">}</code></pre>

<p>The list of errors from <code>validate</code> are of type <code>List[FieldError]</code>.  The <code>S.error</code> method accepts this list and registers each validation error message so it can be shown on the page.  It does this by associating the message with an ID for the field, allowing you to pick out just the errors for an individual field, as we do in this recipe.  The ID is stored on the field, and in the case of <code>Planet.name</code>, it is available as <code>Planet.name.uniqueFieldId</code>.  It’s a <code>Box[String]</code> with a value of <code>Full("name_id")</code>.  It is this <code>name_id</code> value that we used in the <code>lift:Msg?id=name_id&amp;errorClass=error</code> markup to pick out just the error for this field.<a data-type="indexterm" data-primary="error messages" data-secondary="from validation process" id="id-XmCLUBTytPiO"></a><a data-type="indexterm" data-primary="S." data-secondary="error" id="id-jyCdC4Tbt0ig"></a></p>

<p>You don’t have to use <code>S.error</code> to display validation messages.  You can roll your own display code, making use of the <code>FieldError</code> directly.  As you can see from the source for <code>FieldError</code>, the error is available as a <code>msg</code> property:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">case</code> <code class="k">class</code> <code class="nc">FieldError</code><code class="o">(</code><code class="n">field</code><code class="k">:</code> <code class="kt">FieldIdentifier</code><code class="o">,</code> <code class="n">msg</code><code class="k">:</code> <code class="kt">NodeSeq</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">toString</code> <code class="k">=</code> <code class="n">field</code><code class="o">.</code><code class="n">uniqueFieldId</code> <code class="o">+</code> <code class="s">" : "</code> <code class="o">+</code> <code class="n">msg</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="see-also-o8sNhGiW">
<h2>See Also</h2>

<p><a href="http://bit.ly/120VGhc"><code>BaseField.scala</code></a> in the Lift source code contains the definition of the built-in <code>StringValidators</code>.</p>

<p><a data-type="xref" href="#Forms">Forms Processing in Lift</a> describes form processing, notices, and errors.</p>
</section>





</section>













<section data-type="sect1" id="CustomValidation">
<h1>Custom Validation Logic</h1>








<section data-type="sect2" id="problem-2kslFEu8">
<h2>Problem</h2>

<p>You want to provide your own validation logic and apply it to a field in
a record.<a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="custom validation logic for" id="id-DnC1SWFwFauD"></a><a data-type="indexterm" data-primary="validation" id="id-kVCEFpFLFXub"></a><a data-type="indexterm" data-primary="field validation" id="id-4nCkIYFVF0uD"></a><a data-type="indexterm" data-primary="forms processing" data-secondary="field validation" id="id-JnCvtlFNFyuA"></a><a data-type="indexterm" data-primary="custom validation logic" id="id-9nCxhvFpFXuw"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIvuj">
<h2>Solution</h2>

<p>Implement a function from the type of the field to
<code>List[FieldError]</code>, and reference the function in the <code>validations</code> on the field.</p>

<p>Here’s an example: we have a database of planets, and when a user
enters a new planet, we want the name to be unique.  The name of the planet
is a <code>String</code>, so we need to provide a function from <code>String =&gt; List[FieldError]</code>.</p>

<p>With the validation function defined (<code>valUnique</code>, next), we include it in the list of <code>validations</code> on the
<code>name</code> field:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.FieldError</code>

<code class="k">class</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Planet</code>
  <code class="k">override</code> <code class="k">val</code> <code class="n">idField</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LongField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">validations</code> <code class="k">=</code>
      <code class="n">valUnique</code><code class="o">(</code><code class="s">"Planet already exists"</code><code class="o">)</code> <code class="k">_</code> <code class="o">::</code>
      <code class="k">super</code><code class="o">.</code><code class="n">validations</code>
  <code class="o">}</code>

  <code class="k">private</code> <code class="k">def</code> <code class="n">valUnique</code><code class="o">(</code><code class="n">errorMsg</code><code class="k">:</code> <code class="o">=&gt;</code> <code class="nc">String</code><code class="o">)(</code><code class="n">name</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">FieldError</code><code class="o">]</code> <code class="k">=</code>
    <code class="nc">Planet</code><code class="o">.</code><code class="n">unique_?</code><code class="o">(</code><code class="n">name</code><code class="o">)</code> <code class="k">match</code> <code class="o">{</code>
      <code class="k">case</code> <code class="kc">true</code> <code class="k">=&gt;</code> <code class="nc">FieldError</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="n">name</code><code class="o">,</code> <code class="n">errorMsg</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code>
      <code class="k">case</code> <code class="kc">false</code> <code class="k">=&gt;</code> <code class="nc">Nil</code>
    <code class="o">}</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Planet</code> <code class="k">with</code> <code class="nc">MetaRecord</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">unique_?</code><code class="o">(</code><code class="n">name</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">=</code> <code class="n">from</code><code class="o">(</code><code class="n">planets</code><code class="o">)</code> <code class="o">{</code> <code class="n">p</code> <code class="k">=&gt;</code>
    <code class="n">where</code><code class="o">(</code><code class="n">lower</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="n">name</code><code class="o">)</code> <code class="o">===</code> <code class="n">lower</code><code class="o">(</code><code class="n">name</code><code class="o">))</code> <code class="n">select</code><code class="o">(</code><code class="n">p</code><code class="o">)</code>
  <code class="o">}.</code><code class="n">isEmpty</code>
<code class="o">}</code></pre>

<p>The validation is triggered just like any other validation, as described in <a data-type="xref" href="#FieldValidation">Adding Validation to a Field</a>.</p>
</section>













<section data-type="sect2" id="discussion-o8sytkuW">
<h2>Discussion</h2>

<p>By convention, validation functions have two argument lists: the first
for the error message, and the second to receive the value to validate. This
allows you to easily reuse your validation function on other fields.  For example,
if you wanted to validate that satellites have a unique name, you could use
exactly the same function but provide a different error message.</p>

<p>The <code>FieldError</code> you return needs to know the field it applies to as
well as the message to display. In the example, the field is <code>name</code>, but
we’ve used <code>this.name</code> to avoid confusion with the <code>name</code> parameter passed
into the <code>valUnique</code> function.</p>

<p>The example code has used text for the error message, but there is a variation of <code>FieldError</code> that
accepts <code>NodeSeq</code>.  This allows you to produce safe markup as part of the error if you need to.  For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">FieldError</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="n">name</code><code class="o">,</code> <code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code><code class="nc">Please</code> <code class="n">see</code> <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"/policy"</code><code class="o">&gt;</code><code class="n">our</code> <code class="n">name</code> <code class="n">policy</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;&lt;/</code><code class="n">p</code><code class="o">&gt;)</code></pre>

<p>For internationalisation, you may prefer to pass in a key to the validation function, and
resolve<a data-type="indexterm" data-primary="internationalisation" id="id-zdCxSpTDtqun"></a><a data-type="indexterm" data-primary="text localization" id="id-yYCyFYTvtVuy"></a> it via <code>S.?</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">validations</code> <code class="k">=</code>
      <code class="n">valUnique</code><code class="o">(</code><code class="s">"validation.planet"</code><code class="o">)</code> <code class="k">_</code> <code class="o">::</code>
      <code class="k">super</code><code class="o">.</code><code class="n">validations</code>
  <code class="o">}</code>

<code class="c1">// ...combined with...</code>

<code class="k">private</code> <code class="k">def</code> <code class="n">valUnique</code><code class="o">(</code><code class="n">errorKey</code><code class="k">:</code> <code class="o">=&gt;</code> <code class="nc">String</code><code class="o">)(</code><code class="n">name</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">FieldError</code><code class="o">]</code> <code class="k">=</code>
  <code class="nc">Planet</code><code class="o">.</code><code class="n">unique_?</code><code class="o">(</code><code class="n">name</code><code class="o">)</code> <code class="k">match</code> <code class="o">{</code>
    <code class="k">case</code> <code class="kc">false</code> <code class="k">=&gt;</code> <code class="nc">FieldError</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="n">name</code><code class="o">,</code> <code class="n">S</code> <code class="o">?</code> <code class="n">errorKey</code><code class="o">)</code> <code class="o">::</code> <code class="nc">Nil</code>
    <code class="k">case</code> <code class="kc">true</code> <code class="k">=&gt;</code> <code class="nc">Nil</code>
  <code class="o">}</code></pre>
</section>













<section data-type="sect2" id="see-also-g0sxh9uj">
<h2>See Also</h2>

<p><a data-type="xref" href="#FieldValidation">Adding Validation to a Field</a> discusses field validation and the built-in validations.</p>

<p>Text localisation is discussed on the <a href="https://www.assembla.com/wiki/show/liftweb/Localization">Lift wiki</a>.</p>
</section>





</section>













<section data-type="sect1" id="SquerylFilter">
<h1>Modify a Field Value Before It Is Set</h1>








<section data-type="sect2" id="problem-pWsqFoUj">
<h2>Problem</h2>

<p>You want to modify the value of a field before storing it (for example, to clean a value by removing leading and trailing whitespace).<a data-type="indexterm" id="ix_RSLAmvbs" data-primary="Record-Squeryl Lift applications" data-secondary="modifying values before storage"></a><a data-type="indexterm" id="ix_Vmbs" data-primary="values" data-secondary="modifying before storage"></a><a data-type="indexterm" data-primary="whitespace, removing" id="id-JnCmIlFNFwUA"></a></p>
</section>













<section data-type="sect2" id="solution-o8seINUW">
<h2>Solution</h2>

<p>Override <code>setFilter</code> and provide a list of functions to apply to the field.<a data-type="indexterm" data-primary="setFilter" id="id-JnCzFlFpIwUA"></a><a data-type="indexterm" data-primary="filters" id="id-9nCrIvFlIdUw"></a></p>

<p>To remove leading and trailing whitespace entered by the user, the field would use the <code>trim</code> filter:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">override</code> <code class="k">def</code> <code class="n">setFilter</code> <code class="k">=</code> <code class="n">trim</code> <code class="k">_</code> <code class="o">::</code> <code class="k">super</code><code class="o">.</code><code class="n">setFilter</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="discussion-g0s1tbUj">
<h2>Discussion</h2>

<p>The built-in filters are:</p>
<dl>
<dt><code>crop</code></dt>
<dd>
<p>Enforces the field’s min and max length by truncation</p>
</dd>
<dt><code>trim</code></dt>
<dd>
<p>Applies <code>String.trim</code> to the field value</p>
</dd>
<dt><code>toUpper</code> and <code>toLower</code></dt>
<dd>
<p>Change the case of the field value</p>
</dd>
<dt><code>removeRegExChars</code></dt>
<dd>
<p>Removes matching regular expression characters</p>
</dd>
<dt><code>notNull</code></dt>
<dd>
<p>Converts null values to an empty string</p>
</dd>
</dl>

<p>Filters are run before validation. This means if you have a minimum length validation and the trim filter, for example, users cannot pass the validation test by just including spaces on the end of the value they enter.</p>

<p>A filter for a <code>String</code> field would be of type <code>String =&gt; String</code>, and the <code>setFilter</code> function expects a <code>List</code> of these.  Knowing this, it’s straightforward to write custom filters. For example, here’s is a filter that applies a simple form of title case on our <code>name</code> field:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"> <code class="k">def</code> <code class="n">titleCase</code><code class="o">(</code><code class="n">in</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="k">=</code>
  <code class="n">in</code><code class="o">.</code><code class="n">split</code><code class="o">(</code><code class="s">"\\s"</code><code class="o">).</code>
  <code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">toList</code><code class="o">).</code>
  <code class="n">collect</code> <code class="o">{</code>
    <code class="k">case</code> <code class="n">x</code> <code class="o">::</code> <code class="n">xs</code>  <code class="k">=&gt;</code> <code class="o">(</code><code class="nc">Character</code><code class="o">.</code><code class="n">toUpperCase</code><code class="o">(</code><code class="n">x</code><code class="o">).</code><code class="n">toString</code> <code class="o">::</code> <code class="n">xs</code><code class="o">).</code><code class="n">mkString</code>
  <code class="o">}.</code><code class="n">mkString</code><code class="o">(</code><code class="s">" "</code><code class="o">)</code></pre>

<p>This function is splitting the input string on spaces, converting each word into a list of characters, converting the first character into uppercase, and then gluing the strings back together.</p>

<p>We install <code>titleCase</code> on a field like any other filter:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">name</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">256</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">override</code> <code class="k">def</code> <code class="n">setFilter</code> <code class="k">=</code>
    <code class="n">trim</code> <code class="k">_</code> <code class="o">::</code> <code class="n">titleCase</code> <code class="k">_</code> <code class="o">::</code> <code class="k">super</code><code class="o">.</code><code class="n">setFilter</code>
<code class="o">}</code></pre>

<p>Now when a user enters "jaglan beta" as a planet name, it is stored in the database as "Jaglan Beta."</p>
</section>













<section data-type="sect2" id="see-also-q8sZhdUL">
<h2>See Also</h2>

<p>The best place to understand the filters is the trait <code>StringValidators</code> in the <a href="http://bit.ly/120VGhc">source for <code>BaseField</code></a>.</p>

<p>If you really do need to apply title case to a value, <a href="http://commons.apache.org/lang/">the Apache Commons <code>WordUtils</code> class</a> provides ready-made functions for this.<a data-type="indexterm" data-startref="ix_RSLAmvbs" id="id-zdCkFzIJhkUn"></a><a data-type="indexterm" data-startref="ix_Vmbs" id="id-yYCrI1InhJUy"></a></p>
</section>





</section>













<section data-type="sect1" id="SquerylUnitTest">
<h1>Testing with Specs</h1>








<section data-type="sect2" id="problem-o8skFyCW">
<h2>Problem</h2>

<p>You want to write Specs2 unit tests that access your database model with Squeryl and Record.<a data-type="indexterm" id="ix_RSLAtws" data-primary="Record-Squeryl Lift applications" data-secondary="testing with Specs"></a><a data-type="indexterm" data-primary="Specs2" id="id-JnCzFlFNF2CA"></a><a data-type="indexterm" id="ix_UTspec" data-primary="unit tests" data-secondary="with Specs2"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2IxCj">
<h2>Solution</h2>

<p>Use an in-memory database, and arrange for it to be set up before your test and destroyed after it.<a data-type="indexterm" data-primary="in-memory mode" id="id-JnCDSlFpI2CA"></a><a data-type="indexterm" data-primary="databases" data-secondary="in-memory" id="id-9nCdFvFlI0Cw"></a></p>

<p>There are three parts to this: including a database in your project and connecting to it in an in-memory mode; creating a reusable trait to set up the database; and then using the trait in your test.</p>

<p>The H2 database has an in-memory mode, meaning it won’t save data to disk. It needs to be included in <em>build.sbt</em> as a dependency. Whilst you are editing <em>build.sbt</em>, also disable SBT’s parallel test execution to prevent database tests from influencing each other<a data-type="indexterm" data-primary="H2 Database Engine" id="id-yYCrIktaIvCy"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">libraryDependencies</code> <code class="o">+=</code> <code class="s">"com.h2database"</code> <code class="o">%</code> <code class="s">"h2"</code> <code class="o">%</code> <code class="s">"1.3.170"</code>

<code class="n">parallelExecution</code> <code class="n">in</code> <code class="nc">Test</code> <code class="o">:=</code> <code class="kc">false</code></pre>

<p>Create a trait to initialise the database and create the schema<a data-type="indexterm" data-primary="S." data-secondary="init" id="id-yYCASYTaIvCy"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.model</code>

<code class="k">import</code> <code class="nn">java.sql.DriverManager</code>

<code class="k">import</code> <code class="nn">org.squeryl.Session</code>
<code class="k">import</code> <code class="nn">org.squeryl.adapters.H2Adapter</code>

<code class="k">import</code> <code class="nn">net.liftweb.util.StringHelpers</code>
<code class="k">import</code> <code class="nn">net.liftweb.common._</code>
<code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="n">S</code><code class="o">,</code> <code class="nc">Req</code><code class="o">,</code> <code class="nc">LiftSession</code> <code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.SquerylRecord</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.RecordTypeMode._</code>

<code class="k">import</code> <code class="nn">org.specs2.mutable.Around</code>
<code class="k">import</code> <code class="nn">org.specs2.execute.Result</code>

<code class="k">trait</code> <code class="nc">TestLiftSession</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">session</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LiftSession</code><code class="o">(</code><code class="s">""</code><code class="o">,</code> <code class="nc">StringHelpers</code><code class="o">.</code><code class="n">randomString</code><code class="o">(</code><code class="mi">20</code><code class="o">),</code> <code class="nc">Empty</code><code class="o">)</code>
  <code class="k">def</code> <code class="n">inSession</code><code class="o">[</code><code class="kt">T</code><code class="o">](</code><code class="n">a</code><code class="k">:</code> <code class="o">=&gt;</code> <code class="n">T</code><code class="o">)</code><code class="k">:</code> <code class="kt">T</code> <code class="o">=</code> <code class="n">S</code><code class="o">.</code><code class="n">init</code><code class="o">(</code><code class="nc">Req</code><code class="o">.</code><code class="n">nil</code><code class="o">,</code> <code class="n">session</code><code class="o">)</code> <code class="o">{</code> <code class="n">a</code> <code class="o">}</code>
<code class="o">}</code>

<code class="k">trait</code> <code class="nc">DBTestKit</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="nc">Class</code><code class="o">.</code><code class="n">forName</code><code class="o">(</code><code class="s">"org.h2.Driver"</code><code class="o">)</code>

  <code class="nc">Logger</code><code class="o">.</code><code class="n">setup</code> <code class="k">=</code> <code class="nc">Full</code><code class="o">(</code><code class="n">net</code><code class="o">.</code><code class="n">liftweb</code><code class="o">.</code><code class="n">util</code><code class="o">.</code><code class="nc">LoggingAutoConfigurer</code><code class="o">())</code>
  <code class="nc">Logger</code><code class="o">.</code><code class="n">setup</code><code class="o">.</code><code class="n">foreach</code> <code class="o">{</code> <code class="k">_</code><code class="o">.</code><code class="n">apply</code><code class="o">()</code> <code class="o">}</code>

  <code class="k">def</code> <code class="n">configureH2</code><code class="o">()</code> <code class="k">=</code> <code class="o">{</code>
    <code class="nc">SquerylRecord</code><code class="o">.</code><code class="n">initWithSquerylSession</code><code class="o">(</code>
      <code class="nc">Session</code><code class="o">.</code><code class="n">create</code><code class="o">(</code>
        <code class="nc">DriverManager</code><code class="o">.</code><code class="n">getConnection</code><code class="o">(</code><code class="s">"jdbc:h2:mem:dbname;DB_CLOSE_DELAY=-1"</code><code class="o">,</code>
        <code class="s">"sa"</code><code class="o">,</code> <code class="s">""</code><code class="o">),</code>
        <code class="k">new</code> <code class="n">H2Adapter</code><code class="o">)</code>
    <code class="o">)</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">createDb</code><code class="o">()</code> <code class="o">{</code>
    <code class="n">inTransaction</code> <code class="o">{</code>
      <code class="k">try</code> <code class="o">{</code>
        <code class="nc">MySchema</code><code class="o">.</code><code class="n">drop</code>
        <code class="nc">MySchema</code><code class="o">.</code><code class="n">create</code>
      <code class="o">}</code> <code class="k">catch</code> <code class="o">{</code>
        <code class="k">case</code> <code class="n">e</code> <code class="k">:</code> <code class="kt">Throwable</code> <code class="o">=&gt;</code>
          <code class="n">logger</code><code class="o">.</code><code class="n">error</code><code class="o">(</code><code class="s">"DB Schema error"</code><code class="o">,</code> <code class="n">e</code><code class="o">)</code>
          <code class="k">throw</code> <code class="n">e</code>
      <code class="o">}</code>
    <code class="o">}</code>
  <code class="o">}</code>

<code class="o">}</code>

<code class="k">case</code> <code class="k">class</code> <code class="nc">InMemoryDB</code><code class="o">()</code> <code class="k">extends</code> <code class="nc">Around</code> <code class="k">with</code> <code class="nc">DBTestKit</code> <code class="k">with</code> <code class="nc">TestLiftSession</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">around</code><code class="o">[</code><code class="kt">T</code> <code class="k">&lt;%</code> <code class="kt">Result</code><code class="o">](</code><code class="n">testToRun</code><code class="k">:</code> <code class="o">=&gt;</code><code class="n">T</code><code class="o">)</code> <code class="k">=</code> <code class="o">{</code>
    <code class="n">configureH2</code>
    <code class="n">createDb</code>
    <code class="n">inSession</code> <code class="o">{</code>
      <code class="n">inTransaction</code> <code class="o">{</code>
        <code class="n">testToRun</code>
      <code class="o">}</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>In summary, this trail provides an <code>InMemoryDB</code> <em>context</em> for Specs2. This context ensures that the database is configured, the schema created, and a transaction is supplied around your test.</p>

<p>Finally, mix the trait into your test and execute in the scope of the <code>InMemoryDB</code> context.</p>

<p>As an example, using the schema from <a data-type="xref" href="#SquerylOneToMany">One-to-Many Relationship</a>, we can test that the planet Mars has two moons:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.model</code>

<code class="k">import</code> <code class="nn">org.specs2.mutable._</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.RecordTypeMode._</code>
<code class="k">import</code> <code class="nn">MySchema._</code>

<code class="k">class</code> <code class="nc">PlanetsSpec</code> <code class="k">extends</code> <code class="nc">Specification</code> <code class="k">with</code> <code class="nc">DBTestKit</code> <code class="o">{</code>

  <code class="n">sequential</code></pre>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true">  <code class="s">"Planets"</code> <code class="o">&gt;&gt;</code> <code class="o">{</code>

    <code class="s">"know that Mars has two moons"</code> <code class="o">&gt;&gt;</code> <code class="nc">InMemoryDB</code><code class="o">()</code> <code class="o">{</code>

      <code class="k">val</code> <code class="n">mars</code> <code class="k">=</code> <code class="n">planets</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Mars"</code><code class="o">))</code>
      <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Phobos"</code><code class="o">).</code><code class="n">planetId</code><code class="o">(</code><code class="n">mars</code><code class="o">.</code><code class="n">idField</code><code class="o">.</code><code class="n">is</code><code class="o">).</code><code class="n">save</code>
      <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Deimos"</code><code class="o">).</code><code class="n">planetId</code><code class="o">(</code><code class="n">mars</code><code class="o">.</code><code class="n">idField</code><code class="o">.</code><code class="n">is</code><code class="o">).</code><code class="n">save</code>

      <code class="n">mars</code><code class="o">.</code><code class="n">satellites</code><code class="o">.</code><code class="n">size</code> <code class="n">must_==</code> <code class="mi">2</code>
    <code class="o">}</code>

  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Running this with SBT’s <code>test</code> command would show a success:</p>

<pre data-type="programlisting">&gt; test
[info] PlanetsSpec
[info]
[info] Planets
[info] + know that Mars has two moons
[info]
[info]
[info] Total for specification PlanetsSpec
[info] Finished in 1 second, 274 ms
[info] 1 example, 0 failure, 0 error
[info]
[info] Passed: : Total 1, Failed 0, Errors 0, Passed 1, Skipped 0
[success] Total time: 3 s, completed 03-Feb-2013 11:31:16</pre>
</section>













<section data-type="sect2" id="discussion-q8svtLCL">
<h2>Discussion</h2>

<p>The <code>DBTestKit</code> trait has to do quite a lot of work for us.  At the lowest level, it loads the H2 driver and configures Squeryl with an in-memory connection. The <code>mem</code> part of the JDBC connection string (<code>jdbc:h2:mem:dbname;DB_CLOSE_DELAY=-1</code>) means that H2 won’t try to persist the data to disk.  The database just resides in memory, so there are no files in disk to maintain, and it runs quickly.<a data-type="indexterm" data-primary="DBTestKit trait" id="id-yYCgtpFvtvCy"></a></p>

<p>By default, when a connection is closed, the in-memory database is destroyed. In this recipe, we’ve disabled that by adding the <code>DB_CLOSE_DELAY=-1</code>, which will allow us to write unit tests that span connections if we want to.</p>

<p>The next step up from connection management is the creation of the database schema in memory. We do this in <code>createDb</code> by throwing away the schema and any data when we start a test, and create it afresh.  If you have very common test datasets, this might be a good place to insert that data before your test runs.</p>

<p>These steps are brought together at the <code>InMemoryDB</code> class, which implements a Specs2 interface for code to run <code>Around</code> a test.  We’ve also wrapped the test around a <code>TestLiftSession</code>. This provides an empty session, which is useful if you are accessing <span class="keep-together">state-related</span> code (such as the <code>S</code> object).  It’s not necessary for running tests against Record and Squeryl, but it has been included here because you may want to do that at some point.</p>

<p>In our specification itself, we mix in the <code>DBTestKit</code> and reference the <code>InMemoryDB</code> context on the tests that access the database.  You’ll note that we’ve used <code>&gt;&gt;</code> rather than Specs2's <code>should</code> and <code>in</code> that you may have seen elsewhere. This is to avoid name conflicts between Specs2 and Squeryl that you might come across.</p>

<p>As we disabled parallel execution with SBT, we also disable parallel execution in Specs2 with <code>sequential</code>.  We are doing this to prevent a situation where one test might be expecting data that another test is modifying at the same time.<a data-type="indexterm" data-primary="S." data-secondary="addAround" id="id-wqC4FncBtrCA"></a></p>

<p>If all the tests in a specification are going to use the database, you can use the Specs2 <code>AroundContextExample[T]</code> to avoid having to mention <code>InMemoryDB</code> on every test.  To do that, mix in <code>AroundContextExample[InMemoryDB]</code> and define <code>aroundContext</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.model</code>

<code class="k">import</code> <code class="nn">MySchema._</code>

<code class="k">import</code> <code class="nn">org.specs2.mutable._</code>
<code class="k">import</code> <code class="nn">org.specs2.specification.AroundContextExample</code>
<code class="k">import</code> <code class="nn">net.liftweb.squerylrecord.RecordTypeMode._</code>

<code class="k">class</code> <code class="nc">AlternativePlanetsSpec</code> <code class="k">extends</code> <code class="nc">Specification</code> <code class="k">with</code>
  <code class="nc">AroundContextExample</code><code class="o">[</code><code class="kt">InMemoryDB</code><code class="o">]</code> <code class="o">{</code>

  <code class="n">sequential</code>

  <code class="k">def</code> <code class="n">aroundContext</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">InMemoryDB</code><code class="o">()</code>

  <code class="s">"Solar System"</code> <code class="o">&gt;&gt;</code> <code class="o">{</code>

    <code class="s">"know that Mars has two moons"</code> <code class="o">&gt;&gt;</code> <code class="o">{</code>

      <code class="k">val</code> <code class="n">mars</code> <code class="k">=</code> <code class="n">planets</code><code class="o">.</code><code class="n">insert</code><code class="o">(</code><code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Mars"</code><code class="o">))</code>
      <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Phobos"</code><code class="o">).</code><code class="n">planetId</code><code class="o">(</code><code class="n">mars</code><code class="o">.</code><code class="n">idField</code><code class="o">.</code><code class="n">is</code><code class="o">).</code><code class="n">save</code>
      <code class="nc">Satellite</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Deimos"</code><code class="o">).</code><code class="n">planetId</code><code class="o">(</code><code class="n">mars</code><code class="o">.</code><code class="n">idField</code><code class="o">.</code><code class="n">is</code><code class="o">).</code><code class="n">save</code>

      <code class="n">mars</code><code class="o">.</code><code class="n">satellites</code><code class="o">.</code><code class="n">size</code> <code class="n">must_==</code> <code class="mi">2</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>All the tests in <code>AlternativePlanetsSpec</code> will now be run with an <code>InMemoryDB</code> around them.</p>

<p>We’ve used a database with an in-memory mode for the advantages of speed and no files to clean up. However, you could use any regular database: you’d need to change the driver and connection string.</p>
</section>













<section data-type="sect2" id="see-also-1Ls9heCx">
<h2>See Also</h2>

<p>See <a href="http://bit.ly/10iP3wQ">the H2 database website</a> for more about H2's in-memory database settings.</p>

<p><a data-type="xref" href="#MongoUnitTest">Unit Testing Record with MongoDB</a> discusses unit testing with MongoDB, but the comments on SBT’s other testing commands and testing in an IDE would apply to this recipe, too.<a data-type="indexterm" data-startref="ix_RSLAtws" id="id-yYCyF1InhvCy"></a><a data-type="indexterm" data-startref="ix_UTspec" id="id-VMCQIoI1hZCY"></a></p>
</section>





</section>













<section data-type="sect1" id="RandomValueColumn">
<h1>Store a Random Value in a Column</h1>








<section data-type="sect2" id="problem-g0swFmsj">
<h2>Problem</h2>

<p>You need a column to hold a random value.<a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="random value column storage" id="id-JnCDSlFNF4sA"></a><a data-type="indexterm" data-primary="values" data-secondary="storage in a column" id="id-9nCdFvFpFzsw"></a><a data-type="indexterm" data-primary="UniqueIdField" id="id-ZbCnIMFXFJs2"></a></p>
</section>













<section data-type="sect2" id="solution-q8sGIPsL">
<h2>Solution</h2>

<p>Use <code>UniqueIdField</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.record.field.UniqueIdField</code>
<code class="k">val</code> <code class="n">randomId</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">UniqueIdField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">32</code><code class="o">)</code> <code class="o">{}</code></pre>

<p>Note the <code>{}</code> in the example; this is required as <code>UniqueIdField</code> is an
abstract class.</p>

<p>The size value, 32, indicates how many random characters to create.</p>
</section>













<section data-type="sect2" id="discussion-1LswtXsx">
<h2>Discussion</h2>

<p>The <code>UniqueIdField</code> field is a kind of <code>StringField</code> and the default value for the field
comes from <code>StringHelpers.randomString</code>. The value is randomly generated, but not guaranteed to be unique in the database.</p>

<p>The database column backing the <code>UniqueIdField</code> in this recipe will be a <code>varchar(32) not null</code> or similar.  The value stored will look like:</p>

<pre data-type="programlisting">GOJFGQRLS5GVYGPH3L3HRNXTATG3RM5M</pre>

<p>As the value is made up of just letters and numbers, it makes it easy to use in URLs as there are no characters to escape. For example, it could be used in a link to allow a user to validate her account when sent the link over email, which is one of the uses in <code>ProtoUser</code>.</p>

<p>If you need to change the value, the <code>reset</code> method on the field will generate a new random string for the field.</p>

<p>If you need an automatic value that is even more likely to be unique per-row, you can add a field that wraps a <em>universally unique identifier</em> (UUID):</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">java.util.UUID</code>

<code class="k">val</code> <code class="n">uuid</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">36</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">defaultValue</code> <code class="k">=</code> <code class="nc">UUID</code><code class="o">.</code><code class="n">randomUUID</code><code class="o">().</code><code class="n">toString</code>
<code class="o">}</code></pre>

<p>This will automatically insert values of the form "6481a844-460a-a4e0-9191-c808e3051519" in records you create.</p>
</section>













<section data-type="sect2" id="see-also-YmsghqsD">
<h2>See Also</h2>

<p><a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html">Java’s UUID support</a> includes a link to RFC 4122, which defines UUIDs.</p>
</section>





</section>













<section data-type="sect1" id="SquerylUpdatedCreated">
<h1>Automatic Created and Updated Timestamps</h1>








<section data-type="sect2" id="problem-q8sAFBHL">
<h2>Problem</h2>

<p>You want created and updated timestamps on your records and would like them
automatically updated when a row is added or updated.<a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="timestamps in" id="id-9nCjSvFpFqHw"></a><a data-type="indexterm" data-primary="timestamps" id="id-ZbC1FMFXFGH2"></a></p>
</section>













<section data-type="sect2" id="solution-1LsEIGHx">
<h2>Solution</h2>

<p>Define the following traits:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.model</code>

<code class="k">import</code> <code class="nn">java.util.Calendar</code>

<code class="k">import</code> <code class="nn">net.liftweb.record.field.DateTimeField</code>
<code class="k">import</code> <code class="nn">net.liftweb.record.Record</code>

<code class="k">trait</code> <code class="nc">Created</code><code class="o">[</code><code class="kt">T</code> <code class="k">&lt;:</code> <code class="kt">Created</code><code class="o">[</code><code class="kt">T</code><code class="o">]]</code> <code class="nc">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">T</code><code class="o">]</code> <code class="o">{</code>
  <code class="n">self</code><code class="k">:</code> <code class="kt">T</code> <code class="o">=&gt;</code>
  <code class="k">val</code> <code class="n">created</code><code class="k">:</code> <code class="kt">DateTimeField</code><code class="o">[</code><code class="kt">T</code><code class="o">]</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">DateTimeField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">defaultValue</code> <code class="k">=</code> <code class="nc">Calendar</code><code class="o">.</code><code class="n">getInstance</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="k">trait</code> <code class="nc">Updated</code><code class="o">[</code><code class="kt">T</code> <code class="k">&lt;:</code> <code class="kt">Updated</code><code class="o">[</code><code class="kt">T</code><code class="o">]]</code> <code class="nc">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">T</code><code class="o">]</code> <code class="o">{</code>
  <code class="n">self</code><code class="k">:</code> <code class="kt">T</code> <code class="o">=&gt;</code>

  <code class="k">val</code> <code class="n">updated</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">DateTimeField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">defaultValue</code> <code class="k">=</code> <code class="nc">Calendar</code><code class="o">.</code><code class="n">getInstance</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">onUpdate</code> <code class="k">=</code> <code class="k">this</code><code class="o">.</code><code class="n">updated</code><code class="o">(</code><code class="nc">Calendar</code><code class="o">.</code><code class="n">getInstance</code><code class="o">)</code>

<code class="o">}</code>

<code class="k">trait</code> <code class="nc">CreatedUpdated</code><code class="o">[</code><code class="kt">T</code> <code class="k">&lt;:</code> <code class="kt">Updated</code><code class="o">[</code><code class="kt">T</code><code class="o">]</code> <code class="kt">with</code> <code class="kt">Created</code><code class="o">[</code><code class="kt">T</code><code class="o">]]</code> <code class="nc">extends</code>
  <code class="nc">Updated</code><code class="o">[</code><code class="kt">T</code><code class="o">]</code> <code class="k">with</code> <code class="nc">Created</code><code class="o">[</code><code class="kt">T</code><code class="o">]</code> <code class="o">{</code>
    <code class="n">self</code><code class="k">:</code> <code class="kt">T</code> <code class="o">=&gt;</code>
<code class="o">}</code></pre>

<p>Add the trait to the model. For example, we can modify a <code>Planet</code> record to include
the time the record was created and updated:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">Planet</code> <code class="k">private</code> <code class="o">()</code> <code class="k">extends</code> <code class="nc">Record</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code>
  <code class="k">with</code> <code class="nc">KeyedRecord</code><code class="o">[</code><code class="kt">Long</code><code class="o">]</code> <code class="k">with</code> <code class="nc">CreatedUpdated</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="o">{</code>
    <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Planet</code>
    <code class="c1">// field entries as normal...</code>
<code class="o">}</code></pre>

<p>Finally, arrange for the <code>updated</code> field to be updated:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">MySchema</code> <code class="k">extends</code> <code class="nc">Schema</code> <code class="o">{</code>
  <code class="o">...</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">callbacks</code> <code class="k">=</code> <code class="nc">Seq</code><code class="o">(</code>
    <code class="n">beforeUpdate</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="n">call</code> <code class="o">{</code><code class="k">_</code><code class="o">.</code><code class="n">onUpdate</code><code class="o">}</code>
  <code class="o">)</code>
  <code class="o">...</code></pre>
</section>













<section data-type="sect2" id="discussion-YmsMtNHD">
<h2>Discussion</h2>

<p>Although there is a built-in <code>net.liftweb.record.LifecycleCallbacks</code>
trait that allows you to trigger behaviour <code>onUpdate</code>, <code>afterDelete</code>, and so
on, it is only for use on individual fields, rather than records. As our
goal is to update the <code>updated</code> field when any part of the record
changes, we can’t use the <code>LiftcycleCallbacks</code> here.</p>

<p>Instead, the <code>CreatedUpdated</code> trait simplifies adding <code>updated</code> and
<code>created</code> fields to a record, but we do need to remember to add a hook
into the schema to ensure the <code>updated</code> value is changed when a record
is modified. This is why we set the <code>callbacks</code> on the Schema.</p>

<p>The schema for records with <code>CreatedUpdated</code> mixed in will include two additional columns:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="n">updated</code> <code class="k">timestamp</code> <code class="k">not</code> <code class="k">null</code><code class="p">,</code>
<code class="n">created</code> <code class="k">timestamp</code> <code class="k">not</code> <code class="k">null</code></pre>

<p>The <code>timestamp</code> is used for the H2 database. For other databases, the type may be <span class="keep-together">different.</span></p>

<p>The values can be accessed like any other record field.  Using the example data from <a data-type="xref" href="#SquerylOneToMany">One-to-Many Relationship</a>, we could run the following:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">updated</code> <code class="k">:</code> <code class="kt">Calendar</code> <code class="o">=</code> <code class="n">mars</code><code class="o">.</code><code class="n">updated</code><code class="o">.</code><code class="n">id</code>
<code class="k">val</code> <code class="n">created</code> <code class="k">:</code> <code class="kt">Calendar</code> <code class="o">=</code> <code class="n">mars</code><code class="o">.</code><code class="n">created</code><code class="o">.</code><code class="n">is</code></pre>

<p>If you only need created time, or updated time, just mix in the <code>Created[T]</code> or <code>Updated[T]</code> trait instead of <code>CreatedUpdated[T]</code>.</p>

<p>It should be noted that <code>onUpdate</code> is called only on <em>full updates</em> and
not on <em>partial updates</em> with Squeryl. A full update is when the object is
altered and then saved; a partial update is where you attempt to alter objects via a query.<a data-type="indexterm" data-primary="created time" id="id-pOCwtoUbtWH9"></a><a data-type="indexterm" data-primary="updated time" id="id-oPCNhNU8tKHp"></a></p>

<p>If you’re interested in other automations for Record, the Squeryl schema
callbacks support these triggered behaviours:</p>

<ul>
<li>
<p><code>beforeInsert</code> and <code>afterInsert</code></p>
</li>
<li>
<p><code>afterSelect</code></p>
</li>
<li>
<p><code>beforeUpdate</code> and <code>afterUpdate</code></p>
</li>
<li>
<p><code>beforeDelete</code> and <code>afterDelete</code></p>
</li>
</ul>
</section>













<section data-type="sect2" id="see-also-vJskheHA">
<h2>See Also</h2>

<p>Full and partial updates are described in <a href="http://squeryl.org/inserts-updates-delete.html">Insert, Update, and Delete</a>.</p>
</section>





</section>













<section data-type="sect1" id="SquerylLogging">
<h1>Logging SQL</h1>








<section data-type="sect2" id="problem-1LskFKfx">
<h2>Problem</h2>

<p>You want to see the SQL being executed by Squeryl.<a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="SQL logging" id="id-ZbCxSMFXFVf2"></a><a data-type="indexterm" data-primary="SQL logging" id="id-zdCkFGFWF0fn"></a><a data-type="indexterm" data-primary="logging" id="id-yYCrIpF9FYfy"></a></p>
</section>













<section data-type="sect2" id="solution-YmsxIzfD">
<h2>Solution</h2>

<p>Add the following any time you have a Squeryl season, such as just before
your query:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">org</code><code class="o">.</code><code class="n">squeryl</code><code class="o">.</code><code class="nc">Session</code><code class="o">.</code><code class="n">currentSession</code><code class="o">.</code><code class="n">setLogger</code><code class="o">(</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="n">s</code><code class="o">)</code> <code class="o">)</code></pre>

<p>By providing a <code>String =&gt; Unit</code> function to <code>setLogger</code>, Squeryl will
execute that function with the SQL it runs. In this example, we are
simply printing the SQL to the console.</p>
</section>













<section data-type="sect2" id="discussion-vJsrtOfA">
<h2>Discussion</h2>

<p>You’ll probably want to use the logging facilities in Lift to capture SQL.  For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.snippet</code>

<code class="k">import</code> <code class="nn">net.liftweb.common.Loggable</code>
<code class="k">import</code> <code class="nn">org.squeryl.Session</code>

<code class="k">class</code> <code class="nc">MySnippet</code> <code class="k">extends</code> <code class="nc">Loggable</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">render</code> <code class="k">=</code> <code class="o">{</code>
    <code class="nc">Session</code><code class="o">.</code><code class="n">currentSession</code><code class="o">.</code><code class="n">setLogger</code><code class="o">(</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="n">s</code><code class="o">)</code> <code class="o">)</code>
    <code class="c1">// ...your snippet code here...</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>This will log queries according to the settings for the logging system, typically the Logback project configured in <em>src/resources/props/default.logback.xml</em>.</p>

<p>It can be inconvenient to have to enable logging in each snippet during development.  To trigger logging for all snippets, you can modify the <code>addAround</code> call in <em>Boot.scala</em> (<a data-type="xref" href="#ConfiguringSqueryl">Configuring Squeryl and Record</a>) to include a <code>setLogger</code> call while <code>inTransaction</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">S</code><code class="o">.</code><code class="n">addAround</code><code class="o">(</code><code class="k">new</code> <code class="nc">LoanWrapper</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">apply</code><code class="o">[</code><code class="kt">T</code><code class="o">](</code><code class="n">f</code><code class="k">:</code> <code class="o">=&gt;</code> <code class="n">T</code><code class="o">)</code><code class="k">:</code> <code class="kt">T</code> <code class="o">=</code> <code class="o">{</code>
    <code class="k">val</code> <code class="n">result</code> <code class="k">=</code> <code class="n">inTransaction</code> <code class="o">{</code>
    <code class="nc">Session</code><code class="o">.</code><code class="n">currentSession</code><code class="o">.</code><code class="n">setLogger</code><code class="o">(</code> <code class="n">s</code> <code class="k">=&gt;</code> <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="n">s</code><code class="o">)</code> <code class="o">)</code>
    <code class="c1">// ... rest of addAround as normal</code></pre>
</section>













<section data-type="sect2" id="see-also-lqszhvfL">
<h2>See Also</h2>

<p>You can learn about logging in Lift from the <a href="https://www.assembla.com/spaces/liftweb/wiki/Logging">Logging wiki page</a>.</p>
</section>





</section>













<section data-type="sect1" id="SquerylMediumText">
<h1>Model a Column with MySQL MEDIUMTEXT</h1>








<section data-type="sect2" id="problem-YmseFJSD">
<h2>Problem</h2>

<p>You want to use MySQL’s <code>MEDIUMTEXT</code> for a column, but <code>StringField</code>
doesn’t have this option.<a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="MySQLs MEDIUMTEXT" id="id-VMCQIrFXFWSY"></a><a data-type="indexterm" data-primary="MySQL" id="id-rjCwtYFKF1SZ"></a><a data-type="indexterm" data-primary="MEDIUMTEXT" id="id-wqCjhPFGFqSA"></a></p>
</section>













<section data-type="sect2" id="solution-vJslINSA">
<h2>Solution</h2>

<p>Use Squeryl’s <code>dbType</code> in your schema<a data-type="indexterm" data-primary="dbType" id="id-VMCpFrF9IWSY"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">MySchema</code> <code class="k">extends</code> <code class="nc">Schema</code> <code class="o">{</code>
  <code class="n">on</code><code class="o">(</code><code class="n">mytable</code><code class="o">)(</code><code class="n">t</code> <code class="k">=&gt;</code> <code class="n">declare</code><code class="o">(</code>
    <code class="n">t</code><code class="o">.</code><code class="n">mycolumn</code> <code class="n">defineAs</code> <code class="n">dbType</code><code class="o">(</code><code class="s">"MEDIUMTEXT"</code><code class="o">)</code>
  <code class="o">))</code>
<code class="o">}</code></pre>

<p>This schema setting will give you the correct column type in MySQL:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="k">create</code> <code class="k">table</code> <code class="n">mytable</code> <code class="p">(</code>
    <code class="n">mycolumn</code> <code class="n">MEDIUMTEXT</code> <code class="k">not</code> <code class="k">null</code>
<code class="p">);</code></pre>

<p>On the record you can use <code>StringField</code> as usual.</p>
</section>













<section data-type="sect2" id="discussion-lqs8taSL">
<h2>Discussion</h2>

<p>This recipe points towards the flexibility available with Squeryl’s schema definition DSL.  The column attribute in this example is just one of a variety of adjustments you can make to the default choices that Squeryl uses.</p>

<p>For example, you can use the syntax to chain column attributes for a single column, and also define multiple columns at the same time:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">MySchema</code> <code class="k">extends</code> <code class="nc">Schema</code> <code class="o">{</code>
  <code class="n">on</code><code class="o">(</code><code class="n">mytable</code><code class="o">)(</code><code class="n">t</code> <code class="k">=&gt;</code> <code class="n">declare</code><code class="o">(</code>
    <code class="n">t</code><code class="o">.</code><code class="n">mycolumn</code> <code class="n">defineAs</code><code class="o">(</code><code class="n">dbType</code><code class="o">(</code><code class="s">"MEDIUMTEXT"</code><code class="o">),</code><code class="n">indexed</code><code class="o">),</code>
    <code class="n">t</code><code class="o">.</code><code class="n">id</code> <code class="n">definedAs</code><code class="o">(</code><code class="n">unique</code><code class="o">,</code> <code class="n">named</code><code class="o">(</code><code class="s">"MY_ID"</code><code class="o">))</code>
  <code class="o">))</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="see-also-nqslhZSJ">
<h2>See Also</h2>

<p><a href="http://squeryl.org/schema-definition.html">The schema definition page for Squeryl</a> gives examples of attributes you can apply to tables and columns.</p>
</section>





</section>













<section data-type="sect1" id="MySQLCharSet">
<h1>MySQL Character Set Encoding</h1>








<section data-type="sect2" id="problem-vJsJFpFA">
<h2>Problem</h2>

<p>Some characters stored in your MySQL database are appearing as <code>???</code>.<a data-type="indexterm" data-primary="MySQL" id="id-VMCpFrFXFGFY"></a><a data-type="indexterm" data-primary="Record-Squeryl Lift applications" data-secondary="MySQLs character set encoding" id="id-rjCeIYFKFbFZ"></a><a data-type="indexterm" data-primary="UTF-8 character set" id="id-wqCDtPFGFaFA"></a></p>
</section>













<section data-type="sect2" id="solution-lqsAIdFL">
<h2>Solution</h2>

<p>Ensure that:</p>

<ul>
<li>
<p><code>LiftRules.early.append(_.setCharacterEncoding("UTF-8"))</code> is included in <em>Boot.scala</em>.</p>
</li>
<li>
<p><code>?useUnicode=true&amp;characterEncoding=UTF-8</code> is included in your JDBC connections URL.</p>
</li>
<li>
<p>Your MySQL database has been created using a UTF-8 character set.</p>
</li>
</ul>
</section>













<section data-type="sect2" id="discussion-nqs9tgFJ">
<h2>Discussion</h2>

<p>There are a number of interactions here that can impact characters going into, and coming out of, a MySQL database.  The basic problem is that bytes transferred across networks have no meaning unless you know the encoding.</p>

<p>The <code>setCharacterEncoding("UTF-8")</code> call in <em>Boot.scala</em> is being applied to every <code>HTTPRequest</code> that ultimately, in a servlet container, is applied to a <code>ServletRequest</code>. This is how parameters in a request are going to be interpreted by the servlet container when received.</p>

<p>The flip side of this is that responses from Lift are encoded as UTF-8.  You’ll see this in a number of places. For example, <code>templates-hidden/default</code> includes:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"content-type"</code> <code class="na">content=</code><code class="s">"text/html; charset=UTF-8"</code> <code class="nt">/&gt;</code></pre>

<p>Also, the <code>LiftResponse</code> classes set the encoding as UTF-8.</p>

<p>Another aspect is how character data from Lift is sent to the database over the network.  This is controlled by the parameters to the JDBC driver.  The default for MySQL is to detect the encoding, but it seems from experience that this is not a great option, so we force the UTF-8 encoding.<a data-type="indexterm" data-startref="ix_DBsrm" id="id-XmC9Spcyt4FO"></a></p>

<p>Finally, the MySQL database itself needs to store the data as UTF-8.  The default character encoding is not UTF-8, so you’ll need to specify the encoding when you create the database:</p>

<pre data-type="programlisting" data-code-language="sql" data-highlighted="true"><code class="k">CREATE</code> <code class="k">DATABASE</code> <code class="n">myDb</code> <code class="nb">CHARACTER</code> <code class="k">SET</code> <code class="n">utf8</code></pre>
</section>













<section data-type="sect2" id="see-also-NbsrhpFr">
<h2>See Also</h2>

<p><a href="http://bit.ly/ZPKfwi">The MySQL JDBC configuration guide</a>.</p>
</section>





</section>







</section>














<section data-type="chapter" id="MongoRecord">
<h1>MongoDB Persistence with Record</h1>


<p>This chapter gives recipes for making use of MongoDB in your Lift
application. Many of the code examples in this chapter can be found at <a href="https://github.com/LiftCookbook/cookbook_mongo"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_mongo</em></a>.<a data-type="indexterm" id="ix_DBmdbr" data-primary="database persistence" data-secondary="with MongoDB and Record"></a></p>






<section data-type="sect1" id="ConnectingToMongo">
<h1>Connecting to a MongoDB Database</h1>








<section data-type="sect2" id="problem-xqsZFqI7">
<h2>Problem</h2>

<p>You want to connect to a MongoDB database.<a data-type="indexterm" data-primary="MongoDB" data-secondary="connecting to" id="id-LnC7SGFQFvIB"></a></p>
</section>













<section data-type="sect2" id="solution-PaskIAIj">
<h2>Solution</h2>

<p>Add the Lift MongoDB dependencies to your build and configure a connection using <code>net.liftweb.mongodb</code> and <code>com.mongodb</code>.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="Lift MongoDB dependencies" id="id-e4CxIJFqI2Ib"></a></p>

<p>In <em>build.sbt</em>, add the following to <code>libraryDependencies</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-mongodb-record"</code> <code class="o">%</code> <code class="n">liftVersion</code></pre>

<p>In <em>Boot.scala</em>, add:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">com.mongodb.</code><code class="o">{</code><code class="nc">ServerAddress</code><code class="o">,</code> <code class="nc">Mongo</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.mongodb.</code><code class="o">{</code><code class="nc">MongoDB</code><code class="o">,</code><code class="nc">DefaultMongoIdentifier</code><code class="o">}</code>

<code class="k">val</code> <code class="n">server</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">ServerAddress</code><code class="o">(</code><code class="s">"127.0.0.1"</code><code class="o">,</code> <code class="mi">27017</code><code class="o">)</code>
<code class="nc">MongoDB</code><code class="o">.</code><code class="n">defineDb</code><code class="o">(</code><code class="nc">DefaultMongoIdentifier</code><code class="o">,</code> <code class="k">new</code> <code class="nc">Mongo</code><code class="o">(</code><code class="n">server</code><code class="o">),</code> <code class="s">"mydb"</code><code class="o">)</code></pre>

<p>This will give you a connection to a local MongoDB database called
<code>mydb</code>.</p>
</section>













<section data-type="sect2" id="discussion-OKsVtVI0">
<h2>Discussion</h2>

<p>If your database needs authentication,<a data-type="indexterm" data-primary="authentication" data-secondary="for databases" id="id-W7CESLFAtvIG"></a> use <code>MongoDB.defineDbAuth</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">MongoDB</code><code class="o">.</code><code class="n">defineDbAuth</code><code class="o">(</code><code class="nc">DefaultMongoIdentifier</code><code class="o">,</code> <code class="k">new</code> <code class="nc">Mongo</code><code class="o">(</code><code class="n">server</code><code class="o">),</code>
  <code class="s">"mydb"</code><code class="o">,</code> <code class="s">"username"</code><code class="o">,</code> <code class="s">"password"</code><code class="o">)</code></pre>

<p>Some cloud services will give you a URL to connect to, such as
<em>mongodb://alex.mongohq.com:10050/fglvBskrsdsdsDaGNs1</em>. In this case, the host and
the port make up the first part, and the database name is the part after
the <em>/</em>.<a data-type="indexterm" data-primary="cloud services" id="id-kVCAIntDtkIm"></a></p>

<p>If you need to turn a URL like this into a connection, you can do so by
using <code>java.net.URI</code> to parse the URL and make a connection<a data-type="indexterm" data-primary="URLs" data-secondary="database connection with" id="id-kVCEF7hDtkIm"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">MongoUrl</code> <code class="o">{</code>

  <code class="k">def</code> <code class="n">defineDb</code><code class="o">(</code><code class="n">id</code><code class="k">:</code> <code class="kt">MongoIdentifier</code><code class="o">,</code> <code class="n">url</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="o">{</code>

    <code class="k">val</code> <code class="n">uri</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">URI</code><code class="o">(</code><code class="n">url</code><code class="o">)</code>

    <code class="k">val</code> <code class="n">db</code> <code class="k">=</code> <code class="n">uri</code><code class="o">.</code><code class="n">getPath</code> <code class="n">drop</code> <code class="mi">1</code>
    <code class="k">val</code> <code class="n">server</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">Mongo</code><code class="o">(</code><code class="k">new</code> <code class="nc">ServerAddress</code><code class="o">(</code><code class="n">uri</code><code class="o">.</code><code class="n">getHost</code><code class="o">,</code> <code class="n">uri</code><code class="o">.</code><code class="n">getPort</code><code class="o">))</code>

    <code class="nc">Option</code><code class="o">(</code><code class="n">uri</code><code class="o">.</code><code class="n">getUserInfo</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">split</code><code class="o">(</code><code class="s">":"</code><code class="o">))</code> <code class="k">match</code> <code class="o">{</code>
      <code class="k">case</code> <code class="nc">Some</code><code class="o">(</code><code class="nc">Array</code><code class="o">(</code><code class="n">user</code><code class="o">,</code><code class="n">pass</code><code class="o">))</code> <code class="k">=&gt;</code>
        <code class="nc">MongoDB</code><code class="o">.</code><code class="n">defineDbAuth</code><code class="o">(</code><code class="n">id</code><code class="o">,</code> <code class="n">server</code><code class="o">,</code> <code class="n">db</code><code class="o">,</code> <code class="n">user</code><code class="o">,</code> <code class="n">pass</code><code class="o">)</code>
      <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code>
        <code class="nc">MongoDB</code><code class="o">.</code><code class="n">defineDb</code><code class="o">(</code><code class="n">id</code><code class="o">,</code> <code class="n">server</code><code class="o">,</code> <code class="n">db</code><code class="o">)</code>
    <code class="o">}</code>
  <code class="o">}</code>

<code class="o">}</code>

<code class="nc">MongoUrl</code><code class="o">.</code><code class="n">defineDb</code><code class="o">(</code><code class="nc">DefaultMongoIdentifier</code><code class="o">,</code>
  <code class="s">"mongodb://user:pass@127.0.0.1:27017/myDb"</code><code class="o">)</code></pre>

<p>The full URL scheme for MongoDB is more complicated, allowing for multiple hosts and connection parameters, but the previous code handles optional username and password fields and may be enough to get you up and running with your MongoDB <span class="keep-together">configuration.</span></p>

<p>The <code>DefaultMongoIdentifier</code> is a value used to identify a particular connection.  Lift keeps a map of identifiers to connections, meaning you can connect to more than one database.  The common case is a single database, and that is usually assigned to <code>DefaultMongoIdentifier</code>.</p>

<p>However, if you do need to access two MongoDB databases, you can create a new identifier and assign it as part of your record.  For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">OtherMongoIdentifier</code> <code class="k">extends</code> <code class="nc">MongoIdentifier</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">jndiName</code><code class="k">:</code> <code class="kt">String</code> <code class="o">=</code> <code class="s">"other"</code>
<code class="o">}</code>

<code class="nc">MongoUrl</code><code class="o">.</code><code class="n">defineDb</code><code class="o">(</code><code class="nc">OtherMongoIdentifier</code><code class="o">,</code> <code class="s">"mongodb://127.0.0.1:27017/other"</code><code class="o">)</code>

<code class="k">object</code> <code class="nc">Country</code> <code class="k">extends</code> <code class="nc">Country</code> <code class="k">with</code> <code class="nc">MongoMetaRecord</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">collectionName</code> <code class="k">=</code> <code class="s">"example.earth"</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">mongoIdentifier</code> <code class="k">=</code> <code class="nc">OtherMongoIdentifier</code>
<code class="o">}</code></pre>

<p>The <code>lift-mongodb-record</code> dependency itself depends on another Lift module, <code>lift-mongodb</code>, which provides connectivity and other lower-level access to MongoDB. Both bottom out with the MongoDB Java driver.</p>
</section>













<section data-type="sect2" id="see-also-XQsXhDI7">
<h2>See Also</h2>

<p>Connection configuration that includes replica sets and MongoDB options, such as timeout settings, are described on the <a href="https://www.assembla.com/wiki/show/liftweb/Mongo_Configuration">Lift wiki</a>.</p>

<p>The full MongoDB connection format is described in <a href="http://docs.mongodb.org/manual/reference/connection-string/">Connection String URI Format</a>.</p>
</section>





</section>













<section data-type="sect1" id="MongoHashMap">
<h1>Storing a Hash Map in a MongoDB Record</h1>








<section data-type="sect2" id="problem-PasxFptj">
<h2>Problem</h2>

<p>You want to store a hash map in MongoDB.<a data-type="indexterm" data-primary="MongoDB" data-secondary="hash map storage" id="id-AnCPSZFvFXt8"></a><a data-type="indexterm" data-primary="hash maps" id="id-W7CoFLFYFXtG"></a><a data-type="indexterm" data-primary="mapped fields" id="id-e4CxIJFZFatb"></a></p>
</section>













<section data-type="sect2" id="solution-OKsOIJt0">
<h2>Solution</h2>

<p>Create a MongoDB record that contains a <code>MongoMapField</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.mongodb.record._</code>
<code class="k">import</code> <code class="nn">net.liftweb.mongodb.record.field._</code>

<code class="k">class</code> <code class="nc">Country</code> <code class="k">private</code> <code class="o">()</code> <code class="k">extends</code> <code class="nc">MongoRecord</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="k">with</code> <code class="nc">StringPk</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Country</code>
  <code class="k">object</code> <code class="nc">population</code> <code class="k">extends</code> <code class="nc">MongoMapField</code><code class="o">[</code><code class="kt">Country</code>,<code class="kt">Int</code><code class="o">](</code><code class="k">this</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Country</code> <code class="k">extends</code> <code class="nc">Country</code> <code class="k">with</code> <code class="nc">MongoMetaRecord</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">collectionName</code> <code class="k">=</code> <code class="s">"example.earth"</code>
<code class="o">}</code></pre>

<p>In this example, we are creating a record for information about a country,
and the <code>population</code> is a map from a <code>String</code> key, representing a city in that country, to an <code>Integer</code> value, representing the population of that city.</p>

<p>We can use it in a snippet like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">Places</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">uk</code> <code class="k">=</code> <code class="nc">Country</code><code class="o">.</code><code class="n">find</code><code class="o">(</code><code class="s">"uk"</code><code class="o">)</code> <code class="n">openOr</code> <code class="o">{</code>
    <code class="k">val</code> <code class="n">info</code> <code class="k">=</code> <code class="nc">Map</code><code class="o">(</code>
      <code class="s">"Brighton"</code> <code class="o">-&gt;</code> <code class="mi">134293</code><code class="o">,</code>
      <code class="s">"Birmingham"</code> <code class="o">-&gt;</code> <code class="mi">970892</code><code class="o">,</code>
      <code class="s">"Liverpool"</code> <code class="o">-&gt;</code> <code class="mi">469017</code><code class="o">)</code>

    <code class="nc">Country</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"uk"</code><code class="o">).</code><code class="n">population</code><code class="o">(</code><code class="n">info</code><code class="o">).</code><code class="n">save</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">facts</code> <code class="k">=</code> <code class="s">"#facts"</code> <code class="o">#&gt;</code> <code class="o">(</code>
    <code class="k">for</code> <code class="o">{</code> <code class="o">(</code><code class="n">name</code><code class="o">,</code><code class="n">pop</code><code class="o">)</code> <code class="k">&lt;-</code> <code class="n">uk</code><code class="o">.</code><code class="n">population</code><code class="o">.</code><code class="n">is</code> <code class="o">}</code> <code class="k">yield</code>
      <code class="s">".name *"</code> <code class="o">#&gt;</code> <code class="n">name</code> <code class="o">&amp;</code> <code class="s">".pop *"</code> <code class="o">#&gt;</code> <code class="n">pop</code>
  <code class="o">)</code>
<code class="o">}</code></pre>

<p>When this snippet is called, it looks up a record by <code>_id</code> of <code>uk</code> or
creates it using some canned information. The template to go with the
snippet could include:</p>

<pre data-type="programlisting" data-code-language="html" data-highlighted="true"><code class="nt">&lt;div</code> <code class="na">data-lift=</code><code class="s">"Places.facts"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;table&gt;</code>
  <code class="nt">&lt;thead&gt;</code>
   <code class="nt">&lt;tr&gt;&lt;th&gt;</code>City<code class="nt">&lt;/th&gt;&lt;th&gt;</code>Population<code class="nt">&lt;/th&gt;&lt;/tr&gt;</code>
  <code class="nt">&lt;/thead&gt;</code>
  <code class="nt">&lt;tbody&gt;</code>
   <code class="nt">&lt;tr</code> <code class="na">id=</code><code class="s">"facts"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;td</code> <code class="na">class=</code><code class="s">"name"</code><code class="nt">&gt;</code>Name here<code class="nt">&lt;/td&gt;&lt;td</code> <code class="na">class=</code><code class="s">"pop"</code><code class="nt">&gt;</code>Population<code class="nt">&lt;/td&gt;</code>
   <code class="nt">&lt;/tr&gt;</code>
  <code class="nt">&lt;/tbody&gt;</code>
 <code class="nt">&lt;/table&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>In MongoDB, the resulting data structure would be:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="err">$</code> <code class="err">mongo</code> <code class="err">cookbook</code>
<code class="err">MongoDB</code> <code class="err">shell</code> <code class="err">version:</code> <code class="mf">2.0</code><code class="err">.</code><code class="mi">6</code>
<code class="err">connecting</code> <code class="err">to:</code> <code class="err">cookbook</code>
<code class="err">&gt;</code> <code class="err">show</code> <code class="err">collections</code>
<code class="err">example.earth</code>
<code class="err">system.indexes</code>
<code class="err">&gt;</code> <code class="err">db.example.earth.find().pretty()</code>
<code class="p">{</code>
  <code class="nt">"_id"</code> <code class="p">:</code> <code class="s2">"uk"</code><code class="p">,</code>
  <code class="nt">"population"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"Brighton"</code> <code class="p">:</code> <code class="mi">134293</code><code class="p">,</code>
    <code class="nt">"Birmingham"</code> <code class="p">:</code> <code class="mi">970892</code><code class="p">,</code>
    <code class="nt">"Liverpool"</code> <code class="p">:</code> <code class="mi">469017</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</section>













<section data-type="sect2" id="discussion-XQsbtLt7">
<h2>Discussion</h2>

<p>If you do not set a value for the map, the default will be an empty map, represented in MongoDB
as the following:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="p">{</code> <code class="nt">"_id"</code> <code class="p">:</code> <code class="s2">"uk"</code><code class="p">,</code> <code class="nt">"population"</code> <code class="p">:</code> <code class="p">{</code> <code class="p">}</code> <code class="p">}</code></pre>

<p>An alternative is to mark the field as optional:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">population</code> <code class="k">extends</code> <code class="nc">MongoMapField</code><code class="o">[</code><code class="kt">Country</code>,<code class="kt">Int</code><code class="o">](</code><code class="k">this</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">optional_?</code> <code class="k">=</code> <code class="kc">true</code>
<code class="o">}</code></pre>

<p>If you now write the document without a <code>population</code> set, the field will be omitted in MongoDB:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="err">&gt;</code> <code class="err">db.example.earth.find();</code>
<code class="p">{</code> <code class="nt">"_id"</code> <code class="p">:</code> <code class="s2">"uk"</code> <code class="p">}</code></pre>

<p>To append data to the map from your snippet, you can modify the record to supply a
new <code>Map</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">uk</code><code class="o">.</code><code class="n">population</code><code class="o">(</code><code class="n">uk</code><code class="o">.</code><code class="n">population</code><code class="o">.</code><code class="n">is</code> <code class="o">+</code> <code class="o">(</code><code class="s">"Westminster"</code><code class="o">-&gt;</code><code class="mi">81766</code><code class="o">)).</code><code class="n">update</code></pre>

<p>Note that we are using <code>update</code> here, rather than <code>save</code>.  The <code>save</code> method is pretty smart and will either insert a new document into a MongoDB collection or <em>replace</em> an existing document based on the <code>_id</code>.  Update is different: it detects just the changed fields of the document and updates them. It will send this command to MongoDB for the document:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="p">{</code> <code class="nt">"$set"</code> <code class="p">:</code> <code class="p">{</code> <code class="nt">"population"</code> <code class="p">:</code> <code class="p">{</code> <code class="nt">"Brighton"</code> <code class="p">:</code> <code class="mi">134293</code> <code class="p">,</code> <code class="nt">"Liverpool"</code> <code class="p">:</code> <code class="mi">469017</code> <code class="p">,</code>
  <code class="nt">"Birmingham"</code> <code class="p">:</code> <code class="mi">970892</code> <code class="p">,</code> <code class="nt">"Westminster"</code> <code class="p">:</code> <code class="mi">81766</code><code class="p">}</code> <code class="p">}</code></pre>

<p>You’ll probably want to use <code>update</code> over <code>save</code> for changes to existing records.</p>

<p>To access an individual element of the map, you can use <code>get</code> (or <code>value</code>):</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">uk</code><code class="o">.</code><code class="n">population</code><code class="o">.</code><code class="n">get</code><code class="o">(</code><code class="s">"San Francisco"</code><code class="o">)</code>
<code class="c1">// will throw java.util.NoSuchElementException</code></pre>

<p>or you can access via the standard Scala map interface:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">sf</code> <code class="k">:</code> <code class="kt">Option</code><code class="o">[</code><code class="kt">Int</code><code class="o">]</code> <code class="k">=</code> <code class="n">uk</code><code class="o">.</code><code class="n">population</code><code class="o">.</code><code class="n">is</code><code class="o">.</code><code class="n">get</code><code class="o">(</code><code class="s">"San Francisco"</code><code class="o">)</code></pre>










<section data-type="sect3" id="what-a-mongomapfield-can-contain-BVsJIJtwt8">
<h3>What a MongoMapField can contain</h3>

<p>You should be aware that <code>MongoMapField</code> supports only primitive types.<a data-type="indexterm" data-primary="MongoMapFields" id="id-jyClFoFZIXtjtp"></a></p>

<p>The mapped field used in this recipe is typed <code>String =&gt; Int</code>, but of course
MongoDB will let you mix types such as putting a <code>String</code> or a <code>Boolean</code> as a population value.
If you do modify the MongoDB record in the database outside of Lift and mix types, you’ll get a <code>java.lang.ClassCastException</code> at
runtime.<a data-type="indexterm" data-primary="java.lang.ClassCastException" id="id-g9CxhLIEIVtatg"></a><a data-type="indexterm" data-primary="error messages" data-secondary="java.lang.ClassCastException" id="id-qXCrTrIBImtZtq"></a></p>
</section>



</section>













<section data-type="sect2" id="see-also-jWskhPtO">
<h2>See Also</h2>

<p>There’s a <a href="http://bit.ly/lift-mongomap">discussion on the mailing list</a> regarding the limited type support in <code>MongoMapField</code> and a possible way around it by overriding <span class="keep-together"><code>asDBObject</code></span>.</p>
</section>





</section>













<section data-type="sect1" id="MongoEnum">
<h1>Storing an Enumeration in MongoDB</h1>








<section data-type="sect2" id="problem-OKsLF9h0">
<h2>Problem</h2>

<p>You want to store an enumeration in a MongoDB document.<a data-type="indexterm" data-primary="MongoDB" data-secondary="enumeration storage" id="id-W7CESLFYFzhG"></a><a data-type="indexterm" data-primary="enumerations" id="id-e4CAFJFZFvhb"></a><a data-type="indexterm" data-primary="EnumNabeField" id="id-GnC7IgFbFKhN"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKIMh7">
<h2>Solution</h2>

<p>Use <code>EnumNameField</code> to store the string value of the enumeration.  Here’s an example using days of the week:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">DayOfWeek</code> <code class="k">extends</code> <code class="nc">Enumeration</code> <code class="o">{</code>
  <code class="k">type</code> <code class="kt">DayOfWeek</code> <code class="o">=</code> <code class="nc">Value</code>
  <code class="k">val</code> <code class="nc">Mon</code><code class="o">,</code> <code class="nc">Tue</code><code class="o">,</code> <code class="nc">Wed</code><code class="o">,</code> <code class="nc">Thu</code><code class="o">,</code> <code class="nc">Fri</code><code class="o">,</code> <code class="nc">Sat</code><code class="o">,</code> <code class="nc">Sun</code> <code class="k">=</code> <code class="nc">Value</code>
<code class="o">}</code></pre>

<p>We can use this to model someone’s birth day-of-week:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">code.model</code>

<code class="k">import</code> <code class="nn">net.liftweb.mongodb.record._</code>
<code class="k">import</code> <code class="nn">net.liftweb.mongodb.record.field._</code>
<code class="k">import</code> <code class="nn">net.liftweb.record.field.EnumNameField</code>

<code class="k">class</code> <code class="nc">Birthday</code> <code class="k">private</code> <code class="o">()</code> <code class="k">extends</code> <code class="nc">MongoRecord</code><code class="o">[</code><code class="kt">Birthday</code><code class="o">]</code> <code class="k">with</code> <code class="nc">StringPk</code><code class="o">[</code><code class="kt">Birthday</code><code class="o">]{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Birthday</code>
  <code class="k">object</code> <code class="nc">dow</code> <code class="k">extends</code> <code class="nc">EnumNameField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="nc">DayOfWeek</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Birthday</code> <code class="k">extends</code> <code class="nc">Birthday</code> <code class="k">with</code> <code class="nc">MongoMetaRecord</code><code class="o">[</code><code class="kt">Birthday</code><code class="o">]</code></pre>

<p>When creating records, the <code>dow</code> field will expect a <code>DayOfWeek</code> value:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">DayOfWeek._</code>

<code class="nc">Birthday</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"Albert Einstein"</code><code class="o">).</code><code class="n">dow</code><code class="o">(</code><code class="nc">Fri</code><code class="o">).</code><code class="n">save</code>
<code class="nc">Birthday</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"Richard Feynman"</code><code class="o">).</code><code class="n">dow</code><code class="o">(</code><code class="nc">Sat</code><code class="o">).</code><code class="n">save</code>
<code class="nc">Birthday</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"Isaac Newton"</code><code class="o">).</code><code class="n">dow</code><code class="o">(</code><code class="nc">Sun</code><code class="o">).</code><code class="n">save</code></pre>
</section>













<section data-type="sect2" id="discussion-jWsvtAhO">
<h2>Discussion</h2>

<p>Take a look at what’s stored in MongoDB:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="err">&gt;</code> <code class="err">db.birthdays.find()</code>
<code class="p">{</code> <code class="nt">"_id"</code> <code class="p">:</code> <code class="s2">"Albert Einstein"</code><code class="p">,</code> <code class="nt">"dow"</code> <code class="p">:</code> <code class="s2">"Fri"</code> <code class="p">}</code>
<code class="p">{</code> <code class="nt">"_id"</code> <code class="p">:</code> <code class="s2">"Richard Feynman"</code><code class="p">,</code> <code class="nt">"dow"</code> <code class="p">:</code> <code class="s2">"Sat"</code> <code class="p">}</code>
<code class="p">{</code> <code class="nt">"_id"</code> <code class="p">:</code> <code class="s2">"Isaac Newton"</code><code class="p">,</code> <code class="nt">"dow"</code> <code class="p">:</code> <code class="s2">"Sun"</code> <code class="p">}</code></pre>

<p>The <code>dow</code> value is the <code>toString</code> of the enumeration, not the <code>id</code> value:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Fri</code><code class="o">.</code><code class="n">toString</code> <code class="c1">// java.lang.String = Fri</code>
<code class="nc">Fri</code><code class="o">.</code><code class="n">id</code> <code class="c1">//  Int = 4</code></pre>

<p>If you want to store the ID, use <code>EnumField</code> instead.</p>

<p>Be aware that other tools, notably Rogue, expect the string value, not the integer ID, of an enumeration, so you may prefer to use <code>EnumNameField</code> for that reason.</p>
</section>













<section data-type="sect2" id="see-also-2ksZhwhD">
<h2>See Also</h2>

<p><a data-type="xref" href="#QueryingWithRogue">Using Rogue</a> introduces <em>Rogue</em>.</p>
</section>





</section>













<section data-type="sect1" id="MongoEmbedding">
<h1>Embedding a Document Inside a MongoDB Record</h1>








<section data-type="sect2" id="problem-XQspFBT7">
<h2>Problem</h2>

<p>You have a MongoDB record, and you want to embed another set of values
inside it as a single entity.<a data-type="indexterm" data-primary="MongoDB" data-secondary="document embedding" id="id-e4CzSJFZFxTb"></a><a data-type="indexterm" data-primary="documents, embedding in database records" id="id-GnCZFgFbFgTN"></a><a data-type="indexterm" data-primary="values" data-secondary="embedding in database records" id="id-DnCXIWFwFATl"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjI4TO">
<h2>Solution</h2>

<p>Use <code>BsonRecord</code> to define the document to embed, and embed it using
<code>BsonRecordField</code>. Here’s an example of storing information about an
image within a record<a data-type="indexterm" data-primary="BsonRecord" id="id-kVCAIpFpI4Tm"></a><a data-type="indexterm" data-primary="images" data-secondary="storing within a record" id="id-4nCPtYFMIXTz"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.record.field.</code><code class="o">{</code><code class="nc">IntField</code><code class="o">,</code><code class="nc">StringField</code><code class="o">}</code>

<code class="k">class</code> <code class="nc">Image</code> <code class="k">private</code> <code class="o">()</code> <code class="k">extends</code> <code class="nc">BsonRecord</code><code class="o">[</code><code class="kt">Image</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Image</code>
  <code class="k">object</code> <code class="nc">url</code> <code class="k">extends</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">1024</code><code class="o">)</code>
  <code class="k">object</code> <code class="nc">width</code> <code class="k">extends</code> <code class="nc">IntField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
  <code class="k">object</code> <code class="nc">height</code> <code class="k">extends</code> <code class="nc">IntField</code><code class="o">(</code><code class="k">this</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Image</code> <code class="k">extends</code> <code class="nc">Image</code> <code class="k">with</code> <code class="nc">BsonMetaRecord</code><code class="o">[</code><code class="kt">Image</code><code class="o">]</code></pre>

<p>We can reference instances of the <code>Image</code> class via <code>BsonRecordField</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">Country</code> <code class="k">private</code> <code class="o">()</code> <code class="k">extends</code> <code class="nc">MongoRecord</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="k">with</code> <code class="nc">StringPk</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Country</code>
  <code class="k">object</code> <code class="nc">flag</code> <code class="k">extends</code> <code class="nc">BsonRecordField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="nc">Image</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Country</code> <code class="k">extends</code> <code class="nc">Country</code> <code class="k">with</code> <code class="nc">MongoMetaRecord</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">collectionName</code> <code class="k">=</code> <code class="s">"example.earth"</code>
<code class="o">}</code></pre>

<p>To associate a value:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">unionJack</code> <code class="k">=</code>
  <code class="nc">Image</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">url</code><code class="o">(</code><code class="s">"http://bit.ly/unionflag200"</code><code class="o">).</code><code class="n">width</code><code class="o">(</code><code class="mi">200</code><code class="o">).</code><code class="n">height</code><code class="o">(</code><code class="mi">100</code><code class="o">)</code>

<code class="nc">Country</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"uk"</code><code class="o">).</code><code class="n">flag</code><code class="o">(</code><code class="n">unionJack</code><code class="o">).</code><code class="n">save</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code></pre>

<p>In MongoDB, the resulting data structure would be:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="err">&gt;</code> <code class="err">db.example.earth.findOne()</code>
<code class="p">{</code>
  <code class="nt">"_id"</code> <code class="p">:</code> <code class="s2">"uk"</code><code class="p">,</code>
  <code class="nt">"flag"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"url"</code> <code class="p">:</code> <code class="s2">"http://bit.ly/unionflag200"</code><code class="p">,</code>
    <code class="nt">"width"</code> <code class="p">:</code> <code class="mi">200</code><code class="p">,</code>
    <code class="nt">"height"</code> <code class="p">:</code> <code class="mi">100</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</section>













<section data-type="sect2" id="discussion-2ksLtrTD">
<h2>Discussion</h2>

<p>If you don’t set a value on the embedded document, the default will be
saved as:</p>

<pre data-type="programlisting" data-code-language="javascript" data-highlighted="true"><code class="s2">"flag"</code> <code class="o">:</code> <code class="p">{</code> <code class="s2">"width"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="s2">"height"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="s2">"url"</code> <code class="o">:</code> <code class="s2">""</code> <code class="p">}</code></pre>

<p>You can prevent this by making the image optional:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">image</code> <code class="k">extends</code> <code class="nc">BsonRecordField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="nc">Image</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">optional_?</code> <code class="k">=</code> <code class="kc">true</code>
<code class="o">}</code></pre>

<p>With <code>optional_?</code> set in this way, the image part of the MongoDB document
won’t be saved if the value is not set. Within Scala you will then want
to access the value with a <code>valueBox</code> call:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">img</code> <code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">Image</code><code class="o">]</code> <code class="k">=</code> <code class="n">uk</code><code class="o">.</code><code class="n">flag</code><code class="o">.</code><code class="n">valueBox</code></pre>

<p>In fact, regardless of the setting of <code>optional_?</code>, you can access the
value using <code>valueBox</code>.</p>

<p>An alternative to optional values is to always provide a default value for the embedded
document:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">image</code> <code class="k">extends</code> <code class="nc">BsonRecordField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="nc">Image</code><code class="o">)</code> <code class="o">{</code>
 <code class="k">override</code> <code class="k">def</code> <code class="n">defaultValue</code> <code class="k">=</code>
  <code class="nc">Image</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">url</code><code class="o">(</code><code class="s">"http://bit.ly/unionflag200"</code><code class="o">).</code><code class="n">width</code><code class="o">(</code><code class="mi">200</code><code class="o">).</code><code class="n">height</code><code class="o">(</code><code class="mi">100</code><code class="o">)</code>
<code class="o">}</code></pre>
</section>













<section data-type="sect2" id="see-also-pWsJh0Te">
<h2>See Also</h2>

<p><a href="http://bit.ly/144UdJO">The Lift wiki</a> describes <code>BsonRecord</code> in more detail.</p>
</section>





</section>













<section data-type="sect1" id="linking-between-mongodb-records-XQslco">
<h1>Linking Between MongoDB Records</h1>








<section data-type="sect2" id="problem-jWslFlcO">
<h2>Problem</h2>

<p>You have a MongoDB record and want to include a link to another record.<a data-type="indexterm" data-primary="MongoDB" data-secondary="linked records" id="id-GnCJSgFbFEcN"></a><a data-type="indexterm" data-primary="records" data-secondary="linking" id="id-DnCaFWFwFQcl"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIBcD">
<h2>Solution</h2>

<p>Create a reference using a <code>MongoRefField</code> such as <code>ObjectIdRefField</code> or
<code>StringRefField</code>, and dereference the record using the <code>obj</code> call.<a data-type="indexterm" data-primary="MongoRefField" id="id-9nCxhvFlIeca"></a><a data-type="indexterm" data-primary="ObjectIdRefField" id="id-ZbC9TMFkIoc0"></a></p>

<p>As an example, we can create records representing countries, where a
country references the planet where you can find it:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">Planet</code> <code class="k">private</code><code class="o">()</code> <code class="k">extends</code> <code class="nc">MongoRecord</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="k">with</code> <code class="nc">StringPk</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Planet</code>
  <code class="k">object</code> <code class="nc">review</code> <code class="k">extends</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code><code class="mi">1024</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Planet</code> <code class="k">extends</code> <code class="nc">Planet</code> <code class="k">with</code> <code class="nc">MongoMetaRecord</code><code class="o">[</code><code class="kt">Planet</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">collectionName</code> <code class="k">=</code> <code class="s">"example.planet"</code>
<code class="o">}</code>

<code class="k">class</code> <code class="nc">Country</code> <code class="k">private</code> <code class="o">()</code> <code class="k">extends</code> <code class="nc">MongoRecord</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="k">with</code> <code class="nc">StringPk</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">Country</code>
  <code class="k">object</code> <code class="nc">planet</code> <code class="k">extends</code> <code class="nc">StringRefField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="nc">Planet</code><code class="o">,</code> <code class="mi">128</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">Country</code> <code class="k">extends</code> <code class="nc">Country</code> <code class="k">with</code> <code class="nc">MongoMetaRecord</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">collectionName</code> <code class="k">=</code> <code class="s">"example.country"</code>
<code class="o">}</code></pre>

<p>To make this example easier to follow, our model mixes in <code>StringPk[Planet]</code> to use strings as the primary key on our documents, rather than the more usual MongoDB object IDs. Consequently, the link is established with a <code>StringRefField</code>.</p>

<p>In a snippet we can make use of the <code>planet</code> reference by resolving it with <code>.obj</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">class</code> <code class="nc">HelloWorld</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">uk</code> <code class="k">=</code> <code class="nc">Country</code><code class="o">.</code><code class="n">find</code><code class="o">(</code><code class="s">"uk"</code><code class="o">)</code> <code class="n">openOr</code> <code class="o">{</code>
    <code class="k">val</code> <code class="n">earth</code> <code class="k">=</code> <code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"earth"</code><code class="o">).</code><code class="n">review</code><code class="o">(</code><code class="s">"Harmless"</code><code class="o">).</code><code class="n">save</code>
    <code class="nc">Country</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"uk"</code><code class="o">).</code><code class="n">planet</code><code class="o">(</code><code class="n">earth</code><code class="o">.</code><code class="n">id</code><code class="o">.</code><code class="n">is</code><code class="o">).</code><code class="n">save</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">facts</code> <code class="k">=</code>
    <code class="s">".country *"</code> <code class="o">#&gt;</code> <code class="n">uk</code><code class="o">.</code><code class="n">id</code> <code class="o">&amp;</code>
    <code class="s">".planet"</code> <code class="o">#&gt;</code> <code class="n">uk</code><code class="o">.</code><code class="n">planet</code><code class="o">.</code><code class="n">obj</code><code class="o">.</code><code class="n">map</code> <code class="o">{</code> <code class="n">p</code> <code class="k">=&gt;</code>
      <code class="s">".name *"</code> <code class="o">#&gt;</code> <code class="n">p</code><code class="o">.</code><code class="n">id</code> <code class="o">&amp;</code>
      <code class="s">".review *"</code> <code class="o">#&gt;</code> <code class="n">p</code><code class="o">.</code><code class="n">review</code>
    <code class="o">}</code>
  <code class="o">}</code></pre>

<p>For the value <code>uk</code>, we look up an existing record, or create one if none
is found. We create <code>earth</code> as a separate MongoDB record, and
then reference it in the <code>planet</code> field with the ID of the planet.</p>

<p>Retrieving the reference is via the <code>obj</code> method, which returns a
<code>Box[Planet]</code> in this example.</p>
</section>













<section data-type="sect2" id="discussion-pWswtKce">
<h2>Discussion</h2>

<p>Referenced records are fetched from MongoDB when you call the <code>obj</code> method
on a <code>MongoRefField</code>. You can see this by turning on logging in the
MongoDB driver. Do this by adding the following to the start of your
<em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">System</code><code class="o">.</code><code class="n">setProperty</code><code class="o">(</code><code class="s">"DEBUG.MONGO"</code><code class="o">,</code> <code class="s">"true"</code><code class="o">)</code>
<code class="nc">System</code><code class="o">.</code><code class="n">setProperty</code><code class="o">(</code><code class="s">"DB.TRACE"</code><code class="o">,</code> <code class="s">"true"</code><code class="o">)</code></pre>

<p>Having done this, the first time you run the previous snippet, your console
will include:</p>

<pre data-type="programlisting">INFO: find: cookbook.example.country { "_id" : "uk"}
INFO: update: cookbook.example.planet { "_id" : "earth"} { "_id" : "earth" ,
    "review" : "Harmless"}
INFO: update: cookbook.example.country { "_id" : "uk"} { "_id" : "uk" ,
    "planet" : "earth"}
INFO: find: cookbook.example.planet { "_id" : "earth"}</pre>

<p>What you’re seeing here is the initial lookup for <code>uk</code>, followed by the
creation of the <code>earth</code> record and an update that is saving the <code>uk</code>
record. Finally, there is a lookup of <code>earth</code> when <code>uk.obj</code> is called in
the <code>facts</code> method.</p>

<p>The <code>obj</code> call will cache the <code>planet</code> reference. That means you could
say:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">".country *"</code> <code class="o">#&gt;</code> <code class="n">uk</code><code class="o">.</code><code class="n">id</code> <code class="o">&amp;</code>
<code class="s">".planet *"</code> <code class="o">#&gt;</code> <code class="n">uk</code><code class="o">.</code><code class="n">planet</code><code class="o">.</code><code class="n">obj</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">id</code><code class="o">)</code> <code class="o">&amp;</code>
<code class="s">".review *"</code> <code class="o">#&gt;</code> <code class="n">uk</code><code class="o">.</code><code class="n">planet</code><code class="o">.</code><code class="n">obj</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">review</code><code class="o">)</code></pre>

<p>and you’d still only see one query for the <code>earth</code> record despite
calling <code>obj</code> multiple times. The flip side of that is if the <code>earth</code>
record was updated elsewhere in MongoDB after you called <code>obj</code> you would
not see the change from a call to <code>uk.obj</code> unless you reloaded the <code>uk</code>
record first.</p>










<section data-type="sect3" id="querying-by-reference-NbsdU9tecx">
<h3>Querying by reference</h3>

<p>Searching for records by a reference is straightforward<a data-type="indexterm" data-primary="queries" data-secondary="by reference" id="id-wqC7SPFPUztGce"></a><a data-type="indexterm" data-primary="references" data-secondary="querying by" id="id-x1CZFBFWUntecK"></a><a data-type="indexterm" data-primary="records" data-secondary="searching for" id="id-PnCkI7FzUKt1c0"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">earth</code> <code class="k">:</code> <code class="kt">Planet</code> <code class="o">=</code> <code class="o">...</code>
<code class="k">val</code> <code class="n">onEarth</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="k">=</code> <code class="nc">Country</code><code class="o">.</code><code class="n">findAll</code><code class="o">(</code><code class="nc">Country</code><code class="o">.</code><code class="n">planet</code><code class="o">.</code><code class="n">name</code><code class="o">,</code> <code class="n">earth</code><code class="o">.</code><code class="n">id</code><code class="o">.</code><code class="n">is</code><code class="o">)</code></pre>

<p>Or in this case, because we have <code>String</code> references, we could just say:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">onEarth</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">Country</code><code class="o">]</code> <code class="k">=</code> <code class="nc">Country</code><code class="o">.</code><code class="n">findAll</code><code class="o">(</code><code class="nc">Country</code><code class="o">.</code><code class="n">planet</code><code class="o">.</code><code class="n">name</code><code class="o">,</code> <code class="s">"earth"</code><code class="o">)</code></pre>
</section>













<section data-type="sect3" id="updating-and-deleting-8ksOCQtZcG">
<h3>Updating and deleting</h3>

<p>Updating a reference is as you’d expect<a data-type="indexterm" data-primary="references" data-secondary="updating/deleting" id="id-x1C4SBFACntecK"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">uk</code><code class="o">.</code><code class="n">planet</code><code class="o">.</code><code class="n">obj</code><code class="o">.</code><code class="n">foreach</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">review</code><code class="o">(</code><code class="s">"Mostly harmless."</code><code class="o">).</code><code class="n">update</code><code class="o">)</code></pre>

<p>This would result in the changed field being set:</p>

<pre data-type="programlisting">INFO: update: cookbook.example.planet { "_id" : "earth"} { "$set" : {
   "review" : "Mostly harmless."}}</pre>

<p>A <code>uk.planet.obj</code> call will now return a planet with the new review.</p>

<p>Or you could replace the reference with another:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">uk</code><code class="o">.</code><code class="n">planet</code><code class="o">(</code> <code class="nc">Planet</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">id</code><code class="o">(</code><code class="s">"mars"</code><code class="o">).</code><code class="n">save</code><code class="o">.</code><code class="n">id</code><code class="o">.</code><code class="n">is</code> <code class="o">).</code><code class="n">save</code></pre>

<p>Again, note that the reference is via the ID of the record (<code>id.is</code>), not the record itself.</p>

<p>To remove the reference:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">uk</code><code class="o">.</code><code class="n">planet</code><code class="o">(</code><code class="nc">Empty</code><code class="o">).</code><code class="n">save</code></pre>

<p>This removes the link, but the MongoDB record pointed to by the link will remain in the database. If you remove
the object being referenced, a later call to <code>obj</code> will return an
<code>Empty</code> box.</p>
</section>













<section data-type="sect3" id="types-of-link-m8sqsQtacX">
<h3>Types of link</h3>

<p>The example uses a <code>StringRefField</code>, as the MongoDB records themselves use <code>String</code> as the <code>_id</code>. Other reference types are<a data-type="indexterm" data-primary="references" data-secondary="types of" id="id-jyCvtoFMsXtZcp"></a><a data-type="indexterm" data-primary="links" data-secondary="types of" id="id-2nCZhjF8sVtJcq"></a>:</p>
<dl>
<dt><code>ObjectIdRefField</code></dt>
<dd>
<p>This is possibly the most frequently used kind of reference, when you want to reference via the usual default <code>ObjectId</code> in MongoDB.</p>
</dd>
<dt><code>UUIDRefField</code></dt>
<dd>
<p>This is used for records with an ID based on <code>java.util.UUID</code>.</p>
</dd>
<dt><code>StringRefField</code></dt>
<dd>
<p>This is used in this example, where you control the ID as a <code>String</code>.</p>
</dd>
<dt><code>IntRefField</code> and <code>LongRefField</code></dt>
<dd>
<p>This is used when you have a numeric value as an ID.</p>
</dd>
</dl>
</section>



</section>













<section data-type="sect2" id="see-also-o8sNhAcA">
<h2>See Also</h2>

<p>10Gen, Inc.'s <a href="http://docs.mongodb.org/manual/core/data-modeling/"><em>Data Modeling Decisions</em></a> describes embedding of documents compared to referencing objects.</p>
</section>





</section>













<section data-type="sect1" id="QueryingWithRogue">
<h1>Using Rogue</h1>








<section data-type="sect2" id="problem-2kslFaiD">
<h2>Problem</h2>

<p>You want to use Foursquare’s type-safe domain specific language (DSL), Rogue, for querying and updating MongoDB records.<a data-type="indexterm" data-primary="MongoDB" data-secondary="querying/updating records" id="id-DnC1SWFwFzil"></a><a data-type="indexterm" data-primary="records" data-secondary="querying/updating" id="id-kVCEFpFLF7im"></a><a data-type="indexterm" data-primary="type-safe options" id="id-4nCkIYFVF7iz"></a><a data-type="indexterm" data-primary="Foursquare’s domain-specific language (DSL)" id="id-JnCvtlFNFAia"></a><a data-type="indexterm" data-primary="Rogue" id="id-9nCxhvFpF4ia"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZI2ie">
<h2>Solution</h2>

<p>You need to include the Rogue dependency in your build and import Rogue into your code.</p>

<p>For the first step, edit <em>build.sbt</em> and add:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="s">"com.foursquare"</code> <code class="o">%%</code> <code class="s">"rogue"</code> <code class="o">%</code> <code class="s">"1.1.8"</code> <code class="n">intransitive</code><code class="o">()</code></pre>

<p>In your code, run <code>import com.foursquare.rogue._</code> and then start using Rogue.  For example, using the Scala console (see <a data-type="xref" href="#MongoScalaConsole">Running Queries from the Scala Console</a>):</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="k">import</code> <code class="nn">com.foursquare.rogue.Rogue._</code>
<code class="k">import</code> <code class="nn">com.foursquare.rogue.Rogue._</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="k">import</code> <code class="nn">code.model._</code>
<code class="k">import</code> <code class="nn">code.model._</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="nc">Country</code><code class="o">.</code><code class="n">where</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">id</code> <code class="n">eqs</code> <code class="s">"uk"</code><code class="o">).</code><code class="n">fetch</code>
<code class="n">res1</code><code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">code.model.Country</code><code class="o">]</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code><code class="k">class</code> <code class="nc">code</code><code class="o">.</code><code class="n">model</code><code class="o">.</code><code class="nc">Country</code><code class="o">={</code><code class="nc">_id</code><code class="k">=</code><code class="n">uk</code><code class="o">,</code>
  <code class="n">population</code><code class="k">=</code><code class="nc">Map</code><code class="o">(</code><code class="nc">Brighton</code><code class="o">-&gt;</code><code class="mi">134293</code><code class="o">,</code> <code class="nc">Liverpool</code><code class="o">-&gt;</code><code class="mi">469017</code><code class="o">,</code> <code class="nc">Birmingham</code><code class="o">-&gt;</code><code class="mi">970892</code><code class="o">)})</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="nc">Country</code><code class="o">.</code><code class="n">where</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">id</code> <code class="n">eqs</code> <code class="s">"uk"</code><code class="o">).</code><code class="n">count</code>
<code class="n">res2</code><code class="k">:</code> <code class="kt">Long</code> <code class="o">=</code> <code class="mi">1</code>

<code class="n">scala</code><code class="o">&gt;</code> <code class="nc">Country</code><code class="o">.</code><code class="n">where</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">id</code> <code class="n">eqs</code> <code class="s">"uk"</code><code class="o">).</code>
  <code class="n">modify</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">population</code> <code class="n">at</code> <code class="s">"Brighton"</code> <code class="n">inc</code> <code class="mi">1</code><code class="o">).</code><code class="n">updateOne</code><code class="o">()</code></pre>
</section>













<section data-type="sect2" id="discussion-o8sytGiA">
<h2>Discussion</h2>

<p>Rogue is able to use information in your Lift record to offer an elegant way to query and update records. It’s type-safe, meaning, for example, if you try to use an <code>Int</code> where a <code>String</code> is expected in a query, MongoDB would allow that and fail to find results at runtime, but Rogue enables Scala to reject the query at compile time<a data-type="indexterm" data-primary="Scala" data-secondary="type-safe options" id="id-9nCrIvF4t4ia"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">scala</code><code class="o">&gt;</code> <code class="nc">Country</code><code class="o">.</code><code class="n">where</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">id</code> <code class="n">eqs</code> <code class="mi">7</code><code class="o">).</code><code class="n">fetch</code>
<code class="o">&lt;</code><code class="n">console</code><code class="k">&gt;:</code><code class="mi">20</code><code class="k">:</code> <code class="kt">error:</code> <code class="k">type</code> <code class="kt">mismatch</code><code class="o">;</code>
 <code class="n">found</code>   <code class="k">:</code> <code class="kt">Int</code><code class="o">(</code><code class="err">7</code><code class="o">)</code>
 <code class="kt">required:</code> <code class="kt">String</code>
              <code class="nc">Country</code><code class="o">.</code><code class="n">where</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">id</code> <code class="n">eqs</code> <code class="mi">7</code><code class="o">).</code><code class="n">fetch</code></pre>

<p>The DSL constructs a query that we then <code>fetch</code> to send the query to MongoDB. That last method, <code>fetch</code>, is just one of the ways to run the query. Others include:</p>
<dl>
<dt><code>count</code></dt>
<dd>
<p>Queries MongoDB for the size of the result set</p>
</dd>
<dt><code>countDistinct</code></dt>
<dd>
<p>Shows the number of distinct values in the results</p>
</dd>
<dt><code>exists</code></dt>
<dd>
<p>True if there’s any record that matches the query</p>
</dd>
<dt><code>get</code></dt>
<dd>
<p>Returns an <code>Option[T]</code> from the query</p>
</dd>
<dt><code>fetch(limit: Int)</code></dt>
<dd>
<p>Similar to <code>fetch</code>, but returns at most <code>limit</code> results</p>
</dd>
<dt><code>updateOne</code>, <code>updateMulti</code>, <code>upsertOne</code>, and <code>upsertMulti</code></dt>
<dd>
<p>Modify a single document, or all documents, that match the query</p>
</dd>
<dt><code>findAndDeleteOne</code> and <code>bulkDelete_!!</code></dt>
<dd>
<p>Delete records</p>
</dd>
</dl>

<p>The query language itself is expressive, and the best place to explore the variety of queries is in the <code>QueryTest</code> specification in the source for Rogue.  You’ll find a link to this in the README of the project on GitHub.</p>
<div data-type="note" id="id-zpUKcvteiJ"><h6>Note</h6>
<p>Rogue is working towards a version 2 release that introduces a number of new concepts. If you want to give it a try, take a look at the instructions and comments on the <a href="http://bit.ly/rogue2-announce">Rogue mailing list</a>.</p>
</div>
</section>













<section data-type="sect2" id="see-also-g0sxhpiK">
<h2>See Also</h2>

<p>For geospacial queries, see <a data-type="xref" href="#MongoGeospatial">Storing Geospatial Values</a>.</p>

<p><a href="https://github.com/foursquare/rogue">The README page for Rogue</a> is a great starting point, and includes a link to <code>QueryTest</code> giving plenty of example queries to crib.</p>

<p>The motivation for Rogue is described in a <a href="http://bit.ly/120WkLF">Foursquare engineering blog post</a>.</p>
</section>





</section>













<section data-type="sect1" id="MongoGeospatial">
<h1>Storing Geospatial Values</h1>








<section data-type="sect2" id="problem-pWsqFvue">
<h2>Problem</h2>

<p>You want to store latitude and longitude information in MongoDB.<a data-type="indexterm" data-primary="MongoDB" data-secondary="latitude/longitude information" id="id-kVCkSpFLFXum"></a><a data-type="indexterm" data-primary="latitude/longitude information" id="id-4nC2FYFVF0uz"></a><a data-type="indexterm" data-primary="location information" id="id-JnCmIlFNFyua"></a><a data-type="indexterm" data-primary="geospatial indexes" id="id-9nCDtvFpFXua"></a><a data-type="indexterm" data-primary="values" data-secondary="geospatial" id="id-ZbCBhMFXF8u0"></a></p>
</section>













<section data-type="sect2" id="solution-o8seIkuA">
<h2>Solution</h2>

<p>Use Rogue’s <code>LatLong</code> class to embed location information in your model. For
example, we can store the location of a city like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">com.foursquare.rogue.Rogue._</code>
<code class="k">import</code> <code class="nn">com.foursquare.rogue.LatLong</code>

<code class="k">class</code> <code class="nc">City</code> <code class="k">private</code> <code class="o">()</code> <code class="k">extends</code> <code class="nc">MongoRecord</code><code class="o">[</code><code class="kt">City</code><code class="o">]</code> <code class="k">with</code> <code class="nc">ObjectIdPk</code><code class="o">[</code><code class="kt">City</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">meta</code> <code class="k">=</code> <code class="nc">City</code>
  <code class="k">object</code> <code class="nc">name</code> <code class="k">extends</code> <code class="nc">StringField</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="mi">60</code><code class="o">)</code>
  <code class="k">object</code> <code class="nc">loc</code> <code class="k">extends</code> <code class="nc">MongoCaseClassField</code><code class="o">[</code><code class="kt">City</code>, <code class="kt">LatLong</code><code class="o">](</code><code class="k">this</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">object</code> <code class="nc">City</code> <code class="k">extends</code> <code class="nc">City</code> <code class="k">with</code> <code class="nc">MongoMetaRecord</code><code class="o">[</code><code class="kt">City</code><code class="o">]</code> <code class="o">{</code>
  <code class="k">import</code> <code class="nn">net.liftweb.mongodb.BsonDSL._</code>
  <code class="n">ensureIndex</code><code class="o">(</code><code class="n">loc</code><code class="o">.</code><code class="n">name</code> <code class="o">-&gt;</code> <code class="s">"2d"</code><code class="o">,</code> <code class="n">unique</code><code class="k">=</code><code class="kc">true</code><code class="o">)</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">collectionName</code> <code class="k">=</code> <code class="s">"example.city"</code>
<code class="o">}</code></pre>

<p>We can store values like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">place</code> <code class="k">=</code> <code class="nc">LatLong</code><code class="o">(</code><code class="mf">50.819059</code><code class="o">,</code> <code class="o">-</code><code class="mf">0.136642</code><code class="o">)</code>
<code class="k">val</code> <code class="n">city</code> <code class="k">=</code> <code class="nc">City</code><code class="o">.</code><code class="n">createRecord</code><code class="o">.</code><code class="n">name</code><code class="o">(</code><code class="s">"Brighton, UK"</code><code class="o">).</code><code class="n">loc</code><code class="o">(</code><code class="n">pos</code><code class="o">).</code><code class="n">save</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code></pre>

<p>This will produce data in MongoDB that looks like this:</p>

<pre data-type="programlisting" data-code-language="javascript" data-highlighted="true"><code class="p">{</code>
  <code class="s2">"_id"</code> <code class="o">:</code> <code class="nx">ObjectId</code><code class="p">(</code><code class="s2">"50f2f9d43004ad90bbc06b83"</code><code class="p">),</code>
  <code class="s2">"name"</code> <code class="o">:</code> <code class="s2">"Brighton, UK"</code><code class="p">,</code>
  <code class="s2">"loc"</code> <code class="o">:</code> <code class="p">{</code>
    <code class="s2">"lat"</code> <code class="o">:</code> <code class="mf">50.819059</code><code class="p">,</code>
    <code class="s2">"long"</code> <code class="o">:</code> <code class="o">-</code><code class="mf">0.136642</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</section>













<section data-type="sect2" id="discussion-g0s1t9uK">
<h2>Discussion</h2>

<p>MongoDB supports <em>geospatial indexes</em>, and we’re making use of this by doing two things.  First,
we are storing the location information in one of MongoDB’s permitted formats.  The format is
an embedded document containing the coordinates. We could also have used an array of two values
to represent the point.<a data-type="indexterm" data-primary="values" data-secondary="embedding in database records" id="id-9nCdFvF4tXua"></a></p>

<p>Second, we’re creating an index of type <code>2d</code>, which allows us to use MongoDB’s geospatial functions such as <code>$near</code> and <code>$within</code>. The <code>unique=true</code> in the <code>ensureIndex</code> highlights that you can control
whether locations needs to be unique (<code>true</code>, no duplications) or not (<code>false</code>).</p>

<p>With regard to the unique index, you’ll note that we’re calling <code>save(true)</code> on the <code>City</code> in
this example, rather than the plain <code>save</code> in most other recipes.  We could use <code>save</code> here, and
it would work fine, but the difference is that <code>save(true)</code> raises the <em>write concern</em> level
from "normal" to "safe."</p>

<p>With the normal write concern, the call to <code>save</code> would return as soon
as the request has gone down the wire to the MongoDB server.  This gives a certain degree of reliability in that
<code>save</code> would fail if the network had gone away. However, there’s no indication that the server has
processed the request.  For example, if we tried to insert a city at the exact same location as one that was already in the database, the index uniqueness rule would be violated and the record would not be saved.  With just <code>save</code> (or <code>save(false)</code>), our Lift application would not receive this error, and the call would fail silently. Raising the concern to "safe" causes <code>save(true)</code> to wait for an acknowledgment from the MongoDB server, which means the application will receive exceptions for some kinds of errors.</p>

<p>As an example, if we tried to insert a duplicate city, our call to <code>save(true)</code> would <span class="keep-together">result in:</span></p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">com</code><code class="o">.</code><code class="n">mongodb</code><code class="o">.</code><code class="nc">MongoException$DuplicateKey</code><code class="k">:</code> <code class="kt">E11000</code> <code class="kt">duplicate</code> <code class="kt">key</code>
  <code class="n">error</code> <code class="n">index</code><code class="k">:</code> <code class="kt">cookbook.example.city.$loc_2d</code></pre>

<p>There are other levels of write concern, available via another variant of <code>save</code> that takes a <code>WriteConcern</code> as an argument.</p>

<p>If you ever need to drop an index, the MongoDB command is:</p>

<pre data-type="programlisting" data-code-language="js" data-highlighted="true"><code class="nx">db</code><code class="p">.</code><code class="nx">example</code><code class="p">.</code><code class="nx">city</code><code class="p">.</code><code class="nx">dropIndex</code><code class="p">(</code> <code class="s2">"loc_2d"</code> <code class="p">)</code></pre>










<section data-type="sect3" id="querying-dbsmCGtNur">
<h3>Querying</h3>

<p>The reason this recipe uses Rogue’s <code>LatLong</code> class is to enable us to query using the Rogue DSL.  Suppose we’ve inserted other cities into our collection<a data-type="indexterm" data-primary="queries" data-secondary="of location information" id="id-XmCpFOFmCqtGuw"></a>:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="err">&gt;</code> <code class="err">db.example.city.find(</code><code class="p">{}</code><code class="err">,</code> <code class="p">{</code><code class="err">_id:0</code><code class="p">}</code> <code class="err">)</code>
<code class="p">{</code><code class="nt">"name"</code><code class="p">:</code> <code class="s2">"London, UK"</code><code class="p">,</code> <code class="nt">"loc"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"lat"</code><code class="p">:</code> <code class="mf">51.5</code><code class="p">,</code> <code class="nt">"long"</code><code class="p">:</code> <code class="mf">-0.166667</code><code class="p">}</code> <code class="p">}</code>
<code class="p">{</code><code class="nt">"name"</code><code class="p">:</code> <code class="s2">"Brighton, UK"</code><code class="p">,</code> <code class="nt">"loc"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"lat"</code><code class="p">:</code> <code class="mf">50.819059</code><code class="p">,</code> <code class="nt">"long"</code><code class="p">:</code> <code class="mf">-0.136642</code><code class="p">}</code> <code class="p">}</code>
<code class="p">{</code><code class="nt">"name"</code><code class="p">:</code> <code class="s2">"Paris, France"</code><code class="p">,</code> <code class="nt">"loc"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"lat"</code><code class="p">:</code> <code class="mf">48.866667</code><code class="p">,</code> <code class="nt">"long"</code><code class="p">:</code> <code class="mf">2.333333</code><code class="p">}</code> <code class="p">}</code>
<code class="p">{</code><code class="nt">"name"</code><code class="p">:</code> <code class="s2">"Berlin, Germany"</code><code class="p">,</code> <code class="nt">"loc"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"lat"</code><code class="p">:</code> <code class="mf">52.533333</code><code class="p">,</code> <code class="nt">"long"</code><code class="p">:</code> <code class="mf">13.416667</code><code class="p">}</code> <code class="p">}</code>
<code class="p">{</code><code class="nt">"name"</code><code class="p">:</code> <code class="s2">"Sydney, Australia"</code><code class="p">,</code> <code class="nt">"loc"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"lat"</code><code class="p">:</code> <code class="mf">-33.867387</code><code class="p">,</code> <code class="nt">"long"</code><code class="p">:</code> <code class="mf">151.207629</code><code class="p">}</code> <code class="p">}</code>
<code class="p">{</code><code class="nt">"name"</code><code class="p">:</code> <code class="s2">"New York, USA"</code><code class="p">,</code> <code class="nt">"loc"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"lat"</code><code class="p">:</code> <code class="mf">40.714623</code><code class="p">,</code> <code class="nt">"long"</code><code class="p">:</code> <code class="mf">-74.006605</code><code class="p">}</code> <code class="p">}</code></pre>

<p>We can now find those cities within 500 kilometers of London:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">com.foursquare.rogue.</code><code class="o">{</code><code class="nc">LatLong</code><code class="o">,</code> <code class="nc">Degrees</code><code class="o">}</code>

<code class="k">val</code> <code class="n">centre</code> <code class="k">=</code> <code class="nc">LatLong</code><code class="o">(</code><code class="mf">51.5</code><code class="o">,</code> <code class="o">-</code><code class="mf">0.166667</code><code class="o">)</code>
<code class="k">val</code> <code class="n">radius</code> <code class="k">=</code> <code class="nc">Degrees</code><code class="o">(</code> <code class="o">(</code><code class="mi">500</code> <code class="o">/</code> <code class="mf">6378.137</code><code class="o">).</code><code class="n">toDegrees</code> <code class="o">)</code>
<code class="k">val</code> <code class="n">nearby</code> <code class="k">=</code> <code class="nc">City</code><code class="o">.</code><code class="n">where</code><code class="o">(</code> <code class="k">_</code><code class="o">.</code><code class="n">loc</code> <code class="n">near</code> <code class="o">(</code><code class="n">centre</code><code class="o">.</code><code class="n">lat</code><code class="o">,</code> <code class="n">centre</code><code class="o">.</code><code class="n">long</code><code class="o">,</code> <code class="n">radius</code><code class="o">)</code> <code class="o">).</code><code class="n">fetch</code><code class="o">()</code></pre>

<p>This would query MongoDB with this clause:</p>

<pre data-type="programlisting" data-code-language="json" data-highlighted="true"><code class="p">{</code> <code class="nt">"loc"</code> <code class="p">:</code> <code class="p">{</code> <code class="nt">"$near"</code> <code class="p">:</code> <code class="p">[</code> <code class="mf">51.5</code> <code class="p">,</code> <code class="mf">-0.166667</code> <code class="p">,</code> <code class="mf">4.491576420597608</code><code class="p">]}}</code></pre>

<p>which will identify London, Brighton, and Paris as near to London.</p>

<p>The form of the query is a centre point and a spherical radius.  Records falling
inside that radius match the query and are returned closest first. We calculate
the radius in radians: 500 km divided by the radius of the Earth, approximately 6,378 km, gives
us an angle in radians. We convert this to <code>Degrees</code> as required by Rogue.</p>
</section>



</section>













<section data-type="sect2" id="see-also-q8sZhbuj">
<h2>See Also</h2>

<p><a href="http://docs.mongodb.org/manual/core/geospatial-indexes/">The MongoDB Manual</a> discusses geospatial indexes.</p>

<p>Learn more about <a href="http://docs.mongodb.org/manual/core/write-operations/">write concerns</a> from the MongoDB Manual.</p>
</section>





</section>













<section data-type="sect1" id="MongoScalaConsole">
<h1>Running Queries from the Scala Console</h1>








<section data-type="sect2" id="problem-o8skFNUA">
<h2>Problem</h2>

<p>You want to try out a few queries interactively from the Scala console.<a data-type="indexterm" data-primary="queries" data-secondary="with Scala console" id="id-4nCqSYFVFmUz"></a><a data-type="indexterm" data-primary="Scala" data-secondary="interactive queries" id="id-JnCzFlFNFwUa"></a><a data-type="indexterm" data-primary="MongoDB" data-secondary="queries with Scala console" id="id-9nCrIvFpFdUa"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2IbUK">
<h2>Solution</h2>

<p>Start the console from your project, call <code>boot()</code>, and then interact with your model.</p>

<p>For example, using the
MongoDB records developed as part of <a data-type="xref" href="#ConnectingToMongo">Connecting to a MongoDB Database</a>, we can perform a basic query:</p>

<pre data-type="programlisting">$ sbt
...
&gt; console
[info] Compiling 1 Scala source to /cookbook_mongo/target/scala-2.9.1/classes...
[info] Starting scala interpreter...
[info]
Welcome to Scala version 2.9.1.final ...
Type in expressions to have them evaluated.
Type :help for more information.

scala&gt; import bootstrap.liftweb._
import bootstrap.liftweb._

scala&gt; new Boot().boot

scala&gt; import code.model._
import code.model._

scala&gt; Country.findAll
res2: List[code.model.Country] = List(class code.model.Country={_id=uk,
  population=Map(Brighton -&gt; 134293, Liverpool -&gt; 469017,
  Birmingham -&gt; 970892)})

scala&gt; :q</pre>
</section>













<section data-type="sect2" id="discussion-q8svtdUj">
<h2>Discussion</h2>

<p>Running everything in <code>Boot</code> may be a little heavy handed, especially if you are starting up various services and background tasks.  All we need to do is define a database <span class="keep-together">connection.</span> For example, using the sample code presented in <a data-type="xref" href="#ConnectingToMongo">Connecting to a MongoDB Database</a>, we could initialise a conection with:</p>

<pre data-type="programlisting">scala&gt; import bootstrap.liftweb._
import bootstrap.liftweb._

scala&gt; import net.liftweb.mongodb._
import net.liftweb.mongodb._

scala&gt; MongoUrl.defineDb(DefaultMongoIdentifier,
  "mongodb://127.0.0.1:27017/cookbook")

scala&gt; Country.findAll
res2: List[code.model.Country] = List(class code.model.Country={_id=uk,
  population=Map(Brighton -&gt; 134293, Liverpool -&gt; 469017,
    Birmingham -&gt; 970892)})</pre>
</section>













<section data-type="sect2" id="see-also-1Ls9h4Up">
<h2>See Also</h2>

<p><a data-type="xref" href="#ConnectingToMongo">Connecting to a MongoDB Database</a> explains connecting to MongoDB and <a data-type="xref" href="#QueryingWithRogue">Using Rogue</a> describes querying with Rogue.</p>
</section>





</section>













<section data-type="sect1" id="MongoUnitTest">
<h1>Unit Testing Record with MongoDB</h1>








<section data-type="sect2" id="problem-g0swFxCK">
<h2>Problem</h2>

<p>You want to write unit tests to run against your Lift Record code with MongoDB.<a data-type="indexterm" id="ix_MDBunit" data-primary="MongoDB" data-secondary="unit tests"></a><a data-type="indexterm" data-primary="Specs2" id="id-9nCdFvFpF0Ca"></a><a data-type="indexterm" id="ix_UTestspec" data-primary="unit tests" data-secondary="with Specs2"></a></p>
</section>













<section data-type="sect2" id="solution-q8sGILCj">
<h2>Solution</h2>

<p>Using the Specs2 testing framework, surround your specification with a <em>context</em> that creates and connects to a database for each test and destroys it after the test runs.</p>

<p>First, create a Scala trait to set up and destroy a connection to MongoDB.  We’ll be mixing this trait into our specifications:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.http.</code><code class="o">{</code><code class="nc">Req</code><code class="o">,</code> <code class="n">S</code><code class="o">,</code> <code class="nc">LiftSession</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.StringHelpers</code>
<code class="k">import</code> <code class="nn">net.liftweb.common.Empty</code>
<code class="k">import</code> <code class="nn">net.liftweb.mongodb._</code>
<code class="k">import</code> <code class="nn">com.mongodb.ServerAddress</code>
<code class="k">import</code> <code class="nn">com.mongodb.Mongo</code>
<code class="k">import</code> <code class="nn">org.specs2.mutable.Around</code>
<code class="k">import</code> <code class="nn">org.specs2.execute.Result</code>

<code class="k">trait</code> <code class="nc">MongoTestKit</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">server</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">Mongo</code><code class="o">(</code><code class="k">new</code> <code class="nc">ServerAddress</code><code class="o">(</code><code class="s">"127.0.0.1"</code><code class="o">,</code> <code class="mi">27017</code><code class="o">))</code>

  <code class="k">def</code> <code class="n">dbName</code> <code class="k">=</code> <code class="s">"test_"</code><code class="o">+</code><code class="k">this</code><code class="o">.</code><code class="n">getClass</code><code class="o">.</code><code class="n">getName</code>
    <code class="o">.</code><code class="n">replace</code><code class="o">(</code><code class="s">"."</code><code class="o">,</code> <code class="s">"_"</code><code class="o">)</code>
    <code class="o">.</code><code class="n">toLowerCase</code>

  <code class="k">def</code> <code class="n">initDb</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="nc">MongoDB</code><code class="o">.</code><code class="n">defineDb</code><code class="o">(</code><code class="nc">DefaultMongoIdentifier</code><code class="o">,</code> <code class="n">server</code><code class="o">,</code> <code class="n">dbName</code><code class="o">)</code>

  <code class="k">def</code> <code class="n">destroyDb</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
    <code class="nc">MongoDB</code><code class="o">.</code><code class="n">use</code><code class="o">(</code><code class="nc">DefaultMongoIdentifier</code><code class="o">)</code> <code class="o">{</code> <code class="n">d</code> <code class="k">=&gt;</code> <code class="n">d</code><code class="o">.</code><code class="n">dropDatabase</code><code class="o">()</code> <code class="o">}</code>
    <code class="nc">MongoDB</code><code class="o">.</code><code class="n">close</code>
  <code class="o">}</code>

  <code class="k">trait</code> <code class="nc">TestLiftSession</code> <code class="o">{</code>
    <code class="k">def</code> <code class="n">session</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">LiftSession</code><code class="o">(</code><code class="s">""</code><code class="o">,</code> <code class="nc">StringHelpers</code><code class="o">.</code><code class="n">randomString</code><code class="o">(</code><code class="mi">20</code><code class="o">),</code> <code class="nc">Empty</code><code class="o">)</code>
    <code class="k">def</code> <code class="n">inSession</code><code class="o">[</code><code class="kt">T</code><code class="o">](</code><code class="n">a</code><code class="k">:</code> <code class="o">=&gt;</code> <code class="n">T</code><code class="o">)</code><code class="k">:</code> <code class="kt">T</code> <code class="o">=</code> <code class="n">S</code><code class="o">.</code><code class="n">init</code><code class="o">(</code><code class="nc">Req</code><code class="o">.</code><code class="n">nil</code><code class="o">,</code> <code class="n">session</code><code class="o">)</code> <code class="o">{</code> <code class="n">a</code> <code class="o">}</code>
  <code class="o">}</code>

  <code class="k">object</code> <code class="nc">MongoContext</code> <code class="k">extends</code> <code class="nc">Around</code> <code class="k">with</code> <code class="nc">TestLiftSession</code> <code class="o">{</code>
    <code class="k">def</code> <code class="n">around</code><code class="o">[</code><code class="kt">T</code> <code class="k">&lt;%</code> <code class="kt">Result</code><code class="o">](</code><code class="n">testToRun</code><code class="k">:</code> <code class="o">=&gt;</code><code class="n">T</code><code class="o">)</code> <code class="k">=</code> <code class="o">{</code>
      <code class="n">initDb</code><code class="o">()</code>
      <code class="k">try</code> <code class="o">{</code>
        <code class="n">inSession</code> <code class="o">{</code>
          <code class="n">testToRun</code>
        <code class="o">}</code>
      <code class="o">}</code> <code class="k">finally</code> <code class="o">{</code>
        <code class="n">destroyDb</code><code class="o">()</code>
      <code class="o">}</code>
    <code class="o">}</code>
  <code class="o">}</code>

<code class="o">}</code></pre>

<p>This trait provides the plumbing for connection to a MongoDB server running locally, and creates a database based on the name of the class it is mixed into.  The important part is the <code>MongoContext</code>, which ensures that <code>around</code> your specification the database is initialised, and that after your specification is run, it is cleaned up.<a data-type="indexterm" data-primary="S." data-secondary="init" id="id-rjCeIEhQIECX"></a></p>
<div data-type="note" id="Specs2AndScala210"><h6>Note</h6><h1>Specs2 2.x and Scala 2.10</h1>
<p>If you’re using Scala 2.10, you’ll also be using a newer version of
Specs2, and in that case <code>MongoContent</code> needs to be modified. For
Specs2 2.1 you’ll need this code:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">object</code> <code class="nc">MongoContext</code> <code class="k">extends</code> <code class="nc">Around</code> <code class="k">with</code> <code class="nc">TestLiftSession</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">around</code><code class="o">[</code><code class="kt">T</code> <code class="kt">:</code> <code class="kt">AsResult</code><code class="o">](</code><code class="n">testToRun</code><code class="k">:</code> <code class="o">=&gt;</code><code class="n">T</code><code class="o">)</code> <code class="k">:</code> <code class="kt">Result</code> <code class="o">=</code> <code class="o">{</code>
    <code class="n">initDb</code><code class="o">()</code>
    <code class="k">try</code> <code class="o">{</code>
      <code class="n">inSession</code> <code class="o">{</code>
        <code class="nc">ResultExecution</code><code class="o">.</code><code class="n">execute</code><code class="o">(</code><code class="nc">AsResult</code><code class="o">(</code><code class="n">testToRun</code><code class="o">))</code>
      <code class="o">}</code>
    <code class="o">}</code> <code class="k">finally</code> <code class="o">{</code>
        <code class="n">destroyDb</code><code class="o">()</code>
    <code class="o">}</code>
   <code class="o">}</code>
<code class="o">}</code></pre>

<p>The changes in the 2.x series of Specs2 are
documented on <a href="http://bit.ly/specs2-nterpolated">Eric Torreborre’s blog</a>.</p>
</div>

<p>To use this in a specification, mix in the trait and then add the context:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">org.specs2.mutable._</code>

<code class="k">class</code> <code class="nc">MySpec</code> <code class="k">extends</code> <code class="nc">Specification</code> <code class="k">with</code> <code class="nc">MongoTestKit</code> <code class="o">{</code>

  <code class="n">sequential</code>

  <code class="s">"My Record"</code> <code class="n">should</code> <code class="o">{</code>

    <code class="s">"be able to create records"</code> <code class="n">in</code> <code class="nc">MongoContext</code> <code class="o">{</code>
      <code class="k">val</code> <code class="n">r</code> <code class="k">=</code> <code class="nc">MyRecord</code><code class="o">.</code><code class="n">createRecord</code>
      <code class="c1">// ...your useful test here...</code>
      <code class="n">r</code><code class="o">.</code><code class="n">valueBox</code><code class="o">.</code><code class="n">isDefined</code> <code class="n">must</code> <code class="n">beTrue</code>
    <code class="o">}</code>

  <code class="o">}</code>
<code class="o">}</code></pre>

<p>You can now run the test in SBT by<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="unit tests in" id="id-x1C4SZuoI1Cd"></a> typing <code>test</code>:</p>

<pre data-type="programlisting">&gt; test
[info] Compiling 1 Scala source to target/scala-2.9.1/test-classes...
[info] My Record should
[info] + be able to create records
[info]
[info]
[info] Total for specification MySpec
[info] Finished in 1 second, 199 ms
[info] 1 example, 0 failure, 0 error
[info]
[info] Passed: : Total 1, Failed 0, Errors 0, Passed 0, Skipped 0
[success] Total time: 1 s, completed 03-Jan-2013 22:47:54</pre>
</section>













<section data-type="sect2" id="discussion-1LswteCp">
<h2>Discussion</h2>

<p>Lift normally provides all the scaffolding you need to connect and run against MongoDB. Without a running Lift application, we need to ensure MongoDB is configured when our tests run outside of Lift, and that’s what the <code>MongoTestKit</code> trait is providing for us.<a data-type="indexterm" data-primary="DBTestKit trait" id="id-zdCkFGFDt2C0"></a></p>

<p>The one unusual part of the test setup is including a <code>TestLiftSession</code>. This provides an empty session around your test, which is useful if you are accessing or testing state-related code (e.g., access to <code>S</code>).  It’s not strictly necessary for running tests against Record, but it has been included here because you may want to do that at some point, for example if you are testing user login via MongoDB records.</p>

<p>There are a few nice tricks in SBT to help you run tests. Running <code>test</code> will run all the tests in your project. If you want to focus on just one test, you can:</p>

<pre data-type="programlisting">&gt; test-only org.example.code.MySpec</pre>

<p>This command also supports wildcards, so if we only wanted to run tests that start with the word "Mongo" we could:</p>

<pre data-type="programlisting">&gt; test-only org.example.code.Mongo*</pre>

<p>There’s also <code>test-quick</code> (in SBT 0.12), which will only run tests that have not been run, have changed, or failed last time, and <code>~test</code> to watch for changes in tests and run them.</p>

<p><code>test-only</code> together with modifications to <code>around</code> in <code>MongoTestKit</code> can be a good way to track down any issues you have with a test.  By disabling the call to <code>destroyDb()</code>, you can jump into the MongoDB shell and examine the state of the database after a test <span class="keep-together">has run.</span></p>










<section data-type="sect3" id="database-cleanup-BVsAUJteC8">
<h3>Database cleanup</h3>

<p>Around each test, we’ve simply deleted the database so the next time we try to use it, it’ll be empty.  In some situations, you may not be able to do this.  For example, if you’re running tests against a database hosted with companies such as MongoLabs or MongoHQ, then deleting the database will mean you won’t be able to connect to it next time you run.<a data-type="indexterm" data-primary="databases" data-secondary="cleanup after testing" id="id-XmC9SOFeUqtKCw"></a><a data-type="indexterm" data-primary="MongoLabs" id="id-jyClFoFjUXtnCp"></a><a data-type="indexterm" data-primary="MongoHQ" id="id-2nCeIjFNUVtBCq"></a></p>

<p>One way to resolve that is to clean up each individual collection, by defining the collections you need to clean up and replacing <code>destroyDb</code> with a method that will remove all entries in those collections:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">lazy</code> <code class="k">val</code> <code class="n">collections</code> <code class="k">:</code> <code class="kt">List</code><code class="o">[</code><code class="kt">MongoMetaRecord</code><code class="o">[</code><code class="k">_</code><code class="o">]]</code> <code class="k">=</code> <code class="nc">List</code><code class="o">(</code><code class="nc">MyRecord</code><code class="o">)</code>

<code class="k">def</code> <code class="n">destroyDb</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>
  <code class="n">collections</code><code class="o">.</code><code class="n">foreach</code><code class="o">(</code><code class="k">_</code> <code class="n">bulkDelete_!!</code> <code class="k">new</code> <code class="nc">BasicDBObject</code><code class="o">)</code>
  <code class="nc">MongoDB</code><code class="o">.</code><code class="n">close</code>
<code class="o">}</code></pre>

<p>Note that the collection list is <code>lazy</code> to avoid start up of the Record system before we’ve initialised our database connections.</p>
</section>













<section data-type="sect3" id="parallel-tests-MQsYCgtQCG">
<h3>Parallel tests</h3>

<p>If your tests are modifying data and have the potential to interact, you’ll want to stop SBT from running your tests in parallel. A symptom of this would be tests that fail apparently randomly, or working tests that stop working when you add a new test, or tests that seem to lock up.<a data-type="indexterm" data-primary="parallel tests" id="id-jyCxSoFVCXtnCp"></a>  Disable by adding the following to <em>build.sbt</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">parallelExecution</code> <code class="n">in</code> <code class="nc">Test</code> <code class="o">:=</code> <code class="kc">false</code></pre>

<p>You’ll notice that the example specification includes the line: <code>sequential</code>.  This disables the default behaviour in Specs2 of running all tests concurrently.</p>
</section>













<section data-type="sect3" id="running-tests-in-ides-7kspsKtjCN">
<h3>Running tests in IDEs</h3>

<p>IntelliJ IDEA detects and allows you to run Specs2 tests automatically.  With Eclipse, you’ll need to include the JUnit runner annotation at the start of your specification<a data-type="indexterm" data-primary="IntelliJ IDEA development environment" id="id-2nCzSjF8sVtBCq"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="IntelliJ IDEA development" id="id-pOCqFjFjs4t0CO"></a><a data-type="indexterm" data-primary="Eclipse IDE, development in" id="id-oPCeIXFWsvt2Cb"></a><a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="Eclipse plugin for" id="id-g9C1t2FjsVtpCg"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="Eclipse IDE development" id="id-qXCZh4FLsmtlCq"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">org.junit.runner.RunWith</code>
<code class="k">import</code> <code class="nn">org.specs2.runner.JUnitRunner</code>

<code class="nd">@RunWith</code><code class="o">(</code><code class="n">classOf</code><code class="o">[</code><code class="kt">JUnitRunner</code><code class="o">])</code>
<code class="k">class</code> <code class="nc">MySpec</code> <code class="k">extends</code> <code class="nc">Specification</code> <code class="k">with</code> <code class="nc">MongoTestKit</code>  <code class="o">{</code>
<code class="o">...</code></pre>

<p>You can then "Run As…" the class in Eclipse.</p>
</section>



</section>













<section data-type="sect2" id="see-also-YmsghyCm">
<h2>See Also</h2>

<p><a href="http://specs2.org/">The Specs2 site</a> contains examples and a user guide.</p>

<p>If you prefer to use the <a href="http://www.scalatest.org">Scala Test framework</a>, take a look at <a href="https://github.com/eltimn/lift-mongoauth">Tim Nelson’s <em>Mongo Auth</em> Lift module</a>. It includes tests using that framework.  Much of what Tim has written there has been adapted to produce this recipe for Specs2.</p>

<p><a href="http://bit.ly/11NldyA">The Lift MongoDB Record library</a> includes a variation on testing with Specs2, using just <code>Before</code> and <code>After</code> rather than the <code>around</code> example used in this recipe.</p>

<p><a href="https://github.com/flapdoodle-oss/embedmongo.flapdoodle.de">Flapdoodle</a> provides a way to automate the download, install, setup, and cleanup of a MongoDB database. This automation is something you can wrap around your unit tests, and a <a href="https://github.com/athieriot/specs2-embedmongo">Specs2 integration is included</a> using the same <code>Before</code> and <code>After</code> approach to testing used by Lift MongoDB Record.</p>

<p><a href="http://www.scala-sbt.org/release/docs/Detailed-Topics/Testing">The test interface provided by SBT</a>, such as the <code>test</code> command, also supports the ability to fork tests, set specific configurations for test cases, and ways to select which tests are run.</p>

<p><a href="http://bit.ly/144UxZk">The Lift wiki</a> describes more about unit testing and Lift sessions.<a data-type="indexterm" data-startref="ix_DBmdbr" id="id-PnCxFLc7hvCw"></a><a data-type="indexterm" data-startref="ix_MDBunit" id="id-OnCOIbcvhdCg"></a><a data-type="indexterm" data-startref="ix_UTestspec" id="id-XmCbtpcZhzCN"></a></p>
</section>





</section>







</section>














<section data-type="chapter" id="Around">
<h1>Around Lift</h1>


<p>This chapter looks at interacting with other systems from within Lift, such as sending email, calling URLs, or scheduling tasks.</p>

<p>Many of the recipes in this chapter have code examples in a project at <a href="https://github.com/LiftCookbook/cookbook_around"><em class="hyperlink">https://github.com/LiftCookbook/cookbook_around</em></a>.</p>






<section data-type="sect1" id="SendTextEmail">
<h1>Sending Plain-Text Email</h1>








<section data-type="sect2" id="problem-OKsLFJtV">
<h2>Problem</h2>

<p>You want to send a plain-text email from your Lift application.<a data-type="indexterm" data-primary="Lift applications" data-secondary="plain-text email in" id="id-W7CESLFYFXtN"></a><a data-type="indexterm" data-primary="email" data-secondary="plain-text" id="id-e4CAFJFZFatL"></a><a data-type="indexterm" data-primary="Mailer" id="id-GnC7IgFbFntd"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKILtl">
<h2>Solution</h2>

<p>Use the <code>Mailer</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.Mailer</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Mailer._</code>

<code class="nc">Mailer</code><code class="o">.</code><code class="n">sendMail</code><code class="o">(</code>
  <code class="nc">From</code><code class="o">(</code><code class="s">"you@example.org"</code><code class="o">),</code>
  <code class="nc">Subject</code><code class="o">(</code><code class="s">"Hello"</code><code class="o">),</code>
  <code class="nc">To</code><code class="o">(</code><code class="s">"other@example.org"</code><code class="o">),</code>
  <code class="nc">PlainMailBodyType</code><code class="o">(</code><code class="s">"Hello from Lift"</code><code class="o">)</code> <code class="o">)</code></pre>
</section>













<section data-type="sect2" id="discussion-jWsvtPt7">
<h2>Discussion</h2>

<p><code>Mailer</code> sends the message asynchronously, meaning <code>sendMail</code> will
return immediately, so you don’t have to worry about the time costs of
negotiating with an SMTP server. However, there’s also a <code>blockingSendMail</code>
method if you do need to wait.<a data-type="indexterm" data-primary="SMTP servers" id="id-4nCPtYFNt1tJ"></a></p>

<p>By default, the SMTP server used will be <em>localhost</em>. You can change
this by setting the <code>mail.smtp.host</code> property.
For example, edit <em>src/mail/resources/props/default.props</em> and add the line:</p>

<pre data-type="programlisting" data-code-language="java" data-highlighted="true"><code class="n">mail</code><code class="o">.</code><code class="na">smtp</code><code class="o">.</code><code class="na">host</code><code class="o">=</code><code class="n">smtp</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">org</code></pre>

<p>The signature of <code>sendMail</code> requires a <code>From</code>, <code>Subject</code>, and then any
number of <code>MailTypes</code>:</p>
<dl>
<dt><code>To</code>, <code>CC</code>, and <code>BCC</code></dt>
<dd>
<p>The recipient email address</p>
</dd>
<dt><code>ReplyTo</code></dt>
<dd>
<p>The address that mail clients should use for replies</p>
</dd>
<dt><code>MessageHeader</code></dt>
<dd>
<p>Key/value pairs to include as headers in the message</p>
</dd>
<dt><code>PlainMailBodyType</code></dt>
<dd>
<p>A plain-text email sent with UTF-8 encoding</p>
</dd>
<dt><code>PlainPlusBodyType</code></dt>
<dd>
<p>A plain-text email, where you specify the encoding</p>
</dd>
<dt><code>XHTMLMailBodyType</code></dt>
<dd>
<p>For HTML email (<a data-type="xref" href="#HTMLEmail">HTML Email</a>)</p>
</dd>
<dt><code>XHTMLPlusImages</code></dt>
<dd>
<p>For attachments (<a data-type="xref" href="#EmailWithAttachments">Sending Email with Attachments</a>)</p>
</dd>
</dl>

<p>In the previous example, we added two types: <code>PlainMailBodyType</code>
and <code>To</code>.  Adding more is as you’d expect:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Mailer</code><code class="o">.</code><code class="n">sendMail</code><code class="o">(</code>
  <code class="nc">From</code><code class="o">(</code><code class="s">"you@example.org"</code><code class="o">),</code>
  <code class="nc">Subject</code><code class="o">(</code><code class="s">"Hello"</code><code class="o">),</code>
  <code class="nc">To</code><code class="o">(</code><code class="s">"other@example.org"</code><code class="o">),</code>
  <code class="nc">To</code><code class="o">(</code><code class="s">"someone@example.org"</code><code class="o">),</code>
  <code class="nc">MessageHeader</code><code class="o">(</code><code class="s">"X-Ignore-This"</code><code class="o">,</code> <code class="s">"true"</code><code class="o">),</code>
  <code class="nc">PlainMailBodyType</code><code class="o">(</code><code class="s">"Hello from Lift"</code><code class="o">)</code> <code class="o">)</code></pre>

<p>The address-like <code>MailTypes</code> (<code>To</code>, <code>CC</code>, <code>BCC</code>, <code>ReplyTo</code>) can be given an optional "personal name":</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">From</code><code class="o">(</code><code class="s">"you@example.org"</code><code class="o">,</code> <code class="nc">Full</code><code class="o">(</code><code class="s">"Example Corporation"</code><code class="o">))</code></pre>

<p>This would appear in your mailbox as:</p>

<pre data-type="programlisting">From: Example Corporation &lt;you@example.org&gt;</pre>

<p>The default character set is UTF-8. If you need to change this, replace
the use of <code>PlainMailBodyType</code> with
<code>PlainPlusBodyType("Hello from Lift", "ISO8859_1")</code>.</p>
</section>













<section data-type="sect2" id="see-also-2ksZhpt9">
<h2>See Also</h2>

<p><a data-type="xref" href="#EmailWithAttachments">Sending Email with Attachments</a> describes email with attachments.</p>

<p>For HTML email, see <a data-type="xref" href="#HTMLEmail">HTML Email</a>.</p>
</section>





</section>













<section data-type="sect1" id="LogEmail">
<h1>Logging Email Rather than Sending</h1>








<section data-type="sect2" id="problem-XQspFMhl">
<h2>Problem</h2>

<p>You don’t want email sent when developing your Lift application locally,
but you do want to see what would have been sent.<a data-type="indexterm" data-primary="Lift applications" data-secondary="email logging" id="id-e4CzSJFZFvhL"></a><a data-type="indexterm" data-primary="email" data-secondary="logging vs. sending" id="id-GnCZFgFbFKhd"></a><a data-type="indexterm" data-primary="logging" id="id-DnCXIWFwF4h2"></a><a data-type="indexterm" data-primary="Mailer.devModeSend" id="id-kVCltpFLFZhD"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjIAh7">
<h2>Solution</h2>

<p>Assign a logging function to <code>Mailer.devModeSend</code> in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.Mailer._</code>
<code class="k">import</code> <code class="nn">javax.mail.internet.</code><code class="o">{</code><code class="nc">MimeMessage</code><code class="o">,</code><code class="nc">MimeMultipart</code><code class="o">}</code>

<code class="nc">Mailer</code><code class="o">.</code><code class="n">devModeSend</code><code class="o">.</code><code class="n">default</code><code class="o">.</code><code class="n">set</code><code class="o">(</code> <code class="o">(</code><code class="n">m</code><code class="k">:</code> <code class="kt">MimeMessage</code><code class="o">)</code> <code class="k">=&gt;</code>
  <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Would have sent: "</code><code class="o">+</code><code class="n">m</code><code class="o">.</code><code class="n">getContent</code><code class="o">)</code>
<code class="o">)</code></pre>

<p>When you send an email with <code>Mailer</code>, no SMTP server will be contacted, and
instead, you’ll see output to your log:</p>

<pre data-type="programlisting">Would have sent: Hello from Lift</pre>
</section>













<section data-type="sect2" id="discussion-2ksLtwh9">
<h2>Discussion</h2>

<p>The key part of this recipe is setting a
<code>MimeMessage =&gt; Unit</code> function on <code>Mailer.devModeSend</code>.  We happen to be logging, but you can use this function to handle the email any way you want.</p>

<p>The Lift <code>Mailer</code> allows you to control how email is sent at each run mode: by default, email is sent for <code>devModeSend</code>, <code>profileModeSend</code>, <code>pilotModeSend</code>, <code>stagingModeSend</code>, and <code>productionModeSend</code>; whereas, by default, <code>testModeSend</code> only logs that a message would have been sent.</p>

<p>The <code>testModeSend</code> logs a reference to the <code>MimeMessage</code>, meaning your log
would show a message like:</p>

<pre data-type="programlisting">Sending javax.mail.internet.MimeMessage@4a91a883</pre>

<p>This recipe has changed the behaviour of <code>Mailer</code> when your Lift
application is in developer mode (which it is by default). We’re logging
just the body part of the message.</p>

<p>Java Mail doesn’t include a utility to display all the
parts of an email, so if you want more information, you’ll need to
roll your own function.  For example<a data-type="indexterm" data-primary="Java Mail" id="id-ZbCxSLcMtYhd"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">def</code> <code class="n">display</code><code class="o">(</code><code class="n">m</code><code class="k">:</code> <code class="kt">MimeMessage</code><code class="o">)</code> <code class="k">:</code> <code class="kt">String</code> <code class="o">=</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">nl</code> <code class="k">=</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"line.separator"</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">from</code> <code class="k">=</code> <code class="s">"From: "</code><code class="o">+</code><code class="n">m</code><code class="o">.</code><code class="n">getFrom</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">toString</code><code class="o">).</code><code class="n">mkString</code><code class="o">(</code><code class="s">","</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">subj</code> <code class="k">=</code> <code class="s">"Subject: "</code><code class="o">+</code><code class="n">m</code><code class="o">.</code><code class="n">getSubject</code>

  <code class="k">def</code> <code class="n">parts</code><code class="o">(</code><code class="n">mm</code><code class="k">:</code> <code class="kt">MimeMultipart</code><code class="o">)</code> <code class="k">=</code> <code class="o">(</code><code class="mi">0</code> <code class="n">until</code> <code class="n">mm</code><code class="o">.</code><code class="n">getCount</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="n">mm</code><code class="o">.</code><code class="n">getBodyPart</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">body</code> <code class="k">=</code> <code class="n">m</code><code class="o">.</code><code class="n">getContent</code> <code class="k">match</code> <code class="o">{</code>
    <code class="k">case</code> <code class="n">mm</code><code class="k">:</code> <code class="kt">MimeMultipart</code> <code class="o">=&gt;</code>
      <code class="k">val</code> <code class="n">bodyParts</code> <code class="k">=</code> <code class="k">for</code> <code class="o">(</code><code class="n">part</code> <code class="k">&lt;-</code> <code class="n">parts</code><code class="o">(</code><code class="n">mm</code><code class="o">))</code> <code class="k">yield</code> <code class="n">part</code><code class="o">.</code><code class="n">getContent</code><code class="o">.</code><code class="n">toString</code>
      <code class="n">bodyParts</code><code class="o">.</code><code class="n">mkString</code><code class="o">(</code><code class="n">nl</code><code class="o">)</code>

    <code class="k">case</code> <code class="n">otherwise</code> <code class="k">=&gt;</code> <code class="n">otherwise</code><code class="o">.</code><code class="n">toString</code>
  <code class="o">}</code>

  <code class="k">val</code> <code class="n">to</code> <code class="k">=</code> <code class="k">for</code> <code class="o">{</code>
    <code class="n">rt</code> <code class="k">&lt;-</code> <code class="nc">List</code><code class="o">(</code><code class="nc">RecipientType</code><code class="o">.</code><code class="nc">TO</code><code class="o">,</code> <code class="nc">RecipientType</code><code class="o">.</code><code class="nc">CC</code><code class="o">,</code> <code class="nc">RecipientType</code><code class="o">.</code><code class="nc">BCC</code><code class="o">)</code>
    <code class="n">address</code> <code class="k">&lt;-</code> <code class="nc">Option</code><code class="o">(</code><code class="n">m</code><code class="o">.</code><code class="n">getRecipients</code><code class="o">(</code><code class="n">rt</code><code class="o">))</code> <code class="n">getOrElse</code> <code class="nc">Array</code><code class="o">()</code>
  <code class="o">}</code> <code class="k">yield</code> <code class="n">rt</code><code class="o">.</code><code class="n">toString</code> <code class="o">+</code> <code class="s">": "</code> <code class="o">+</code> <code class="n">address</code><code class="o">.</code><code class="n">toString</code>

  <code class="nc">List</code><code class="o">(</code><code class="n">from</code><code class="o">,</code> <code class="n">to</code><code class="o">.</code><code class="n">mkString</code><code class="o">(</code><code class="n">nl</code><code class="o">),</code> <code class="n">subj</code><code class="o">,</code> <code class="n">body</code><code class="o">)</code> <code class="n">mkString</code> <code class="n">nl</code>
<code class="o">}</code>

<code class="nc">Mailer</code><code class="o">.</code><code class="n">devModeSend</code><code class="o">.</code><code class="n">default</code><code class="o">.</code><code class="n">set</code><code class="o">(</code> <code class="o">(</code><code class="n">m</code><code class="k">:</code> <code class="kt">MimeMessage</code><code class="o">)</code> <code class="k">=&gt;</code>
  <code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="o">(</code><code class="s">"Would have sent: "</code><code class="o">+</code><code class="n">display</code><code class="o">(</code><code class="n">m</code><code class="o">))</code>
<code class="o">)</code></pre>

<p>This would produce output of the form:</p>

<pre data-type="programlisting">Would have sent: From: you@example.org
To: other@example.org
To: someone@example.org
Subject: Hello
Hello from Lift</pre>

<p>This example <code>display</code> function is long but mostly straightforward. The <code>body</code> value handles multipart messages by extracting each body part.  This is triggered when sending more structured emails, such as the HTML emails<a data-type="indexterm" data-primary="HTML" data-secondary="email" id="id-x1C0INCYtkh0"></a><a data-type="indexterm" data-primary="email" data-secondary="HTML" id="id-PnCetlCAtpho"></a> described in <a data-type="xref" href="#HTMLEmail">HTML Email</a>.</p>

<p>If you want to debug the mail system while it’s actually sending the email, enable the Java Mail debug mode.  In <em>default.props</em> add:</p>

<pre data-type="programlisting" data-code-language="properties" data-highlighted="true"><code class="na">mail.debug</code><code class="o">=</code><code class="s">true</code></pre>

<p>This produces low-level output from the Java Mail system when email is sent:</p>

<pre data-type="programlisting">DEBUG: JavaMail version 1.4.4
DEBUG: successfully loaded resource: /META-INF/javamail.default.providers
DEBUG SMTP: useEhlo true, useAuth false
DEBUG SMTP: trying to connect to host "localhost", port 25, isSSL false
...</pre>
</section>













<section data-type="sect2" id="see-also-pWsJhXhV">
<h2>See Also</h2>

<p>Run modes are described on <a href="https://www.assembla.com/spaces/liftweb/wiki/Run_Modes">the Lift wiki</a>.</p>
</section>





</section>













<section data-type="sect1" id="HTMLEmail">
<h1>HTML Email</h1>








<section data-type="sect2" id="problem-jWslF4T7">
<h2>Problem</h2>

<p>You want to send an HTML email from your Lift application.<a data-type="indexterm" data-primary="Lift applications" data-secondary="HTML email" id="id-GnCJSgFbFgTd"></a><a data-type="indexterm" data-primary="Mailer" id="id-DnCaFWFwFAT2"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIrT9">
<h2>Solution</h2>

<p>Give <code>Mailer</code> a <code>NodeSeq</code> containing your HTML message:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.Mailer</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Mailer._</code>

<code class="k">val</code> <code class="n">msg</code> <code class="k">=</code> <code class="o">&lt;</code><code class="n">html</code><code class="o">&gt;</code>
   <code class="o">&lt;</code><code class="n">head</code><code class="o">&gt;</code>
     <code class="o">&lt;</code><code class="n">title</code><code class="o">&gt;</code><code class="nc">Hello</code><code class="o">&lt;/</code><code class="n">title</code><code class="o">&gt;</code>
   <code class="o">&lt;/</code><code class="n">head</code><code class="o">&gt;</code>
   <code class="o">&lt;</code><code class="n">body</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="n">h1</code><code class="o">&gt;</code><code class="nc">Hello</code><code class="o">&lt;/</code><code class="n">h1</code><code class="o">&gt;</code>
   <code class="o">&lt;/</code><code class="n">body</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="n">html</code><code class="o">&gt;</code>

<code class="nc">Mailer</code><code class="o">.</code><code class="n">sendMail</code><code class="o">(</code>
  <code class="nc">From</code><code class="o">(</code><code class="s">"me@example.org"</code><code class="o">),</code>
  <code class="nc">Subject</code><code class="o">(</code><code class="s">"Hello"</code><code class="o">),</code>
  <code class="nc">To</code><code class="o">(</code><code class="s">"you@example.org"</code><code class="o">),</code>
  <code class="n">msg</code><code class="o">)</code></pre>
</section>













<section data-type="sect2" id="discussion-pWswt0TV">
<h2>Discussion</h2>

<p>An implicit converts the <code>NodeSeq</code> into an <code>XHTMLMailBodyType</code>. This
ensures the mime type of the email is <code>text/html</code>. Despite the name of
"XHTML," the message is converted for transmission using
HTML5 semantics.<a data-type="indexterm" data-primary="HTML5" data-secondary="email semantics" id="id-9nCDtvF4txTV"></a><a data-type="indexterm" data-primary="XHTMLMailBodyType" id="id-ZbCBhMFMtdTd"></a></p>

<p>The character encoding for HTML email, UTF-8, can be changed by setting
<code>mail.charset</code> in your Lift properties file.<a data-type="indexterm" data-primary="UTF-8 character set" id="id-JnCzFjIDtJTQ"></a></p>

<p>If you want to set both the text and HTML version of a message, supply each body wrapped in the appropriate <code>BodyType</code> class:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">html</code> <code class="k">=</code> <code class="o">&lt;</code><code class="n">html</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">head</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="n">title</code><code class="o">&gt;</code><code class="nc">Hello</code><code class="o">&lt;/</code><code class="n">title</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="n">head</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">body</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="n">h1</code><code class="o">&gt;</code><code class="nc">Hello</code><code class="o">!&lt;/</code><code class="n">h1</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="n">body</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="n">html</code><code class="o">&gt;</code>

<code class="k">var</code> <code class="n">text</code> <code class="k">=</code> <code class="s">"Hello!"</code>

<code class="nc">Mailer</code><code class="o">.</code><code class="n">sendMail</code><code class="o">(</code>
  <code class="nc">From</code><code class="o">(</code><code class="s">"me@example.org"</code><code class="o">),</code>
  <code class="nc">Subject</code><code class="o">(</code><code class="s">"Hello"</code><code class="o">),</code>
  <code class="nc">To</code><code class="o">(</code><code class="s">"you@example.org"</code><code class="o">),</code>
  <code class="nc">PlainMailBodyType</code><code class="o">(</code><code class="n">text</code><code class="o">),</code>
  <code class="nc">XHTMLMailBodyType</code><code class="o">(</code><code class="n">html</code><code class="o">)</code>
<code class="o">)</code></pre>

<p>This message would be sent as a <code>multipart/alternative</code>:</p>

<pre data-type="programlisting">Content-Type: multipart/alternative;
  boundary="----=_Part_1_1197390963.1360226660982"
Date: Thu, 07 Feb 2013 02:44:22 -0600 (CST)

------=_Part_1_1197390963.1360226660982
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit

Hello!
------=_Part_1_1197390963.1360226660982
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: 7bit

&lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;Hello&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;h1&gt;Hello!&lt;/h1&gt;
      &lt;/body&gt;
    &lt;/html&gt;
------=_Part_1_1197390963.1360226660982--</pre>

<p>When receiving a message with this content, it is up to the mail client to decide which version to show (text or HTML).</p>
</section>













<section data-type="sect2" id="see-also-o8sNhqTy">
<h2>See Also</h2>

<p>For sending with attachments, see <a data-type="xref" href="#EmailWithAttachments">Sending Email with Attachments</a>.</p>
</section>





</section>













<section data-type="sect1" id="AuthEmail">
<h1>Sending Authenticated Email</h1>








<section data-type="sect2" id="problem-2kslFBc9">
<h2>Problem</h2>

<p>You need to authenticate with an SMTP server to send email.<a data-type="indexterm" data-primary="Lift applications" data-secondary="authenticated email" id="id-DnC1SWFwFQc2"></a><a data-type="indexterm" data-primary="email" data-secondary="authenticated" id="id-kVCEFpFLFqcD"></a><a data-type="indexterm" data-primary="SMTP servers" id="id-4nCkIYFVF4cJ"></a><a data-type="indexterm" data-primary="authentication" data-secondary="for email" id="id-JnCvtlFNFzcQ"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIKcV">
<h2>Solution</h2>

<p>Set the <code>Mailer.authenticator</code> in <code>Boot</code> with the credentials for your
SMTP server, and enable the <code>mail.smtp.auth</code> flag in your Lift properties
file.<a data-type="indexterm" data-primary="Mailer.authenticator" id="id-9nCDtvFlIecV"></a></p>

<p>Modify <em>Boot.scala</em> to include:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.</code><code class="o">{</code><code class="nc">Props</code><code class="o">,</code> <code class="nc">Mailer</code><code class="o">}</code>
<code class="k">import</code> <code class="nn">javax.mail.</code><code class="o">{</code><code class="nc">Authenticator</code><code class="o">,</code><code class="nc">PasswordAuthentication</code><code class="o">}</code>

<code class="nc">Mailer</code><code class="o">.</code><code class="n">authenticator</code> <code class="k">=</code> <code class="k">for</code> <code class="o">{</code>
  <code class="n">user</code> <code class="k">&lt;-</code> <code class="nc">Props</code><code class="o">.</code><code class="n">get</code><code class="o">(</code><code class="s">"mail.user"</code><code class="o">)</code>
  <code class="n">pass</code> <code class="k">&lt;-</code> <code class="nc">Props</code><code class="o">.</code><code class="n">get</code><code class="o">(</code><code class="s">"mail.password"</code><code class="o">)</code>
<code class="o">}</code> <code class="k">yield</code> <code class="k">new</code> <code class="nc">Authenticator</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">getPasswordAuthentication</code> <code class="k">=</code>
    <code class="k">new</code> <code class="nc">PasswordAuthentication</code><code class="o">(</code><code class="n">user</code><code class="o">,</code><code class="n">pass</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>In this example, we expect the username and password to come from Lift
properties, so we need to modify
<em>src/main/resources/props/default.props</em> to include them:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">mail</code><code class="o">.</code><code class="n">smtp</code><code class="o">.</code><code class="n">auth</code><code class="k">=</code><code class="kc">true</code>
<code class="n">mail</code><code class="o">.</code><code class="n">user</code><code class="k">=</code><code class="n">me</code><code class="nd">@example</code><code class="o">.</code><code class="n">org</code>
<code class="n">mail</code><code class="o">.</code><code class="n">password</code><code class="k">=</code><code class="n">correct</code> <code class="n">horse</code> <code class="n">battery</code> <code class="n">staple</code>
<code class="n">mail</code><code class="o">.</code><code class="n">smtp</code><code class="o">.</code><code class="n">host</code><code class="k">=</code><code class="n">smtp</code><code class="o">.</code><code class="n">sendgrid</code><code class="o">.</code><code class="n">net</code></pre>

<p>When you send email, the credentials in <em>default.props</em> will be used to authenticate with the SMTP server.</p>
</section>













<section data-type="sect2" id="discussion-o8sytAcy">
<h2>Discussion</h2>

<p>We’ve used Lift properties as a way to configure SMTP authentication.
This has the benefit of allowing us to enable authentication for just
some run modes. For example, if our <em>default.props</em> did not contain
authentication settings, but our <em>production.default.props</em> did, then no
authentication would happen in development mode, ensuring we can’t
accidentally send email outside of a production environment.</p>

<p>You don’t have to use a properties file for this: the Lift <code>Mailer</code>
also supports JNDI, or you could look up a username and password some other way and set <code>Mailer.authenticator</code> when you have the values.<a data-type="indexterm" data-primary="Java Naming and Directory Interface (JNDI)" id="id-ZbCnImIMtocd"></a><a data-type="indexterm" data-primary="Mailer" id="id-zdCbtzIDtlc7"></a></p>

<p>However, some mail services such as SendGrid do require <code>mail.smtp.auth=true</code> to be set, and that should go into your Lift properties file or set as a JVM argument: <span class="keep-together"><code>-Dmail.smtp.auth=true</code></span>.<a data-type="indexterm" data-primary="SendGrid" id="id-zdCXIvtDtlc7"></a></p>
</section>













<section data-type="sect2" id="see-also-g0sxhdc2">
<h2>See Also</h2>

<p>As well as <code>mail.smtp.auth</code>, there are a <a href="http://docs.oracle.com/javaee/5/api/javax/mail/package-summary.html">range of settings to control the Java Mail API</a>. Examples include controlling port numbers and timeouts.<a data-type="indexterm" data-primary="port numbers" id="id-ZbCnIMFahocd"></a><a data-type="indexterm" data-primary="timeouts" id="id-zdCbtGFJhlc7"></a></p>
</section>





</section>













<section data-type="sect1" id="EmailWithAttachments">
<h1>Sending Email with Attachments</h1>








<section data-type="sect2" id="problem-pWsqF2iV">
<h2>Problem</h2>

<p>You want to send an email with one or more attachments.<a data-type="indexterm" data-primary="Lift applications" data-secondary="email attachments" id="id-kVCkSpFLF7iD"></a><a data-type="indexterm" data-primary="email" data-secondary="attachments" id="id-4nC2FYFVF7iJ"></a><a data-type="indexterm" data-primary="Mailer" id="id-JnCmIlFNFAiQ"></a><a data-type="indexterm" data-primary="XHTMLPPlusImages" id="id-9nCDtvFpF4iV"></a></p>
</section>













<section data-type="sect2" id="solution-o8seIGiy">
<h2>Solution</h2>

<p>Use the <code>Mailer</code> <code>XHTMLPlusImages</code> to package a message with attachments.</p>

<p>Suppose we want to construct a CSV file and send it via email:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">content</code> <code class="k">=</code> <code class="s">"Planet,Discoverer\r\n"</code> <code class="o">+</code>
  <code class="s">"HR 8799 c, Marois et al\r\n"</code> <code class="o">+</code>
  <code class="s">"Kepler-22b, Kepler Science Team\r\n"</code>

<code class="k">case</code> <code class="k">class</code> <code class="nc">CSVFile</code><code class="o">(</code><code class="n">bytes</code><code class="k">:</code> <code class="kt">Array</code><code class="o">[</code><code class="kt">Byte</code><code class="o">],</code>
  <code class="n">filename</code><code class="k">:</code> <code class="kt">String</code> <code class="o">=</code> <code class="s">"file.csv"</code><code class="o">,</code>
  <code class="n">mime</code><code class="k">:</code> <code class="kt">String</code> <code class="o">=</code> <code class="s">"text/csv; charset=utf8; header=present"</code> <code class="o">)</code>

<code class="k">val</code> <code class="n">attach</code> <code class="k">=</code> <code class="nc">CSVFile</code><code class="o">(</code><code class="n">content</code><code class="o">.</code><code class="n">mkString</code><code class="o">.</code><code class="n">getBytes</code><code class="o">(</code><code class="s">"utf8"</code><code class="o">))</code>

<code class="k">val</code> <code class="n">body</code> <code class="k">=</code> <code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code><code class="nc">Please</code> <code class="n">research</code> <code class="n">the</code> <code class="n">enclosed</code><code class="o">.&lt;/</code><code class="n">p</code><code class="o">&gt;</code>

<code class="k">val</code> <code class="n">msg</code> <code class="k">=</code> <code class="nc">XHTMLPlusImages</code><code class="o">(</code><code class="n">body</code><code class="o">,</code>
  <code class="nc">PlusImageHolder</code><code class="o">(</code><code class="n">attach</code><code class="o">.</code><code class="n">filename</code><code class="o">,</code> <code class="n">attach</code><code class="o">.</code><code class="n">mime</code><code class="o">,</code> <code class="n">attach</code><code class="o">.</code><code class="n">bytes</code><code class="o">))</code>

<code class="nc">Mailer</code><code class="o">.</code><code class="n">sendMail</code><code class="o">(</code>
  <code class="nc">From</code><code class="o">(</code><code class="s">"me@example.org"</code><code class="o">,</code>
  <code class="nc">Subject</code><code class="o">(</code><code class="s">"Planets"</code><code class="o">),</code>
  <code class="nc">To</code><code class="o">(</code><code class="s">"you@example.org"</code><code class="o">),</code>
  <code class="n">msg</code><code class="o">)</code></pre>

<p>What’s happening here is that our message is an <code>XHTMLPlusImages</code> instance, which accepts
a body message and attachment.  The attachment, the <code>PlusImageHolder</code>, is an <code>Array[Byte]</code>, mime type, and a filename.</p>
</section>













<section data-type="sect2" id="discussion-g0s1tpi2">
<h2>Discussion</h2>

<p><code>XHTMLPlusImages</code> can also accept more than one <code>PlusImageHolder</code> if you
have more than one file to attach.  Although the name <code>PlusImageHolder</code> may suggest it is for attachment images, you can attach any kind of data as an <code>Array[Byte]</code> with an appropriate mime type.</p>

<p>By default, the attachment is sent with an <code>inline</code> disposition. This controls the <code>Content-Disposition</code> header in the message, and <code>inline</code> means the content is intended for display automatically when the message is shown.  The alternative is <code>attachment</code>, and this can be indicated with an optional final parameter to <code>PlusImageHolder</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">PlusImageHolder</code><code class="o">(</code><code class="n">attach</code><code class="o">.</code><code class="n">filename</code><code class="o">,</code> <code class="n">attach</code><code class="o">.</code><code class="n">mime</code><code class="o">,</code> <code class="n">attach</code><code class="o">.</code><code class="n">bytes</code><code class="o">,</code> <code class="n">attachment</code><code class="k">=</code><code class="kc">true</code><code class="o">)</code></pre>

<p>In reality, the mail client will display the message how it wants to, but this extra parameter may give you a little more control.</p>

<p>To attach a premade file, you can use <code>LiftRules.loadResource</code> to fetch content from the classpath.  If our project contained a file called <em>Kepler-22b_System_Diagram.jpg</em> in the <em>src/main/resources/</em> folder, we could load and attach it like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">filename</code> <code class="k">=</code> <code class="s">"Kepler-22b_System_Diagram.jpg"</code>

<code class="k">val</code> <code class="n">msg</code> <code class="k">=</code>
  <code class="k">for</code> <code class="o">(</code> <code class="n">bytes</code> <code class="k">&lt;-</code> <code class="nc">LiftRules</code><code class="o">.</code><code class="n">loadResource</code><code class="o">(</code><code class="s">"/"</code><code class="o">+</code><code class="n">filename</code><code class="o">)</code> <code class="o">)</code>
  <code class="k">yield</code> <code class="nc">XHTMLPlusImages</code><code class="o">(</code>
    <code class="o">&lt;</code><code class="n">p</code><code class="o">&gt;</code><code class="nc">Please</code> <code class="n">research</code> <code class="k">this</code> <code class="n">planet</code><code class="o">.&lt;/</code><code class="n">p</code><code class="o">&gt;,</code>
    <code class="nc">PlusImageHolder</code><code class="o">(</code><code class="n">filename</code><code class="o">,</code> <code class="s">"image/jpg"</code><code class="o">,</code> <code class="n">bytes</code><code class="o">)</code> <code class="o">)</code>

<code class="n">msg</code> <code class="k">match</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="n">m</code><code class="o">)</code> <code class="k">=&gt;</code>
    <code class="nc">Mailer</code><code class="o">.</code><code class="n">sendMail</code><code class="o">(</code>
      <code class="nc">From</code><code class="o">(</code><code class="s">"me@example.org"</code><code class="o">),</code>
      <code class="nc">Subject</code><code class="o">(</code><code class="s">"Planet attachment"</code><code class="o">),</code>
      <code class="nc">To</code><code class="o">(</code><code class="s">"you@example.org"</code><code class="o">),</code>
      <code class="n">m</code><code class="o">)</code>

  <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code>
    <code class="n">logger</code><code class="o">.</code><code class="n">error</code><code class="o">(</code><code class="s">"Planet file not found"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>As the content of <em>src/main/resources</em> is included on the classpath, we pass the filename to <code>loadResource</code> with a leading <code>/</code> character so the file can be found at the right place on the classpath.</p>

<p>The <code>loadResource</code> returns a <code>Box[Array[Byte]]</code> as we have no guarantee the file will exist. We map this to a <code>Box[XHTMLPlusImages]</code> and match on that result to either send the email or log that the file wasn’t found.</p>
</section>













<section data-type="sect2" id="see-also-q8sZhQiD">
<h2>See Also</h2>

<p>Messages are sent using the <code>multipart/related</code> mime heading, with an <code>inline</code> disposition. <a href="https://github.com/lift/framework/issues/1197">Lift ticket #1197</a> links to a discussion regarding <code>multipart/mixed</code> that may be preferable for working around issues with Microsoft Exchange.</p>

<p><a href="http://www.ietf.org/rfc/rfc2183.txt">RFC 2183</a> describes the <code>Content-Disposition</code> header.</p>
</section>





</section>













<section data-type="sect1" id="RunLater">
<h1>Run a Task Later</h1>








<section data-type="sect2" id="problem-o8skFkuy">
<h2>Problem</h2>

<p>You want to schedule code to run at some future time.<a data-type="indexterm" data-primary="Lift applications" data-secondary="delayed tasks" id="id-4nCqSYFVF0uJ"></a><a data-type="indexterm" data-primary="functions" data-secondary="delayed execution of" id="id-JnCzFlFNFyuQ"></a><a data-type="indexterm" data-primary="tasks" data-secondary="delayed execution of" id="id-9nCrIvFpFXuV"></a><a data-type="indexterm" data-primary="Schedule" id="id-ZbCPtMFXF8ud"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2I9u2">
<h2>Solution</h2>

<p>Use <code>net.liftweb.util.Schedule</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.Schedule</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="nc">Schedule</code><code class="o">(()</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="s">"doing it"</code><code class="o">),</code> <code class="mi">30</code> <code class="n">seconds</code><code class="o">)</code></pre>

<p>This would cause "doing it" to be printed on the console 30
seconds from now.</p>
</section>













<section data-type="sect2" id="discussion-q8svtbuD">
<h2>Discussion</h2>

<p>The signature for <code>Schedule</code> used previously expects a function of type <code>() =&gt; Unit</code>, which is the thing we want to happen in the future, and a <code>TimeSpan</code> from Lift’s <code>TimeHelpers</code>, which is when we want it to happen.  The <code>30 seconds</code> value gives us a <code>TimeSpan</code> via the <code>Helpers._</code> import, but there’s a variation called <code>perform</code> that accepts a <code>Long</code> millisecond value if you prefer that:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Schedule</code><code class="o">.</code><code class="n">perform</code><code class="o">(()</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="s">"doing it"</code><code class="o">),</code> <code class="mi">30</code><code class="o">*</code><code class="mi">1000L</code><code class="o">)</code></pre>

<p>Behind the scenes, Lift is making use of the <code>ScheduledExecutorService</code> from <code>java.util.concurrent</code> and, as such, returns a <code>ScheduledFuture[Unit]</code>.  You can use this future to <code>cancel</code> the operation before it runs.</p>

<p>It may be a surprise to find that you can call <code>Schedule</code> with just a function as an argument, and not a delay value.  This version runs the function immediately, but on a worker thread.  This is a convenient way to asynchronously run other tasks without going to the trouble of creating an actor for the purpose.</p>

<p>There is also a <code>Schedule.schedule</code> method that will send an
actor a specified message after a given delay.  This takes a <code>TimeSpan</code> delay, but again there’s also a <code>Schedule.perform</code> version that accepts a <code>Long</code> as a delay.</p>

<p>The <code>Helpers._</code> import brings with it some implicit conversions for <code>TimeSpan</code>. For example, a JodaTime <code>Period</code> can be given to <code>schedule</code> and that will be used as a delay before executing your function. Don’t be tempted in this situation to use a JodaTime <code>DateTime</code>. This would be converted to a <code>TimeSpan</code>, but doesn’t make sense as a delay.</p>
</section>













<section data-type="sect2" id="see-also-1Ls9hOuo">
<h2>See Also</h2>

<p><a data-type="xref" href="#RunTasksPeriodically">Run Tasks Periodically</a> includes an example of scheduling with actors.</p>

<p><code>ScheduledFuture</code> is documented via the <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/Future.html">Java Doc for <code>Future</code></a>.  If you’re building complex, low-level, cancellable concurrency functions, it’s advisable to have a copy of <em>Java Concurrency in Practice</em> close by (written by Goetz, <em>et al.</em>, Addison-Wesley Professional).</p>
</section>





</section>













<section data-type="sect1" id="RunTasksPeriodically">
<h1>Run Tasks Periodically</h1>








<section data-type="sect2" id="problem-g0swFbU2">
<h2>Problem</h2>

<p>You want a scheduled task to run periodically (repeatedly).<a data-type="indexterm" data-primary="Lift applications" data-secondary="repeat tasks" id="id-JnCDSlFNFwUQ"></a><a data-type="indexterm" data-primary="tasks" data-secondary="repeat execution of" id="id-9nCdFvFpFdUV"></a><a data-type="indexterm" data-primary="Schedule" id="id-ZbCnIMFXFQUd"></a></p>
</section>













<section data-type="sect2" id="solution-q8sGIdUD">
<h2>Solution</h2>

<p>Use <code>net.liftweb.util.Schedule</code> ensuring that you call <code>schedule</code> again
during your task to reschedule it. For example, using an actor:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.util.Schedule</code>
<code class="k">import</code> <code class="nn">net.liftweb.actor.LiftActor</code>
<code class="k">import</code> <code class="nn">net.liftweb.util.Helpers._</code>

<code class="k">object</code> <code class="nc">MyScheduledTask</code> <code class="k">extends</code> <code class="nc">LiftActor</code> <code class="o">{</code>

  <code class="k">case</code> <code class="k">class</code> <code class="nc">DoIt</code><code class="o">()</code>
  <code class="k">case</code> <code class="k">class</code> <code class="nc">Stop</code><code class="o">()</code>

  <code class="k">private</code> <code class="k">var</code> <code class="n">stopped</code> <code class="k">=</code> <code class="kc">false</code>

   <code class="k">def</code> <code class="n">messageHandler</code> <code class="k">=</code> <code class="o">{</code>
     <code class="k">case</code> <code class="nc">DoIt</code> <code class="k">if</code> <code class="o">!</code><code class="n">stopped</code> <code class="k">=&gt;</code>
        <code class="nc">Schedule</code><code class="o">.</code><code class="n">schedule</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="nc">DoIt</code><code class="o">,</code> <code class="mi">10</code> <code class="n">minutes</code><code class="o">)</code>
       <code class="c1">// ... do useful work here</code>

     <code class="k">case</code> <code class="nc">Stop</code> <code class="k">=&gt;</code>
       <code class="n">stopped</code> <code class="k">=</code> <code class="kc">true</code>
   <code class="o">}</code>
<code class="o">}</code></pre>

<p>The example creates a <code>LiftActor</code> for the work to be done. On receipt of
a <code>DoIt</code> message, the actor reschedules itself before doing whatever
useful work needs to be done. In this way, the actor will be called
every 10 minutes.</p>
</section>













<section data-type="sect2" id="discussion-1Lswt4Uo">
<h2>Discussion</h2>

<p>The <code>Schedule.schedule</code> call is ensuring that <code>this</code> actor is sent the
<code>DoIt</code> message after 10 minutes.</p>

<p>To start this process off, possibly in <em>Boot.scala</em>, just send the
<code>DoIt</code> message to the actor:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">MyScheduledTask</code> <code class="o">!</code> <code class="nc">MyScheduledTask</code><code class="o">.</code><code class="nc">DoIt</code></pre>

<p>To ensure the process stops correctly when Lift shuts down, we register
a shutdown hook in <em>Boot.scala</em> to send the <code>Stop</code> message to prevent
future reschedules:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">unloadHooks</code><code class="o">.</code><code class="n">append</code><code class="o">(</code> <code class="o">()</code> <code class="k">=&gt;</code> <code class="nc">MyScheduledTask</code> <code class="o">!</code> <code class="nc">MyScheduledTask</code><code class="o">.</code><code class="nc">Stop</code> <code class="o">)</code></pre>

<p>Without the <code>Stop</code> message, the actor would continue to be rescheduled
until the JVM exits. This may be acceptable, but note that during
development with SBT, without the <code>Stop</code> message, you will continue to
schedule tasks after issuing the <code>container:stop</code> command.</p>

<p>Schedule returns a <code>ScheduledFuture[Unit]</code> from the Java concurrency
library, which allows you to <code>cancel</code> the activity.</p>
</section>













<section data-type="sect2" id="see-also-YmsghBUk">
<h2>See Also</h2>

<p>Chapter 1 of <em>Lift in Action</em> (by Perrett, Manning Publications, Co.) includes a Comet Actor clock example that uses <code>Schedule</code>.</p>
</section>





</section>













<section data-type="sect1" id="FetchURLs">
<h1>Fetching URLs</h1>








<section data-type="sect2" id="problem-q8sAFLCD">
<h2>Problem</h2>

<p>You want your Lift application to fetch a URL and process it as text, JSON, XML, or HTML.<a data-type="indexterm" data-primary="Lift applications" data-secondary="fetching URLs" id="id-9nCjSvFpF0CV"></a><a data-type="indexterm" data-primary="URLs" data-secondary="fetching" id="id-ZbC1FMFXFZCd"></a><a data-type="indexterm" data-primary="Dispatch library" id="id-zdCXIGFWF2C7"></a><a data-type="indexterm" data-primary="HTTP" data-secondary="interaction" id="id-yYCgtpF9FvCn"></a></p>
</section>













<section data-type="sect2" id="solution-1LsEIeCo">
<h2>Solution</h2>

<p>Use <em>Dispatch</em>, "a library for asynchronous HTTP interaction."</p>

<p>Before you start, include Dispatch dependency in <em>build.sbt</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">libraryDependencies</code> <code class="o">+=</code> <code class="s">"net.databinder.dispatch"</code> <code class="o">%%</code> <code class="s">"dispatch-core"</code> <code class="o">%</code> <code class="s">"0.9.5"</code></pre>

<p>Using the example from the Dispatch documentation, we can make an HTTP request to try to determine the country from the service at <a href="http://www.hostip.info/use.html"><em class="hyperlink">http://www.hostip.info/use.html</em></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">dispatch._</code>
<code class="k">val</code> <code class="n">svc</code> <code class="k">=</code> <code class="n">url</code><code class="o">(</code><code class="s">"http://api.hostip.info/country.php"</code><code class="o">)</code>
<code class="k">val</code> <code class="n">country</code> <code class="k">:</code> <code class="kt">Promise</code><code class="o">[</code><code class="kt">String</code><code class="o">]</code> <code class="k">=</code> <code class="nc">Http</code><code class="o">(</code><code class="n">svc</code> <code class="nc">OK</code> <code class="n">as</code><code class="o">.</code><code class="nc">String</code><code class="o">)</code>

<code class="n">println</code><code class="o">(</code><code class="n">country</code><code class="o">())</code></pre>

<p>Note that the result <code>country</code> is not a <code>String</code> but a <code>Promise[String]</code>, and we use <span class="keep-together"><code>apply</code></span> to wait for the resulting value.</p>

<p>The result printed will be a country code such as <code>GB</code>, or <code>XX</code> if the country cannot be determined from your IP address.</p>
</section>













<section data-type="sect2" id="discussion-YmsMtyCk">
<h2>Discussion</h2>

<p>This short example expects a 200 (OK) status result and turns the result into a <code>String</code>, but that’s a tiny part of what Dispatch is capable of.  We’ll explore further in this section.<a data-type="indexterm" data-primary="HTTP" data-secondary="status codes" id="id-yYCyFpFvtvCn"></a><a data-type="indexterm" data-primary="200 status code" id="id-VMCQIrFktZCd"></a></p>

<p>What if the request doesn’t return a 200? In that case, with the code we have, we’d get an exception such as: "Unexpected response status: 404." There are a few ways to change that.<a data-type="indexterm" data-primary="404 status" id="id-yYCAS1IvtvCn"></a><a data-type="indexterm" data-primary="unexpected response (404) status" id="id-VMCpFoIktZCd"></a></p>

<p>We can ask for an <code>Option</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">result</code> <code class="k">:</code> <code class="kt">Option</code><code class="o">[</code><code class="kt">String</code><code class="o">]</code> <code class="k">=</code> <code class="n">country</code><code class="o">.</code><code class="n">option</code><code class="o">()</code></pre>

<p>As you’d expect, this will give a <code>None</code> or <code>Some[String]</code>. However, if you have debug level logging enabled in your application, you’ll see the request and response and error messages from the underlying Netty library.  You can tune these messages by adding a logger setting to <em>default.logback.xml</em> file<a data-type="indexterm" data-primary="Netty library" id="id-OnCVtrTytdCK"></a>:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true"><code class="nt">&lt;logger</code> <code class="na">name=</code><code class="s">"com.ning.http.client"</code> <code class="na">level=</code><code class="s">"WARN"</code><code class="nt">/&gt;</code></pre>

<p>A second possibility is to use <code>either</code> with the usual convention that the <code>Right</code> is the expected result and <code>Left</code> signifies a failure:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">country</code><code class="o">.</code><code class="n">either</code><code class="o">()</code> <code class="k">match</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Left</code><code class="o">(</code><code class="n">status</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="n">status</code><code class="o">.</code><code class="n">getMessage</code><code class="o">)</code>
  <code class="k">case</code> <code class="nc">Right</code><code class="o">(</code><code class="n">cc</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">println</code><code class="o">(</code><code class="n">cc</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>This will print a result as we are forcing the evaluation with an apply via <code>either()</code>.</p>

<p><code>Promise[T]</code> implements <code>map</code>, <code>flatMap</code>, <code>filter</code>, <code>fold</code>, and all the usual methods you’d expect it to allow you to compose.  This means you can use the promise with a <code>for</code> <span class="keep-together">comprehension:</span></p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">codeLength</code> <code class="k">=</code> <code class="k">for</code> <code class="o">(</code><code class="n">cc</code> <code class="k">&lt;-</code> <code class="n">country</code><code class="o">)</code> <code class="k">yield</code> <code class="n">cc</code><code class="o">.</code><code class="n">length</code></pre>

<p>Note that <code>codeLength</code> is a <code>Promise[Int]</code>. To get the value, you can evaluate <code>codeLength()</code> and you’ll get a result of <code>2</code>.</p>

<p>As well as extracting string values with <code>as.String</code>, there are other options, including:</p>
<dl>
<dt><code>as.Bytes</code></dt>
<dd>
<p>To work with <code>Promise[Array[Byte]]</code></p>
</dd>
<dt><code>as.File</code></dt>
<dd>
<p>To write to a file, as in <code>Http(svc &gt; as.File(new File("/tmp/cc")))</code></p>
</dd>
<dt><code>as.Response</code></dt>
<dd>
<p>To allow you to provide a <code>client.Response =&gt; T</code> function to use on the response</p>
</dd>
<dt><code>as.xml.Elem</code></dt>
<dd>
<p>To parse an XML response</p>
</dd>
</dl>

<p>As an example of <code>as.xml.Elem</code>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">svc</code> <code class="k">=</code> <code class="n">url</code><code class="o">(</code><code class="s">"http://api.hostip.info/?ip=12.215.42.19"</code><code class="o">)</code>
<code class="k">val</code> <code class="n">country</code>  <code class="k">=</code> <code class="nc">Http</code><code class="o">(</code><code class="n">svc</code> <code class="o">&gt;</code> <code class="n">as</code><code class="o">.</code><code class="n">xml</code><code class="o">.</code><code class="nc">Elem</code><code class="o">)</code>
<code class="n">println</code><code class="o">(</code><code class="n">country</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code> <code class="o">\\</code> <code class="s">"description"</code><code class="o">)())</code></pre>

<p>This example is parsing the XML response to the request, which returns a <code>Promise[scala.xml.Elem]</code>.  We’re picking out the description node of the XML via a <code>map</code>, which will be a <code>Promise[NodeSeq]</code> that we then force to evaluate.  The output is something like:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true"><code class="nt">&lt;gml:description</code>
  <code class="na">xmlns:xsi=</code><code class="s">"http://www.w3.org/2001/XMLSchema-instance"</code>
  <code class="na">xmlns:gml=</code><code class="s">"http://www.opengis.net/gml"</code><code class="nt">&gt;</code>
     This is the Hostip Lookup Service
<code class="nt">&lt;/gml:description&gt;</code></pre>

<p>That example assumes the request is going to be well formed. In addition to the core Databinder library, there are extensions for JSoup and TagSoup to assist in parsing HTML that isn’t necessarily well formed.<a data-type="indexterm" data-primary="JSoup" id="id-lrCPSYTZtwCG"></a><a data-type="indexterm" data-primary="TagSoup" id="id-nxCzFKTxtQCY"></a><a data-type="indexterm" data-primary="Databinder library" id="id-NnCaI2TwtMCg"></a></p>

<p>For example, to use JSoup, include the dependency:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">libraryDependencies</code> <code class="o">+=</code> <code class="s">"net.databinder.dispatch"</code> <code class="o">%%</code> <code class="s">"dispatch-jsoup"</code> <code class="o">%</code> <code class="s">"0.9.5"</code></pre>

<p>You can then use the features of JSoup, such as picking out elements of a page using CSS selectors:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">org.jsoup.nodes.Document</code>

<code class="k">val</code> <code class="n">svc</code> <code class="k">=</code> <code class="n">url</code><code class="o">(</code><code class="s">"http://www.example.org"</code><code class="o">).</code><code class="n">setFollowRedirects</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code>
<code class="k">val</code> <code class="n">title</code> <code class="k">=</code> <code class="nc">Http</code><code class="o">(</code><code class="n">svc</code> <code class="o">&gt;</code> <code class="n">as</code><code class="o">.</code><code class="n">jsoup</code><code class="o">.</code><code class="nc">Document</code><code class="o">).</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">select</code><code class="o">(</code><code class="s">"h1"</code><code class="o">).</code><code class="n">text</code><code class="o">).</code><code class="n">option</code>
<code class="n">println</code><code class="o">(</code> <code class="n">title</code><code class="o">()</code> <code class="n">getOrElse</code> <code class="s">"unknown title"</code> <code class="o">)</code></pre>

<p>Here we are applying JSoup’s <code>select</code> function to pick out the <code>&lt;h1&gt;</code> element on the page, taking the text of the element, which we turn into a <code>Promise[Option[String]]</code>.  The result, unless <em>example.org</em> has changed, will be "Example Domain."</p>

<p>As a final example of using Dispatch, we can pipe a request into Lift’s JSON library:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftweb.json._</code>
<code class="k">import</code> <code class="nn">com.ning.http.client</code>

<code class="k">object</code> <code class="nc">asJson</code> <code class="k">extends</code> <code class="o">(</code><code class="n">client</code><code class="o">.</code><code class="nc">Response</code> <code class="k">=&gt;</code> <code class="nc">JValue</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">def</code> <code class="n">apply</code><code class="o">(</code><code class="n">r</code><code class="k">:</code> <code class="kt">client.Response</code><code class="o">)</code> <code class="k">=</code> <code class="nc">JsonParser</code><code class="o">.</code><code class="n">parse</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="n">getResponseBody</code><code class="o">)</code>
<code class="o">}</code>

<code class="k">val</code> <code class="n">svc</code> <code class="k">=</code> <code class="n">url</code><code class="o">(</code><code class="s">"http://api.hostip.info/get_json.php?ip=212.58.241.131"</code><code class="o">)</code>
<code class="k">val</code> <code class="n">json</code> <code class="k">:</code> <code class="kt">Promise</code><code class="o">[</code><code class="kt">JValue</code><code class="o">]</code> <code class="k">=</code> <code class="nc">Http</code><code class="o">(</code><code class="n">svc</code> <code class="o">&gt;</code> <code class="n">asJson</code><code class="o">)</code>

<code class="k">case</code> <code class="k">class</code> <code class="nc">HostInfo</code><code class="o">(</code><code class="n">country_name</code><code class="k">:</code> <code class="kt">String</code><code class="o">,</code> <code class="n">country_code</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code>
<code class="k">implicit</code> <code class="k">val</code> <code class="n">formats</code> <code class="k">=</code> <code class="nc">DefaultFormats</code>

<code class="k">val</code> <code class="n">hostInfo</code> <code class="k">=</code> <code class="n">json</code><code class="o">.</code><code class="n">map</code><code class="o">(</code><code class="k">_</code><code class="o">.</code><code class="n">extract</code><code class="o">[</code><code class="kt">HostInfo</code><code class="o">])()</code></pre>

<p>The URL we’re calling returns a JSON representation for location information of the IP address we’ve passed.</p>

<p>By providing a <code>Response =&gt; JValue</code> to Dispatch, we’re able to pass the response body through to the JSON parser. We can then map on the <code>Promise[JValue]</code> to apply whatever Lift JSON functions we want to. In this case, we’re extracting a simple case class.</p>

<p>The result would show <code>hostInfo</code> as:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">HostInfo</code><code class="o">(</code><code class="nc">UNITED</code> <code class="nc">KINGDOM</code><code class="o">,</code><code class="nc">GB</code><code class="o">)</code></pre>
</section>













<section data-type="sect2" id="see-also-vJskhaCo">
<h2>See Also</h2>

<p><a href="http://dispatch.databinder.net/Dispatch.html">The Dispatch documentation</a> is well written and guides you through the way Dispatch approaches HTTP. Do spend some time with it.</p>

<p>For questions about Dispatch, the best place is the <a href="https://groups.google.com/forum/#!forum/dispatch-scala">Dispatch Google Group</a>.</p>

<p>The previous major version of Dispatch, 0.8.x ("Dispatch Classic"), is quite different from the "reboot" of the project as version 0.9.  Consequently, examples you may see that use 0.8.x will need some conversion to run with 0.9.x. <a href="http://bit.ly/14Bm6LS">Nathan Hamblen’s blog</a> describes the change.</p>

<p>For working with JSoup, take a look at the <a href="http://jsoup.org/cookbook/">JSoup Cookbook</a>.</p>
</section>





</section>







</section>














<section data-type="chapter" id="deployment">
<h1>Production Deployment</h1>


<p>Deploying a Lift application to production means little more than packaging it and ensuring you set the <em>run mode</em> to <code>production</code>. The recipes in this chapter show how to do this for various hosted services.<a data-type="indexterm" id="ix_LApd" data-primary="Lift applications" data-secondary="production deployment of"></a></p>

<p>You can also install and run a <em>container</em> such as Tomcat or Jetty on your own servers. Containers were introduced in <a data-type="xref" href="#RunningYourApplication">Running your application</a>. This brings with it the need to understand how to install, configure, start, stop, and manage each container, and how to integrate it with load balancers or other frontends. These are large topics, and you can find out more from such sources as<a data-type="indexterm" data-primary="Tomcat" id="id-W7CQIGIl"></a><a data-type="indexterm" data-primary="Jetty" id="id-e4CLt8Iz"></a><a data-type="indexterm" data-primary="containers" data-secondary="deployment to" id="id-GnCEhjIz"></a><a data-type="indexterm" data-primary="load balancers" id="id-DnCJTbIa"></a>:</p>

<ul>
<li>
<p>The deployment section of the <a href="https://www.assembla.com/spaces/liftweb/wiki/Deployment">Lift wiki</a>.</p>
</li>
<li>
<p>Timothy Perrett, <em>Lift in Action</em>, Chapter 15, "Deployment and Scaling," Manning Publications, Co.</p>
</li>
<li>
<p>Jason Brittain and Ian F. Darwin, <em>Tomcat: The Definitive Guide</em>, O’Reilly Media, Inc.</p>
</li>
<li>
<p>Tanuj Khare, <em>Apache Tomcat 7 Essentials</em>, Packt Publishing.</p>
</li>
</ul>

<p>The Lift wiki includes a page on <a href="https://www.assembla.com/spaces/liftweb/wiki/Tomcat">Tomcat configuration options relevant to Lift</a>.</p>






<section data-type="sect1" id="CloudBees">
<h1>Deploying to CloudBees</h1>








<section data-type="sect2" id="problem-2kslFrTj">
<h2>Problem</h2>

<p>You have an account with the CloudBees PaaS hosting environment, and you
want to deploy your Lift application there.<a data-type="indexterm" id="ix_PDcbee" data-primary="production deployments" data-secondary="to CloudBees"></a><a data-type="indexterm" id="ix_cbee" data-primary="CloudBees"></a><a data-type="indexterm" id="ix_HOSTcbee" data-primary="hosting" data-secondary="with CloudBees"></a></p>
<div data-type="caution" id="id-DDUXIWFGTm"><h6>Caution</h6>
<p>CloudBees have announced they are closing their hosting service as of 31st December 2014.</p>
</div>
</section>













<section data-type="sect2" id="solution-pWsZI0TP">
<h2>Solution</h2>

<p>Use the SBT <code>package</code> command to produce a WAR file that can be deployed
to CloudBees, and then use the CloudBees SDK to configure and deploy your
application.<a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="using CloudBees with" id="id-4nC2FYFMIXT1"></a><a data-type="indexterm" data-primary="WAR files" id="id-JnCmIlFpIJTv"></a><a data-type="indexterm" data-primary="files" data-secondary="WAR files" id="id-9nCDtvFlIxTN"></a></p>

<p>From within the CloudBees "Grand Central" console, create a new application under your account. In what follows, we’ll assume your account is called <code>myaccount</code> and your application is called <code>myapp</code>.</p>

<p>For the best performance, you will want to ensure the Lift run mode is set to
"production." Do this from the CloudBees SDK command line:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees config:set -a myaccount/myapp run.mode<code class="o">=</code>production</pre>

<p>This will set the run mode to production for your CloudBees applications
identified as <code>myaccount/myapp</code>. Omitting the <code>-a</code> will set it for your
whole CloudBees account.</p>

<p>CloudBees will remember this setting, so you only need to do it once.</p>

<p>You can then deploy:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>sbt package
...
<code class="o">[</code>info<code class="o">]</code> Packaging /Users/richard/myapp/target/scala-2.9.1/myapp.war...
...
<code class="nv">$ </code>bees app:deploy -a myaccount/myapp ./target/scala-2.9.1/myapp.war</pre>

<p>This will send your WAR file to CloudBees and deploy it.  You’ll see the location (URL) of your application output from the bees <code>app:deploy</code> command when it completes.</p>

<p>If you change a configuration setting, you will need to restart the application for the setting
to take effect. Deploying the application will do this, otherwise, run the <code>bees app:restart</code> command:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:restart -a myaccount/myapp</pre>
</section>













<section data-type="sect2" id="discussion-o8sytqTZ">
<h2>Discussion</h2>

<p>If you are deploying an application to multiple CloudBees
instances, be aware that, by default, CloudBees will round robin requests
to each instance. If you use any of Lift’s state features, you’ll want to
enable session affinity (sticky sessions)<a data-type="indexterm" data-primary="session affinity" id="id-4nCqSYFNtXT1"></a><a data-type="indexterm" data-primary="sticky sessions" id="id-JnCzFlFDtJTv"></a><a data-type="indexterm" data-primary="browsers" data-secondary="session affinity" id="id-9nCrIvF4txTN"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="stateful features of" id="id-ZbCPtMFMtdTn"></a><a data-type="indexterm" data-primary="Comet" data-secondary="and CloudBees" id="id-zdCrhGFDtbTA"></a>:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:update -a myaccount/myapp <code class="nv">stickySession</code><code class="o">=</code><code class="nb">true</code></pre>

<p>If you are using Comet, it’ll work fine, but the CloudBees default is to enable
<em>request buffering</em>. This allows CloudBees to do smart things, such as rerouting
requests in a cluster if one machine does not respond. A
consequence of request buffering is that long-polling Comet requests will time out more
often. To turn this feature off, run the following<a data-type="indexterm" data-primary="request buffering" id="id-ZbC1FltMtdTn"></a>:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:update -a myaccount/myapp <code class="nv">disableProxyBuffering</code><code class="o">=</code><code class="nb">true</code></pre>

<p>As with the run mode setting, CloudBees will remember these settings, so you
only need to set them once.</p>

<p>Finally, you may want to increase the <em>permanent generation</em> memory setting of the JVM. By default, an application has 64 MB assigned for the PermGen. To increase this to 128 MB, run the <code>bees app:update</code> command<a data-type="indexterm" data-primary="permanent generation" id="id-rjCeIqcxtVTp"></a><a data-type="indexterm" data-primary="Java Virtual Machine (JVM)" data-secondary="troubleshooting" id="id-wqCDtncBtbTk"></a>:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:update -a myaccount/myapp <code class="nv">jvmPermSize</code><code class="o">=</code>128</pre>

<p>The commands <code>bees app:info</code> and <code>bees config:list</code> will report back the settings for your application.</p>










<section data-type="sect3" id="rdbms-configuration-8kskUQt2TZ">
<h3>RDBMS configuration</h3>

<p>If you are using a SQL database in your application, you’ll want to
configure <em>src/main/webapp/WEB-INF/cloudbees-web.xml</em>. For
example<a data-type="indexterm" data-primary="RDBMS (Relational Database Management System)" id="id-PnCxF7FzUKt7T4"></a><a data-type="indexterm" data-primary="SQL databases" id="id-OnCOImFoUWtVT1"></a><a data-type="indexterm" data-primary="databases" data-secondary="configuring connections to" id="id-XmCbtOFeUqtXTm"></a>:</p>

<pre data-type="programlisting" data-code-language="xml" data-highlighted="true"><code class="cp">&lt;?xml version="1.0"?&gt;</code>
<code class="nt">&lt;cloudbees-web-app</code> <code class="na">xmlns=</code><code class="s">"http://www.cloudbees.com/xml/webapp/1"</code><code class="nt">&gt;</code>

<code class="nt">&lt;appid&gt;</code>myaccount/myapp<code class="nt">&lt;/appid&gt;</code>

<code class="nt">&lt;resource</code> <code class="na">name=</code><code class="s">"jdbc/mydb"</code> <code class="na">auth=</code><code class="s">"Container"</code> <code class="na">type=</code><code class="s">"javax.sql.DataSource"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"username"</code> <code class="na">value=</code><code class="s">"dbuser"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"password"</code> <code class="na">value=</code><code class="s">"dbpassword"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"url"</code> <code class="na">value=</code><code class="s">"jdbc:cloudbees://mydb"</code> <code class="nt">/&gt;</code>

  <code class="c">&lt;!-- For these connections settings, see:</code>
<code class="c">   http://commons.apache.org/dbcp/configuration.html</code>
<code class="c">  --&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"maxActive"</code> <code class="na">value=</code><code class="s">"10"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"maxIdle"</code> <code class="na">value=</code><code class="s">"2"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"maxWait"</code> <code class="na">value=</code><code class="s">"15000"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"removeAbandoned"</code> <code class="na">value=</code><code class="s">"true"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"removeAbandonedTimeout"</code> <code class="na">value=</code><code class="s">"300"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"logAbandoned"</code> <code class="na">value=</code><code class="s">"true"</code> <code class="nt">/&gt;</code>

  <code class="c">&lt;!-- Avoid idle timeouts --&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"validationQuery"</code> <code class="na">value=</code><code class="s">"SELECT 1"</code> <code class="nt">/&gt;</code>
  <code class="nt">&lt;param</code> <code class="na">name=</code><code class="s">"testOnBorrow"</code> <code class="na">value=</code><code class="s">"true"</code> <code class="nt">/&gt;</code>

 <code class="nt">&lt;/resource&gt;</code>

<code class="nt">&lt;/cloudbees-web-app&gt;</code></pre>

<p>This is a JNDI database configuration, defining a connection to a
CloudBees database called <code>mydb</code>. This will be used by Lift if the JNDI
name<a data-type="indexterm" data-primary="Java Naming and Directory Interface (JNDI)" id="id-XmCpFLteUqtXTm"></a> is referenced in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">DefaultConnectionIdentifier</code><code class="o">.</code><code class="n">jndiName</code> <code class="k">=</code> <code class="s">"jdbc/mydb"</code>

<code class="k">if</code> <code class="o">(!</code><code class="nc">DB</code><code class="o">.</code><code class="n">jndiJdbcConnAvailable_?</code><code class="o">)</code> <code class="o">{</code>
  <code class="c1">// set up alternative local database connection here</code>
<code class="o">}</code></pre>

<p>Because the JNDI setting is only defined in <em>cloudbees-web.xml</em>, it will
only be available in a CloudBees environment. This means you can develop
against a different database locally and use your CloudBees database
when deploying.</p>
</section>













<section data-type="sect3" id="host-ip-and-port-number-m8sWCQtLT2">
<h3>Host IP and port number</h3>

<p>Generally, you don’t need to know about your deployed instance’s public host name and port number. Requests to your application URL are routed to a specific instance by CloudBees. However there are situations, especially when you have multiple instances, where you do need to find this out. For example, if you want to receive messages from Amazon’s Simple Notification Service (SNS), then each instance will need to give a direct URL to SNS when the application boots.<a data-type="indexterm" data-primary="Amazon’s Simple Notification Service (SNS)" id="id-PnCpS7FaCKt7T4"></a><a data-type="indexterm" data-primary="public hostnames" id="id-OnCLFmFJCWtVT1"></a><a data-type="indexterm" data-primary="port numbers" id="id-XmCKIOFmCqtXTm"></a></p>

<p>CloudBees has provided <a href="http://bit.ly/163GynV">documentation on how to do this</a>. To get the public hostname, you need to make an HTTP request to <em><a href="http://instance-data/latest/meta-data/public-hostname"><em class="hyperlink">http://instance-data/latest/meta-data/public-hostname</em></a></em>. For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">io.Source</code>

<code class="k">val</code> <code class="n">beesPublicHostname</code> <code class="k">:</code> <code class="kt">Box</code><code class="o">[</code><code class="kt">String</code><code class="o">]</code> <code class="k">=</code> <code class="n">tryo</code> <code class="o">{</code>
  <code class="nc">Source</code><code class="o">.</code><code class="n">fromURL</code><code class="o">(</code><code class="s">"http://instance-data/latest/meta-data/public-hostname"</code><code class="o">).</code>
    <code class="n">getLines</code><code class="o">().</code><code class="n">toStream</code><code class="o">.</code><code class="n">head</code>
<code class="o">}</code></pre>

<p>This will return a <code>Full</code> hostname on the CloudBees environment, but when running locally will fail and return a <code>Failure</code>. For example:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Failure</code><code class="o">(</code><code class="n">instance</code><code class="o">-</code><code class="n">data</code><code class="o">,</code><code class="nc">Full</code><code class="o">(</code><code class="n">java</code><code class="o">.</code><code class="n">net</code><code class="o">.</code><code class="nc">UnknownHostException</code><code class="k">:</code> <code class="kt">instance-data</code><code class="o">),</code><code class="nc">Empty</code><code class="o">)</code></pre>

<p>The port number can be found from the name of a file in the <em>.genapps/ports</em> folder of your application deployment:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">val</code> <code class="n">beesPort</code> <code class="k">:</code> <code class="kt">Option</code><code class="o">[</code><code class="kt">Int</code><code class="o">]</code> <code class="k">=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">portsDir</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">File</code><code class="o">(</code><code class="nc">System</code><code class="o">.</code><code class="n">getenv</code><code class="o">(</code><code class="s">"PWD"</code><code class="o">),</code> <code class="s">".genapp/ports"</code><code class="o">)</code>
  <code class="k">for</code> <code class="o">{</code>
    <code class="n">files</code> <code class="k">&lt;-</code> <code class="nc">Option</code><code class="o">(</code><code class="n">portsDir</code><code class="o">.</code><code class="n">list</code><code class="o">)</code>
    <code class="n">port</code> <code class="k">&lt;-</code> <code class="n">files</code><code class="o">.</code><code class="n">flatMap</code><code class="o">(</code><code class="n">asInt</code><code class="o">).</code><code class="n">headOption</code>
  <code class="o">}</code> <code class="k">yield</code> <code class="n">port</code>
<code class="o">}</code></pre>

<p>The <code>java.io.File list</code> method returns a list of filenames in a directory, but will return <code>null</code> if the directory doesn’t exist or if there are any IO errors.  For this reason, we wrap it in <code>Option</code> to convert <code>null</code> values to <code>None</code>.</p>

<p>Running locally, this will return a <code>None</code>, but on CloudBees, you’ll see a <code>Full[Int]</code> port number.</p>

<p>You might put these two values together as follows:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">java.net.InetAddress</code>

<code class="k">val</code> <code class="n">hostAndPort</code> <code class="k">:</code> <code class="kt">String</code> <code class="o">=</code>
  <code class="o">(</code><code class="n">beesPublicHostname</code> <code class="n">openOr</code> <code class="nc">InetAddress</code><code class="o">.</code><code class="n">getLocalHost</code><code class="o">.</code><code class="n">getHostAddress</code><code class="o">)</code> <code class="o">+</code>
  <code class="s">":"</code> <code class="o">+</code> <code class="o">(</code><code class="n">beesPort</code> <code class="n">getOrElse</code> <code class="mi">8080</code><code class="o">).</code><code class="n">toString</code></pre>

<p>Running locally, <code>hostAndPort</code> might be <code>192.168.1.60:8080</code> and running on CloudBees, it would be something like <code>ec2-204-236-222-252.compute-1.amazonaws.com:8520</code>.</p>
</section>













<section data-type="sect3" id="java-version-dbspsGt9TL">
<h3>Java version</h3>

<p>Currently the default JVM provided by CloudBees is JDK 7, but you can select 6, 7, and 8.
To change the default Java Virtual Machine, use the <code>bees config:set</code> command: <a data-type="indexterm" data-primary="Java Virtual Machine (JVM)" data-secondary="and CloudBees" id="id-XmCpFOFqsqtXTm"></a></p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees config:set -a myaccount/myapp -Rjava_version<code class="o">=</code>1.8</pre>

<p>Excluding the application identifier <code>-a myaccount/myapp</code> from the command will set the JVM as the default for all applications in the account. The  <code>bees config:set</code> command will update the configuration, but not take effect until the application has been updated or restarted.</p>

<p>The JVM can also be changed when an application is deployed or updated via the following commands:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:deploy -a myaccount/myapp sample.war -Rjava_version<code class="o">=</code>1.6
<code class="nv">$ </code>bees app:update -a myaccount/myapp -Rjava_version<code class="o">=</code>1.7</pre>

<p>To confirm which JVM an application is currently running, use the
<code>bees config:list</code> command, which will display the Java version:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees config:list -a myaccount/myapp
Runtime Parameters:
  <code class="nv">java_version</code><code class="o">=</code>1.6</pre>
</section>













<section data-type="sect3" id="container-version-BVsOHJtGTO">
<h3>Container version</h3>

<p>CloudBees offers several containers: Tomcat 6.0.32 (the default), Tomcat 7, JBoss 7.02, JBoss 7.1, and GlassFish 3.<a data-type="indexterm" data-primary="containers" data-secondary="and CloudBees" id="id-XmC9SOF7HqtXTm"></a><a data-type="indexterm" data-primary="Tomcat" id="id-jyClFoFOHXt1TV"></a><a data-type="indexterm" data-primary="JBoss" id="id-2nCeIjFDHVt9Td"></a></p>

<p>To change containers, the application will need to be redeployed, as CloudBees uses different file configurations for the various containers.<a data-type="indexterm" data-primary="files" data-secondary="container-specific configuration" id="id-jyCxSEIOHXt1TV"></a>  Hence we use the <code>bees app:deploy</code> command. The following example updates to Tomcat 7:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:deploy -t tomcat7 -a myaccount/myapp sample.war</pre>

<p>The JVM and container commands can be run as a single <code>bees app:deploy</code>, as follows:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:deploy -t tomcat -a myaccount/myapp sample.war -Rjava_version<code class="o">=</code>1.6</pre>

<p>This would deploy <em>sample.war</em> to the <code>myapp</code> application on <code>myaccount</code> with Tomcat 6.0.32 and JDK 6.</p>

<p>To determine which container an application is deployed to, use the command <code>bees app:info</code>:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>bees app:info -a myaccount/myapp
Application     : myaccount/myapp
Title           : myapp
Created         : Wed Mar <code class="m">20</code> 11:02:40 EST 2013
Status          : active
URL             : myapp.myaccount.cloudbees.net
clusterSize     : 1
container       : java_free
containerType   : tomcat
idleTimeout     : 21600
maxMemory       : 256
proxyBuffering  : <code class="nb">false</code>
securityMode    : PUBLIC
serverPool      : stax-global <code class="o">(</code>Stax Global Pool<code class="o">)</code></pre>
</section>













<section data-type="sect3" id="clickstarts-MQsrfgtMT9">
<h3>ClickStarts</h3>

<p>ClickStart applications are templates to quickly get an application and automated build up and running at CloudBees. The Lift ClickStart creates a private Git source repository at CloudBees that contains a Lift 2.4 application, provisions a MySQL database, creates a Maven-based Jenkins build, and deploys the application.  All you need to do is provide a name for the application (without whitespace).<a data-type="indexterm" data-primary="ClickStart Applications" id="id-jyCxSoF7fXt1TV"></a><a data-type="indexterm" data-primary="templates" data-secondary="for CloudBees" id="id-2nClFjF9fVt9Td"></a><a data-type="indexterm" data-primary="Maven-based Jenkins build" id="id-pOCZIjFVf4tNTB"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="ClickStart Applications" id="id-oPCytXFyfvtyTr"></a></p>

<p>To access the Git source repository created for you, you’ll need to upload an SSH public key. You can do this in the "My Keys" section of your account settings on the CloudBees website.</p>

<p>The build that’s created for you will automatically build and deploy your application to CloudBees when you push changes to your Git repository.</p>

<p>If all of that’s a good match to the technologies and services you want to use, ClickStart is a great way to deploy your application. Alternatively, it gives you a starting point from which you can modify elements; or you could <a href="https://github.com/CloudBees-community/lift_template">fork the CloudBees Lift template and create your own</a>.</p>
</section>



</section>













<section data-type="sect2" id="see-also-g0sxhoTz">
<h2>See Also</h2>

<p><a href="https://wiki.cloudbees.com/bin/view/RUN/BeesSDK">The CloudBees SDK</a> provides command-line tools for configuring and controlling <span class="keep-together">applications.</span></p>

<p><a href="https://developer.cloudbees.com">The CloudBees developer portal</a> contains a "Resources" section that provides details of the CloudBees services. In it, you’ll find details on <a href="https://wiki.cloudbees.com/bin/view/RUN/JVM+PermGen+Space">PermGen settings</a>, <a href="https://developer.cloudbees.com/bin/view/RUN/JVMVersion">JVM selection</a>, and <a href="https://developer.cloudbees.com/bin/view/RUN/ClickStack">servlet containers</a>.<a data-type="indexterm" data-startref="ix_PDcbee" id="id-VMCohoI1hrTO"></a><a data-type="indexterm" data-startref="ix_cbee" id="id-rjCJTgIWhVTp"></a><a data-type="indexterm" data-startref="ix_HOSTcbee" id="id-wqC1cDIphbTk"></a></p>
</section>





</section>













<section data-type="sect1" id="Beanstalk">
<h1>Deploying to Amazon Elastic Beanstalk</h1>








<section data-type="sect2" id="problem-pWsqFKcP">
<h2>Problem</h2>

<p>You want to run your Lift application on Amazon Web Services (AWS) Elastic Beanstalk.<a data-type="indexterm" data-primary="production deployments" data-secondary="to Amazon Web Services (AWS) Elastic Beanstalk" id="id-kVCkSpFLFqck"></a><a data-type="indexterm" data-primary="Amazon Web Services (AWS) Elastic Beanstalk" id="id-4nC2FYFVF4c1"></a><a data-type="indexterm" data-primary="Elastic Beanstalk" id="id-JnCmIlFNFzcv"></a><a data-type="indexterm" data-primary="Tomcat" id="id-9nCDtvFpFecN"></a><a data-type="indexterm" data-primary="Simple Build Tool (SBT)" data-secondary="using Elastic Beanstalk with" id="id-ZbCBhMFXFocn"></a><a data-type="indexterm" data-primary="WAR files" id="id-zdCLTGFWFlcA"></a><a data-type="indexterm" data-primary="files" data-secondary="WAR files" id="id-yYClcpF9FecY"></a><a data-type="indexterm" data-primary="Beanstalk" id="id-VMCBirFXFOcO"></a><a data-type="indexterm" data-primary="hosting" data-secondary="with Elastic Beanstalk" id="id-rjCmuYFKFJcp"></a></p>
</section>













<section data-type="sect2" id="solution-o8seIAcZ">
<h2>Solution</h2>

<p>Create a new Tomcat 7 <em>environment</em>, use SBT to package your Lift application as a WAR file, and then deploy the application to your environment.</p>

<p>To create a new environment, visit the AWS console, navigate to Elastic Beanstalk, and select "Apache Tomcat 7" as your environment. This will create and launch a default Beanstalk application. This may take a few minutes, but will eventually report "Successfully running version Sample Application." You’ll be shown the URL of the application (something like <em><a href="http://default-environment-nsdmixm7ja.elasticbeanstalk.com"><em class="hyperlink">http://default-environment-nsdmixm7ja.elasticbeanstalk.com</em></a></em>), and visiting the URL you’re given will show the running default Amazon application.</p>

<p>Prepare your WAR file by running:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>sbt package</pre>

<p>This will write a WAR file into the <em>target</em> folder.  To deploy this WAR file from the AWS Beanstalk web console (see <a data-type="xref" href="#ConsoleImage">Figure 10-1</a>), select the "Versions" tab under the "Elastic Beanstalk Application Details" and click the "Upload new version" button. You’ll be given a dialog where you give a version label and use the "Choose file" button to select the WAR file you just built.  You can either upload and deploy in one step, or upload first and then select the version in the console and hit the "Deploy" button.</p>

<p>The Beanstalk console will show "Environment updating…", and after some minutes, it’ll report "Successfully running."  Your Lift application is now deployed and running on Beanstalk.</p>

<p>A final step is to enable Lift’s production run mode. From the environment in the AWS Beanstalk web console, follow the "Edit Configuration" link. A dialog will appear, and under the "Container" tab, add <code>-Drun.mode=production</code> to the "JVM Command Line Options" and hit "Apply Changes" to redeploy your application.</p>

<figure id="ConsoleImage">
<img src="images/lfcb_1001.png" alt="lfcb 1001">
<figcaption><span class="label">Figure 10-1. </span>AWS console, with Elastic Beanstalk service selected</figcaption>
</figure>
</section>













<section data-type="sect2" id="discussion-g0s1tdcz">
<h2>Discussion</h2>

<p>Elastic Beanstalk provides a prebuilt stack of software and infrastructure, in this case: Linux, Tomcat 7, a 64 bit "t1.micro" EC2 instance, load balancing, and an S3 bucket. That’s the <em>environment</em> and it has reasonable default settings.  Beanstalk also provides an easy way to deploy your Lift application.  As we’ve seen in this recipe, you upload an application (WAR file) to Beanstalk and deploy it to the environment.</p>

<p>As with many cloud providers,<a data-type="indexterm" data-primary="cloud services" id="id-9nCjSBI4tecN"></a><a data-type="indexterm" data-primary="files" data-secondary="local vs. cloud storage of" id="id-ZbC1FmIMtocn"></a> keep in mind that you want to avoid local file storage. The reason for this is to allow instances to be terminated or restarted without data loss. With your Beanstalk application, you do have a filesystem and you can write to it, but it is lost if the image is restarted. You can get persistent local file storage—for example, using Amazon Elastic Block Storage<a data-type="indexterm" data-primary="Amazon Elastic Block Storage" id="id-zdCXIzIDtlcA"></a>—but you’re fighting against the nature of the <span class="keep-together">platform.</span></p>

<p>Logfiles are written to the local filesystem. To access them, from the AWS console, navigate to your environment, into the "Logs" tab, and hit the "Snapshot" button. This will take a copy of the logs and store them in an S3 bucket,<a data-type="indexterm" data-primary="S3 bucket" id="id-ZbCxSltMtocn"></a> and give you a link to the file contents.  This is a single file showing the content of a variety of logfiles, and <em>catalina.out</em> will be the one showing any output from your Lift application.  If you want to try to keep these logfiles around, you can configure the environment to rotate the logs to S3 every hour from the "Container" tab under "Edit Configuration."<a data-type="indexterm" data-primary="logging" id="id-yYCrIktvtecY"></a></p>

<p>The Lift application WAR files are stored in the same S3 bucket that the logs are stored in. From the AWS console, you’ll find it under the S3 page listed with a name like "elasticbeanstalk-us-east-1-5989673916964." You’ll note that the AWS uploads makes your WAR filename unique by adding a prefix to each filename. If you need to be able to tell the difference between these files in S3, one good approach is to bump the <code>version</code> value in your <em>build.sbt</em> file.  This version number is included in the WAR <span class="keep-together">filename.</span></p>










<section data-type="sect3" id="multiple-instances-lqswTzt0cz">
<h3>Multiple instances</h3>

<p>Beanstalks enables <em>autoscaling</em> by default. That is, it launches a single instance of your Lift application, but if the load increases above a threshold, up to four instances may be running.<a data-type="indexterm" data-primary="autoscaling" id="id-rjCpFYFOTYtMc0"></a><a data-type="indexterm" data-primary="Lift applications" data-secondary="autoscaling of" id="id-wqCrIPF4TztGc0"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="stateful features of" id="id-x1C1tBFlTntecQ"></a><a data-type="indexterm" data-primary="session affinity" id="id-PnC0h7F0TKt1c4"></a><a data-type="indexterm" data-primary="browsers" data-secondary="session affinity" id="id-OnCKTmFbTWtdc1"></a><a data-type="indexterm" data-primary="sticky sessions" id="id-XmClcOFLTqtocm"></a><a data-type="indexterm" data-primary="load balancers" id="id-jyCgioFETXtZcV"></a></p>

<p>If you’re making use of Lift’s state features, you’ll need to enable sticky sessions from the "Load Balancer" tab of the environment configuration. It’s a checkbox named <span class="keep-together">"Enable</span> Session Stickiness"—it’s easy to miss, but that tab does scroll to show more options if you don’t see it the first time.</p>
</section>













<section data-type="sect3" id="working-with-a-database-nqs7cpt8cy">
<h3>Working with a database</h3>

<p>There’s nothing unusual you have to do to use Lift and a database from Beanstalk. However, Beanstalk does try to make it easy for you to work with Amazon’s Relational Database Service (RDS).  Either when creating your Beanstalk environment, or from the configuration options later, you can add an RDS instance, which can be an Oracle, SQL-Server, or MySQL database.<a data-type="indexterm" data-primary="RDBMS (Relational Database Management System)" id="id-rjCXSYFzcYtMc0"></a><a data-type="indexterm" data-primary="databases" data-secondary="RDS instances of" id="id-wqC4FPFmcztGc0"></a><a data-type="indexterm" data-primary="MySQL" id="id-x1C0IBFEcntecQ"></a><a data-type="indexterm" data-primary="SQL-Server" id="id-PnCet7FxcKt1c4"></a></p>

<p>The MySQL option will create a MySQL InnoDB database. The database will be accessible from Beanstalk, but not from elsewhere on the Internet. To change that, modify the security groups for the RDS instance from the AWS web console.  For example, you might permit access from your IP address.</p>

<p>When your application launches with an associated RDS instance, the JVM system properties include settings for the database name, host, port, user, and password.  You could pull them together like this in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Class</code><code class="o">.</code><code class="n">forName</code><code class="o">(</code><code class="s">"com.mysql.jdbc.Driver"</code><code class="o">)</code>

<code class="k">val</code> <code class="n">connection</code> <code class="k">=</code> <code class="k">for</code> <code class="o">{</code>
  <code class="n">host</code> <code class="k">&lt;-</code> <code class="nc">Box</code> <code class="o">!!</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_HOSTNAME"</code><code class="o">)</code>
  <code class="n">port</code> <code class="k">&lt;-</code> <code class="nc">Box</code> <code class="o">!!</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_PORT"</code><code class="o">)</code>
  <code class="n">db</code>   <code class="k">&lt;-</code> <code class="nc">Box</code> <code class="o">!!</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_DB_NAME"</code><code class="o">)</code>
  <code class="n">user</code> <code class="k">&lt;-</code> <code class="nc">Box</code> <code class="o">!!</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_USERNAME"</code><code class="o">)</code>
  <code class="n">pass</code> <code class="k">&lt;-</code> <code class="nc">Box</code> <code class="o">!!</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_PASSWORD"</code><code class="o">)</code>
<code class="o">}</code> <code class="k">yield</code> <code class="nc">DriverManager</code><code class="o">.</code><code class="n">getConnection</code><code class="o">(</code>
    <code class="s">"jdbc:mysql://%s:%s/%s"</code> <code class="n">format</code> <code class="o">(</code><code class="n">host</code><code class="o">,</code><code class="n">port</code><code class="o">,</code><code class="n">db</code><code class="o">),</code>
    <code class="n">user</code><code class="o">,</code> <code class="n">pass</code><code class="o">)</code></pre>

<p>That would give you a <code>Box[Connection]</code> that, if <code>Full</code>, you could use in a <code>SquerylRecord.initWithSquerylSession</code> call, for example (see <a data-type="xref" href="#Squeryl">Relational Database Persistence with Record and Squeryl</a>).</p>

<p>Alternatively, you might want to guarantee a connection by supplying defaults for all the values with something like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Class</code><code class="o">.</code><code class="n">forName</code><code class="o">(</code><code class="s">"com.mysql.jdbc.Driver"</code><code class="o">)</code>

<code class="k">val</code> <code class="n">connection</code> <code class="k">=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">host</code> <code class="k">=</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_HOSTNAME"</code><code class="o">,</code> <code class="s">"localhost"</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">port</code> <code class="k">=</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_PORT"</code><code class="o">,</code> <code class="s">"3306"</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">db</code> <code class="k">=</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_DB_NAME"</code><code class="o">,</code> <code class="s">"db"</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">user</code> <code class="k">=</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_USERNAME"</code><code class="o">,</code> <code class="s">"sa"</code><code class="o">)</code>
  <code class="k">val</code> <code class="n">pass</code> <code class="k">=</code> <code class="nc">System</code><code class="o">.</code><code class="n">getProperty</code><code class="o">(</code><code class="s">"RDS_PASSWORD"</code><code class="o">,</code> <code class="s">""</code><code class="o">)</code>

  <code class="nc">DriverManager</code><code class="o">.</code><code class="n">getConnection</code><code class="o">(</code>
    <code class="s">"jdbc:mysql://%s:%s/%s"</code> <code class="n">format</code> <code class="o">(</code><code class="n">host</code><code class="o">,</code><code class="n">port</code><code class="o">,</code><code class="n">db</code><code class="o">),</code>
    <code class="n">user</code><code class="o">,</code> <code class="n">pass</code><code class="o">)</code>
<code class="o">}</code></pre>
</section>



</section>













<section data-type="sect2" id="see-also-q8sZhAcV">
<h2>See Also</h2>

<p>Amazon provided a <a href="http://bit.ly/11FFQtl">walkthrough with screenshots</a>, showing how to create a Beanstalk application.</p>

<p><em><a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920020561.do">Elastic Beanstalk</a></em>, by van Vliet <em>et al.</em> (O’Reilly) goes into the details of the Beanstalk infrastructure, how to work with Eclipse, enabling continuous integration, and how to hack the instance (for example, to use Nginx as a frontend to Beanstalk).</p>

<p><a href="http://bit.ly/ZPLZ95">The Amazon documentation for "Configuring Databases with AWS Elastic Beanstalk"</a> describes the RDS settings in more detail.</p>
</section>





</section>













<section data-type="sect1" id="HerokuDeployment">
<h1>Deploying to Heroku</h1>








<section data-type="sect2" id="problem-o8skFGiZ">
<h2>Problem</h2>

<p>You want to deploy your Lift application to your account on the Heroku cloud platform.<a data-type="indexterm" id="ix_PDhero" data-primary="production deployments" data-secondary="to Heroku"></a><a data-type="indexterm" id="ix_hero" data-primary="Heroku"></a><a data-type="indexterm" data-primary="WAR files" id="id-9nCrIvFpF4iN"></a><a data-type="indexterm" data-primary="files" data-secondary="WAR files" id="id-ZbCPtMFXFzin"></a><a data-type="indexterm" id="ix_HOSThero" data-primary="hosting" data-secondary="with Heroku"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2Ipiz">
<h2>Solution</h2>

<p>Package your Lift application as a WAR file and use the Heroku deploy plugin to send and run your application. This will give you an application running under Tomcat 7. Anyone can use this method to deploy an application, but Heroku provides support only for Enterprise Java customers.<a data-type="indexterm" data-primary="Tomcat" id="id-JnCDSlFpIAiv"></a><a data-type="indexterm" data-primary="Enterprise Java" id="id-9nCdFvFlI4iN"></a></p>

<p>This recipe walks through the process in three stages: one-time setup; deployment of the WAR; and configuration of your Lift application for production performance.</p>

<p>If you’ve not already done so, download and install the Heroku command-line tools ("Toolbelt") and log in using your Heroku credentials and upload an SSH key:</p>

<pre data-type="programlisting">$ heroku login
Enter your Heroku credentials.
Email: you@example.org
Password (typing will be hidden):
Found the following SSH public keys:
1) github.pub
2) id_rsa.pub
Which would you like to use with your Heroku account? 2
Uploading SSH public key ~/.ssh/id_rsa.pub... done
Authentication successful.</pre>

<p>Install the deploy plugin:</p>

<pre data-type="programlisting">$ heroku plugins:install https://github.com/heroku/heroku-deploy
Installing heroku-deploy... done</pre>

<p>With that one-time setup complete, you can create an application on Heroku. Here we’ve not specified a name, so we are given a random name of "glacial-waters-6292" that we will use throughout this recipe:</p>

<pre data-type="programlisting">$ heroku create
Creating glacial-waters-6292... done, stack is cedar
http://glacial-waters-6292.herokuapp.com/ |
git@heroku.com:glacial-waters-6292.git</pre>

<p>Before deploying, we set the Lift run mode to production.  This is done via the <code>config:set</code> command.  First check the current settings for <code>JAVA_OPTS</code> and then modify the options by adding <code>-Drun.mode=production</code>:</p>

<pre data-type="programlisting">$ heroku config:get JAVA_OPTS --app glacial-waters-6292
-Xmx384m -Xss512k -XX:+UseCompressedOops

$ heroku config:set JAVA_OPTS="-Drun.mode=production -Xmx384m -Xss512k
  -XX:+UseCompressedOops" --app glacial-waters-6292</pre>

<p>We can deploy to Heroku by packaging the application as a WAR file and then running the Heroku <code>deploy:war</code> command:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>sbt package
....
<code class="o">[</code>info<code class="o">]</code> Packaging target/scala-2.9.1/myapp-0.0.1.war ...
....
<code class="nv">$ </code>heroku deploy:war --war target/scala-2.9.1/myapp-0.0.1.war
  --app glacial-waters-6292
Uploading target/scala-2.9.1/myapp-0.0.1.war............done
Deploying to glacial-waters-6292.........done
Created release v6</pre>

<p>Your Lift application is now running on Heroku.</p>
</section>













<section data-type="sect2" id="discussion-q8svtQiV">
<h2>Discussion</h2>

<p>There are a few important comments regarding Lift applications on Heroku. First, note that there’s no support for session affinity. This means if you deploy to multiple <em>dynos</em> (Heroku terminology for instances), there is no coordination over which requests go to which servers. As a consequence, you won’t be able to make use of Lift’s stateful features and will want to turn them off (<a data-type="xref" href="#RunningStateless">Running Stateless</a> describes how to do that).</p>

<p>Second, if you are using Lift Comet features, there’s an adjustment to make in <em>Boot.scala</em> to work a little better in the Heroku environment<a data-type="indexterm" data-primary="Comet" data-secondary="and Heroku" id="id-zdCkFzIDtGiA"></a>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">LiftRules</code><code class="o">.</code><code class="n">cometRequestTimeout</code> <code class="k">=</code> <code class="nc">Full</code><code class="o">(</code><code class="mi">25</code><code class="o">)</code></pre>

<p>This setting controls how long Lift waits before testing a Comet connection. We’re replacing the Lift default of 120 seconds
with 25 seconds, because Heroku terminates connections after 30 seconds.  Although Lift recovers from this, the user experience may be to see a delay when interacting with a page.</p>

<p>A third important point to note is that the dyno will be restarted every day. Additionally, if you are only running one web dyno, it will be idled after an hour of inactivity. You can see this happening by tailing your application log:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>heroku logs -t --app glacial-waters-6292
...
2012-12-31T11:31:39+00:00 heroku<code class="o">[</code>web.1<code class="o">]</code>: Idling
2012-12-31T11:31:41+00:00 heroku<code class="o">[</code>web.1<code class="o">]</code>: Stopping all processes with SIGTERM
2012-12-31T11:31:43+00:00 heroku<code class="o">[</code>web.1<code class="o">]</code>: Process exited with status 143
2012-12-31T11:31:43+00:00 heroku<code class="o">[</code>web.1<code class="o">]</code>: State changed from up to down</pre>

<p>Anyone visiting your Lift application will cause Heroku to unidle your application.</p>

<p>Note, though, that the application was stopped with a <code>SIGTERM</code>.  This is a Unix signal sent to a process, the JVM in this case, to request it to stop.  Unfortunately, the Tomcat application on Heroku does not use this signal to request Lift to shut down. This may be of little consequence to you, but if you do have external resources you want to release to other actions to take at shutdown, you need to register a shutdown hook with the JVM.<a data-type="indexterm" data-primary="SIGTERM" id="id-PnCxFPuAtjiG"></a><a data-type="indexterm" data-primary="hooks" id="id-OnCOIduytJix"></a><a data-type="indexterm" data-primary="shutdown hooks" id="id-XmCbtluytPil"></a></p>

<p>For example, you might add this to <em>Boot.scala</em> if you’re running on Heroku:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Runtime</code><code class="o">.</code><code class="n">getRuntime</code><code class="o">().</code><code class="n">addShutdownHook</code><code class="o">(</code><code class="k">new</code> <code class="nc">Thread</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">run</code><code class="o">()</code> <code class="o">{</code>
    <code class="n">println</code><code class="o">(</code><code class="s">"Shutdown hook being called"</code><code class="o">)</code>
    <code class="c1">// Do useful clean up here</code>
  <code class="o">}</code>
<code class="o">})</code></pre>

<p>Do not count on being able to do much during shutdown.  Heroku allows around 10 seconds before killing the JVM after issuing the <code>SIGTERM</code>.</p>

<p>Possibly a more general approach is to perform cleanup using Lift’s unload hooks (see <a data-type="xref" href="#ShutdownHooks">Run Code When Lift Shuts Down</a>) and then arrange the hooks to be called when Heroku sends the signal to terminate:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">Runtime</code><code class="o">.</code><code class="n">getRuntime</code><code class="o">().</code><code class="n">addShutdownHook</code><code class="o">(</code><code class="k">new</code> <code class="nc">Thread</code> <code class="o">{</code>
  <code class="k">override</code> <code class="k">def</code> <code class="n">run</code><code class="o">()</code> <code class="o">{</code>
    <code class="nc">LiftRules</code><code class="o">.</code><code class="n">unloadHooks</code><code class="o">.</code><code class="n">toList</code><code class="o">.</code><code class="n">foreach</code><code class="o">{</code> <code class="n">f</code> <code class="k">=&gt;</code> <code class="n">tryo</code> <code class="o">{</code> <code class="n">f</code><code class="o">()</code> <code class="o">}</code> <code class="o">}</code>
  <code class="o">}</code>
<code class="o">})</code></pre>

<p>This handling of <code>SIGTERM</code> may be a surprise, but if we look at how the application is running on Heroku, things become clearer.  The dyno is an allocation of resources (512 MB of memory) and allows an arbitrary command to run. The command being run is a Java process starting a "webapp runner" package. You can see this in two ways. First, if you shell to your dyno, you’ll see a WAR file as well as a JAR file:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>heroku run bash --app glacial-waters-6292
Running <code class="sb">`</code>bash<code class="sb">`</code> attached to terminal... up, run.8802
~ <code class="nv">$ </code>ls
Procfile  myapp-0.0.1.war  webapp-runner-7.0.29.3.jar</pre>

<p>Second, by looking at the processes executing:</p>

<pre data-type="programlisting">$ heroku ps --app glacial-waters-6292
=== web: `${PRE_JAVA}java ${JAVA_OPTS} -jar webapp-runner-7.0.29.3.jar
 --port ${PORT} ${WEBAPP_RUNNER_OPTS} myapp-0.0.1.war`
web.1: up 2013/01/01 22:37:35 (~ 31s ago)</pre>

<p>Here we see a Java process executing a JAR file called <em>webapp-runner-7.0.29.3.jar</em> that is passed our WAR file as an argument. This is not identical to the Tomcat <em>catalina.sh</em> script you may be more familiar with, but instead is <a href="https://github.com/jsimone/webapp-runner">this launcher process</a>. As it does not register a handler to deal with <code>SIGTERM</code>, we will have to if we need to release any resources during shutdown.<a data-type="indexterm" data-primary="JAR files" id="id-nxClhEhxtniW"></a><a data-type="indexterm" data-primary="files" data-secondary="JAR files" id="id-NnCQT7hwtaiY"></a></p>

<p>All of this means that if you want to launch a Lift application in a different way, you can. You’d need to wrap an appropriate container (Jetty or Tomcat, for example), and provide a <code>main</code> method for Heroku to call. This is sometimes called <em>containerless deployment</em>.<a data-type="indexterm" data-primary="containerless deployment" id="id-lrCAIYTZtQiZ"></a></p>

<p>If you are not a Heroku Enterprise Java customer, and you’re uncomfortable with the unsupported nature of the <code>deploy:war</code> plugin, you now know what you need to do to run in a supported way: provide a <code>main</code> method that launches your application and listen for connections. The "See Also" section gives pointers for how to do this.</p>










<section data-type="sect3" id="database-access-in-heroku-WEsAi8t9ij">
<h3>Database access in Heroku</h3>

<p>Heroku makes no restrictions on which databases you can connect to from your Lift application, but they try to make it easy to use their PostgreSQL service by attaching a free database to applications you create.<a data-type="indexterm" data-primary="databases" data-secondary="configuring connections to" id="id-nxC1SLFWiWtjiL"></a><a data-type="indexterm" data-primary="PostgreSQL service" id="id-NnC7FnFgi4tBiV"></a></p>

<p>You can find out if you have a database by running the <code>pg</code> command<a data-type="indexterm" data-primary="URLs" data-secondary="fetching" id="id-8nCEFpIbi2t1i2"></a>:</p>

<pre data-type="programlisting" data-code-language="bash" data-highlighted="true"><code class="nv">$ </code>heroku pg --app glacial-waters-6292
<code class="o">===</code> HEROKU_POSTGRESQL_BLACK_URL <code class="o">(</code>DATABASE_URL<code class="o">)</code>
Plan:        Dev
Status:      available
Connections: 0
PG Version:  9.1.6
Created:     2012-12-31 10:02 UTC
Data Size:   5.9 MB
Tables:      0
Rows:        0/10000 <code class="o">(</code>In compliance<code class="o">)</code>
Fork/Follow: Unsupported</pre>

<p>The URL of the database is provided to your Lift application as the <code>DATABASE_URL</code> environment variable. It will have a value of something like this:</p>

<pre data-type="programlisting">postgres://gghetjutddgr:RNC_lINakkk899HHYEFUppwG@ec2-54-243-230-119.compute-1.
 amazonaws.com:5432/d44nsahps11hda</pre>

<p>This URL contains a username, password, host, and database name, but needs to be manipulated to be used by JDBC.  To do so, you might include the following in <em>Boot.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"> <code class="nc">Box</code> <code class="o">!!</code> <code class="nc">System</code><code class="o">.</code><code class="n">getenv</code><code class="o">(</code><code class="s">"DATABASE_URL"</code><code class="o">)</code> <code class="k">match</code> <code class="o">{</code>
  <code class="k">case</code> <code class="nc">Full</code><code class="o">(</code><code class="n">url</code><code class="o">)</code> <code class="k">=&gt;</code> <code class="n">initHerokuDb</code><code class="o">(</code><code class="n">url</code><code class="o">)</code>
  <code class="k">case</code> <code class="k">_</code> <code class="k">=&gt;</code> <code class="c1">// configure local database perhaps</code>
<code class="o">}</code>

<code class="k">def</code> <code class="n">initHerokuDb</code><code class="o">(</code><code class="n">dbInfo</code><code class="k">:</code> <code class="kt">String</code><code class="o">)</code> <code class="o">{</code>
  <code class="nc">Class</code><code class="o">.</code><code class="n">forName</code><code class="o">(</code><code class="s">"org.postgresql.Driver"</code><code class="o">)</code>

  <code class="c1">// Extract credentials from Heroku database URL:</code>
  <code class="k">val</code> <code class="n">dbUri</code> <code class="k">=</code> <code class="k">new</code> <code class="nc">URI</code><code class="o">(</code><code class="n">dbInfo</code><code class="o">)</code>
  <code class="k">val</code> <code class="nc">Array</code><code class="o">(</code><code class="n">user</code><code class="o">,</code> <code class="n">pass</code><code class="o">)</code> <code class="k">=</code> <code class="n">dbUri</code><code class="o">.</code><code class="n">getUserInfo</code><code class="o">.</code><code class="n">split</code><code class="o">(</code><code class="s">":"</code><code class="o">)</code>

  <code class="c1">// Construct JDBC connection string from the URI:</code>
  <code class="k">def</code> <code class="n">connection</code> <code class="k">=</code> <code class="nc">DriverManager</code><code class="o">.</code><code class="n">getConnection</code><code class="o">(</code>
    <code class="s">"jdbc:postgresql://"</code> <code class="o">+</code> <code class="n">dbUri</code><code class="o">.</code><code class="n">getHost</code> <code class="o">+</code> <code class="sc">':'</code> <code class="o">+</code> <code class="n">dbUri</code><code class="o">.</code><code class="n">getPort</code> <code class="o">+</code>
      <code class="n">dbUri</code><code class="o">.</code><code class="n">getPath</code><code class="o">,</code> <code class="n">user</code><code class="o">,</code> <code class="n">pass</code><code class="o">)</code>

  <code class="nc">SquerylRecord</code><code class="o">.</code><code class="n">initWithSquerylSession</code><code class="o">(</code>
    <code class="nc">Session</code><code class="o">.</code><code class="n">create</code><code class="o">(</code><code class="n">connection</code><code class="o">,</code> <code class="k">new</code> <code class="nc">PostgreSqlAdapter</code><code class="o">))</code>

<code class="o">}</code></pre>

<p>Here we are testing for the presence of the <code>DATABASE_URL</code> environment variable, which would indicate that we are in the Heroku environment. We can then extract out the connection information to use in <code>Session.create</code>.  We would additionally need to complete the usual <code>addAround</code> configuration described in <a data-type="xref" href="#ConfiguringSqueryl">Configuring Squeryl and Record</a>.</p>

<p>For it to run, <em>build.sbt</em> needs the appropriate dependencies for Record and PostgreSQL:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="o">...</code>
<code class="s">"postgresql"</code> <code class="o">%</code> <code class="s">"postgresql"</code> <code class="o">%</code> <code class="s">"9.1-901.jdbc4"</code><code class="o">,</code>
<code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-record"</code> <code class="o">%</code> <code class="n">liftVersion</code><code class="o">,</code>
<code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-squeryl-record"</code> <code class="o">%</code> <code class="n">liftVersion</code><code class="o">,</code>
<code class="o">...</code></pre>

<p>With this in place, your Lift application can make use of the Heroku database. You can also access the database from the shell, for example:</p>

<pre data-type="programlisting">$ pg:psql --app glacial-waters-6292
psql (9.1.4, server 9.1.6)
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

d44nsahps11hda=&gt; \d
No relations found.
d44nsahps11hda=&gt; \q
$</pre>

<p>To access via a JDBC tool outside of the Heroku environment, you’ll need to include parameters to force SSL. For example:</p>

<pre data-type="programlisting">jdbc:postgresql://ec2-54-243-230-119.compute-1.amazonaws.com:5432/d44nsahps11hda?username=gghetjutddgr&amp;password=RNC_lINakkk899HHYEFUppwG&amp;ssl=true&amp;sslfactory=org.postgresql.ssl.NonValidatingFactory</pre>
</section>



</section>













<section data-type="sect2" id="see-also-1Ls9hQin">
<h2>See Also</h2>

<p>The <a href="https://devcenter.heroku.com/categories/scala">Scala</a> and <a href="https://devcenter.heroku.com/categories/java">Java</a> articles at Heroku, and <a href="https://devcenter.heroku.com/articles/dynos">Dynos and the Dyno Manager</a>, are useful to learn more of the details described in this recipe.</p>

<p>The JVM shutdown hooks are described in the <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html">JDK documentation</a>.</p>

<p><a href="https://devcenter.heroku.com/articles/java-webapp-runner">Heroku’s guide to containerless deployment</a> makes use of Maven to package your application.  There is also a <a href="https://github.com/ghostm/lift_blank_heroku">template SBT project from Matthew Henderson</a> that includes a <code>JettyLauncher</code> class.</p>

<p><a href="https://devcenter.heroku.com/articles/request-timeout">Request Timeout</a> describes how Heroku deals with Comet long polling.<a data-type="indexterm" data-startref="ix_PDhero" id="id-rjCpFEhWhnip"></a><a data-type="indexterm" data-startref="ix_hero" id="id-wqCrIehphgik"></a><a data-type="indexterm" data-startref="ix_HOSThero" id="id-x1C1tyhphgiN"></a></p>
</section>





</section>







</section>














<section data-type="chapter" id="ContributingAndHelp">
<h1>Contributing, Bug Reports, and <span class="keep-together">Getting Help</span></h1>







<section data-type="sect1" id="GettingHelp">
<h1>You’d Like Some Help</h1>








<section data-type="sect2" id="problem-OKsLFmFO">
<h2>Problem</h2>

<p>You’re stuck on something in Lift and you’d like some help.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="accessing help" id="id-W7CESLFYFWFn"></a><a data-type="indexterm" data-primary="help, accessing" id="id-e4CAFJFZF1Fn"></a><a data-type="indexterm" data-primary="Lift mailing list" id="id-GnC7IgFbFpFa"></a><a data-type="indexterm" data-primary="Lift community" id="id-DnCqtWFwF8FB"></a><a data-type="indexterm" data-primary="mailing list, for help with Lift" id="id-kVCvhpFLFbFv"></a></p>
</section>













<section data-type="sect2" id="solution-XQsKIOFb">
<h2>Solution</h2>

<p>Ask a question on the <a href="https://groups.google.com/group/liftweb">Lift mailing list</a>.</p>
</section>













<section data-type="sect2" id="discussion-jWsvtoFq">
<h2>Discussion</h2>

<p>You will find some information about Lift on StackOverflow, Quora, and elsewhere, but the mailing list is <em>the</em> place to go to get help and support. You can search the archive to see if your question has already been addressed, but questions are very welcome as it helps the Lift community understand what users need and what might be causing problems or need explanation. Much of what you’re reading here originates from questions that have been asked on the mailing list.</p>

<p>New members to the mailing list are moderated to help reduce spam. This means the first time you post, your message may take a few hours to show up.</p>
</section>













<section data-type="sect2" id="see-also-2ksZhjFV">
<h2>See Also</h2>

<p>The Lift community is one of the things that makes Lift what it is. Please take a look at <a href="http://liftweb.net/community"><em class="hyperlink">http://liftweb.net/community</em></a> before posting: you’ll get the best response with a polite question.</p>

<p>If you need paid consulting, development, or SLA-backed support, there’s a list of organizations on the <a href="https://www.assembla.com/spaces/liftweb/wiki/Commercial_Support">wiki</a>.</p>
</section>





</section>













<section data-type="sect1" id="HowToReportBugs">
<h1>How to Report Bugs</h1>








<section data-type="sect2" id="problem-XQspFDIb">
<h2>Problem</h2>

<p>You’ve found a bug and want to report it.<a data-type="indexterm" data-primary="bugs, reporting of" id="id-e4CzSJFZF2In"></a><a data-type="indexterm" data-primary="reporting bugs" id="id-GnCZFgFbFXIa"></a><a data-type="indexterm" data-primary="questions about Lift, how to ask" id="id-DnCXIWFwFNIB"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="bug reports" id="id-kVCltpFLFkIv"></a></p>
</section>













<section data-type="sect2" id="solution-jWsjIEIq">
<h2>Solution</h2>

<p>Discuss your findings on the Lift mailing list, describing what you’re
seeing, and what you’d expected to see.</p>

<p>By all means look at the existing tickets to see if your issue is there or recently fixed, but please do not
raise a ticket unless asked to do so by a Lift committer on the mailing list.</p>
</section>













<section data-type="sect2" id="discussion-2ksLtxIV">
<h2>Discussion</h2>
<blockquote>
<p>If Lift is not behaving as you expect, please ask questions about what
you’re seeing. The ideal form of these questions is "When I do X, my
Lift app does Y, but I expect it to do Z, why?" This provides a set of
language to discuss your application and the way that Lift responds to
requests. Perhaps there’s a way of improving Lift. Perhaps there’s a
concept that’s different in Lift than you might be used to. Perhaps
there’s a documentation issue that can help bridge the gap between what
Lift is doing and what you expect it to do. Most importantly, just
because Lift is behaving differently than you expect it to, it’s not
necessarily a bug in Lift.</p>
<p data-type="attribution">David Pollack, <cite>http://bit.ly/lift-expects</cite></p>
</blockquote>

<p>A great way to get help with the issue you have, or get a bug fixed, is to produce a small example to illustrate the problem and post it on GitHub. The key is to provide instructions so someone can run the example and see exactly what you see without having to jump through hoops.</p>
</section>













<section data-type="sect2" id="see-also-pWsJhkI2">
<h2>See Also</h2>

<p>You’ll find a list of tickets at <a href="http://ticket.liftweb.net/"><em class="hyperlink">http://ticket.liftweb.net/</em></a>.</p>

<p>If you’re asked to, or want to, post example code, please follow <a href="http://www.assembla.com/wiki/show/liftweb/Posting_example_code">the guide</a>.</p>

<p>If you’ve found a bug, and you’re asked to create a ticket, the main thing to do is include a link to the mailing list discussion of the issue, as described in <a href="http://www.assembla.com/wiki/show/liftweb/Creating_tickets">Creating tickets</a>.</p>
</section>





</section>













<section data-type="sect1" id="LiftCodeContributions">
<h1>Contributing Small Code Changes and ScalaDoc</h1>








<section data-type="sect2" id="problem-jWslFPtq">
<h2>Problem</h2>

<p>You have a small change or ScalaDoc improvement you’d like incorporated into Lift.<a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="submitting improvements to" id="id-GnCJSgFbFnta"></a><a data-type="indexterm" data-primary="contributors" data-secondary="to Lift Web Framework" id="id-DnCaFWFwFZtB"></a><a data-type="indexterm" data-primary="code changes, contributing" id="id-kVCAIpFLFatv"></a></p>
</section>













<section data-type="sect2" id="solution-2kseIptV">
<h2>Solution</h2>

<p>You can issue pull requests against the Lift source, providing your change meets one of the following requirements:</p>

<ul>
<li>
<p>It’s a change to a comment.</p>
</li>
<li>
<p>It’s example code.</p>
</li>
<li>
<p>It’s a <em>small</em> change, enhancement, or bug fix to Lift.</p>
</li>
</ul>

<p>Your pull request must include an edit to add your signature to the bottom of the <em>contributors.md</em> file.</p>
</section>













<section data-type="sect2" id="discussion-pWswtWt2">
<h2>Discussion</h2>

<p>Historically, Lift had a strict contributor policy of simply not accepting any code contributions except from committers who had signed an agreement to assign copyright to the Lift project.  This allowed corporations wanting to adopt Lift to do so without litigation concerns.</p>

<p>The safety is still there, now via the requirement for a signature on the contributors file, which reads:</p>
<blockquote>
<p>By submitting this pull request which includes my name and email address (the email address may be in a non-robot readable format), I agree that the entirety of the contribution is my own original work, that there are no prior claims on this work including, but not limited to, any agreements I may have with my employer or other contracts, and that I license this work under an Apache 2.0 license.</p></blockquote>

<p>What’s a small change? That’s a good question, and if you’re unsure, talk about your proposed change on the mailing list.</p>
</section>













<section data-type="sect2" id="see-also-o8sNh1tN">
<h2>See Also</h2>

<p>This contribution policy was <a href="http://www.lift.la/blog/new_contribution_policy">introduced in November 2012</a>.</p>

<p>The <em>contributors.md</em> file is found <a href="https://github.com/lift/framework/blob/master/contributors.md">on GitHub</a>.</p>

<p>The Lift source is <a href="https://github.com/lift/">on GitHub</a>.  The <em>framework</em> project is probably the one you want, although you’ll also find Git repositories for examples and Lift websites there.</p>

<p>GitHub provides an introduction to <a href="https://help.github.com/articles/using-pull-requests">pull requests</a>.</p>

<p><a data-type="xref" href="#modules">Sharing Code in Modules</a> describes how to share code of any size via Lift modules.</p>
</section>





</section>













<section data-type="sect1" id="wiki">
<h1>Contributing Documentation</h1>








<section data-type="sect2" id="problem-2kslFwhV">
<h2>Problem</h2>

<p>You’d like to contribute documentation to Lift.<a data-type="indexterm" data-primary="contributors" data-secondary="to Lift Web Framework" id="id-DnC1SWFwF4hB"></a><a data-type="indexterm" data-primary="documentation, contribution of" id="id-kVCEFpFLFZhv"></a></p>
</section>













<section data-type="sect2" id="solution-pWsZIXh2">
<h2>Solution</h2>

<p>Update or add to the <a href="https://www.assembla.com/wiki/show/liftweb">Lift wiki</a>.</p>

<p>You’ll need to sign in, or create a free account, with Assembla, the company that hosts the wiki. You then need to become a <em>watcher</em> of the Lift wiki, which is offered as a link on the top right of the Lift wiki page.  As a watcher, you can edit pages and create new pages.<a data-type="indexterm" data-primary="Assembla" id="id-JnCzFjIpIvhl"></a><a data-type="indexterm" data-primary="Lift wiki page" id="id-9nCrIBIlI2hD"></a></p>
</section>













<section data-type="sect2" id="discussion-o8syt4hN">
<h2>Discussion</h2>

<p>If you’re unsure about a change you’d like to make, just ask for feedback on the Lift mailing list.</p>

<p>One limitation of the watcher role on Assembla is that you cannot move pages. If you create a new page in the wrong section, or want to reorganise pages, you’ll need to ask on the Lift mailing list for someone with permissions to do that for you.</p>
</section>













<section data-type="sect2" id="see-also-g0sxhyhQ">
<h2>See Also</h2>

<p>The markup format for the wiki pages is <a href="http://redcloth.org/hobix.com/textile/">Textile</a>.</p>
</section>





</section>













<section data-type="sect1" id="AddRecipe">
<h1>How to Add a New Recipe to This Cookbook</h1>








<section data-type="sect2" id="problem-pWsqF0T2">
<h2>Problem</h2>

<p>You’d like to add a section or chapter to this cookbook.<a data-type="indexterm" data-primary="Lift Cookbook" data-secondary="submitting recipes to" id="id-kVCkSpFLF4Tv"></a></p>
</section>













<section data-type="sect2" id="solution-o8seIqTN">
<h2>Solution</h2>

<p>If you’re comfortable using Git, you can fork the repository and send a
pull request.<a data-type="indexterm" data-primary="templates" data-secondary="for Lift Cookbook submissions" id="id-4nCqSYFMIXT0"></a></p>

<p>Alternatively, download a template file, write your recipe, and email it
to the <a href="https://groups.google.com/group/liftweb">Lift mailing list</a>.</p>

<p>You can find the template file <a href="http://bit.ly/19AllpY">on GitHub</a>.</p>
</section>













<section data-type="sect2" id="discussion-g0s1toTQ">
<h2>Discussion</h2>

<p>Anything you’ve puzzled over, or things that have surprised you, impressed you, or are nonobvious are great topics for recipes. Improvements, discussions, and clarifications of existing recipes are welcome, too.</p>

<p>The cookbook is structured using a markup language called AsciiDoc. If you’re familiar with Markdown or Textile, you’ll find similarities. For the cookbook, you only need to know about section headings, source code formatting, and links.  Examples of all of these are in the <em>template.asciidoc</em> file.<a data-type="indexterm" data-primary="AsciiDoc markup language" id="id-ZbC1FmIMtdTg"></a><a data-type="indexterm" data-primary="Markdown" id="id-zdCXIzIDtbTr"></a><a data-type="indexterm" data-primary="Textile markup" id="id-yYCgt1Ivt2Ta"></a></p>

<p>To find out where to make a change, you need to know that each chapter is a separate file, and each recipe is a section in that file.</p>










<section data-type="sect3" id="licensing-vJskhwtMTd">
<h3>Licensing</h3>

<p>We ask contributors the following<a data-type="indexterm" data-primary="Lift Cookbook" data-secondary="code use permissions" id="id-yYCASpFnh4tXTx"></a>:</p>

<ul>
<li>
<p>You agree to license your work (including the words you write, the code you use, and any images) to us under the Creative Commons Attribution, Non Commercial, No Derivatives license.</p>
</li>
<li>
<p>You assert that the work is your own, or you have the necessary permission for the work.</p>
</li>
</ul>

<p>To keep things simple, all author royalties from this book are given to charity.</p>
</section>



</section>













<section data-type="sect2" id="see-also-q8sZhJT4">
<h2>See Also</h2>

<p>The source to this book is <a href="https://github.com/d6y/lift-cookbook/">on GitHub</a>.</p>

<p><a href="http://powerman.name/doc/asciidoc">The AsciiDoc cheatsheet</a> is a quick way to get into AsciiDoc, but if you need more, the <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc home page has the details</a>.</p>

<p>GitHub provides an introduction to <a href="https://help.github.com/articles/using-pull-requests">pull requests</a>.</p>

<p><a data-type="xref" href="#wiki">Contributing Documentation</a> describes other ways to contribute documentation to Lift.</p>
</section>





</section>













<section data-type="sect1" id="modules">
<h1>Sharing Code in Modules</h1>








<section data-type="sect2" id="problem-o8skFAcN">
<h2>Problem</h2>

<p>You have code you’d like to share between Lift projects or with the community.<a data-type="indexterm" id="ix_CSmf" data-primary="code sharing, modules for"></a><a data-type="indexterm" id="ix_Mcs" data-primary="modules, for code sharing"></a><a data-type="indexterm" data-primary="Lift Web Framework" data-secondary="modules for code sharing" id="id-9nCrIvFpFecD"></a></p>
</section>













<section data-type="sect2" id="solution-g0s2IdcQ">
<h2>Solution</h2>

<p>Create a Lift module, and then reference the module from your Lift projects.</p>

<p>As an example, let’s create a module to embed the <em>snowstorm snowfall effect</em> on every page in your Lift web application (please don’t do this).</p>

<p>There’s nothing special about modules: they are coded, packaged, and used like any other dependency. What makes them possible is the exposure of extension points via <span class="keep-together"><code>LiftRules</code></span>. The main convention is to have an <code>init</code> method that Lift applications can use to initialise your module.</p>

<p>For our snowstorm, we’re going to package some JavaScript and inject the script onto every page.</p>

<p>Starting with the <em>lift_blank</em> template downloaded from <em>liftweb.net</em>, we can remove all the source and HTML files, as this won’t be a runnable Lift application in itself. However, it will leave us with the regular Lift structure and build configuration.</p>

<p>Our module will need the <a href="https://github.com/scottschiller/snowstorm/">snowstorm JavaScript file</a> copied as <em>resources/toserve/snowstorm.js</em>.  This will place the JavaScript file on the classpath of our Lift application.</p>

<p>The final piece of the module is to ensure the JavaScript is included on every page:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">package</code> <code class="nn">net.liftmodules.snowstorm</code>

<code class="k">import</code> <code class="nn">net.liftweb.http._</code>

<code class="k">object</code> <code class="nc">Snowstorm</code> <code class="o">{</code>

 <code class="k">def</code> <code class="n">init</code><code class="o">()</code> <code class="k">:</code> <code class="kt">Unit</code> <code class="o">=</code> <code class="o">{</code>

  <code class="nc">ResourceServer</code><code class="o">.</code><code class="n">allow</code> <code class="o">{</code>
     <code class="k">case</code> <code class="s">"snowstorm.js"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="k">=&gt;</code> <code class="kc">true</code>
  <code class="o">}</code>

  <code class="k">def</code> <code class="n">addSnow</code><code class="o">(</code><code class="n">s</code><code class="k">:</code> <code class="kt">LiftSession</code><code class="o">,</code> <code class="n">r</code><code class="k">:</code> <code class="kt">Req</code><code class="o">)</code> <code class="k">=</code> <code class="n">S</code><code class="o">.</code><code class="n">putInHead</code><code class="o">(</code>
    <code class="o">&lt;</code><code class="n">script</code> <code class="n">type</code><code class="o">=</code><code class="s">"text/javascript"</code> <code class="n">src</code><code class="o">=</code><code class="s">"/classpath/snowstorm.js"</code><code class="o">&gt;&lt;/</code><code class="n">script</code><code class="o">&gt;</code> <code class="o">)</code>

  <code class="nc">LiftSession</code><code class="o">.</code><code class="n">onBeginServicing</code> <code class="k">=</code> <code class="n">addSnow</code> <code class="k">_</code> <code class="o">::</code> <code class="nc">LiftSession</code><code class="o">.</code><code class="n">onBeginServicing</code>

 <code class="o">}</code>

<code class="o">}</code></pre>

<p>Here we are plugging into Lift’s processing pipeline and adding the required
JavaScript to the head of every page.<a data-type="indexterm" data-primary="S." data-secondary="putInHead" id="id-x1C4SOUoIZca"></a></p>

<p>We modify <em>build.sbt</em> to give the module a name, organisation, and version number.  We also can remove many of the dependencies and the web plugin as we only depend on the web API elements of Lift:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">name</code> <code class="o">:=</code> <code class="s">"snowstorm"</code>

<code class="n">version</code> <code class="o">:=</code> <code class="s">"1.0.0"</code>

<code class="n">organization</code> <code class="o">:=</code> <code class="s">"net.liftmodules"</code>

<code class="n">scalaVersion</code> <code class="o">:=</code> <code class="s">"2.9.1"</code>

<code class="n">resolvers</code> <code class="o">++=</code> <code class="nc">Seq</code><code class="o">(</code>
   <code class="s">"snapshots"</code> <code class="n">at</code> <code class="s">"http://oss.sonatype.org/content/repositories/snapshots"</code><code class="o">,</code>
   <code class="s">"releases"</code> <code class="n">at</code> <code class="s">"http://oss.sonatype.org/content/repositories/releases"</code>
<code class="o">)</code>

<code class="n">scalacOptions</code> <code class="o">++=</code> <code class="nc">Seq</code><code class="o">(</code><code class="s">"-deprecation"</code><code class="o">,</code> <code class="s">"-unchecked"</code><code class="o">)</code>

<code class="n">libraryDependencies</code> <code class="o">++=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="s">"2.5"</code>
  <code class="nc">Seq</code><code class="o">(</code>
    <code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-webkit"</code>  <code class="o">%</code> <code class="n">liftVersion</code>  <code class="o">%</code> <code class="s">"compile"</code>
  <code class="o">)</code>
<code class="o">}</code></pre>

<p>We can publish this plugin to the repository on disk by starting SBT and typing:</p>

<pre data-type="programlisting">publish-local</pre>

<p>With our module built and published, we can now include it in our Lift applications. To do that, modify the Lift application’s <em>build.sbt</em> to reference this new "snowstorm" dependency:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">libraryDependencies</code> <code class="o">++=</code> <code class="o">{</code>
  <code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="s">"2.5"</code>
  <code class="nc">Seq</code><code class="o">(</code>
  <code class="o">...</code>
  <code class="s">"net.liftmodules"</code> <code class="o">%%</code> <code class="s">"snowstorm"</code> <code class="o">%</code> <code class="s">"1.0.0"</code><code class="o">,</code>
  <code class="o">...</code></pre>

<p>In our Lift application’s <em>Boot.scala</em>, we finally initialise the plugin:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">net.liftmodules.snowstorm.Snowstorm</code>
<code class="nc">Snowstorm</code><code class="o">.</code><code class="n">init</code><code class="o">()</code></pre>

<p>When we run our Lift application, white snow will be falling on every page, supplied by the module.</p>
</section>













<section data-type="sect2" id="discussion-q8svtAc4">
<h2>Discussion</h2>

<p>The module is self contained: there’s no need for users to copy JavaScript files around or modify their templates.  To achieve that, we’ve made use of <code>ResourceServer</code>.  When we reference the JavaScript file via <em>/classpath/snowstorm.js</em>, Lift will attempt to locate <em>snowstorm.js</em> from the classpath.  This is what we want for our Lift application, because <em>snowstorm.js</em> will be inside the module JAR file.</p>

<p>However, we do not want to expose all files on the classpath to anyone visiting our application. To avoid that, Lift looks for resources inside a <em>toserve</em> folder, which for our purposes means files and folders inside <em>src/main/resources/toserve</em>.  You can think of <span class="keep-together"><em>/classpath</em></span> meaning <em>toserve</em> (although, you can change those values via <code>LiftRules.resourceServerPath</code> and <code>ResourceServer.baseResourceLocation</code>).</p>

<p>As a further precaution, you need to explicitly allow access to these resources.  That’s done with:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="nc">ResourceServer</code><code class="o">.</code><code class="n">allow</code> <code class="o">{</code>
  <code class="k">case</code> <code class="s">"snowstorm.js"</code> <code class="o">::</code> <code class="nc">Nil</code> <code class="k">=&gt;</code> <code class="kc">true</code>
<code class="o">}</code></pre>

<p>We’re just always returning <code>true</code> for anyone who asks for this resource, but we could dynamically control access here if we wanted.</p>

<p><code>S.putInHead</code> adds the JavaScript to the head of a page and is triggered on every page by <code>LiftSession.onBeginServicing</code> (also discussed in <a data-type="xref" href="#OnSession">Running Code When Sessions Are Created (or Destroyed)</a>). We could make use of <code>Req</code> here to restrict the snowstorm to particular pages, but we’re adding it to every page.</p>

<p>Hopefully you can see that anything you can do in a Lift application you can probably turn into a Lift module.  A typical approach might be to have functionality in a Lift application, and then factor out settings in <code>Boot</code> into a module <code>init</code> method.  For example, if you wanted to provide REST services as a module, that would be possible and is an approach taken by the Lift PayPal module.</p>










<section data-type="sect3" id="making-your-module-available-m8szuQtacB">
<h3>Making your module available</h3>

<p>If you do want your module to be used by a wider audience, you need to publish it to a public repository, such as Sonatype or CloudBees. You’ll also want to keep your module up-to-date with Lift releases. There are a few conventions around this.</p>

<p>One convention is to include the Lift "edition" as part of the module name. For example, version 1.0.0 of your <em>foo</em> module for Lift 2.5 would have the name <em>foo_2.5</em>. This makes it clear your module is compatible with Lift for all of 2.5, including milestones, release candidates, snapshots, and final releases.  It also means you need to publish your module only once, at least until Lift 2.6 or 3.0 is available.</p>

<p>One way to manage updates is to make a modification to your module build to allow the Lift version number to change. This makes it possible to automate the build when new versions of Lift are released. To do that, create <em>project/LiftModule.scala</em> in your module:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">sbt._</code>
<code class="k">import</code> <code class="nn">sbt.Keys._</code>

<code class="k">object</code> <code class="nc">LiftModuleBuild</code> <code class="k">extends</code> <code class="nc">Build</code> <code class="o">{</code>

  <code class="k">val</code> <code class="n">liftVersion</code> <code class="k">=</code> <code class="nc">SettingKey</code><code class="o">[</code><code class="kt">String</code><code class="o">](</code><code class="s">"liftVersion"</code><code class="o">,</code>
    <code class="s">"Full version number of the Lift Web Framework"</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">liftEdition</code> <code class="k">=</code> <code class="nc">SettingKey</code><code class="o">[</code><code class="kt">String</code><code class="o">](</code><code class="s">"liftEdition"</code><code class="o">,</code>
    <code class="s">"Lift Edition (short version number to append to artifact name)"</code><code class="o">)</code>

  <code class="k">val</code> <code class="n">project</code> <code class="k">=</code> <code class="nc">Project</code><code class="o">(</code><code class="s">"LiftModule"</code><code class="o">,</code> <code class="n">file</code><code class="o">(</code><code class="s">"."</code><code class="o">))</code>
<code class="o">}</code></pre>

<p>This defines a setting to control the Lift version number.  You use it in your module <em>build.sbt</em> like this:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="n">name</code> <code class="o">:=</code> <code class="s">"snowstorm"</code>

<code class="n">organization</code> <code class="o">:=</code> <code class="s">"net.liftmodules"</code>

<code class="n">version</code> <code class="o">:=</code> <code class="s">"1.0.0-SNAPSHOT"</code>

<code class="n">liftVersion</code> <code class="o">&lt;&lt;=</code> <code class="n">liftVersion</code> <code class="o">??</code> <code class="s">"2.5-SNAPSHOT"</code>

<code class="n">liftEdition</code> <code class="o">&lt;&lt;=</code> <code class="n">liftVersion</code> <code class="n">apply</code> <code class="o">{</code> <code class="k">_</code><code class="o">.</code><code class="n">substring</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code class="mi">3</code><code class="o">)</code> <code class="o">}</code>

<code class="n">name</code> <code class="o">&lt;&lt;=</code> <code class="o">(</code><code class="n">name</code><code class="o">,</code> <code class="n">liftEdition</code><code class="o">)</code> <code class="o">{</code> <code class="o">(</code><code class="n">n</code><code class="o">,</code> <code class="n">e</code><code class="o">)</code> <code class="k">=&gt;</code>  <code class="n">n</code> <code class="o">+</code> <code class="s">"_"</code> <code class="o">+</code> <code class="n">e</code> <code class="o">}</code>

<code class="o">...</code>

<code class="n">libraryDependencies</code> <code class="o">&lt;++=</code> <code class="n">liftVersion</code> <code class="o">{</code> <code class="n">v</code> <code class="k">=&gt;</code>
  <code class="s">"net.liftweb"</code> <code class="o">%%</code> <code class="s">"lift-webkit"</code> <code class="o">%</code> <code class="n">v</code> <code class="o">%</code> <code class="s">"provided"</code> <code class="o">::</code>
  <code class="nc">Nil</code>
<code class="o">}</code></pre>

<p>Note the <code>"provided"</code> configuration for Lift in the build file. This means that when your module is used, the version of Lift’s WebKit will be the version provided by the application being built by the person using your module.</p>

<p>What the previous code gives you is a way for your module to depend on Lift ("2.5"), without locking your module into a specific release if it happens to be built with "2.5-SNAPSHOT." By using a setting of <code>liftVersion</code>, we can control the version via a script for all modules.  This is what we do to publish a range of Lift modules after each Lift release, as described <a href="https://www.assembla.com/spaces/liftweb/wiki/Releasing_the_modules">on the Lift wiki</a>.</p>

<p>When your module is built, don’t forget to announce it on the Lift mailing list.</p>
</section>













<section data-type="sect3" id="debugging-your-module-dbs7UGtpck">
<h3>Debugging your module</h3>

<p>When working on a module and testing it in a Lift application, it would be a chore to have to publish your module each time you changed it. Fortunately, SBT allows your Lift application to depend on the source of a module.  To use this, change your Lift project to remove the dependency on the published module and instead add a local dependency by creating <em>project/LocalModuleDev.scala</em>:</p>

<pre data-type="programlisting" data-code-language="scala" data-highlighted="true"><code class="k">import</code> <code class="nn">sbt._</code>
<code class="k">object</code> <code class="nc">LocalModuleDev</code> <code class="k">extends</code> <code class="nc">Build</code> <code class="o">{</code>
  <code class="k">lazy</code> <code class="k">val</code> <code class="n">root</code> <code class="k">=</code> <code class="nc">Project</code><code class="o">(</code><code class="s">""</code><code class="o">,</code> <code class="n">file</code><code class="o">(</code><code class="s">"."</code><code class="o">))</code> <code class="n">dependsOn</code><code class="o">(</code><code class="n">snow</code><code class="o">)</code>
  <code class="k">lazy</code> <code class="k">val</code> <code class="n">snow</code> <code class="k">=</code> <code class="nc">ProjectRef</code><code class="o">(</code><code class="n">uri</code><code class="o">(</code><code class="s">"../snowstorm"</code><code class="o">),</code> <code class="s">"LiftModule"</code><code class="o">)</code>
<code class="o">}</code></pre>

<p>We are assuming that the snowstorm source can be found at <em>../snowstorm</em> relative to the Lift application we are using. With this in place, when you build your Lift project, SBT will automatically compile and depend on changes in the local <code>snowstorm</code> module.</p>
</section>



</section>













<section data-type="sect2" id="see-also-1Ls9hrcv">
<h2>See Also</h2>

<p>Originally, Lift included a set of modules, but these have been separated out to <a href="https://github.com/liftmodules/">individual projects</a>.  The Lift contributor policy outlined in <a data-type="xref" href="#LiftCodeContributions">Contributing Small Code Changes and ScalaDoc</a> doesn’t apply to Lift modules: you’re free to contribute to these modules as you would any other open source project.<a data-type="indexterm" data-startref="ix_CSmf" id="id-yYCrIpFnheca"></a><a data-type="indexterm" data-startref="ix_Mcs" id="id-VMC2trF1hOcQ"></a></p>

<p>The Lift wiki pages for modules can be reached via <a href="http://liftmodules.net"><em class="hyperlink">http://liftmodules.net</em></a>.</p>

<p><a href="https://github.com/scottschiller/snowstorm/">The Snowstorm project</a> has been "setting CPUs on fire worldwide every winter since 2003," and the module developed for this recipe is <a href="https://github.com/LiftCookbook/snowstorm-example-module">on GitHub</a>.</p>

<p>To publish to Sonatype, take a look at <a href="http://bit.ly/163Hb0y">their guide</a>. CloudBees offers an <a href="http://www.cloudbees.com/foss/foss-dev.cb">open source repository</a>.</p>

<p>There are other ways to structure common code between Lift applications. For an example that uses SBT modules and Git, see the <a href="http://bit.ly/lift-moduleapp">mailing list discussion on "Modularize Lift Applications"</a>.</p>
</section>





</section>







</section>









<section data-type="index">
  <h1>Index</h1>
  <div data-type="index">
    <div data-type="indexdiv">
        <h3>Symbols</h3>
        <ul>
          <li>
  
  <span data-type="index-term">&amp; (combining) selectors</span>, <a data-type="index:locator" href="book.html#id-LnCvtGFxI7hr">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">200 status code</span>, <a data-type="index:locator" href="book.html#id-VMCQIrFktZCd">Discussion</a>, <a data-type="index:locator" href="book.html#id-VMCpFJi9I8Ur">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">403 (forbidden) statuses</span>, <a data-type="index:locator" href="book.html#id-4nCqSAIMIYfa">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">404 (Empty) pages</span>, <a data-type="index:locator" href="book.html#id-ZbCnIMFMtZCJ">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">404 (not found) pages</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFjHx">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">404 status</span>, <a data-type="index:locator" href="book.html#id-yYCAS1IvtvCn">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">500 (internal server) error</span>, <a data-type="index:locator" href="book.html#id-JnCzF7tpIyuN">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">@ selector expressions</span>, <a data-type="index:locator" href="book.html#id-0nCEFGFPIzT8">Solution</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>A</h3>
        <ul>
          <li>
  
  <span data-type="index-term">access control</span>, <a data-type="index:locator" href="book.html#id-9nCDtvFpF0Cp">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">access not allowed error message</span>, <a data-type="index:locator" href="book.html#id-wqCjh9tBtMsW">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">AFNetworking</span>, <a data-type="index:locator" href="book.html#id-9nCdFBI4tzsM">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Ajax</span>
  <ul>
    <li>
  
  <span data-type="index-term">file upload tool</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFLF2s8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">form processing via</span>, <a data-type="index:locator" href="book.html#id-0nCEFGFqFzTJ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">server-side code triggering</span>, <a data-type="index:locator" href="book.html#ix_AJssc">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">setting CSS class</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFnT7i8">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">ajaxCall</span>, <a data-type="index:locator" href="book.html#id-zdCbtGFeixtdhn">ajaxCall: receiving an arbitrary client-side string</a>, <a data-type="index:locator" href="book.html#id-9nCrIDS4t2h1tPhg">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">ajaxInvoke</span>, <a data-type="index:locator" href="book.html#ix_AIssc">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">ajaxSelect</span>, <a data-type="index:locator" href="book.html#id-GnCPtgFkIgTg">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">alert dialog boxes</span>, <a data-type="index:locator" href="book.html#id-DnC1SmtvtQcA">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Amazon Elastic Block Storage</span>, <a data-type="index:locator" href="book.html#id-zdCXIzIDtlcA">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Amazon Elastic Load Balancer</span>, <a data-type="index:locator" href="book.html#id-PnCkI7F0TKtwHa">Amazon Load Balancer</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Amazon Web Services (AWS) Elastic Beanstalk</span>, <a data-type="index:locator" href="book.html#id-4nC2FYFVF4c1">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Amazon’s Simple Notification Service (SNS)</span>, <a data-type="index:locator" href="book.html#id-PnCpS7FaCKt7T4">Host IP and port number</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">andThen selector expressions</span>, <a data-type="index:locator" href="book.html#id-0nClIGFPIKh8">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">AsciiDoc markup language</span>, <a data-type="index:locator" href="book.html#id-ZbC1FmIMtdTg">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Assembla</span>, <a data-type="index:locator" href="book.html#id-JnCzFjIpIvhl">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">associations, removing</span>, <a data-type="index:locator" href="book.html#id-nxClhGuxtDcM">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">attributes</span>, <a data-type="index:locator" href="book.html#id-GnCEhjImtgT7">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">authentication</span>
  <ul>
    <li>
  
  <span data-type="index-term">for databases</span>, <a data-type="index:locator" href="book.html#id-W7CESLFAtvIG">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">for email</span>, <a data-type="index:locator" href="book.html#id-JnCvtlFNFzcQ">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">authentication tokens</span>, <a data-type="index:locator" href="book.html#id-LnC7S2hxIkTZ">Solutions</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">autocomplete suggestions</span>, <a data-type="index:locator" href="book.html#ix_autocomp">Problem</a>
  <ul>
    <li>
  
  <span data-type="index-term">alternative libraries for</span>, <a data-type="index:locator" href="book.html#id-ZbCxSMFqirtBuM">Alternative autocomplete JavaScript</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">jQuery UI for</span>, <a data-type="index:locator" href="book.html#id-kVCvhpFpIXuQ">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">new values and</span>, <a data-type="index:locator" href="book.html#id-zdCXIGFjcxteu4">Submitting new values</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">query/callback functions</span>, <a data-type="index:locator" href="book.html#id-jyC9TlcDiXtKu1">Alternative autocomplete JavaScript</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Typeahead</span>, <a data-type="index:locator" href="book.html#id-yYCASktKi4tNuV">Alternative autocomplete JavaScript</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">autoscaling</span>, <a data-type="index:locator" href="book.html#id-rjCpFYFOTYtMc0">Multiple instances</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>B</h3>
        <ul>
          <li>
  
  <span data-type="index-term">Beanstalk</span>, <a data-type="index:locator" href="book.html#id-VMCBirFXFOcO">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">binary compatibility</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFMhnCn">See Also</a>, <a data-type="index:locator" href="book.html#id-e4CAFJFqIWCG">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">binary data uploads</span>, <a data-type="index:locator" href="book.html#id-9nCrIvF4tqHr">Discussion</a>, <a data-type="index:locator" href="book.html#id-GnCPtgFbFeiK">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Boot.scala</span>, <a data-type="index:locator" href="book.html#id-W7CQIGIDhXtJIw">Source code</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Bootstrap</span>, <a data-type="index:locator" href="book.html#id-rjCwtgI0iYtYuP">Alternative autocomplete JavaScript</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">browsers</span>
  <ul>
    <li>
  
  <span data-type="index-term">avoiding caching</span>, <a data-type="index:locator" href="book.html#id-W7CESLFYFZCa">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">detecting features in</span>, <a data-type="index:locator" href="book.html#id-zdCXIecpIxtwi4">HTML5 date pickers</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">downloads vs. visits</span>, <a data-type="index:locator" href="book.html#id-4nCqSYFVFPFa">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">field focus in</span>, <a data-type="index:locator" href="book.html#id-GnC7IgFbFeig">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">handling session loss</span>, <a data-type="index:locator" href="book.html#id-4nCkIYFVFlCb">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">loading pages without refresh</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFbFQug">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">reloading</span>, <a data-type="index:locator" href="book.html#id-LnCNIGFWtkTZ">Discussion</a>, <a data-type="index:locator" href="book.html#id-DnCXIVivt4hn">Discussion</a>, <a data-type="index:locator" href="book.html#id-KnC9IeFbFJhv">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">running code on session creation/destruction</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFYFQTy">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">session affinity</span>, <a data-type="index:locator" href="book.html#id-9nCrIvF4txTN">Discussion</a>, <a data-type="index:locator" href="book.html#id-OnCKTmFbTWtdc1">Multiple instances</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">using legacy</span>, <a data-type="index:locator" href="book.html#id-AnCPS1IYIoia">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">BsonRecord</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFpI4Tm">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">bugs, reporting of</span>, <a data-type="index:locator" href="book.html#id-e4CzSJFZF2In">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">build.sbt, contents</span>, <a data-type="index:locator" href="book.html#id-JnCmIjIDtyuj">Discussion</a>, <a data-type="index:locator" href="book.html#id-LnCbFetxI0tQI8">Simple Build Tool</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>C</h3>
        <ul>
          <li>
  
  <span data-type="index-term">chat sessions</span>, <a data-type="index:locator" href="book.html#id-9nCxhvFpF0C8">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">checkboxes</span>
  <ul>
    <li>
  
  <span data-type="index-term">conditional disablement of</span>, <a data-type="index:locator" href="book.html#id-kVCltpFLFPCQ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">multiple options</span>, <a data-type="index:locator" href="book.html#id-4nCPtYFVF2sd">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Chrome, date picker format</span>, <a data-type="index:locator" href="book.html#id-JnCzFLhpIKtniA">HTML5 date pickers</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">class attributes</span>, <a data-type="index:locator" href="book.html#id-ZbCnIMFjUrtXTn">Appending to a class attribute</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Class Not Found error message</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFYFlUa">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">clickable links</span>, <a data-type="index:locator" href="book.html#id-ZbCBhMFXFjSy">Problem</a>, <a data-type="index:locator" href="book.html#id-JnCzFlFNFxFk">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">ClickStart Applications</span>, <a data-type="index:locator" href="book.html#id-jyCxSoF7fXt1TV">ClickStarts</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">cloud services</span>, <a data-type="index:locator" href="book.html#id-kVCAIntDtkIm">Discussion</a>, <a data-type="index:locator" href="book.html#id-9nCjSBI4tecN">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">CloudBees</span>, <a data-type="index:locator" href="book.html#ix_cbee">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Cmd+click shortcut</span>, <a data-type="index:locator" href="book.html#id-LnCbFGFWt8cZ">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">code changes, contributing</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFLFatv">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">code sharing, modules for</span>, <a data-type="index:locator" href="book.html#ix_CSmf">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Comet</span>
  <ul>
    <li>
  
  <span data-type="index-term">and CloudBees</span>, <a data-type="index:locator" href="book.html#id-zdCrhGFDtbTA">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">and Heroku</span>, <a data-type="index:locator" href="book.html#id-zdCkFzIDtGiA">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">executing JavaScript with</span>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFnCA">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">conditional checks</span>, <a data-type="index:locator" href="book.html#id-4nCrhYFVFlCd">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">conditional comments</span>, <a data-type="index:locator" href="book.html#id-W7CetLFYFKia">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">containerless deployment</span>, <a data-type="index:locator" href="book.html#id-lrCAIYTZtQiZ">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">containers</span>
  <ul>
    <li>
  
  <span data-type="index-term">and CloudBees</span>, <a data-type="index:locator" href="book.html#id-XmC9SOF7HqtXTm">Container version</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">deployment to</span>, <a data-type="index:locator" href="book.html#id-GnCEhjIz">Production Deployment</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">troubleshooting</span>, <a data-type="index:locator" href="book.html#id-KnCdFeFqtetv">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">types of</span>, <a data-type="index:locator" href="book.html#id-GnCycgFmtntyIN">Running your application</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">upload size limits</span>, <a data-type="index:locator" href="book.html#id-DnCaFbIvtziQ">Discussion</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">content types, setting</span>, <a data-type="index:locator" href="book.html#id-yYCyF1IvtrIz">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">contributors</span>
  <ul>
    <li>
  
  <span data-type="index-term">to Lift Cookbook</span>, <a data-type="index:locator" href="book.html#id-QnCPFXF7Tp">Contributors</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">to Lift Web Framework</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFZtB">Problem</a>, <a data-type="index:locator" href="book.html#id-DnC1SWFwF4hB">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">controlled access</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFNF2CN">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">cookies</span>, <a data-type="index:locator" href="book.html#id-VMCQIlc9IZCw">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">created time</span>, <a data-type="index:locator" href="book.html#id-pOCwtoUbtWH9">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">CSS caching</span>, <a data-type="index:locator" href="book.html#id-e4CAFJFZFWC2">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">CSS classes, setting on Ajax forms</span>, <a data-type="index:locator" href="book.html#id-4nC2FYFGT7ib">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">CSS selectors</span>
  <ul>
    <li>
  
  <span data-type="index-term">and disabled attribute</span>, <a data-type="index:locator" href="book.html#id-9nCNcvFpF0Cr">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">applying to earlier expressions</span>, <a data-type="index:locator" href="book.html#id-bGCmS2FLFmhn">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">setting meta tag contents with</span>, <a data-type="index:locator" href="book.html#id-LnCvtGFQFkTr">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">syntax for</span>, <a data-type="index:locator" href="book.html#id-W7CoFGIDhQTa">See Also</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">testing/debugging</span>, <a data-type="index:locator" href="book.html#id-QnCkSXFjF0ta">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">currency</span>, <a data-type="index:locator" href="book.html#id-ZbCPtMFXFGHb">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">custom HTTP status pages</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLFQf4">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">custom validation logic</span>, <a data-type="index:locator" href="book.html#id-9nCxhvFpFXuw">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>D</h3>
        <ul>
          <li>
  
  <span data-type="index-term">Data Table (Spec2)</span>, <a data-type="index:locator" href="book.html#id-x1C0IBFphntEI4">Data table</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">database constraint errors</span>, <a data-type="index:locator" href="book.html#id-OnCVtXHytPTO">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">database persistence</span>
  <ul>
    <li>
  
  <span data-type="index-term">with MongoDB and Record</span>, <a data-type="index:locator" href="book.html#ix_DBmdbr">MongoDB Persistence with Record</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">with Squeryl Record module</span>, <a data-type="index:locator" href="book.html#ix_DBsrm">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">databases</span>
  <ul>
    <li>
  
  <span data-type="index-term">alternative</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFAtmuB">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">cleanup after testing</span>, <a data-type="index:locator" href="book.html#id-XmC9SOFeUqtKCw">Database cleanup</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">configuring connections to</span>, <a data-type="index:locator" href="book.html#id-nxC1SLFWiWtjiL">Database access in Heroku</a>, <a data-type="index:locator" href="book.html#id-kVCltpFDtZhb">Discussion</a>, <a data-type="index:locator" href="book.html#id-XmCbtOFeUqtXTm">RDBMS configuration</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">in-memory</span>, <a data-type="index:locator" href="book.html#id-9nCdFvFlI0Cw">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">RDS instances of</span>, <a data-type="index:locator" href="book.html#id-wqC4FPFmcztGc0">Working with a database</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">viewing</span>, <a data-type="index:locator" href="book.html#id-GnCzTgFbFQue">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Databinder library</span>, <a data-type="index:locator" href="book.html#id-NnCaI2TwtMCg">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">date pickers</span>, <a data-type="index:locator" href="book.html#id-AnCDFZFvFoiV">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">DBTestKit trait</span>, <a data-type="index:locator" href="book.html#id-yYCgtpFvtvCy">Discussion</a>, <a data-type="index:locator" href="book.html#id-zdCkFGFDt2C0">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">dbType</span>, <a data-type="index:locator" href="book.html#id-VMCpFrF9IWSY">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">debugging requests</span>, <a data-type="index:locator" href="book.html#id-AnCDFZFvFNhA">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">dependencies, naming conventions of</span>, <a data-type="index:locator" href="book.html#id-4nCrhYFNtlCl">Discussion</a>, <a data-type="index:locator" href="book.html#id-VMCpFoIktktz">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">dependency injection</span>, <a data-type="index:locator" href="book.html#id-VMCvToIktZCw">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">dialog boxes</span>, <a data-type="index:locator" href="book.html#id-kVCEFntDtqc8">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">directory structure</span>, <a data-type="index:locator" href="book.html#id-9nCvHBI4tptl">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Dispatch library</span>, <a data-type="index:locator" href="book.html#id-zdCXIGFWF2C7">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">documentation, contribution of</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLFZhv">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">documents, embedding in database records</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFbFgTN">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">downloads, triggering</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFpF7FX">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">drag-and-drop support</span>, <a data-type="index:locator" href="book.html#id-9nCDtvFpFzs8">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Drebel plugin</span>, <a data-type="index:locator" href="book.html#id-kVCOT7hDt4TX">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">DRY URLs</span>, <a data-type="index:locator" href="book.html#id-LnCvtGFQF0tv">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>E</h3>
        <ul>
          <li>
  
  <span data-type="index-term">earlyResponse function</span>, <a data-type="index:locator" href="book.html#id-ZbCnIMFXFGHJ">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Eclipse IDE, development in</span>, <a data-type="index:locator" href="book.html#id-aeCdFEF2FlcY">Problem</a>, <a data-type="index:locator" href="book.html#id-oPCeIXFWsvt2Cb">Running tests in IDEs</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Elastic Beanstalk</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFNFzcv">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">element selectors</span>, <a data-type="index:locator" href="book.html#id-0nCEFGFqFDc8">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">email</span>
  <ul>
    <li>
  
  <span data-type="index-term">.com missing from address</span>, <a data-type="index:locator" href="book.html#id-AnCVtZFAT9">Missing .com from Email Addresses</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">attachments</span>, <a data-type="index:locator" href="book.html#id-4nC2FYFVF7iJ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">authenticated</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLFqcD">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">HTML</span>, <a data-type="index:locator" href="book.html#id-PnCetlCAtpho">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">logging vs. sending</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFbFKhd">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">plain-text</span>, <a data-type="index:locator" href="book.html#id-e4CAFJFZFatL">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Enterprise Java</span>, <a data-type="index:locator" href="book.html#id-9nCdFvFlI4iN">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">enumerations</span>, <a data-type="index:locator" href="book.html#id-yYCyFpFrT4tysV">Enumerations</a>, <a data-type="index:locator" href="book.html#id-e4CAFJFZFvhb">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">EnumNabeField</span>, <a data-type="index:locator" href="book.html#id-GnC7IgFbFKhN">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">error messages</span>
  <ul>
    <li>
  
  <span data-type="index-term">404 (Empty) pages</span>, <a data-type="index:locator" href="book.html#id-zdCbtGFDt2Cj">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">404 (not found) pages</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFbH7">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">500 (internal server)</span>, <a data-type="index:locator" href="book.html#id-4nCqSqtMI0uN">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">access not allowed</span>, <a data-type="index:locator" href="book.html#id-rjCwtNtxt9sm">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Class Not Found</span>, <a data-type="index:locator" href="book.html#id-AnCPSZFvF7Ua">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">clickable links in</span>, <a data-type="index:locator" href="book.html#id-zdCLTGFWFOSX">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">database constraint errors</span>, <a data-type="index:locator" href="book.html#id-XmCXhoHytvTO">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">file access</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFlI0Cp">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">from validation process</span>, <a data-type="index:locator" href="book.html#id-XmCLUBTytPiO">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">java.lang.ClassCastException</span>, <a data-type="index:locator" href="book.html#id-qXCrTrIBImtZtq">What a MongoMapField can contain</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">java.lang.OutOfMemoryError: PermGen space</span>, <a data-type="index:locator" href="book.html#id-4nCPtVuNtVhl">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">referential integrity exception</span>, <a data-type="index:locator" href="book.html#id-QnCNT2IytvcO">Discussion</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">exception handlers</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFLFXuO">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">exceptions, catching</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFau7">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">explanation pages</span>, <a data-type="index:locator" href="book.html#id-ZbCPtMFkIZCJ">Solution</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>F</h3>
        <ul>
          <li>
  
  <span data-type="index-term">F3 shortcut</span>, <a data-type="index:locator" href="book.html#id-AnCKIZFVtVcE">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">field focus</span>, <a data-type="index:locator" href="book.html#id-DnCqtWFwFziA">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">field validation</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFLF7ib">Problem</a>, <a data-type="index:locator" href="book.html#id-4nCkIYFVF0uD">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">files</span>
  <ul>
    <li>
  
  <span data-type="index-term">access control to</span>, <a data-type="index:locator" href="book.html#id-4nC2FYFVFlCN">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">container-specific configuration</span>, <a data-type="index:locator" href="book.html#id-jyCxSEIOHXt1TV">Container version</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">JAR files</span>, <a data-type="index:locator" href="book.html#id-NnCQT7hwtaiY">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">local vs. cloud storage of</span>, <a data-type="index:locator" href="book.html#id-ZbC1FmIMtocn">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">recovering filename suffixes</span>, <a data-type="index:locator" href="book.html#id-AnCVtZFvFNhv">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">suffix matching</span>, <a data-type="index:locator" href="book.html#id-AnCDFZFvFVcv">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">uploading</span>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFjHL">Problem</a>, <a data-type="index:locator" href="book.html#id-W7CoFLFYFKiz">Problem</a>, <a data-type="index:locator" href="book.html#id-4nC2FYFVF2sb">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">WAR files</span>, <a data-type="index:locator" href="book.html#id-ZbCPtMFXFzin">Problem</a>, <a data-type="index:locator" href="book.html#id-yYClcpF9FecY">Problem</a>, <a data-type="index:locator" href="book.html#id-9nCDtvFlIxTN">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">filters</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFlIdUw">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">floating-point values</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFpFqH8">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">FocusOnLoad command</span>, <a data-type="index:locator" href="book.html#id-e4CAFJFZFrie">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">forbidden (403) status pages</span>, <a data-type="index:locator" href="book.html#id-JnCzFjIpIrfk">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">formGroup function</span>, <a data-type="index:locator" href="book.html#id-wqC7S0CmcztmTy">Submit styling</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">forms processing</span>
  <ul>
    <li>
  
  <span data-type="index-term">Ajax JSON format</span>, <a data-type="index:locator" href="book.html#ix_FPajxjson">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">autocomplete suggestions</span>, <a data-type="index:locator" href="book.html#ix_FPauto">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">collecting values from</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFkhKtwTn">Collecting the value on form submission</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">conditional disablement</span>, <a data-type="index:locator" href="book.html#id-DnCXIWFwFnCL">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">date picker input</span>, <a data-type="index:locator" href="book.html#id-LnC7SGFQFMiV">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">field validation</span>, <a data-type="index:locator" href="book.html#id-4nCPtYFVF7iD">Problem</a>, <a data-type="index:locator" href="book.html#id-JnCvtlFNFyuA">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">file upload</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLFwHQ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">HTML input fields</span>, <a data-type="index:locator" href="book.html#id-e4CWhJFQtxT2">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">multiple selections</span>, <a data-type="index:locator" href="book.html#ix_FPmulval">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">radio buttons</span>, <a data-type="index:locator" href="book.html#ix_FPradbut">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">routine (non-Ajax) methods</span>, <a data-type="index:locator" href="book.html#id-KnCnSeFbFJhj">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">via Ajax</span>, <a data-type="index:locator" href="book.html#id-aeCvSEF2FVTj">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Foursquare’s domain-specific language (DSL)</span>, <a data-type="index:locator" href="book.html#id-JnCvtlFNFAia">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">functions</span>
  <ul>
    <li>
  
  <span data-type="index-term">delayed execution of</span>, <a data-type="index:locator" href="book.html#id-JnCzFlFNFyuQ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">hidden</span>, <a data-type="index:locator" href="book.html#id-zdCkFzIDtxtns4">Selecting no options</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">identity</span>, <a data-type="index:locator" href="book.html#id-kVCvhpFDtXu4">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">order of execution</span>, <a data-type="index:locator" href="book.html#id-XmCyTZUPcqtXTb">Submit styling</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">server-side code and</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFYFJc8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">testing of</span>, <a data-type="index:locator" href="book.html#id-9nCdFvFpFjIX">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">triggering with HTML select option</span>, <a data-type="index:locator" href="book.html#id-LnC7SGFQFkT2">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>G</h3>
        <ul>
          <li>
  
  <span data-type="index-term">geospatial indexes</span>, <a data-type="index:locator" href="book.html#id-9nCDtvFpFXua">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Google Sitemaps</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFnCQ">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">guard conditions</span>, <a data-type="index:locator" href="book.html#id-4nCkIqtNt7ix">Discussion</a>, <a data-type="index:locator" href="book.html#id-zdCxSyhDt2Cj">Discussion</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>H</h3>
        <ul>
          <li>
  
  <span data-type="index-term">H2 Database Engine</span>, <a data-type="index:locator" href="book.html#id-W7CetLFYFmuB">Problem</a>, <a data-type="index:locator" href="book.html#id-yYCrIktaIvCy">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">hash maps</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFYFXtG">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">head section, adding to</span>, <a data-type="index:locator" href="book.html#id-DnCXIWFwFxsx">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">help, accessing</span>, <a data-type="index:locator" href="book.html#id-e4CAFJFZF1Fn">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Heroku</span>, <a data-type="index:locator" href="book.html#ix_hero">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">hidden fields</span>, <a data-type="index:locator" href="book.html#id-PnCpS0SAtMUa">Discussion</a>, <a data-type="index:locator" href="book.html#id-9nCjSehmcptlTa">Submit styling</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">hidden functions</span>, <a data-type="index:locator" href="book.html#id-ZbCxSmIMtrt2sM">Selecting no options</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">hooks</span>, <a data-type="index:locator" href="book.html#id-OnCOIduytJix">Discussion</a>, <a data-type="index:locator" href="book.html#id-GnC7IgFbFEcD">Problem</a>, <a data-type="index:locator" href="book.html#id-e4CxIJFZFxTd">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">hosting</span>
  <ul>
    <li>
  
  <span data-type="index-term">with CloudBees</span>, <a data-type="index:locator" href="book.html#ix_HOSTcbee">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">with Elastic Beanstalk</span>, <a data-type="index:locator" href="book.html#id-rjCmuYFKFJcp">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">with Heroku</span>, <a data-type="index:locator" href="book.html#ix_HOSThero">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">HTML</span>
  <ul>
    <li>
  
  <span data-type="index-term">conditional comments</span>, <a data-type="index:locator" href="book.html#id-0nCXSGFqFYi8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">email</span>, <a data-type="index:locator" href="book.html#id-x1C0INCYtkh0">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">meta tags</span>, <a data-type="index:locator" href="book.html#id-0nClIGFqFzT8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">moving JavaScript to end of pages</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFLFrU8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">select options</span>, <a data-type="index:locator" href="book.html#id-W7CQILFYFQT8">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">HTML5</span>
  <ul>
    <li>
  
  <span data-type="index-term">date pickers</span>, <a data-type="index:locator" href="book.html#id-ZbCQcMFkIrtjiM">HTML5 date pickers</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">email semantics</span>, <a data-type="index:locator" href="book.html#id-9nCDtvF4txTV">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">markup issues</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFDt2s4">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">parser</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFAtKia">Discussion</a>, <a data-type="index:locator" href="book.html#id-e4CxIJFZFOU2">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">HTTP</span>
  <ul>
    <li>
  
  <span data-type="index-term">header access restriction</span>, <a data-type="index:locator" href="book.html#id-JnCzFlFNF4sN">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">interaction</span>, <a data-type="index:locator" href="book.html#id-yYCgtpF9FvCn">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">POSTs from iOS devices</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLF2sL">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">status codes</span>, <a data-type="index:locator" href="book.html#id-yYCyFpFvtvCn">Discussion</a>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFyfx">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">HTTPS use, forcing</span>, <a data-type="index:locator" href="book.html#id-9nCdFvFpFqHp">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">HttpServletRequest access</span>, <a data-type="index:locator" href="book.html#id-VMCQIrFmTBsr">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>I</h3>
        <ul>
          <li>
  
  <span data-type="index-term">identity functions</span>, <a data-type="index:locator" href="book.html#id-DnCqtWFvtaux">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">images</span>
  <ul>
    <li>
  
  <span data-type="index-term">storing within a record</span>, <a data-type="index:locator" href="book.html#id-4nCPtYFMIXTz">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">uploading</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFZFrir">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">in-memory mode</span>, <a data-type="index:locator" href="book.html#id-e4CAF8IQtguG">Discussion</a>, <a data-type="index:locator" href="book.html#id-JnCDSlFpI2CA">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">initWithSquerylSession</span>, <a data-type="index:locator" href="book.html#id-DnCqtWFgI4hD">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">InMemoryResponse</span>, <a data-type="index:locator" href="book.html#id-PnCxF7FzUKtVUa">InMemoryResponse</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">IntelliJ IDEA development environment</span>, <a data-type="index:locator" href="book.html#id-0nCEFGFqFYir">Problem</a>, <a data-type="index:locator" href="book.html#id-2nCzSjF8sVtBCq">Running tests in IDEs</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">interactive development, CSS selector debugging</span>, <a data-type="index:locator" href="book.html#id-bGCgF2FLFgtn">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">internal server (500) error messages</span>, <a data-type="index:locator" href="book.html#id-9nCrIOtlIXup">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">internationalisation</span>, <a data-type="index:locator" href="book.html#id-zdCxSpTDtqun">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Internet Explorer, conditional comments</span>, <a data-type="index:locator" href="book.html#id-LnCbFGFQFMir">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">iOS applications, HTTP POSTs from</span>, <a data-type="index:locator" href="book.html#id-4nCkIYFVF2sx">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>J</h3>
        <ul>
          <li>
  
  <span data-type="index-term">JAR files</span>, <a data-type="index:locator" href="book.html#id-nxClhEhxtniW">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Java Mail</span>, <a data-type="index:locator" href="book.html#id-ZbCxSLcMtYhd">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Java Naming and Directory Interface (JNDI)</span>, <a data-type="index:locator" href="book.html#id-ZbCnImIMtocd">Discussion</a>, <a data-type="index:locator" href="book.html#id-e4CxIJFZFvhp">Problem</a>, <a data-type="index:locator" href="book.html#id-XmCpFLteUqtXTm">RDBMS configuration</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Java Virtual Machine (JVM)</span>
  <ul>
    <li>
  
  <span data-type="index-term">and CloudBees</span>, <a data-type="index:locator" href="book.html#id-XmCpFOFqsqtXTm">Java version</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">troubleshooting</span>, <a data-type="index:locator" href="book.html#id-aeCNIEFJtOtY">Discussion</a>, <a data-type="index:locator" href="book.html#id-zdCrhNsDt7hM">Discussion</a>, <a data-type="index:locator" href="book.html#id-aeCvSEFJtVTY">Discussion</a>, <a data-type="index:locator" href="book.html#id-wqCDtncBtbTk">Discussion</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Java, installation of</span>, <a data-type="index:locator" href="book.html#id-QnCkSPIJINIE">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">java.lang.ClassCastException</span>, <a data-type="index:locator" href="book.html#id-g9CxhLIEIVtatg">What a MongoMapField can contain</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">JavaScript</span>
  <ul>
    <li>
  
  <span data-type="index-term">caching</span>, <a data-type="index:locator" href="book.html#id-GnC7IgFbFkC7">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">client-side function triggering with</span>, <a data-type="index:locator" href="book.html#id-AnCPSZFvFVcG">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">custom messages</span>, <a data-type="index:locator" href="book.html#id-yYCAS7ivtVu1">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">executing with Comet actor</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLFPC8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">field focus with</span>, <a data-type="index:locator" href="book.html#id-W7CESLFYFKi8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">moving to page end</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFyUg">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">running a template with</span>, <a data-type="index:locator" href="book.html#id-DnCXIWFwFauA">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">server-side function triggering with</span>, <a data-type="index:locator" href="book.html#id-DnCGhWFgIATA">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">JBoss</span>, <a data-type="index:locator" href="book.html#id-2nCeIjFDHVt9Td">Container version</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Jetty</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFmtKhx">Discussion</a>, <a data-type="index:locator" href="book.html#id-kVCAI2IDt7iL">Discussion</a>, <a data-type="index:locator" href="book.html#id-e4CLt8Iz">Production Deployment</a>, <a data-type="index:locator" href="book.html#id-DnC7iWFvtZt9IJ">Running your application</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">jlift.js JavaScript library</span>, <a data-type="index:locator" href="book.html#id-e4CLtJFqImcQ">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">jQuery File Upload widget</span>, <a data-type="index:locator" href="book.html#id-zdCLTGFWFdsJ">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">jQuery UI autocomplete</span>, <a data-type="index:locator" href="book.html#id-e4CAFJFqIguQ">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">jQuery UI date picker</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFqIriQ">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">JRebel</span>
  <ul>
    <li>
  
  <span data-type="index-term">license for</span>, <a data-type="index:locator" href="book.html#id-9nCNcvF7TptlTY">Purchased licenses</a>, <a data-type="index:locator" href="book.html#id-aeCdFEFrIVTY">Solutions</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">reducing restarts with</span>, <a data-type="index:locator" href="book.html#id-kVCltbiDtZhX">Discussion</a>, <a data-type="index:locator" href="book.html#id-0nCEFGFYtzTr">Discussion</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">JSON DSL</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFgIwUQ">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">JSON format</span>
  <ul>
    <li>
  
  <span data-type="index-term">form processing in</span>, <a data-type="index:locator" href="book.html#ix_JSONfp">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">returning from REST calls</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFbFyUK">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">jsonCall</span>, <a data-type="index:locator" href="book.html#id-ZbC1FDSyTYhDtdhJ">Discussion</a>, <a data-type="index:locator" href="book.html#id-wqC1cPFguztVh9">jsonCall: receiving a JSON value</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">JsonHandler class</span>, <a data-type="index:locator" href="book.html#id-W7CQILFBIJcO">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">JSoup</span>, <a data-type="index:locator" href="book.html#id-lrCPSYTZtwCG">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">JVM persistence mechanisms</span>, <a data-type="index:locator" href="book.html#id-W7CESLFAtXtQ">Discussion</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>L</h3>
        <ul>
          <li>
  
  <span data-type="index-term">latitude/longitude information</span>, <a data-type="index:locator" href="book.html#id-4nC2FYFVF0uz">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">license, for JRebel</span>, <a data-type="index:locator" href="book.html#id-JnC0TlF2TKtwTl">Purchased licenses</a>, <a data-type="index:locator" href="book.html#id-0nClIGFPIzTr">Solutions</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift applications</span>
  <ul>
    <li>
  
  <span data-type="index-term">authenticated email</span>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFQc2">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">autoscaling of</span>, <a data-type="index:locator" href="book.html#id-wqCrIPF4TztGc0">Multiple instances</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">basic instructions</span>, <a data-type="index:locator" href="book.html#id-KnCnS8heIAIv">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">code execution at shutdown of</span>, <a data-type="index:locator" href="book.html#id-W7CESLFYFJcy">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">creating from scratch</span>, <a data-type="index:locator" href="book.html#id-bGCgF2FaIgta">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">delayed tasks</span>, <a data-type="index:locator" href="book.html#id-4nCqSYFVF0uJ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Eclipse IDE development</span>, <a data-type="index:locator" href="book.html#id-KnCnSeFbFKcv">Problem</a>, <a data-type="index:locator" href="book.html#id-qXCZh4FLsmtlCq">Running tests in IDEs</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">email attachments</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFLF7iD">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">email logging</span>, <a data-type="index:locator" href="book.html#id-e4CzSJFZFvhL">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">fetching URLs</span>, <a data-type="index:locator" href="book.html#id-9nCjSvFpF0CV">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">forced to be stateless</span>, <a data-type="index:locator" href="book.html#id-e4CzSJFZFrid">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">HTML email</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFgTd">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">HTML generation</span>, <a data-type="index:locator" href="book.html#ix_LAhtml">HTML</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">IntelliJ IDEA development</span>, <a data-type="index:locator" href="book.html#id-aeCvSEF2FgiY">Problem</a>, <a data-type="index:locator" href="book.html#id-pOCqFjFjs4t0CO">Running tests in IDEs</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">lift_proto.db H2 database for</span>, <a data-type="index:locator" href="book.html#id-LnCbFGFQFeuZ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">plain-text email in</span>, <a data-type="index:locator" href="book.html#id-W7CESLFYFXtN">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">production deployment of</span>, <a data-type="index:locator" href="book.html#ix_LApd">Production Deployment</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">repeat tasks</span>, <a data-type="index:locator" href="book.html#id-JnCDSlFNFwUQ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">running</span>, <a data-type="index:locator" href="book.html#id-e4CpTJFQtat0ID">Running your application</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">source code for</span>, <a data-type="index:locator" href="book.html#id-zdC8HGFJhxt2IO">Source code</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">speeding development of</span>, <a data-type="index:locator" href="book.html#id-AnCVtZFVtjTE">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Squeryl-Record configuration</span>, <a data-type="index:locator" href="book.html#id-LnC7SGFQF0tx">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">standard layout of</span>, <a data-type="index:locator" href="book.html#id-4nCmCAINt1tl">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">text editor development</span>, <a data-type="index:locator" href="book.html#id-QnCkSXFjFphE">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Textile markup rendering</span>, <a data-type="index:locator" href="book.html#id-zdCXIGFWFrtX">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">verification of</span>, <a data-type="index:locator" href="book.html#id-wqCjhGtYIztm">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift community</span>, <a data-type="index:locator" href="book.html#id-DnCqtWFwF8FB">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift Cookbook</span>
  <ul>
    <li>
  
  <span data-type="index-term">code use permissions</span>, <a data-type="index:locator" href="book.html#id-yYCASpFnh4tXTx">Licensing</a>, <a data-type="index:locator" href="book.html#id-0nCXSGFXCK">Using Code Examples</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">contributors</span>, <a data-type="index:locator" href="book.html#id-EnCMSMFwTJ">Contributors</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">projects for</span>, <a data-type="index:locator" href="book.html#id-KnCdF1IQcJ">Source</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">software versions used in</span>, <a data-type="index:locator" href="book.html#id-W7CQILFYFlUB">Problem</a>, <a data-type="index:locator" href="book.html#id-aeCdFEFpuW">Software Versions</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">submitting recipes to</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFLF4Tv">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift JSON domain-specific language (DSL)</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFkIyUK">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift mailing list</span>, <a data-type="index:locator" href="book.html#id-GnC7IgFbFpFa">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift modules</span>, <a data-type="index:locator" href="book.html#id-VMCQIrFktktz">Discussion</a>, <a data-type="index:locator" href="book.html#id-DnCqtWFgIauL">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift Web Framework</span>
  <ul>
    <li>
  
  <span data-type="index-term">accessing help</span>, <a data-type="index:locator" href="book.html#id-W7CESLFYFWFn">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">as designer-friendly</span>, <a data-type="index:locator" href="book.html#id-W7CESLFBIlUa">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">bug reports</span>, <a data-type="index:locator" href="book.html#id-kVCltpFLFkIv">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">ClickStart Applications</span>, <a data-type="index:locator" href="book.html#id-oPCytXFyfvtyTr">ClickStarts</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">CSS selector transforms</span>, <a data-type="index:locator" href="book.html#id-KnCnSeFqtetb">Discussion</a>, <a data-type="index:locator" href="book.html#id-JnC0TlFNF2Cn">Problem</a>, <a data-type="index:locator" href="book.html#id-4nCkIqtMI7ib">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">downloading</span>, <a data-type="index:locator" href="book.html#id-7nCJSgFDFVId">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">form processing in</span>, <a data-type="index:locator" href="book.html#ix_LWFfp">Forms Processing in Lift</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">latest build of</span>, <a data-type="index:locator" href="book.html#id-LnC7SGFQFxUZ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">learning more about</span>, <a data-type="index:locator" href="book.html#id-W7CetLFAtJcB">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Lift MongoDB dependencies</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFqI2Ib">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">modules for code sharing</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFpFecD">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">prerequisites</span>, <a data-type="index:locator" href="book.html#id-mwCoSyFp">Preface</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">snippets in</span>, <a data-type="index:locator" href="book.html#id-e4CpT8IQtat2">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Squeryl Record module</span>, <a data-type="index:locator" href="book.html#id-0nCbtGFd">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">stateful features of</span>, <a data-type="index:locator" href="book.html#id-ZbCPtMFMtdTn">Discussion</a>, <a data-type="index:locator" href="book.html#id-wqC7SBiBtaFG">Discussion</a>, <a data-type="index:locator" href="book.html#id-x1C1tBFlTntecQ">Multiple instances</a>, <a data-type="index:locator" href="book.html#id-4nC2FqtMI7iN">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">submitting improvements to</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFnta">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Textile module</span>, <a data-type="index:locator" href="book.html#id-ZbC1FMFXFAty">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">view first approach of</span>, <a data-type="index:locator" href="book.html#id-7nCEIgFp">HTML</a>, <a data-type="index:locator" href="book.html#id-ZbCdsMFahrtPID">Source code</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">vs. conventional software</span>, <a data-type="index:locator" href="book.html#id-QnCkSXFytNIE">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Widgets module</span>, <a data-type="index:locator" href="book.html#id-GnC7IgFkIQuQ">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Lift wiki page</span>, <a data-type="index:locator" href="book.html#id-9nCrIBIlI2hD">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">lift_basic H2 database</span>, <a data-type="index:locator" href="book.html#id-AnCKIZFvF9uE">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">LiftRules</span>
  <ul>
    <li>
  
  <span data-type="index-term">.early</span>, <a data-type="index:locator" href="book.html#id-zdCLTpTDt7hj">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">.earlyInStateful</span>, <a data-type="index:locator" href="book.html#id-VMCohkuktzhr">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">.earlyInStateless</span>, <a data-type="index:locator" href="book.html#id-XmClcoHytEhK">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">.noCometSessionCmd</span>, <a data-type="index:locator" href="book.html#id-rjCNcgIxtECa">Discussion</a>, <a data-type="index:locator" href="book.html#id-ZbC9TMFXFZCb">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">.onBeginServicing</span>, <a data-type="index:locator" href="book.html#id-GnCPtgFkIKhD">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">.unloadHooks</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFkIEcD">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">LiftScreen</span>
  <ul>
    <li>
  
  <span data-type="index-term">CssBoundLiftScreen</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFNFrfn">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">custom layout</span>, <a data-type="index:locator" href="book.html#id-4nC2FYFVFYfd">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">LiftSession hooks</span>, <a data-type="index:locator" href="book.html#id-GnC7IgFkIgTD">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">links</span>
  <ul>
    <li>
  
  <span data-type="index-term">clickable</span>, <a data-type="index:locator" href="book.html#id-9nCDtvFpFmSX">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">types of</span>, <a data-type="index:locator" href="book.html#id-2nCZhjF8sVtJcq">Types of link</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">load balancers</span>, <a data-type="index:locator" href="book.html#id-OnCVtmFbTWtgHO">Amazon Load Balancer</a>, <a data-type="index:locator" href="book.html#id-jyCgioFETXtZcV">Multiple instances</a>, <a data-type="index:locator" href="book.html#id-DnCJTbIa">Production Deployment</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">location information</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFNFyua">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Location Parameters</span>, <a data-type="index:locator" href="book.html#id-x1C2iBFYtysr">Discussion</a>, <a data-type="index:locator" href="book.html#id-PnCxF7FxcKtwHa">Via SiteMap</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">locparam</span>, <a data-type="index:locator" href="book.html#id-PnCQu7FAtZsZ">Discussion</a>, <a data-type="index:locator" href="book.html#id-OnCOImF7cWtgHO">Via SiteMap</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">logging</span>, <a data-type="index:locator" href="book.html#id-yYCrIktvtecY">Discussion</a>, <a data-type="index:locator" href="book.html#id-DnCXIWFwF4h2">Problem</a>, <a data-type="index:locator" href="book.html#id-yYCrIpF9FYfy">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>M</h3>
        <ul>
          <li>
  
  <span data-type="index-term">Mailer</span>, <a data-type="index:locator" href="book.html#id-zdCbtzIDtlc7">Discussion</a>, <a data-type="index:locator" href="book.html#id-JnCmIlFNFAiQ">Problem</a>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFAT2">Problem</a>, <a data-type="index:locator" href="book.html#id-GnC7IgFbFntd">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Mailer.authenticator</span>, <a data-type="index:locator" href="book.html#id-9nCDtvFlIecV">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Mailer.devModeSend</span>, <a data-type="index:locator" href="book.html#id-kVCltpFLFZhD">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">mailing list, for help with Lift</span>, <a data-type="index:locator" href="book.html#id-kVCvhpFLFbFv">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">many-to-many relationships</span>, <a data-type="index:locator" href="book.html#ix_mtmr">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">mapped fields</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFZFatb">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Markdown</span>, <a data-type="index:locator" href="book.html#id-zdCXIzIDtbTr">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Maven-based Jenkins build</span>, <a data-type="index:locator" href="book.html#id-pOCZIjFVf4tNTB">ClickStarts</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">MEDIUMTEXT</span>, <a data-type="index:locator" href="book.html#id-wqCjhPFGFqSA">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">meta tag contents, setting</span>, <a data-type="index:locator" href="book.html#id-KnCnSeFbFOTb">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">milestone releases</span>, <a data-type="index:locator" href="book.html#id-e4CAFJFQtOUG">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">minimum/maximum length validation</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFDt7ib">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">mock requests</span>, <a data-type="index:locator" href="book.html#id-zdCbtGFWFyIX">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">modules, for code sharing</span>, <a data-type="index:locator" href="book.html#ix_Mcs">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">MongoDB</span>
  <ul>
    <li>
  
  <span data-type="index-term">connecting to</span>, <a data-type="index:locator" href="book.html#id-LnC7SGFQFvIB">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">document embedding</span>, <a data-type="index:locator" href="book.html#id-e4CzSJFZFxTb">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">enumeration storage</span>, <a data-type="index:locator" href="book.html#id-W7CESLFYFzhG">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">hash map storage</span>, <a data-type="index:locator" href="book.html#id-AnCPSZFvFXt8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">latitude/longitude information</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFLFXum">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">linked records</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFEcN">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">queries with Scala console</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFpFdUa">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">querying/updating records</span>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFzil">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">unit tests</span>, <a data-type="index:locator" href="book.html#ix_MDBunit">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">MongoHQ</span>, <a data-type="index:locator" href="book.html#id-2nCeIjFNUVtBCq">Database cleanup</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">MongoLabs</span>, <a data-type="index:locator" href="book.html#id-jyClFoFjUXtnCp">Database cleanup</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">MongoMapFields</span>, <a data-type="index:locator" href="book.html#id-jyClFoFZIXtjtp">What a MongoMapField can contain</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">MongoRefField</span>, <a data-type="index:locator" href="book.html#id-9nCxhvFlIeca">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Motto example</span>, <a data-type="index:locator" href="book.html#id-AnCPS1IYIVcV">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">multiple selections</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFxsL">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">MySQL</span>, <a data-type="index:locator" href="book.html#id-rjCwtYFKF1SZ">Problem</a>, <a data-type="index:locator" href="book.html#id-VMCpFrFXFGFY">Problem</a>, <a data-type="index:locator" href="book.html#id-x1C0IBFEcntecQ">Working with a database</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>N</h3>
        <ul>
          <li>
  
  <span data-type="index-term">names/naming</span>
  <ul>
    <li>
  
  <span data-type="index-term">of dependencies</span>, <a data-type="index:locator" href="book.html#id-JnC0TlFDt2Cw">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">page titles</span>, <a data-type="index:locator" href="book.html#id-e4CpTJFZFmc2">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">recovering filename suffixes</span>, <a data-type="index:locator" href="book.html#id-LnCNIGFQF7hv">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Netty library</span>, <a data-type="index:locator" href="book.html#id-OnCVtrTytdCK">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">not found messages</span>, <a data-type="index:locator" href="book.html#id-4nCPtYFVFqHa">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>O</h3>
        <ul>
          <li>
  
  <span data-type="index-term">object-relational mapping</span>, <a data-type="index:locator" href="book.html#id-KnCdFeF7">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">ObjectIdRefField</span>, <a data-type="index:locator" href="book.html#id-ZbC9TMFkIoc0">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">onBeginServicing function</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFqIvhd">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">one-to-many relationships</span>, <a data-type="index:locator" href="book.html#ix_otmr">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">onEvent</span>, <a data-type="index:locator" href="book.html#id-ZbCBhMFahrtXTK">Collecting the value on form submission</a>, <a data-type="index:locator" href="book.html#id-zdCrhGFjcxtdhn">onEvent: receiving the value of a DOM element</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">OutputSteamResponse</span>, <a data-type="index:locator" href="book.html#id-4nCkIYFVFmUN">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>P</h3>
        <ul>
          <li>
  
  <span data-type="index-term">page not found (404 error) message</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFLFwH4">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">page titles</span>, <a data-type="index:locator" href="book.html#id-LnCNIGFQF8cr">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">parallel tests</span>, <a data-type="index:locator" href="book.html#id-jyCxSoFVCXtnCp">Parallel tests</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">parameters, manual selection of</span>, <a data-type="index:locator" href="book.html#id-LnCbFGFWt7hV">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">PassThru transform</span>, <a data-type="index:locator" href="book.html#id-AnCDFZFvF9ua">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">permanent generation</span>, <a data-type="index:locator" href="book.html#id-yYC4TasvtBhX">Discussion</a>, <a data-type="index:locator" href="book.html#id-rjCeIqcxtVTp">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">port numbers</span>, <a data-type="index:locator" href="book.html#id-XmCKIOFmCqtXTm">Host IP and port number</a>, <a data-type="index:locator" href="book.html#id-ZbCnIMFahocd">See Also</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">PostgreSQL service</span>, <a data-type="index:locator" href="book.html#id-NnC7FnFgi4tBiV">Database access in Heroku</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">production deployments</span>
  <ul>
    <li>
  
  <span data-type="index-term">databases for</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFQtguG">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">to Amazon Web Services (AWS) Elastic Beanstalk</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFLFqck">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">to CloudBees</span>, <a data-type="index:locator" href="book.html#ix_PDcbee">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">to Heroku</span>, <a data-type="index:locator" href="book.html#ix_PDhero">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">production releases</span>, <a data-type="index:locator" href="book.html#id-W7CESLFAtlUB">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">progress bars</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFNF4sj">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">public hostnames</span>, <a data-type="index:locator" href="book.html#id-OnCLFmFJCWtVT1">Host IP and port number</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>Q</h3>
        <ul>
          <li>
  
  <span data-type="index-term">queries</span>
  <ul>
    <li>
  
  <span data-type="index-term">by reference</span>, <a data-type="index:locator" href="book.html#id-wqC7SPFPUztGce">Querying by reference</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">of location information</span>, <a data-type="index:locator" href="book.html#id-XmCpFOFmCqtGuw">Querying</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">with Scala console</span>, <a data-type="index:locator" href="book.html#id-4nCqSYFVFmUz">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">query parameters</span>, <a data-type="index:locator" href="book.html#id-JnCmIlF2TAij">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">questions about Lift, how to ask</span>, <a data-type="index:locator" href="book.html#id-DnCXIWFwFNIB">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>R</h3>
        <ul>
          <li>
  
  <span data-type="index-term">radio buttons</span>, <a data-type="index:locator" href="book.html#ix_radbut">Problem</a>, <a data-type="index:locator" href="book.html#id-AnCKIZFvFNhG">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">RDBMS (Relational Database Management System)</span>, <a data-type="index:locator" href="book.html#id-PnCxF7FzUKt7T4">RDBMS configuration</a>, <a data-type="index:locator" href="book.html#id-rjCXSYFzcYtMc0">Working with a database</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Record, configuration of</span>, <a data-type="index:locator" href="book.html#id-AnC1TZFl">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Record-Squeryl Lift applications</span>
  <ul>
    <li>
  
  <span data-type="index-term">configuring</span>, <a data-type="index:locator" href="book.html#id-AnCDFZFvFXt9">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">custom validation logic for</span>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFauD">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">field validation in</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFeix">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">JNDI data sources for</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFYFzhQ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">many-to-many relationships in</span>, <a data-type="index:locator" href="book.html#ix_RSLAmtmr">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">modifying values before storage</span>, <a data-type="index:locator" href="book.html#ix_RSLAmvbs">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">MySQLs character set encoding</span>, <a data-type="index:locator" href="book.html#id-rjCeIYFKFbFZ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">MySQLs MEDIUMTEXT</span>, <a data-type="index:locator" href="book.html#id-VMCQIrFXFWSY">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">one-to-many relationships in</span>, <a data-type="index:locator" href="book.html#ix_RSLAotmr">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">random value column storage</span>, <a data-type="index:locator" href="book.html#id-JnCDSlFNF4sA">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">SQL logging</span>, <a data-type="index:locator" href="book.html#id-ZbCxSMFXFVf2">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">testing with Specs</span>, <a data-type="index:locator" href="book.html#ix_RSLAtws">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">timestamps in</span>, <a data-type="index:locator" href="book.html#id-9nCjSvFpFqHw">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">records</span>
  <ul>
    <li>
  
  <span data-type="index-term">linking</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFQcl">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">querying/updating</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLF7im">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">searching for</span>, <a data-type="index:locator" href="book.html#id-PnCkI7FzUKt1c0">Querying by reference</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">references</span>
  <ul>
    <li>
  
  <span data-type="index-term">querying by</span>, <a data-type="index:locator" href="book.html#id-x1CZFBFWUntecK">Querying by reference</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">types of</span>, <a data-type="index:locator" href="book.html#id-jyCvtoFMsXtZcp">Types of link</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">updating/deleting</span>, <a data-type="index:locator" href="book.html#id-x1C4SBFACntecK">Updating and deleting</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">referential integrity exception</span>, <a data-type="index:locator" href="book.html#id-EnCxhzImtycp">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">regular expression validation</span>, <a data-type="index:locator" href="book.html#id-JnCDS7tDtAiA">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">release candidates</span>, <a data-type="index:locator" href="book.html#id-GnC7IgFmtyUe">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">releases repository</span>, <a data-type="index:locator" href="book.html#id-DnCqtWFvtwUn">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">replacement rules</span>, <a data-type="index:locator" href="book.html#id-e4CLt8IQtxT2">Discussion</a>, <a data-type="index:locator" href="book.html#id-yYCyFXcPc4tXTV">Submit styling</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">reporting bugs</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFbFXIa">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">reports, generating</span>, <a data-type="index:locator" href="book.html#id-PnCkIXiAtXF1">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">request buffering</span>, <a data-type="index:locator" href="book.html#id-ZbC1FltMtdTn">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">request pipeline</span>
  <ul>
    <li>
  
  <span data-type="index-term">access-controlled files</span>, <a data-type="index:locator" href="book.html#id-kVCkSpFLFPCO">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">catching exceptions</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFQuD">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">code execution at shutdown</span>, <a data-type="index:locator" href="book.html#id-kVCvhpFLFqcO">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">code execution on session creation/destruction</span>, <a data-type="index:locator" href="book.html#id-GnCPtgFbFgTD">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">controlling</span>, <a data-type="index:locator" href="book.html#id-bGCgF2Fk">Request Pipeline</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">debugging requests</span>, <a data-type="index:locator" href="book.html#id-LnC7SGFQF7hl">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">diagrams of</span>, <a data-type="index:locator" href="book.html#id-KnCdF1IV">Request Pipeline</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">forcing HTTPS use</span>, <a data-type="index:locator" href="book.html#id-JnCDSlFNFlHN">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">HTTP header access restriction</span>, <a data-type="index:locator" href="book.html#id-4nCqSYFVF2sN">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">HttpServletRequest access</span>, <a data-type="index:locator" href="book.html#id-yYCyFpFrTWs1">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">shortcutting</span>, <a data-type="index:locator" href="book.html#id-zdCxSvtDtwFX">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">stateless mode</span>, <a data-type="index:locator" href="book.html#id-DnCXIWFwFzi7">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">streaming content</span>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFwU7">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">requests</span>
  <ul>
    <li>
  
  <span data-type="index-term">configuring</span>, <a data-type="index:locator" href="book.html#id-wqCvTPFBtjIG">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">creating mock</span>, <a data-type="index:locator" href="book.html#id-ZbCnIMFXF7Iy">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">debugging</span>, <a data-type="index:locator" href="book.html#id-W7CQILFYFzhy">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">processing with S.param</span>, <a data-type="index:locator" href="book.html#id-LnCNIGFxI7hV">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">resource ID attribute</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFkIkC7">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">REST web services</span>, <a data-type="index:locator" href="book.html#ix_REST">REST</a>
  <ul>
    <li>
  
  <span data-type="index-term">and report generation</span>, <a data-type="index:locator" href="book.html#id-x1CZFEiYtrFe">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">avoiding URL repeats</span>, <a data-type="index:locator" href="book.html#id-aeCdFEF2FOtb">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">file suffix matching</span>, <a data-type="index:locator" href="book.html#id-LnC7SGFQF8cv">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">file uploads</span>, <a data-type="index:locator" href="book.html#id-yYClcpF9FWsW">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Google Sitemaps</span>, <a data-type="index:locator" href="book.html#id-GnCJSgFbFkCK">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">image uploads</span>, <a data-type="index:locator" href="book.html#id-AnCPSZFvFoiv">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">native iOS applications and</span>, <a data-type="index:locator" href="book.html#id-DnC1SWFwFxsQ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">preserving .com URL endings</span>, <a data-type="index:locator" href="book.html#id-0nCEFGFBTO">Missing .com from Email Addresses</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">recovering filename suffixes</span>, <a data-type="index:locator" href="book.html#id-0nCEFGFqFKhV">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">returning JSON</span>, <a data-type="index:locator" href="book.html#id-e4CzSJFZFOUr">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">RestHelper</span>, <a data-type="index:locator" href="book.html#id-JnC7iLhDtJTw">Discussion</a>, <a data-type="index:locator" href="book.html#id-KnCBheFj">REST</a>, <a data-type="index:locator" href="book.html#id-JnCzFlFpI2CN">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Rogue</span>, <a data-type="index:locator" href="book.html#id-9nCxhvFpF4ia">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>S</h3>
        <ul>
          <li>
  
  <span data-type="index-term">S.</span>
  <ul>
    <li>
  
  <span data-type="index-term">addAround</span>, <a data-type="index:locator" href="book.html#id-wqC4FncBtrCA">Discussion</a>, <a data-type="index:locator" href="book.html#id-ZbCnIPukIrt2">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">appendJs</span>, <a data-type="index:locator" href="book.html#id-jyCjIzUDiXtKu1">Alternative autocomplete JavaScript</a>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFwUA">Problem</a>, <a data-type="index:locator" href="book.html#id-4nCkIYFMImUb">Solution</a>, <a data-type="index:locator" href="book.html#id-ZbCBhLckIzij">Solution</a>, <a data-type="index:locator" href="book.html#id-yYCgtpFPc4tNuV">Submitting new values</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">attr</span>, <a data-type="index:locator" href="book.html#id-e4CzSjtQtri2">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">error</span>, <a data-type="index:locator" href="book.html#id-jyCdC4Tbt0ig">Discussion</a>, <a data-type="index:locator" href="book.html#id-yYClcpF9FDSz">Problem</a>, <a data-type="index:locator" href="book.html#id-VMC2tlc9IQiY">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">formGroup</span>, <a data-type="index:locator" href="book.html#id-XmCKIoHPcqtXTb">Submit styling</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">get_?</span>, <a data-type="index:locator" href="book.html#id-kVCltNTDtZhQ">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">getrequest</span>, <a data-type="index:locator" href="book.html#id-JnC0TpTDtvhn">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">getRequestHeadter(name)</span>, <a data-type="index:locator" href="book.html#id-4nCrhBTNtVhd">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">hostName</span>, <a data-type="index:locator" href="book.html#id-ZbCxSLckIZCB">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">init</span>, <a data-type="index:locator" href="book.html#id-yYCASYTaIvCy">Solution</a>, <a data-type="index:locator" href="book.html#id-rjCeIEhQIECX">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">notice</span>, <a data-type="index:locator" href="book.html#id-yYClcpFnh4tXT1">Collecting the value on form submission</a>, <a data-type="index:locator" href="book.html#id-PnCetLcAtXF1">Discussion</a>, <a data-type="index:locator" href="book.html#id-VMCBirFXFWSz">Problem</a>, <a data-type="index:locator" href="book.html#id-PnCetXiXIYHV">Solution</a>, <a data-type="index:locator" href="book.html#id-yYCrIXcaIOiy">Solution</a>, <a data-type="index:locator" href="book.html#id-kVClt4cpIZhQ">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">param</span>, <a data-type="index:locator" href="book.html#id-AnCKIZFVtNhV">Discussion</a>, <a data-type="index:locator" href="book.html#id-0nCEFGFPIKhJ">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">params(name)</span>, <a data-type="index:locator" href="book.html#id-GnCZFQTmtKhQ">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">post_?</span>, <a data-type="index:locator" href="book.html#id-DnCXI4Tvt4hL">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">putInHead</span>, <a data-type="index:locator" href="book.html#id-x1C4SOUoIZca">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">redirectTo</span>, <a data-type="index:locator" href="book.html#id-yYCyFktvtQFz">Discussion</a>, <a data-type="index:locator" href="book.html#id-4nCrhxcMIVhd">Solution</a>, <a data-type="index:locator" href="book.html#id-zdCbtOupIxtn">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">render</span>, <a data-type="index:locator" href="book.html#id-yYCrIYTvtVu1">Discussion</a>, <a data-type="index:locator" href="book.html#id-zdCkFecpI2Ce">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">request</span>, <a data-type="index:locator" href="book.html#id-rjCwtYFOT9sm">Problem</a>, <a data-type="index:locator" href="book.html#id-zdCbtvtpI0fX">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">request.map</span>, <a data-type="index:locator" href="book.html#id-rjCwtATxtKHA">Discussion</a>, <a data-type="index:locator" href="book.html#id-ZbCPtMFXFJsJ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">session</span>, <a data-type="index:locator" href="book.html#id-ZbCnIltkIVfy">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">warning messages</span>, <a data-type="index:locator" href="book.html#id-rjCmuYFKF1SM">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">S3 bucket</span>, <a data-type="index:locator" href="book.html#id-ZbCxSltMtocn">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Safari, date picker format</span>, <a data-type="index:locator" href="book.html#id-4nCqSohMI1tdio">HTML5 date pickers</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Scala</span>
  <ul>
    <li>
  
  <span data-type="index-term">binary compatibility in</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFQhPCX">See Also</a>, <a data-type="index:locator" href="book.html#id-GnC7IgFkIkCe">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">changing versions of</span>, <a data-type="index:locator" href="book.html#id-AnCPSZFvFWCE">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">client-side actions and</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFZFmce">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">interactive queries</span>, <a data-type="index:locator" href="book.html#id-JnCzFlFNFwUa">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">relational database conversion</span>, <a data-type="index:locator" href="book.html#id-aeCNIEFN">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">REPL CSS selector testing</span>, <a data-type="index:locator" href="book.html#id-bGCmS2FaIgtn">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Stream class</span>, <a data-type="index:locator" href="book.html#id-zdCXIyhpIkUj">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">type-safe options</span>, <a data-type="index:locator" href="book.html#id-9nCrIvF4t4ia">Discussion</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">Scala IDE for Eclipse plugin</span>, <a data-type="index:locator" href="book.html#id-0nCEFGFPIDcr">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Schedule</span>, <a data-type="index:locator" href="book.html#id-ZbCPtMFXF8ud">Problem</a>, <a data-type="index:locator" href="book.html#id-ZbCnIMFXFQUd">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">security</span>
  <ul>
    <li>
  
  <span data-type="index-term">file access control</span>, <a data-type="index:locator" href="book.html#id-ZbCBhMFXFZCJ">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">form-based attacks</span>, <a data-type="index:locator" href="book.html#id-wqC7S7HBtQUJ">Discussion</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">select boxes</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFLF2sQ">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SendGrid</span>, <a data-type="index:locator" href="book.html#id-zdCXIvtDtlc7">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">server-side code</span>
  <ul>
    <li>
  
  <span data-type="index-term">triggering with buttons</span>, <a data-type="index:locator" href="book.html#id-W7CetLFYFzh8">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">triggering with HTML select option</span>, <a data-type="index:locator" href="book.html#id-AnCDFZFvFjTG">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">session affinity</span>, <a data-type="index:locator" href="book.html#id-4nCqSYFNtXT1">Discussion</a>, <a data-type="index:locator" href="book.html#id-PnC0h7F0TKt1c4">Multiple instances</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">session hooks</span>, <a data-type="index:locator" href="book.html#id-AnCPSZFvFjTA">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">session loss</span>, <a data-type="index:locator" href="book.html#id-JnCvtlFNF2Cj">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">setFilter</span>, <a data-type="index:locator" href="book.html#id-JnCzFlFpIwUA">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SetHtml</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFpIXu8">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SHtml.</span>
  <ul>
    <li>
  
  <span data-type="index-term">ajaxCall</span>, <a data-type="index:locator" href="book.html#id-yYCYhpFKi4toh1">ajaxCall: receiving an arbitrary client-side string</a>, <a data-type="index:locator" href="book.html#id-JnCzFGSDtvh2tYhD">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">ajaxSelect</span>, <a data-type="index:locator" href="book.html#id-e4CxIJFqIxTe">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">jsonCall</span>, <a data-type="index:locator" href="book.html#id-9nCjSDS7T2h1tPhg">Discussion</a>, <a data-type="index:locator" href="book.html#id-rjCJTYFwuYtbh9">jsonCall: receiving a JSON value</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">jsonForm method</span>, <a data-type="index:locator" href="book.html#id-zdCLTAipIlcw">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">onEvent</span>, <a data-type="index:locator" href="book.html#id-9nCDtvFKhptlTq">Collecting the value on form submission</a>, <a data-type="index:locator" href="book.html#id-ZbCPtMFpcrtOhK">onEvent: receiving the value of a DOM element</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">text input field</span>, <a data-type="index:locator" href="book.html#id-W7CoFLFBIKiO">Solution</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">shutdown hooks</span>, <a data-type="index:locator" href="book.html#id-XmCbtluytPil">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">shutdown, code execution at</span>, <a data-type="index:locator" href="book.html#id-e4CAFJFZFmcd">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SIGTERM</span>, <a data-type="index:locator" href="book.html#id-PnCxFPuAtjiG">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Simple Build Tool (SBT)</span>
  <ul>
    <li>
  
  <span data-type="index-term">command history in</span>, <a data-type="index:locator" href="book.html#id-kVCAImuDtZhX">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">configuration of</span>, <a data-type="index:locator" href="book.html#id-QnCkSXFJI0tE">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">Eclipse plugin for</span>, <a data-type="index:locator" href="book.html#id-g9C1t2FjsVtpCg">Running tests in IDEs</a>, <a data-type="index:locator" href="book.html#id-LnCNIGFxI8cZ">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">standard layout with</span>, <a data-type="index:locator" href="book.html#id-kVCnU2IDtatX">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">starting</span>, <a data-type="index:locator" href="book.html#id-0nClIGFPIMtvIp">Simple Build Tool</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">text editor development with</span>, <a data-type="index:locator" href="book.html#id-KnCdFeFeIJhv">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">triggered execution mode</span>, <a data-type="index:locator" href="book.html#id-W7CQInhAtzhB">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">unit tests in</span>, <a data-type="index:locator" href="book.html#id-x1C4SZuoI1Cd">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">using CloudBees with</span>, <a data-type="index:locator" href="book.html#id-4nC2FYFMIXT1">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">using Elastic Beanstalk with</span>, <a data-type="index:locator" href="book.html#id-ZbCBhMFXFocn">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">using JRebel with</span>, <a data-type="index:locator" href="book.html#id-KnCnSeFeIOTv">Solutions</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">SiteMap</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFpFzsp">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">sitemap structure</span>, <a data-type="index:locator" href="book.html#id-4nCPtYFVFlCx">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SMTP servers</span>, <a data-type="index:locator" href="book.html#id-4nCPtYFNt1tJ">Discussion</a>, <a data-type="index:locator" href="book.html#id-4nCkIYFVF4cJ">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">snapshot releases</span>, <a data-type="index:locator" href="book.html#id-AnCDFZFvF7UE">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">snippet invocation</span>, <a data-type="index:locator" href="book.html#id-JnCQUlFkhKtXIl">Source code</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">snippets</span>, <a data-type="index:locator" href="book.html#id-GnCycjImtnt7">Discussion</a>, <a data-type="index:locator" href="book.html#id-W7CwhLFYFJca">Problem</a>, <a data-type="index:locator" href="book.html#id-GnCPtgFbFyU7">Problem</a>, <a data-type="index:locator" href="book.html#id-kVCltpFLF2s4">Problem</a>, <a data-type="index:locator" href="book.html#id-LnC7SGFQFeur">Problem</a>, <a data-type="index:locator" href="book.html#id-aeCdFEF2FVT0">Problem</a>, <a data-type="index:locator" href="book.html#id-LnC7SGFxIMir">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">source code</span>, <a data-type="index:locator" href="book.html#id-JnClsjIDtKtw">Discussion</a>, <a data-type="index:locator" href="book.html#id-yYC8fpFnh4tQIj">Source code</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Specs2</span>, <a data-type="index:locator" href="book.html#id-wqC4FPFphzt4Iw">Data table</a>, <a data-type="index:locator" href="book.html#id-JnCzFlFNF2CA">Problem</a>, <a data-type="index:locator" href="book.html#id-9nCdFvFpF0Ca">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SQL databases</span>, <a data-type="index:locator" href="book.html#id-OnCOImFoUWtVT1">RDBMS configuration</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SQL logging</span>, <a data-type="index:locator" href="book.html#id-zdCkFGFWF0fn">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SQL-like queries</span>, <a data-type="index:locator" href="book.html#id-LnCYhGFb">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">SQL-Server</span>, <a data-type="index:locator" href="book.html#id-PnCet7FxcKt1c4">Working with a database</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Squeryl Record module</span>, <a data-type="index:locator" href="book.html#id-bGCmS2FV">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Squeryl, configuring</span>, <a data-type="index:locator" href="book.html#id-W7CLcLFw">Relational Database Persistence with Record and Squeryl</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">stash function</span>, <a data-type="index:locator" href="book.html#id-rjCwtqcQIECa">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">stateless mode</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFbFeiD">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">sticky sessions</span>, <a data-type="index:locator" href="book.html#id-JnCzFlFDtJTv">Discussion</a>, <a data-type="index:locator" href="book.html#id-XmClcOFLTqtocm">Multiple instances</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">streaming content</span>, <a data-type="index:locator" href="book.html#id-kVCEFpFLFrUO">Problem</a>, <a data-type="index:locator" href="book.html#id-DnCXIWFgIauQ">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">StreamingResponse</span>, <a data-type="index:locator" href="book.html#id-XmCKIOFmCqtkUg">StreamingResponse</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">submit buttons</span>, <a data-type="index:locator" href="book.html#id-e4CzS2hQtxTQ">Discussion</a>, <a data-type="index:locator" href="book.html#id-GnCPtgFbFEcg">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">submit styling</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFVcKtwTA">Submit styling</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">superclass changes</span>, <a data-type="index:locator" href="book.html#id-LnC7SetWtkTZ">Discussion</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>T</h3>
        <ul>
          <li>
  
  <span data-type="index-term">tables, viewing in databases</span>, <a data-type="index:locator" href="book.html#id-e4CWhJFZFguG">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">TagSoup</span>, <a data-type="index:locator" href="book.html#id-nxCzFKTxtQCY">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">tasks</span>
  <ul>
    <li>
  
  <span data-type="index-term">delayed execution of</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFpFXuV">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">repeat execution of</span>, <a data-type="index:locator" href="book.html#id-9nCdFvFpFdUV">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">templates</span>
  <ul>
    <li>
  
  <span data-type="index-term">adding to the head section</span>, <a data-type="index:locator" href="book.html#id-GnCZFgFbFWs7">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">for CloudBees</span>, <a data-type="index:locator" href="book.html#id-2nClFjF9fVt9Td">ClickStarts</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">for Lift Cookbook submissions</span>, <a data-type="index:locator" href="book.html#id-4nCqSYFMIXT0">Solution</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">loading without browser refresh</span>, <a data-type="index:locator" href="book.html#id-e4CzSJFZFgue">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">using Google Sitemaps with</span>, <a data-type="index:locator" href="book.html#id-kVCAIpFLFPCL">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">using IE HTML conditional comments in</span>, <a data-type="index:locator" href="book.html#id-AnCKIZFvFoia">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">text editors, development with</span>, <a data-type="index:locator" href="book.html#id-bGCgF2FLFmha">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">text localization</span>, <a data-type="index:locator" href="book.html#id-yYCyFYTvtVuy">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Textile markup</span>, <a data-type="index:locator" href="book.html#id-yYCgt1Ivt2Ta">Discussion</a>, <a data-type="index:locator" href="book.html#id-9nCjSvFpFNtX">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">timeouts</span>, <a data-type="index:locator" href="book.html#id-zdCbtGFJhlc7">See Also</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">timestamps</span>, <a data-type="index:locator" href="book.html#id-ZbC1FMFXFGH2">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">titles, page titles</span>, <a data-type="index:locator" href="book.html#id-AnCVtZFvFVca">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Tomcat</span>, <a data-type="index:locator" href="book.html#id-jyClFoFOHXt1TV">Container version</a>, <a data-type="index:locator" href="book.html#id-DnCXIWFvt4hD">Discussion</a>, <a data-type="index:locator" href="book.html#id-4nCPtAINt7ix">Discussion</a>, <a data-type="index:locator" href="book.html#id-9nCDtvFpFecN">Problem</a>, <a data-type="index:locator" href="book.html#id-W7CQIGIl">Production Deployment</a>, <a data-type="index:locator" href="book.html#id-kVC9upFDtatKIj">Running your application</a>, <a data-type="index:locator" href="book.html#id-JnCDSlFpIAiv">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">triggered execution mode</span>, <a data-type="index:locator" href="book.html#id-AnCDF0hVtNhE">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Tschan, Sebastian</span>, <a data-type="index:locator" href="book.html#id-ZbCBhMFXFJsb">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Twitter Bootstrap</span>, <a data-type="index:locator" href="book.html#id-VMCQIoIriatMuM">Alternative autocomplete JavaScript</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">type ascription</span>, <a data-type="index:locator" href="book.html#id-9nCxhvF4tdUM">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">type-safe options</span>, <a data-type="index:locator" href="book.html#id-OnCDuVIytkHY">Discussion</a>, <a data-type="index:locator" href="book.html#id-4nCkIYFVF7iz">Problem</a>, <a data-type="index:locator" href="book.html#id-yYCrIpFnh4tysV">Type-safe options</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Typeahead component</span>, <a data-type="index:locator" href="book.html#id-yYCyF1IKi4tNuV">Alternative autocomplete JavaScript</a>, <a data-type="index:locator" href="book.html#id-JnCzFLhkhyun">See Also</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>U</h3>
        <ul>
          <li>
  
  <span data-type="index-term">UI elements, wired</span>, <a data-type="index:locator" href="book.html#id-JnCzFlFNFlHj">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">unexpected response (404) status</span>, <a data-type="index:locator" href="book.html#id-VMCpFoIktZCd">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">UniqueIdField</span>, <a data-type="index:locator" href="book.html#id-ZbCnIMFXFJs2">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">unit tests</span>
  <ul>
    <li>
  
  <span data-type="index-term">H2's in-memory mode and</span>, <a data-type="index:locator" href="book.html#id-W7CESGIAtmuB">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">with Specs2</span>, <a data-type="index:locator" href="book.html#ix_UTspec">Problem</a>, <a data-type="index:locator" href="book.html#ix_UTestspec">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">unload hooks</span>, <a data-type="index:locator" href="book.html#id-DnCqtWFwFQc7">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">unparsed XML content</span>, <a data-type="index:locator" href="book.html#id-e4CAF8IQtri2">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">updated time</span>, <a data-type="index:locator" href="book.html#id-oPCNhNU8tKHp">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">URLs</span>
  <ul>
    <li>
  
  <span data-type="index-term">avoiding repeats</span>, <a data-type="index:locator" href="book.html#id-0nClIGFqFMtV">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">database connection with</span>, <a data-type="index:locator" href="book.html#id-kVCEF7hDtkIm">Discussion</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">fetching</span>, <a data-type="index:locator" href="book.html#id-8nCEFpIbi2t1i2">Database access in Heroku</a>, <a data-type="index:locator" href="book.html#id-ZbC1FMFXFZCd">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">preserving .com endings</span>, <a data-type="index:locator" href="book.html#id-LnCNIGFYTe">Missing .com from Email Addresses</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">UTF-8 character set</span>, <a data-type="index:locator" href="book.html#id-JnCzFjIDtJTQ">Discussion</a>, <a data-type="index:locator" href="book.html#id-wqCDtPFGFaFA">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>V</h3>
        <ul>
          <li>
  
  <span data-type="index-term">validation</span>, <a data-type="index:locator" href="book.html#id-DnCaFWFwFziD">Problem</a>, <a data-type="index:locator" href="book.html#id-kVCEFpFLFXub">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">values</span>
  <ul>
    <li>
  
  <span data-type="index-term">collecting upon form submission</span>, <a data-type="index:locator" href="book.html#id-zdCLTGFJhxtMTn">Collecting the value on form submission</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">embedding in database records</span>, <a data-type="index:locator" href="book.html#id-9nCdFvF4tXua">Discussion</a>, <a data-type="index:locator" href="book.html#id-DnCXIWFwFATl">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">geospatial</span>, <a data-type="index:locator" href="book.html#id-ZbCBhMFXF8u0">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">modifying before storage</span>, <a data-type="index:locator" href="book.html#ix_Vmbs">Problem</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">storage in a column</span>, <a data-type="index:locator" href="book.html#id-9nCdFvFpFzsw">Problem</a>
  <ul>
  </ul>
</li>    </ul>
</li>                  <li>
  
  <span data-type="index-term">video streaming</span>, <a data-type="index:locator" href="book.html#id-kVCltpFpIXuL">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">view first approach</span>
  <ul>
    <li>
  
  <span data-type="index-term">CSS selectors and</span>, <a data-type="index:locator" href="book.html#id-EnCmtMF7">HTML</a>
  <ul>
  </ul>
</li>      <li>
  
  <span data-type="index-term">definition of</span>, <a data-type="index:locator" href="book.html#id-9nCkCvFKhptnIY">Source code</a>
  <ul>
  </ul>
</li>    </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>W</h3>
        <ul>
          <li>
  
  <span data-type="index-term">WAR files</span>, <a data-type="index:locator" href="book.html#id-9nCrIvFpF4iN">Problem</a>, <a data-type="index:locator" href="book.html#id-zdCLTGFWFlcA">Problem</a>, <a data-type="index:locator" href="book.html#id-JnCmIlFpIJTv">Solution</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">web containers</span>, <a data-type="index:locator" href="book.html#id-0nCbtGFYtMtr">Discussion</a>, <a data-type="index:locator" href="book.html#id-GnCZF9imtKhe">Discussion</a>, <a data-type="index:locator" href="book.html#id-e4CzSJFQtvhp">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">whitespace, removing</span>, <a data-type="index:locator" href="book.html#id-JnCmIlFNFwUA">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">wire formats, for dates</span>, <a data-type="index:locator" href="book.html#id-W7CESLFAtKiO">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">wired cells, formatting</span>, <a data-type="index:locator" href="book.html#id-4nCqSYFVFqHb">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">WiringUI.toNode method</span>, <a data-type="index:locator" href="book.html#id-zdCrhGFWFJHJ">Problem</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">Wizard</span>, <a data-type="index:locator" href="book.html#id-4nCZcohNtXTl">Discussion</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>X</h3>
        <ul>
          <li>
  
  <span data-type="index-term">XHTML parser</span>, <a data-type="index:locator" href="book.html#id-PnCkIaSPi8cptGU7">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">XHTMLMailBodyType</span>, <a data-type="index:locator" href="book.html#id-ZbCBhMFMtdTd">Discussion</a>
  <ul>
  </ul>
</li>                  <li>
  
  <span data-type="index-term">XHTMLPPlusImages</span>, <a data-type="index:locator" href="book.html#id-9nCDtvFpF4iV">Problem</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
    <div data-type="indexdiv">
        <h3>Z</h3>
        <ul>
          <li>
  
  <span data-type="index-term">ZeroTurnaround</span>, <a data-type="index:locator" href="book.html#id-ZbCDiMFyTrtXTD">Purchased licenses</a>
  <ul>
  </ul>
</li>                </ul>
    </div>
</div></section>
            

<section data-type="colophon" class="abouttheauthor" id="about-the-authors-ROKsr">
  <h1>About the Author(s)</h1>
  <p>Richard Dallaway is a partner at Underscore Consulting, working on client software projects. He's a Lift committer, where he has focused on the module system. Prior to Underscore, Richard gained his PhD from the School of Cognitive Science at the University of Sussex, then worked on machine-learning projects before moving to consultancy and software engineering. He lives with his wife and one small terrier in Brighton, UK.</p>
</section>

<section id="colophon" data-type="colophon">
  <h1>Colophon</h1>

  <p>The animal on the cover of <em>Lift Cookbook</em> is an American lobster (<em>Homarus americanus</em>), a species of lobster found on the Atlantic coast of North America.</p>

<p>The cover image is from an unknown source. The cover font is Adobe ITC Garamond. The text font is Adobe Minion Pro; the heading font is Adobe Myriad Condensed; and the code font is Dalton Maag's Ubuntu Mono.</p>

</section>

  </body>
</html>
