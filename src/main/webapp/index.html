<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.7">
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


/*
 * Theme specific overrides of the preceding (asciidoc.css) CSS.
 *
 */
body {
  font-family: Garamond, Georgia, serif;
  font-size: 17px;
  color: #3E4349;
  line-height: 1.3em;
}
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Garmond, Georgia, serif;
  font-weight: normal;
  border-bottom-width: 0;
  color: #3E4349;
}
div.title, caption.title { color: #596673; font-weight: bold; }
h1 { font-size: 240%; }
h2 { font-size: 180%; }
h3 { font-size: 150%; }
h4 { font-size: 130%; }
h5 { font-size: 115%; }
h6 { font-size: 100%; }
#header h1 { margin-top: 0; }
#toc {
  color: #444444;
  line-height: 1.5;
  padding-top: 1.5em;
}
#toctitle {
  font-size: 20px;
}
#toc a {
    border-bottom: 1px dotted #999999;
    color: #444444 !important;
    text-decoration: none !important;
}
#toc a:hover {
    border-bottom: 1px solid #6D4100;
    color: #6D4100 !important;
    text-decoration: none !important;
}
div.toclevel1 { margin-top: 0.2em; font-size: 16px; }
div.toclevel2 { margin-top: 0.15em; font-size: 14px; }
em, dt, td.hdlist1 { color: black; }
strong { color: #3E4349; }
a { color: #004B6B; text-decoration: none; border-bottom: 1px dotted #004B6B; }
a:visited { color: #615FA0; border-bottom: 1px dotted #615FA0; }
a:hover { color: #6D4100; border-bottom: 1px solid #6D4100; }
div.tableblock > table, table.tableblock { border: 3px solid #E8E8E8; }
th.tableblock, td.tableblock { border: 1px solid #E8E8E8; }
ul > li > * { color: #3E4349; }
pre, tt, .monospaced { font-family: Consolas,Menlo,'Deja Vu Sans Mono','Bitstream Vera Sans Mono',monospace; }
tt, .monospaced { font-size: 0.9em; color: black;
}
div.exampleblock > div.content, div.sidebarblock > div.content, div.listingblock > div.content { border-width: 0 0 0 3px; border-color: #E8E8E8; }
div.verseblock { border-left-width: 0; margin-left: 3em; }
div.quoteblock { border-left-width: 3px; margin-left: 0; margin-right: 0;}
div.admonitionblock td.content { border-left: 3px solid #E8E8E8; }
@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_about_this_text">About this text</h3>
<div class="paragraph"><p>A collection of solutions to questions you might have while developing
web applications with the <a href="http://www.liftweb.net">Lift web framework</a>.</p></div>
<div class="paragraph"><p>The aim is to give a single, short answer to a specific question. Where
there are different ways to achieve the same result, this cookbook just
shows one way, but may point you at alternatives in a discussion on the
solution.</p></div>
</div>
<div class="sect2">
<h3 id="_learning_about_lift">Learning about Lift</h3>
<div class="paragraph"><p>If you are looking to learn Lift, take a look at:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://simply.liftweb.net/">Simply Lift</a>.
</p>
</li>
<li>
<p>
<a href="http://www.manning.com/perrett/">Lift in Action</a>, Manning Publications.
</p>
</li>
<li>
<p>
<a href="http://exploring.liftweb.net/">Exploring Lift</a> (also known as <strong>The
Definitive Guide to Lift</strong>).
</p>
</li>
<li>
<p>
<a href="http://liftweb.net/getting_started">Getting Started</a> and
<a href="http://www.assembla.com/spaces/liftweb/wiki/Resources">Resources</a> on the
Lift web site.
</p>
</li>
<li>
<p>
<a href="http://seventhings.liftweb.net/">Seven things</a> that distinguish Lift
from other web frameworks.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_copyright">Copyright</h3>
<div class="paragraph"><p>This document is licensed Creative Commons Attribution, Non Commercial,
No Derivatives.</p></div>
</div>
<div class="sect2">
<h3 id="_contributors">Contributors</h3>
<div class="ulist"><ul>
<li>
<p>
Richard Dallaway
</p>
</li>
<li>
<p>
Jono Ferguson
</p>
</li>
<li>
<p>
Franz Bettag
</p>
</li>
<li>
<p>
Marek Å»ebrowski
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_source">Source</h3>
<div class="paragraph"><p>The source is at
<a href="https://github.com/d6y/lift-cookbook">https://github.com/d6y/lift-cookbook</a></p></div>
</div>
<div class="sect2">
<h3 id="_updates">Updates</h3>
<div class="paragraph"><p>Follow <a href="https://twitter.com/#!/liftcookbook">@LiftCookbook</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_software_versions">Software versions</h3>
<div class="paragraph"><p>Except where otherwise indicated, the examples use Lift 2.4 with SBT
0.11.2</p></div>
</div>
<div class="sect2">
<h3 id="_conventions">Conventions</h3>
<div class="ulist"><ul>
<li>
<p>
<strong>Emphasised text</strong> is used for filenames, commands, introducing new
concepts.
</p>
</li>
<li>
<p>
<span class="monospaced">Constant width</span> for code and commands.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_and_running">Install and Running</h2>
<div class="sectionbody">
<div class="paragraph"><p>This chapter covers questions regarding starting development with Lift: running a first Lift application and setting up a coding environment. You&#8217;ll find answers regarding production deployment in <a href="#deployment">[deployment]</a>.</p></div>
<div class="sect2">
<h3 id="_downloading_and_running_lift">Downloading and Running Lift</h3>
<div class="sect3">
<h4 id="_problem">Problem</h4>
<div class="paragraph"><p>You want to install and run Lift on your computer.</p></div>
</div>
<div class="sect3">
<h4 id="_solution">Solution</h4>
<div class="paragraph"><p>The only prerequisite for installing and running Lift is to have Java
1.5 or later installed. Instructions for installing Java can be found at
<a href="http://java.com/">http://java.com/</a>.</p></div>
<div class="paragraph"><p>You can find out if you have Java from the shell or command prompt by asking for the version you have installed:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ java -version
java version "1.7.0_07"
Java(TM) SE Runtime Environment (build 1.7.0_07-b10)
Java HotSpot(TM) 64-Bit Server VM (build 23.3-b01, mixed mode)</pre>
</div></div>
<div class="paragraph"><p>Once you have Java, the following instructions will download, build and
start a basic Lift application.</p></div>
<div class="sect4">
<h5 id="_for_mac_and_linux">For Mac and Linux</h5>
<div class="ulist"><ul>
<li>
<p>
Visit <a href="http://liftweb.net/download">http://liftweb.net/download</a> and download the Lift 2.5-M3 Zip file.
</p>
</li>
<li>
<p>
Unzip the file.
</p>
</li>
<li>
<p>
Start <em>Terminal</em> or your favourite shell tool.
</p>
</li>
<li>
<p>
Navigate into the unzipped folder and into the <span class="monospaced">scala_29</span> sub-folder and then into the <span class="monospaced">lift_basic</span> folder.
</p>
</li>
<li>
<p>
Run:<span class="monospaced">./sbt</span>.
</p>
</li>
<li>
<p>
Required libraries will be downloaded automatically.
</p>
</li>
<li>
<p>
At the SBT prompt (&gt;) type: <span class="monospaced">container:start</span>.
</p>
</li>
<li>
<p>
Open your browser and go to <span class="monospaced">http://127.0.0.1:8080/</span>.
</p>
</li>
<li>
<p>
When you&#8217;re done, type <span class="monospaced">exit</span> at the SBT prompt to stop your application from running.
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_for_windows">For Windows</h5>
<div class="ulist"><ul>
<li>
<p>
Visit <a href="http://liftweb.net/download">http://liftweb.net/download</a> locate the link to the Zip version of Lift 2.5-M3 and save this to disk.
</p>
</li>
<li>
<p>
Extract the contents of the Zip file.
</p>
</li>
<li>
<p>
Navigate in Explorer to the extracted folder, and inside navigate into <span class="monospaced">scala_29</span> and then <span class="monospaced">lift_basic</span>.
</p>
</li>
<li>
<p>
Double click <span class="monospaced">sbt.bat</span> to run the build tool and a terminal window should open.
</p>
</li>
<li>
<p>
Required libraries will be downloaded automatically.
</p>
</li>
<li>
<p>
At the SBT prompt (&gt;) type: <span class="monospaced">container:start</span>.
</p>
</li>
<li>
<p>
You may find Windows Firewall blocking Java from running. If so, opt to "allow access".
</p>
</li>
<li>
<p>
Start your browser and go to <span class="monospaced">http://127.0.0.1:8080/</span>
</p>
</li>
<li>
<p>
When you&#8217;re done, type <span class="monospaced">exit</span> at the SBT prompt to stop your application from running.
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_expected_result">Expected result</h5>
<div class="paragraph"><p>The result of the above commands should be a basic Lift application running on
your computer:</p></div>
<div class="imageblock">
<div class="content">
<img src="images/apphome.png" alt="images/apphome.png">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion">Discussion</h4>
<div class="paragraph"><p>Lift isn&#8217;t installed in the usual sense of "installing software".
Instead you use standard build tools, such as SBT or Maven, to assemble your application with the Lift framework. In this recipe we downloaded a ZIP file containing four fairly minimal Lift applications, and then started one of them via the build tool.</p></div>
<div class="sect4">
<h5 id="_simple_build_tool">Simple Build Tool</h5>
<div class="paragraph"><p>Typing <span class="monospaced">sbt</span> starts the Simple Build Tool, a dependency management
tool used by Scala projects (it&#8217;s not specific to Lift).  SBT will check the project definition and download any libraries required, which includes the Lift framework.</p></div>
<div class="paragraph"><p>This download happens once, and the downloaded
files are stored on disk in a <span class="monospaced">.ivy2</span> in your home folder.</p></div>
<div class="paragraph"><p>Your application build is configured by <span class="monospaced">build.sbt</span>.  Looking inside you&#8217;ll see:</p></div>
<div class="ulist"><ul>
<li>
<p>
basic information about your application, including a name and version;
</p>
</li>
<li>
<p>
resolvers, which inform SBT where to fetch dependencies from;
</p>
</li>
<li>
<p>
settings for plugins and the Scala compiler; and
</p>
</li>
<li>
<p>
a list of dependencies required to run your application, which will include the Lift framework.
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_running_your_application">Running Your Application</h5>
<div class="paragraph"><p>The command <span class="monospaced">container:start</span> starts the web server on the default port of 8080 and
passes requests to the Lift application. The word "container" refers to the
software you deploy your application into. There are a variety of containers (Jetty and
Tomcat are probably the best known) all of which conform to a standard for deployment.
The upshot is you can build your application and deploy to whichever one you prefer.
The <span class="monospaced">container:start</span> command uses Jetty.</p></div>
</div>
<div class="sect4">
<h5 id="_source_code">Source Code</h5>
<div class="paragraph"><p>The source code of the application resides in <span class="monospaced">src/main/webapp</span> and <span class="monospaced">src/main/scala</span>. If you take a look at <span class="monospaced">index.html</span> in the <span class="monospaced">webapp</span> folder you&#8217;ll see mention of <span class="monospaced">lift:helloWorld</span>. That&#8217;s a reference to the class defined in <span class="monospaced">scala/code/snippet/HelloWorld.scala</span>. This is a <em>snippet invocation</em> and an example of Lift&#8217;s <em>view first</em> approach to web applications. That is, there&#8217;s no routing set up for the index page to collect the data and forward it to the view. Instead, the view defines areas of the content that are replaced with functions, such as those functions defined in <span class="monospaced">HelloWorld.scala</span>.</p></div>
<div class="paragraph"><p>Lift knows to look in the <span class="monospaced">code</span> package for snippets because that package is declared as a location for snippets in <span class="monospaced">scala/bootstrap/liftweb/Boot.scala</span>. The Boot class is run when starting your application, and it&#8217;s where you can configure the behaviour of Lift.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also">See Also</h4>
<div class="paragraph"><p>The Simple Build Tool documentation is at <a href="http://www.scala-sbt.org">http://www.scala-sbt.org</a>.</p></div>
<div class="paragraph"><p>Tutorials for Lift can be found in <em>Simply Lift</em> at <a href="http://simply.liftweb.net/">http://simply.liftweb.net/</a> and in <em>Lift in Action</em> (Tim Perrett, 2011, Manning Publications Co).</p></div>
</div>
</div>
<div class="sect2">
<h3 id="texteditor">Developing Using a Text Editor</h3>
<div class="sect3">
<h4 id="_problem_2">Problem</h4>
<div class="paragraph"><p>You want to develop your Lift application using your favourite text
editor, hitting reload in your browser to see changes.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_2">Solution</h4>
<div class="paragraph"><p>Run SBT while you are editing, and ask it to detect and compile changes to Scala files.  To do that, start <span class="monospaced">sbt</span> and enter the following to the SBT prompt:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>~; container:start; container:reload /</pre>
</div></div>
<div class="paragraph"><p>When you save a source file in your editor, SBT will detect this,
compile the file, and reload the web container.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_2">Discussion</h4>
<div class="paragraph"><p>An SBT command prefixed with <span class="monospaced">~</span> makes that command run when files
change. The first semicolon introduces a sequence of commands, where if
the first command succeeds, the second will run. The second semicolon
means the <span class="monospaced">reload</span> command will run if the <span class="monospaced">start</span> command ran OK. The <span class="monospaced">start</span>
command will recompile any Scala source files that have changed.</p></div>
<div class="paragraph"><p>When you run SBT in this way, you&#8217;ll notice the following output:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>1. Waiting for source changes... (press enter to interrupt)</pre>
</div></div>
<div class="paragraph"><p>And indeed, if you do press enter in the SBT window you&#8217;ll exit this "triggered
execution" mode and SBT will no longer be looking for file changes. However, while
SBT is watching for changes, the output will indicate when this happens with something
that looks a little like this:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>[info] Compiling 1 Scala source to target/scala-2.9.1/classes...
[success] Total time: 1 s, completed 15-Nov-2012 18:14:46
[pool-301-thread-4] DEBUG net.liftweb.http.LiftServlet - Destroyed Lift handler.
[info] stopped o.e.j.w.WebAppContext{/,[src/main/webapp/]}
[info] NO JSP Support for /, did not find org.apache.jasper.servlet.JspServlet
[info] started o.e.j.w.WebAppContext{/,[src/main/webapp/]}
[success] Total time: 0 s, completed 15-Nov-2012 18:14:46
2. Waiting for source changes... (press enter to interrupt)</pre>
</div></div>
<div class="paragraph"><p>Edits to HTML files don&#8217;t trigger the SBT compile and reload commands.
This is because SBT&#8217;s default behaviour is to look for
Scala and Java source file changes, and changes to files in <span class="monospaced">src/main/resources</span>.
This works out just fine, because Jetty will use your modified HTML file when you
reload the browser page.</p></div>
<div class="paragraph"><p>Restarting the web container each time you edit a Scala file isn&#8217;t ideal. You can reduce
the need for restarts by integrating JRebel into your development environment, as described
in <a href="#jrebel">[jrebel]</a>.</p></div>
<div class="paragraph"><p>However, if you are making a serious number of edits, you may prefer to issue a <span class="monospaced">container:stop</span> command until you&#8217;re ready to run you application again with <span class="monospaced">container:start</span> to prevent SBT compiling and restarting your application. The SBT console has a command history, and using the up and down keyboard arrows allows you to navigate to previous commands and run them by pressing the return key.  That takes some of the tedium out of these long commands.</p></div>
<div class="paragraph"><p>One error you may run into is:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>java.lang.OutOfMemoryError: PermGen space</pre>
</div></div>
<div class="paragraph"><p>The "permanent generation" is a Java virtual machine concept. It&#8217;s the area of memory used for storing classes amongst other things.  It&#8217;s a fixed size and once it is full this PermGen error appears.  As you might imagine, continually restarting a container causes many classes to be loaded and unloaded, but the process is not perfect, effectively leaking memory. The best you can do is stop and then restart SBT.  If you&#8217;re seeing this error often, check the setting for <span class="monospaced">-XX:MaxPermSize</span> inside the <span class="monospaced">sbt</span> (or <span class="monospaced">sbt.bat</span>) script, and if you can, double it.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_2">See Also</h4>
<div class="paragraph"><p>There&#8217;s more about triggered execution at <a href="http://www.scala-sbt.org/release/docs/Detailed-Topics/Triggered-Execution">http://www.scala-sbt.org/release/docs/Detailed-Topics/Triggered-Execution</a>.</p></div>
<div class="paragraph"><p>Reference for the core SBT command line: <a href="http://www.scala-sbt.org/release/docs/Detailed-Topics/Command-Line-Reference">http://www.scala-sbt.org/release/docs/Detailed-Topics/Command-Line-Reference</a>.</p></div>
<div class="paragraph"><p>Command reference for the web plugin for SBT is at: <a href="https://github.com/siasia/xsbt-web-plugin/wiki">https://github.com/siasia/xsbt-web-plugin/wiki</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="jrebel">Incorporating JRebel</h3>
<div class="sect3">
<h4 id="_problem_3">Problem</h4>
<div class="paragraph"><p>You want to avoid application restarts when you change a Scala source file by using JRebel.</p></div>
</div>
<div class="sect3">
<h4 id="_solutions">Solutions</h4>
<div class="paragraph"><p>There are three steps required: install JRebel once; each year request the free Scala license; and configure SBT to use JRebel.</p></div>
<div class="paragraph"><p>First, visit the <a href="http://zeroturnaround.com/software/jrebel/">http://zeroturnaround.com/software/jrebel/</a> and request the free Scala license.</p></div>
<div class="paragraph"><p>Second, download the "Generic ZIP Archive" version of JRebel, unzip it to where you like. For this recipe I&#8217;ve chosen to use <span class="monospaced">/opt/zt/jrebel/</span>.</p></div>
<div class="paragraph"><p>When your have received your account confirmation email from JRebel, you can copy your "authentication token" from the "Active" area of ZeroTurnaround&#8217;s site. To apply the token to your local install, run the JRebel configuration script:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ /opt/zt/jrebel/bin/jrebel-config.sh</pre>
</div></div>
<div class="paragraph"><p>For Windows navigate to and launch <span class="monospaced">bin\jrebel-config.cmd</span>.</p></div>
<div class="paragraph"><p>In the "Activation" setting select "I want to use myJRebel" and then in the "License" section paste in your activation token. Click the "Activate" button, and once you see the license status change to "You have a valid myJRebel token&#8230;" click "Finish".</p></div>
<div class="paragraph"><p>Finally, configure SBT by modifying the <span class="monospaced">sbt</span> script to enable JRebel.  This means setting the <span class="monospaced">-javaagent</span> and <span class="monospaced">-noverify</span> flags for Java, and enabling the JRebel Lift plugin.</p></div>
<div class="paragraph"><p>For Mac and Linux, the script that&#8217;s included with the Lift downloads would become:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>java -Drebel.lift_plugin=true -noverify -javaagent:/opt/zt/jrebel/jrebel.jar -Xmx1024M -Xss2M \
-XX:MaxPermSize=512m -XX:+CMSClassUnloadingEnabled -jar `dirname $0`/sbt-launch-0.12.jar "$@"</pre>
</div></div>
<div class="paragraph"><p>For Windows, modify <span class="monospaced">sbt.bat</span> to be:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>set SCRIPT_DIR=%~dp0
java -Drebel.lift_plugin=true -noverify -javaagent:c:/opt/zt/jrebel/jrebel.jar \
-XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256m -Xmx1024M -Xss2M
-jar "%SCRIPT_DIR%\sbt-launch-0.12.jar" %*</pre>
</div></div>
<div class="paragraph"><p>There&#8217;s nothing else to do to use JRebel.  When you start SBT you&#8217;ll see a large banner starting something like this:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>2012-12-16 23:00:32] #############################################################
[2012-12-16 23:00:32]
[2012-12-16 23:00:32]  JRebel 5.1.1 (201211271929)
[2012-12-16 23:00:32]  (c) Copyright ZeroTurnaround OU, Estonia, Tartu.
[2012-12-16 23:00:32]
[2012-12-16 23:00:32]  Over the last 30 days JRebel prevented
[2012-12-16 23:00:32]  at least 335 redeploys/restarts saving you about 13.6 hours.
....</pre>
</div></div>
<div class="paragraph"><p>With JRebel installed, you can now <span class="monospaced">container:start</span> your application, modify and compile a Scala file and reload a page in your application. You&#8217;ll see a notice that the class has been reloaded:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>[2012-12-16 23:15:44] JRebel: Reloading class 'code.snippet.HelloWorld'.</pre>
</div></div>
<div class="paragraph"><p>That change is live, without having to restart the container.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_3">Discussion</h4>
<div class="paragraph"><p>JRebel is very likely to speed up your development. It updates code in a running Java virtual machine, without having to stop it or start it.  The effect is that, on the whole, you can compile a class, then hit reload in your browser to see the change in your Lift application.</p></div>
<div class="paragraph"><p>Even with JRebel you will need to restart your applications from time to time, but JRebel usually reduces the number of restarts. For example, <span class="monospaced">Boot.scala</span> is run when your application starts, so if you modify something in your <span class="monospaced">Boot.scala</span> you&#8217;ll need to start and start your application. JRebel can&#8217;t help with that.</p></div>
<div class="paragraph"><p>But there are also other situations that JRebel cannot help with, such as when a superclass changes. Generally, JRebel will emit a warning about this in the console window.  If that happens, stop and start your application.</p></div>
<div class="paragraph"><p>The <span class="monospaced">-Drebel.lift_plugin=true</span> setting adds Lift-specific functionality to JRebel.  Specifically, it allows JRebel to reload changes to <span class="monospaced">LiftScreen</span>, <span class="monospaced">Wizard</span> and <span class="monospaced">RestHelper</span>. This means you can change fields or screens, and change REST <span class="monospaced">serve</span> code.</p></div>
<div class="sect4">
<h5 id="_purchased_licenses">Purchased licenses</h5>
<div class="paragraph"><p>This recipe used a free Scala license for a service called myJRebel. This communicates with JRebel servers via the activation code.  If you have purchased a license from ZeroTurnaround, the situation is slightly different.  In this case, you will have a license key which you store in a file. You can place the file, <span class="monospaced">jrebel.lic</span> in a <span class="monospaced">.jrebel</span> folder in your home directory, or alongside <span class="monospaced">jrebel.jar</span> (e.g., in the <span class="monospaced">/opt/zt/jrebel/</span> folder if that&#8217;s where you installed JRebel), or you can specify some other location.  To do that, modify the <span class="monospaced">sbt</span> script and specify the location of the file by adding another Java setting:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>-Drebel.license=/path/to/jrebel.lic</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_3">See Also</h4>
<div class="paragraph"><p>You&#8217;ll find details about how JRebel works in the FAQ at: <a href="http://zeroturnaround.com/software/jrebel/resources/faq/">http://zeroturnaround.com/software/jrebel/resources/faq/</a>.</p></div>
<div class="paragraph"><p>The Lift support was announced in a blog post in 2012 at <a href="http://zeroturnaround.com/jrebel/lift-support-in-jrebel/">http://zeroturnaround.com/jrebel/lift-support-in-jrebel/</a>, where you&#8217;ll find more about the capabilities of the plugin.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_developing_using_eclipse">Developing using Eclipse</h3>
<div class="sect3">
<h4 id="_problem_4">Problem</h4>
<div class="paragraph"><p>You want to develop your Lift application using the Eclipse IDE, hitting
reload in your browser to see changes.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_3">Solution</h4>
<div class="paragraph"><p>Use the "Scala IDE for Eclipse" plugin to Eclipse. The instructions for this
are given at <a href="http://scala-ide.org">http://scala-ide.org</a>. We recommend the
stable version. This will give you an Eclipse perspective that knows about Scala.</p></div>
<div class="paragraph"><p>To create the project files to allow Eclipse to load your Lift project, install "sbteclipse" by adding the following to <span class="monospaced">projects/plugins.sbt</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">addSbtPlugin</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"com.typesafe.sbteclipse"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"sbteclipse-plugin"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"2.1.0"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>You can then create Eclipse project files (<span class="monospaced">.project</span> and <span class="monospaced">.classpath</span>) within SBT by entering the
following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>eclipse</pre>
</div></div>
<div class="paragraph"><p>Open the project in Eclipse by navigating to "File &gt; Import.." and select "General &gt; Existing
Projects into Workspace". Browse to, and select, your Lift project. You
are now set up to develop your application in Eclipse.</p></div>
<div class="paragraph"><p>To see live changes as you edit and save your work, run SBT in a separate terminal window.  That is, start <span class="monospaced">sbt</span> from a terminal window outside of Eclipse and enter the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>~; container:start; container:reload /</pre>
</div></div>
<div class="paragraph"><p>This behaviour of this command is described in <a href="#texteditor">[texteditor]</a>, but if you&#8217;re using JRebel (see <a href="#jrebel">[jrebel]</a>) then you just need to run <span class="monospaced">container:start</span> by itself.</p></div>
<div class="paragraph"><p>You can then edit in Eclipse, save to compile, and in your web browser hit reload to see
the changes.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_4">Discussion</h4>
<div class="paragraph"><p>One of the great benefits of an IDE is the ability to navigate source, by cmd+click (Mac) or F3 (PC).
You can ask the SBT <span class="monospaced">eclipse</span> command to download the Lift
source and Scaladoc, allowing you to click through to the Lift source from
methods and classes, which is a useful way to discover more about Lift.</p></div>
<div class="paragraph"><p>To achieve this in a project, run <span class="monospaced">eclipse with-source=true</span>, but if you want
this to be the default behaviour, add the following to your <span class="monospaced">build.sbt</span> file:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>EclipseKeys<span style="color: #990000">.</span>withSource <span style="font-weight: bold"><span style="color: #0000FF">:=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span></tt></pre></div></div>
<div class="paragraph"><p>If you find yourself using the plugin frequently, you may wish to declare it
in your global SBT configuration files so it appies to all projects.  To do that,
create a <span class="monospaced">~/.sbt/plugins/plugins.sbt</span> file containing:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>resolvers <span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Classpaths<span style="color: #990000">.</span>typesafeResolver

<span style="font-weight: bold"><span style="color: #000000">addSbtPlugin</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"com.typesafe.sbteclipse"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"sbteclipse-plugin"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"2.1.0"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Note the blank line between the <span class="monospaced">resolvers</span> and the <span class="monospaced">addSbtPlugin</span> is significant to SBT.</p></div>
<div class="paragraph"><p>Finally, set any global configurations (such as <span class="monospaced">withSource</span>) <span class="monospaced">in `~/.sbt/global.sbt</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_4">See Also</h4>
<div class="paragraph"><p>There are other useful settings for sbteclipse, described at <a href="https://github.com/typesafehub/sbteclipse/wiki">https://github.com/typesafehub/sbteclipse/wiki</a>.</p></div>
<div class="paragraph"><p>The SBT guide to using plugins, <a href="http://www.scala-sbt.org/release/docs/Getting-Started/Using-Plugins">http://www.scala-sbt.org/release/docs/Getting-Started/Using-Plugins</a> and the wiki page for global configuration, <a href="http://www.scala-sbt.org/release/docs/Detailed-Topics/Global-Settings">http://www.scala-sbt.org/release/docs/Detailed-Topics/Global-Settings</a>, explains the <span class="monospaced">~/.sbt/</span> structure for SBT.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="idea">Developing using Intellij IDEA</h3>
<div class="sect3">
<h4 id="_problem_5">Problem</h4>
<div class="paragraph"><p>You want to use the Intellij IDEA development environment when writing your Lift application.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_4">Solution</h4>
<div class="paragraph"><p>You need the Scala plugin for IntelliJ, and an SBT plugin to generate the IDEA project files.</p></div>
<div class="paragraph"><p>The IntelliJ plugin you&#8217;ll need to install once, and these instructions are for IntelliJ IDEA 12.  The details may vary between releases of the IDE, but the basic idea is to find the JetBrains Scala plugin, and download and install it.</p></div>
<div class="paragraph"><p>From the "Welcome to Intellij IDEA" screen, select "Configure" and then "Plugins". Select "Browse repositories&#8230;". In the search box, top right, type "Scala".  You&#8217;ll find on the left a number of matches: select "Scala".  On the right, you&#8217;ll see confirmation that this is the "Plugin for Scala language support" and the vendor is JetBrains Inc. Select the "Download and Install" icon from the top of the window (or right click to download and install). "Close" the dialog, and OK out of the Plugins window. You&#8217;ll be promoted to restart IntelliJ IDEA.</p></div>
<div class="paragraph"><p>With the IDE configured, you now need to add the SBT plugin inside your project by adding the following to the file <span class="monospaced">projects/plugins.sbt</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">addSbtPlugin</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"com.github.mpeltonen"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"sbt-idea"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"1.2.0"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Start SBT and at the SBT prompt create the IDEA project files by typing:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>gen-idea</pre>
</div></div>
<div class="paragraph"><p>This will generate the <span class="monospaced">.idea</span> and <span class="monospaced">.iml</span> files you need so you can do "File" and "Open&#8230;" in IntelliJ and navigate to your project.</p></div>
<div class="paragraph"><p>To see live changes as you edit and save your work, run SBT in a separate terminal window.  That is, start <span class="monospaced">sbt</span> from a terminal window outside of IntelliJ and enter the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>~; container:start; container:reload /</pre>
</div></div>
<div class="paragraph"><p>This behaviour of this command is described in <a href="#texteditor">[texteditor]</a>, but if you&#8217;re using JRebel (see <a href="#jrebel">[jrebel]</a>) then you just need to run <span class="monospaced">container:start</span> by itself.</p></div>
<div class="paragraph"><p>Each time you make the project, the container will pick up the changes, and you can see them by re-loading your browser window.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_5">Discussion</h4>
<div class="paragraph"><p>By default the <span class="monospaced">gen-idea</span> command will fetch source for dependent libraries. That means out-of-the-box you can click though to Lift source code to explore it and learn more about the framework.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_5">See Also</h4>
<div class="paragraph"><p>The sbt-idea plugin at <a href="https://github.com/mpeltonen/sbt-idea">https://github.com/mpeltonen/sbt-idea</a> doesn&#8217;t have a configuration guide yet. One way to discover the features is to browse the release notes in the <span class="monospaced">notes</span> folder of that project.</p></div>
<div class="paragraph"><p>JetBrains have a blog for the Scala plugin with feature news and tips: <a href="http://blog.jetbrains.com/scala/">http://blog.jetbrains.com/scala/</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_the_lift_proto_h2_database">Viewing the lift_proto H2 Database</h3>
<div class="sect3">
<h4 id="_problem_6">Problem</h4>
<div class="paragraph"><p>You&#8217;re developing using the default <span class="monospaced">lift_proto.db</span> H2 database, and
you would like use a tool to look at the tables.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_5">Solution</h4>
<div class="paragraph"><p>Use the web interface included as part of H2. Here are the steps:</p></div>
<div class="ulist"><ul>
<li>
<p>
Locate the H2 JAR file. For me, this was: <span class="monospaced">~/.ivy2/cache/com.h2database/h2/jars/h2-1.2.147.jar</span>.
</p>
</li>
<li>
<p>
Start the server from a terminal window using the JAR file you found: <span class="monospaced">java -cp /path/to/h2-version.jar org.h2.tools.Server</span>
</p>
</li>
<li>
<p>
This should launch your web browser, asking you to login.
</p>
</li>
<li>
<p>
Select "Generic H2 Server" in "Saved Settings".
</p>
</li>
<li>
<p>
Enter <span class="monospaced">jdbc:h2:/path/to/youapp/lift_proto.db;AUTO_SERVER=TRUE</span> for "JDBC URL", adjusting the path for the location of your database, and adjusting the name of the database ("lift_proto.db") if different in your <span class="monospaced">Boot.scala</span>.
</p>
</li>
<li>
<p>
Press "Connect" to view and edit your database.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_discussion_6">Discussion</h4>
<div class="paragraph"><p>The default Lift projects that include a database, such as <span class="monospaced">lift_basic</span>, use the H2 relational database as it can be included as an SBT dependency and requires no external installation or configuration. It&#8217;s a fine product, although production deployments typically use standalone databases, such as PostgreSQL or MySQL.</p></div>
<div class="paragraph"><p>Even if you&#8217;re deploying to a non-H2 database it may be useful to keep H2 around because it has an in-memory mode, which is great for unit tests. This means you can create a database in-memory, no files on disk, and throw it away when your unit tests ends.</p></div>
<div class="paragraph"><p>If you don&#8217;t like the web interface, the connection settings described in this recipe should give you the information you need to configure other SQL tools.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_6">See Also</h4>
<div class="paragraph"><p>The properties of H2 are described at  <a href="http://www.h2database.com">http://www.h2database.com</a>.</p></div>
<div class="paragraph"><p>If you&#8217;re using the console frequently, consider mapping it accessible from your Lift application in development node.  This is described by Diego Medina in a blog post at <a href="https://fmpwizard.telegr.am/blog/lift-and-h2">https://fmpwizard.telegr.am/blog/lift-and-h2</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_latest_lift_build">Using the Latest Lift build</h3>
<div class="sect3">
<h4 id="_problem_7">Problem</h4>
<div class="paragraph"><p>You want to use the latest build ("snapshot") of Lift.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_6">Solution</h4>
<div class="paragraph"><p>You need to make two changes to your <span class="monospaced">build.sbt</span> file. First, reference
the snapshot repository:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>resolvers <span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"snapshots"</span> at <span style="color: #FF0000">"http://oss.sonatype.org/content/repositories/snapshots"</span></tt></pre></div></div>
<div class="paragraph"><p>Second, change the <span class="monospaced">liftVersion</span> in your build to be the latest version. For this example, we will
assume there is a 2.6-SNAPSHOT to use rather than a 2.5 version:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> liftVersion <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"2.6-SNAPSHOT"</span></tt></pre></div></div>
<div class="paragraph"><p>Restarting SBT (or issuing a <span class="monospaced">reload</span> command) will trigger a download
of the latest build.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_7">Discussion</h4>
<div class="paragraph"><p>Production releases of Lift (e.g., "2.4", "25"), as well as milestone releases
(e.g., "2.5-M3") and release candidates (e.g., "2.5-RC1") are published
into a releases repository. When SBT downloads them, they are downloaded
once.</p></div>
<div class="paragraph"><p>Snapshot releases are different: they are the result of an automated
build, and change often. You can force SBT to resolve the latest
versions by running the command <span class="monospaced">clean</span> and then <span class="monospaced">update</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_7">See Also</h4>
<div class="paragraph"><p>To learn the detail of SNAPSHOT versions, dig into the Maven Complete Reference at [<a href="http://www.sonatype.com/books/mvnref-book/reference/pom-relationships-sect-pom-syntax.html">http://www.sonatype.com/books/mvnref-book/reference/pom-relationships-sect-pom-syntax.html</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_new_version_of_scala">Using a New Version of Scala</h3>
<div class="sect3">
<h4 id="_problem_8">Problem</h4>
<div class="paragraph"><p>A new Scala version has just been released and you want to immediately
use it in your Lift project.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_7">Solution</h4>
<div class="paragraph"><p>You may find that the latest SNAPSHOT of Lift is built using the latest
Scala version. Failing that, and assuming you cannot wait for a build,
providing that the Scala version is binary compatible with the latest
version used by Lift, you can change your build file to force the Scala
version.</p></div>
<div class="paragraph"><p>For example, assuming your <span class="monospaced">build.sbt</span> file is set up to use Lift 2.4
with Scala 2.9.1:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>scalaVersion <span style="font-weight: bold"><span style="color: #0000FF">:=</span></span> <span style="color: #FF0000">"2.9.1"</span>

libraryDependencies <span style="color: #990000">++</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> liftVersion <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"2.4"</span>
  <span style="font-weight: bold"><span style="color: #000000">Seq</span></span><span style="color: #990000">(</span>
    <span style="color: #FF0000">"net.liftweb"</span> <span style="color: #990000">%%</span> <span style="color: #FF0000">"lift-webkit"</span> <span style="color: #990000">%</span> liftVersion <span style="color: #990000">%</span> <span style="color: #FF0000">"compile-&gt;default"</span>
  <span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s assume that you now want to use Scala 2.9.2 but Lift 2.4 was only
built against Scala 2.9.1. Replace <span class="monospaced">%%</span> with <span class="monospaced">%</span> for the <span class="monospaced">net.liftweb</span>
resources and explicitly include the Scala version that Lift was built
against for each Lift component:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>scalaVersion <span style="font-weight: bold"><span style="color: #0000FF">:=</span></span> <span style="color: #FF0000">"2.9.2"</span>

libraryDependencies <span style="color: #990000">++</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> liftVersion <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"2.4"</span>
  <span style="font-weight: bold"><span style="color: #000000">Seq</span></span><span style="color: #990000">(</span>
    <span style="color: #FF0000">"net.liftweb"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"lift-webkit_2.9.1"</span> <span style="color: #990000">%</span> liftVersion <span style="color: #990000">%</span> <span style="color: #FF0000">"compile-&gt;default"</span>
  <span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_8">Discussion</h4>
<div class="paragraph"><p>Dependencies have a particular naming convention.  For example, the <span class="monospaced">lift-webkit</span> library for Lift 2.5-M3 is called <span class="monospaced">lift-webkit_2.9.1-2.5-M3.jar</span>.  Normally in <span class="monospaced">build.sbt</span> we simply refer to <span class="monospaced">"net.liftweb" %% "lift-webkit"</span> and SBT turns that into the name of a file that can be downloaded.</p></div>
<div class="paragraph"><p>However, in the above example we have forced SBT to explicitly fetch the 2.9.1 version
of the Lift resources rather than allow it to compute the URL to the
Lift components.  This is the difference between using <span class="monospaced">%%</span> and <span class="monospaced">%</span> in a
dependency: with <span class="monospaced">%%</span> you do not specify the Scala version as SBT will append
the <span class="monospaced">scalaVersion</span> number automatically; with <em>%</em> this automatic change is not made, so
have to manually specify more details for the name of the library.</p></div>
<div class="paragraph"><p>Please note this only works for minor releases of Scala: major releases
break compatibility.  For example Scala 2.9.1 is compatible with Scala 2.9.0, but not 2.10.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_8">See Also</h4>
<div class="paragraph"><p>Binary compatibly in Scala is discussed on the Scala user mailing list at
<a href="http://article.gmane.org/gmane.comp.lang.scala.user/39290">http://article.gmane.org/gmane.comp.lang.scala.user/39290</a>.</p></div>
<div class="paragraph"><p>The SBT behaviour is described at: <a href="http://www.scala-sbt.org/release/docs/Getting-Started/Library-Dependencies">http://www.scala-sbt.org/release/docs/Getting-Started/Library-Dependencies</a>.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_html">HTML</h2>
<div class="sectionbody">
<div class="paragraph"><p>Generating HTML is often a major component of web applications.  This chapter is concerned with Lift&#8217;s <em>View First</em> approach and use of <em>CSS Selectors</em>.  Later chapters focus on Form processing, REST web services, and JavaScript (Ajax and Comet).</p></div>
<div class="sect2">
<h3 id="_testing_and_debugging_css_selectors">Testing and Debugging CSS Selectors</h3>
<div class="sect3">
<h4 id="_problem_9">Problem</h4>
<div class="paragraph"><p>You want to explore or debug CSS selectors interactively.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_8">Solution</h4>
<div class="paragraph"><p>Use the Scala REPL to run your CSS selector. From withing SBT use the <span class="monospaced">console</span> command to get into the REPL. Here&#8217;s an example were we test out a CSS selector which applies a href to a link:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;</span> console
<span style="color: #990000">[</span>info<span style="color: #990000">]</span> Starting scala interpreter<span style="color: #990000">...</span>
<span style="color: #990000">[</span>info<span style="color: #990000">]</span>
Welcome to Scala version <span style="color: #993399">2.9</span><span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">final</span></span>
Type in expressions to have them evaluated<span style="color: #990000">.</span>
Type <span style="font-weight: bold"><span style="color: #0000FF">:</span></span>help <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> more information<span style="color: #990000">.</span>

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> in <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">&lt;</span>a<span style="color: #990000">&gt;</span>click me<span style="color: #990000">&lt;/</span>a<span style="color: #990000">&gt;</span>
in<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>Elem <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">&lt;</span>a<span style="color: #990000">&gt;</span>click me<span style="color: #990000">&lt;/</span>a<span style="color: #990000">&gt;</span>

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> f <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"a [href]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"http://example.org"</span>
f<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>CssSel <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">Full</span></span><span style="color: #990000">(</span>a <span style="color: #990000">[</span>href<span style="color: #990000">]),</span> <span style="font-weight: bold"><span style="color: #000000">Full(ElemSelector(a,Full(AttrSubNode</span></span><span style="color: #990000">(</span>href<span style="color: #990000">)))))</span>

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">f</span></span><span style="color: #990000">(</span>in<span style="color: #990000">)</span>
res0<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="font-weight: bold"><span style="color: #000000">NodeSeq</span></span><span style="color: #990000">(&lt;</span>a href<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"http://example.org"</span><span style="color: #990000">&gt;</span>click me<span style="color: #990000">&lt;/</span>a<span style="color: #990000">&gt;)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_9">Discussion</h4>
<div class="paragraph"><p>CSS selector transforms are one of the distinguishing features of Lift. They succinctly describe a node in your template (left-hand side) and give a replacement (right-hand side). They do take a little while to get use to, so being able to test them at the Scala REPL is useful.</p></div>
<div class="paragraph"><p>It may help to know that prior to CSS selectors Lift snippets were typically defined in terms
of a function that took a <span class="monospaced">NodeSeq</span> and returned a <span class="monospaced">NodeSeq</span>, often via the <span class="monospaced">bind</span> method.  When Lift processes such a template it knows what the input <span class="monospaced">NodeSeq</span> is, so it&#8217;s natural to supply a function that returns a <span class="monospaced">NodeSeq</span>.  You won&#8217;t see that usage so often any more, but the principle is the same.</p></div>
<div class="paragraph"><p>The CSS selector functionality in Lift gives you a <span class="monospaced">CssSel</span> function
which is <span class="monospaced">NodeSeq =&gt; NodeSeq</span>. We exploit this in the above example by constructing an input
<span class="monospaced">NodeSeq</span> (called <span class="monospaced">in</span>), then creating a CSS function (called <span class="monospaced">f</span>).  Because we know that <span class="monospaced">CssSel</span>
is defined as a <span class="monospaced">NodeSeq =&gt; NodeSeq</span> the natural way to execute the selector is to supply
the <span class="monospaced">in</span> as a parameter, and this gives us the answer, <span class="monospaced">res0</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_9">See Also</h4>
<div class="paragraph"><p>The syntax for selectors is best described in <em>Simply Lift</em> at <a href="http://simply.liftweb.net/index-7.10.html#toc-Section-7.10">http://simply.liftweb.net/index-7.10.html#toc-Section-7.10</a>.</p></div>
<div class="paragraph"><p>Section 6.1.2 of <em>Lift in Action</em> also describes selectors and gives examples.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_sequencing_css_selector_operations">Sequencing CSS Selector Operations</h3>
<div class="sect3">
<h4 id="_problem_10">Problem</h4>
<div class="paragraph"><p>You want your CSS selector binding to apply to the results of earlier
binding expressions.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_9">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">andThen</span> rather than <span class="monospaced">&amp;</span> to compose your selector expressions.</p></div>
<div class="paragraph"><p>For example, suppose we want to replace <span class="monospaced">&lt;div id="foo"/&gt;</span> with
<span class="monospaced">&lt;div id="bar"&gt;bar content&lt;/div&gt;</span> but for some reason we needed to
generate the <span class="monospaced">bar</span> div as a separate step in the selector expression:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>sbt<span style="color: #990000">&gt;</span> console
<span style="color: #990000">[</span>info<span style="color: #990000">]</span> Starting scala interpreter<span style="color: #990000">...</span>
<span style="color: #990000">[</span>info<span style="color: #990000">]</span>
Welcome to Scala version <span style="color: #993399">2.9</span><span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #990000">(</span>Java <span style="color: #993399">1.7</span><span style="color: #990000">.</span>0<span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #993399">05</span><span style="color: #990000">).</span>
Type in expressions to have them evaluated<span style="color: #990000">.</span>
Type <span style="font-weight: bold"><span style="color: #0000FF">:</span></span>help <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> more information<span style="color: #990000">.</span>

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"#foo"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">&lt;</span>div id<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"bar"</span><span style="color: #990000">/&gt;</span> andThen <span style="color: #FF0000">"#bar *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"bar content"</span>
render<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">render</span></span><span style="color: #990000">(&lt;</span>div id<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"foo"</span><span style="color: #990000">/&gt;)</span>
res0<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">NodeSeq</span></span><span style="color: #990000">(&lt;</span>div id<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"bar"</span><span style="color: #990000">&gt;</span>bar content<span style="color: #990000">&lt;/</span>div<span style="color: #990000">&gt;)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_10">Discussion</h4>
<div class="paragraph"><p>When using <span class="monospaced">&amp;</span> think of the CSS selectors as always applying to the
original template, no matter what other expressions you are combining.
This is because <span class="monospaced">&amp;</span> is aggregating the selectors together before applying them; whereas <span class="monospaced">andThen</span> is
a method of all Scala functions that composes two functions together, with the fist being
called before the second.</p></div>
<div class="paragraph"><p>Compare the example above if we change the <span class="monospaced">andThen</span> with
<span class="monospaced">&amp;</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"#foo"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">&lt;</span>div id<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"bar"</span> <span style="color: #990000">/&gt;</span> <span style="color: #990000">&amp;</span> <span style="color: #FF0000">"#bar *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"bar content"</span>
render<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>CssSel

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">render</span></span><span style="color: #990000">(&lt;</span>div id<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"foo"</span><span style="color: #990000">/&gt;)</span>
res1<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">NodeSeq</span></span><span style="color: #990000">(&lt;</span>div id<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"bar"</span><span style="color: #990000">&gt;&lt;/</span>div<span style="color: #990000">&gt;)</span></tt></pre></div></div>
<div class="paragraph"><p>The second expression will not match as it is applied to the original
input of <span class="monospaced">&lt;div id="foo"/&gt;</span>. There&#8217;s no <span class="monospaced">id="bar"</span> in there to match on,
so this means in the second expression adds
nothing to the <span class="monospaced">render</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_10">See Also</h4>
<div class="paragraph"><p>This topic is from the Lift mailing list, and you can see the original context there:
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/fz3Pmlhzhfg">https://groups.google.com/forum/?fromgroups#!topic/liftweb/fz3Pmlhzhfg</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_meta_tag_contents">Setting Meta Tag Contents</h3>
<div class="sect3">
<h4 id="_problem_11">Problem</h4>
<div class="paragraph"><p>You want to set the content of an HTML meta tag using Lift.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_10">Solution</h4>
<div class="paragraph"><p>Use the <span class="monospaced">@</span> CSS binding name selector. For example, given:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;meta</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"keywords"</span> <span style="color: #009900">content</span><span style="color: #990000">=</span><span style="color: #FF0000">"words, here, please"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The following snippet code will update the value of the contents
attribute:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">"@keywords [content]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"words, we, really, want"</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_11">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">@</span> selector selects all elements with the given name. It&#8217;s useful in this case to change <span class="monospaced">&lt;meta name="keyword"&gt;</span> tag, but you may also see it used with elsewhere, for example with HTML forms to select input fields, such as <span class="monospaced">&lt;input name="address"&gt;</span>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">[content]</span> part is an example of a <em>replacement rule</em> that can follow a selector. That&#8217;s to say, it&#8217;s not specific to the <span class="monospaced">@</span> selector and can be used with other selectors.  In this example it adds or replaces the value of the attribute called "content".</p></div>
<div class="paragraph"><p>There are two other replacement rules useful for manipulating attributes: removing attributes and appending to attributes:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">[content!]</span> to remove an attribute with a matching value, which in our example would be <span class="monospaced">"@keywords [content!]" #&gt; "words, here, please"</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">[content+]</span> to append to the value, such as <span class="monospaced">"@keywords [content+]" #&gt; ", more"</span>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Although not directly relevant to <span class="monospaced">meta</span> tags, you should be aware of there is one convenient special case for appending to an attribute. If the attribute is <span class="monospaced">class</span>, a space is added together with your class value. As a demonstration of that, here&#8217;s an example of appending a class called "funky" to a <span class="monospaced">div</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"div [class+]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"funky"</span>
render<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>CssSel

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">render</span></span><span style="color: #990000">(&lt;</span>div <span style="font-weight: bold"><span style="color: #0000FF">class=</span></span><span style="color: #FF0000">"wrapper"</span><span style="color: #990000">/&gt;)</span>
res0<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">NodeSeq</span></span><span style="color: #990000">(&lt;</span>div <span style="font-weight: bold"><span style="color: #0000FF">class=</span></span><span style="color: #FF0000">"wrapper funky"</span><span style="color: #990000">&gt;&lt;/</span>div<span style="color: #990000">&gt;)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_11">See Also</h4>
<div class="paragraph"><p>The syntax for selectors is best described in <em>Simply Lift</em> at <a href="http://simply.liftweb.net/index-7.10.html">http://simply.liftweb.net/index-7.10.html</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_the_page_title">Setting the Page Title</h3>
<div class="sect3">
<h4 id="_problem_12">Problem</h4>
<div class="paragraph"><p>You want to set the <span class="monospaced">&lt;title&gt;</span> of the page from a Lift snippet.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_11">Solution</h4>
<div class="paragraph"><p>Select all the elements of the <span class="monospaced">title</span> element and replace them with the
text you want:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">"title *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"I am different"</span></tt></pre></div></div>
<div class="paragraph"><p>Assuming you have a <span class="monospaced">&lt;title&gt;</span> tag in your template, the above will
result in:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;title&gt;</span></span>I am different<span style="font-weight: bold"><span style="color: #0000FF">&lt;/title&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_12">Discussion</h4>
<div class="paragraph"><p>It is also possible to set the page title from the contents of <span class="monospaced">SiteMap</span>,
meaning the title used will be the title you&#8217;ve assigned to the page in
the site map:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;title</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:Menu.title"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/title&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The <span class="monospaced">lift:Menu.title</span> code appends to any existing text in the title.
This means the following will have the phrase "Site Title - " in the
title followed by the page title:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;title</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:Menu.title"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Site Title - <span style="font-weight: bold"><span style="color: #0000FF">&lt;/title&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>If you need more control, you can of course bind on title using a
regular snippet. This example uses a custom snippet to put the site
title after the page title:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;title</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:MyTitle"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/title&gt;</span></span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">object</span></span> MyTitle <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">&lt;</span>title<span style="color: #990000">&gt;&lt;</span>lift<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>Menu<span style="color: #990000">.</span>title <span style="color: #990000">/&gt;</span> <span style="color: #990000">-</span> Site Title<span style="color: #990000">&lt;/</span>title<span style="color: #990000">&gt;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_12">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<em>Simply Lift</em> chapter 7: <a href="http://simply.liftweb.net/index-7.10.html">http://simply.liftweb.net/index-7.10.html</a>.
</p>
</li>
<li>
<p>
The Wiki page for SiteMap: <a href="http://www.assembla.com/spaces/liftweb/wiki/SiteMap">http://www.assembla.com/spaces/liftweb/wiki/SiteMap</a>.
</p>
</li>
<li>
<p>
The "dynamic titles on sitemap" mailing list discussion offers further options for computing page titles:
<a href="http://groups.google.com/group/liftweb/browse_thread/thread/e19bd2dda2b3159d">http://groups.google.com/group/liftweb/browse_thread/thread/e19bd2dda2b3159d</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_including_html5_shiv">Including HTML5 Shiv</h3>
<div class="sect3">
<h4 id="_problem_13">Problem</h4>
<div class="paragraph"><p>You want to include HTML5 Shiv (a.k.a. HTML5 Shim) so you can use HTML5
elements with legacy IE browsers.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_12">Solution</h4>
<div class="paragraph"><p>Put the markup in a snippet and include the snippet in your page or
template.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> code<span style="color: #990000">.</span>snippet

<span style="font-weight: bold"><span style="color: #000080">import</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>Unparsed

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Html5Shiv <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Unparsed</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"""&lt;!--[if lt IE 9]&gt;</span>
<span style="color: #FF0000">  &lt;script src="</span>http<span style="font-weight: bold"><span style="color: #0000FF">:</span></span><span style="font-style: italic"><span style="color: #9A1900">//html5shim.googlecode.com/svn/trunk/html5.js"&gt;</span></span>
  <span style="color: #990000">&lt;/</span>script<span style="color: #990000">&gt;&lt;![</span>endif<span style="color: #990000">]--&gt;</span><span style="color: #FF0000">""")</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Reference the snippet in the <span class="monospaced">&lt;head&gt;</span> of your
<span class="monospaced">templates-hidden/default.html</span>, e.g.,:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:Html5Shiv"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_13">Discussion</h4>
<div class="paragraph"><p>The HTML5 parser used by Lift does not carry comments from the source
through to the rendered page. If you just tried to paste the html5shim markup into
your template you&#8217;d find it missing from the rendered page.</p></div>
<div class="paragraph"><p>We deal with this by generating unparsed markup from a snippet. If you&#8217;re looking at
<span class="monospaced">Unparsed</span> and worried, your instincts are correct.  Normally Lift would cause the
markup to be escaped, but in this case we really do want
unparsed XML content (the comment tag) included in the output.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_13">See Also</h4>
<div class="paragraph"><p>If you&#8217;re doing a lot of IE conditional includes, take a look at the mailing list
suggestion from Antonio Salazar Cardozo for using a IE confitional comment snippet: <a href="https://groups.google.com/d/msg/liftweb/kLzcJwfIqHQ/K91MdtoNz0MJ">https://groups.google.com/d/msg/liftweb/kLzcJwfIqHQ/K91MdtoNz0MJ</a>.</p></div>
<div class="paragraph"><p>The html5shim project can be found at: <a href="http://code.google.com/p/html5shim/">http://code.google.com/p/html5shim/</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_returning_snippet_markup_unchanged">Returning Snippet Markup Unchanged</h3>
<div class="sect3">
<h4 id="_problem_14">Problem</h4>
<div class="paragraph"><p>You want a snippet to return the original markup associated with the
snippet invocation.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_13">Solution</h4>
<div class="paragraph"><p>Use the <span class="monospaced">PassThru</span> transform. For
example, suppose you have a snippet which performs a transforms when some
condition is met, but if the condition is not met, you want the snippet
return the original markup.</p></div>
<div class="paragraph"><p>Starting with the original markup&#8230;</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"myclass"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>Nothing to worry about<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>&#8230;we could leave it alone or change it with this snippet:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>someCondition<span style="color: #990000">)</span>
    <span style="color: #FF0000">".myclass *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">&lt;</span>p<span style="color: #990000">&gt;</span>The condition happened<span style="color: #990000">&lt;/</span>p<span style="color: #990000">&gt;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
    PassThru</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_14">Discussion</h4>
<div class="paragraph"><p><span class="monospaced">PassThru</span> is a <span class="monospaced">NodeSeq =&gt; NodeSeq</span> function that returns the input it
is given (an identity function).  It&#8217;s defined as:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>object PassThru extends Function1[NodeSeq, NodeSeq] {
  def apply(in: NodeSeq): NodeSeq = in
}</pre>
</div></div>
<div class="paragraph"><p>The pattern of converting one <span class="monospaced">NodeSeq</span> to another is simple, but also powerful enough to get you out of most situations as you can always arbitrarily re-write the <span class="monospaced">NodeSeq</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_14">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
The <em>How
to return the original markup associated with snippet invocation?</em> mailing list discussion: <a href="https://groups.google.com/d/msg/liftweb/A69tyIBBSdg/mUGO6_qUFqwJ">https://groups.google.com/d/msg/liftweb/A69tyIBBSdg/mUGO6_qUFqwJ</a>
</p>
</li>
<li>
<p>
Take a look at the source for <span class="monospaced">PassThru</span>, which is at <a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/CssSel.scala">https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/CssSel.scala</a>, to see how this and other similar functions are defined.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_snippet_not_found_when_using_html5">Snippet Not Found when using HTML5</h3>
<div class="sect3">
<h4 id="_problem_15">Problem</h4>
<div class="paragraph"><p>You&#8217;re using Lift with the HTML5 parser and one of your snippets,
perhaps <span class="monospaced">&lt;lift:HelloWorld.howdy /&gt;</span>, is rendering with a "Class Not
Found" error.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_14">Solution</h4>
<div class="paragraph"><p>Switch to the designer-friendly snippet invocation mechanism. E.g.,</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:HellowWorld.howdy"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>...<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_15">Discussion</h4>
<div class="paragraph"><p>The HTML5 parser and the traditional Lift XHTML parser have different
behaviours. In particular the HTML5 parser converts elements and attribute names to lower
case when looking up snippets. This means Lift would take <span class="monospaced">&lt;lift:HelloWorld.howdy /&gt;</span> and look for a class called "helloworld" rather than "HelloWorld", which would be the cause of the "Class Not Found Error".</p></div>
<div class="paragraph"><p>Switching to the designer-friendly mechnism is the solution here, and you gain validating HTML as a bonus.</p></div>
<div class="paragraph"><p>In this text we use the HTML5 parser, which is set in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">// Use HTML5 for rendering</span></span>
<span style="font-weight: bold"><span style="color: #000000">LiftRules.htmlProperties.default.set(</span></span> <span style="color: #990000">(</span>r<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Req<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Html5Properties</span></span><span style="color: #990000">(</span>r<span style="color: #990000">.</span>userAgent<span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_15">See Also</h4>
<div class="paragraph"><p>The key differences between the XHTML and HTML5 parser are outlined on the mailing list at <a href="https://groups.google.com/d/msg/liftweb/H-xe1uRLW1c/B60UH8P54VAJ">https://groups.google.com/d/msg/liftweb/H-xe1uRLW1c/B60UH8P54VAJ</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_avoiding_css_and_javascript_caching">Avoiding CSS and JavaScript Caching</h3>
<div class="sect3">
<h4 id="_problem_16">Problem</h4>
<div class="paragraph"><p>You&#8217;ve modified CSS or JavaScript in your application, but web browsers
have cached your resources and are using the older versions. You&#8217;d like
to avoid this browser caching.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_15">Solution</h4>
<div class="paragraph"><p>Add the <span class="monospaced">lift:with-resource-id</span> class attribute to script or link tags:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:with-resource-id"</span> <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/myscript.js"</span>
 <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The addition of this class will cause Lift to append a "resource id" to
your <span class="monospaced">src</span> (or <span class="monospaced">href</span>), and as this resource id changes each time Lift
starts, it defeats browser caching.</p></div>
<div class="paragraph"><p>The resultant HTML might be:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/myscript.js?F619732897824GUCAAN=_"</span>
  <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_16">Discussion</h4>
<div class="paragraph"><p>The randome value that is appended to the resource is computed when your Lift application boots.  This means it should be stable between releases of your application.</p></div>
<div class="paragraph"><p>If you need some other behaviour from <span class="monospaced">with-resource-id</span> you can assign
a new function of type <span class="monospaced">String =&gt; String</span> to
<span class="monospaced">LiftRules.attachResourceId</span>. The default implementation, shown above,
takes the resource name ("/myscript.js" in the example) and returns the
resource name with an id appended.</p></div>
<div class="paragraph"><p>You can also wrap a number of tags inside a
<span class="monospaced">&lt;lift:with-resource-id&gt;...&lt;lift:with-resource-id&gt;</span> block. However,
avoid doing this in the <span class="monospaced">&lt;head&gt;</span> of your page as the HTML5 parser will
move the tags to be outside of the head section.</p></div>
<div class="paragraph"><p>Note that some proxies may choose not to cache resources with query
parameters at all. If that impacts you, it&#8217;s possible to code a custom resource id method
to move the random resouce ID out of the query parameter and into the path.</p></div>
<div class="paragraph"><p>Here&#8217;s one approach to doing this. Rather than generate JavaScript and CSS links that look like <span class="monospaced">/myscript.js?F61973</span>, we will generate <span class="monospaced">/cache/F61973/myscript.js</span>. We then will need to tell Lift to take requests
that look like this new format, and render the correct content for the request.  This all happens in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">// The random number we're using to avoid caching</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> resourceId <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Helpers<span style="color: #990000">.</span>nextFuncName

<span style="font-style: italic"><span style="color: #9A1900">// Prefix lift:with-resource-id links with "/cache/{resouceId}"</span></span>
LiftRules<span style="color: #990000">.</span>attachResourceId <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">(</span>path<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #FF0000">{</span>
  <span style="color: #FF0000">"/cache/"</span> <span style="color: #990000">+</span> resourceId <span style="color: #990000">+</span> path
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">// The resource suffix we're caching: ".js" or ".css"</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> CacheableExt <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">unapply</span></span><span style="color: #990000">(</span>s<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Option<span style="color: #990000">[</span>String<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> s <span style="font-weight: bold"><span style="color: #0000FF">match</span></span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"js"</span> <span style="color: #990000">|</span> <span style="color: #FF0000">"css"</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">Some</span></span><span style="color: #990000">(</span>s<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> None
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">// Remove the cache/{resourceId} from the request if there is one</span></span>
<span style="font-weight: bold"><span style="color: #000000">LiftRules.statelessRewrite.prepend</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #000000">NamedPF</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"BrowserCacheAssist"</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">RewriteRequest</span></span><span style="color: #990000">(</span>
    <span style="font-weight: bold"><span style="color: #000000">ParsePath</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"cache"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> id <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> file<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">CacheableExt</span></span><span style="color: #990000">(</span>suffix<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #000000">RewriteResponse</span></span><span style="color: #990000">(</span>file<span style="color: #990000">.</span>init <span style="color: #990000">++</span> <span style="font-weight: bold"><span style="color: #000000">List</span></span><span style="color: #990000">(</span>file<span style="color: #990000">.</span>last<span style="color: #990000">+</span><span style="color: #FF0000">"."</span><span style="color: #990000">+</span>suffix<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">Map[String,String]</span></span><span style="color: #990000">())</span>
<span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The <span class="monospaced">statelessRewrite</span> is a little long, but it&#8217;s doing quite a lot.  First, it&#8217;s matching only
request that start with "cache", followed by some value, followed by a filename, where the suffix
of the file matches the <span class="monospaced">CacheableExt</span>.  If it does, we reconstruct the path without the caching part.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_16">See Also</h4>
<div class="paragraph"><p>The source for <span class="monospaced">LiftRules</span> shows the default implementation of <span class="monospaced">attachResourceId</span>: <a href="https://github.com/lift/framework/blob/master/web/webkit/src/main/scala/net/liftweb/http/LiftRules.scala">https://github.com/lift/framework/blob/master/web/webkit/src/main/scala/net/liftweb/http/LiftRules.scala</a>.</p></div>
<div class="paragraph"><p>Google&#8217;s <em>Optimize caching</em> notes are a good source of information about browser behaviour: <a href="https://developers.google.com/speed/docs/best-practices/caching">https://developers.google.com/speed/docs/best-practices/caching</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_to_the_head_of_a_page">Adding to the Head of a Page</h3>
<div class="sect3">
<h4 id="_problem_17">Problem</h4>
<div class="paragraph"><p>You use a template for layout, but on one specific page you need to add
something to the <span class="monospaced">&lt;head&gt;</span> section.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_16">Solution</h4>
<div class="paragraph"><p>Use the <span class="monospaced">lift:head</span> snippet or CSS class so Lift knows to merge the
contents with the <span class="monospaced">&lt;head&gt;</span> of your page. For example, suppose you have
the following contents in <span class="monospaced">templates-hidden/default.html</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;html</span></span> <span style="color: #009900">lang</span><span style="color: #990000">=</span><span style="color: #FF0000">"en"</span> <span style="color: #009900">xmlns:lift</span><span style="color: #990000">=</span><span style="color: #FF0000">"http://liftweb.net/"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;head&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;meta</span></span> <span style="color: #009900">charset</span><span style="color: #990000">=</span><span style="color: #FF0000">"utf-8"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/meta&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;title</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:Menu.title"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>App: <span style="font-weight: bold"><span style="color: #0000FF">&lt;/title&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"jquery"</span> <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/classpath/jquery.js"</span>
      <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"json"</span> <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/classpath/json.js"</span>
      <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/head&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;body&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"content"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>The main content will get bound here<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/body&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/html&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Also suppose you have <span class="monospaced">index.html</span> on which you want to include <span class="monospaced">my.css</span>
just for that page. Do so by including the CSS in the part of the page
that will get processed and mark it for the head with <span class="monospaced">lift:head</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;!DOCTYPE</span></span> <span style="color: #009900">html</span><span style="font-weight: bold"><span style="color: #000080">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;html&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;head&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;title&gt;</span></span>Special<span style="font-weight: bold"><span style="color: #0000FF">&lt;/title&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/head&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;body</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:content_id=main"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"main"</span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:surround?with=default;at=content"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;link</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:head"</span> <span style="color: #009900">rel</span><span style="color: #990000">=</span><span style="color: #FF0000">"stylesheet"</span> <span style="color: #009900">href</span><span style="color: #990000">=</span><span style="color: #FF0000">"/my.css"</span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">'text/css'</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;h2&gt;</span></span>Hello<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h2&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/body&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/html&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Note that this <span class="monospaced">index.html</span> page is validated HTML5, and will produce a
result with the custom CSS inside the <span class="monospaced">&lt;head&gt;</span> tag, something like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;!DOCTYPE</span></span> <span style="color: #009900">html</span><span style="font-weight: bold"><span style="color: #000080">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;html</span></span> <span style="color: #009900">lang</span><span style="color: #990000">=</span><span style="color: #FF0000">"en"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;head&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;meta</span></span> <span style="color: #009900">charset</span><span style="color: #990000">=</span><span style="color: #FF0000">"utf-8"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;title&gt;</span></span>App:  Home<span style="font-weight: bold"><span style="color: #0000FF">&lt;/title&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span>
    <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/classpath/jquery.js"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"jquery"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span>
    <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/classpath/json.js"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"json"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;link</span></span> <span style="color: #009900">rel</span><span style="color: #990000">=</span><span style="color: #FF0000">"stylesheet"</span> <span style="color: #009900">href</span><span style="color: #990000">=</span><span style="color: #FF0000">"/my.css"</span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/css"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/head&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;body&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"main"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;h2&gt;</span></span>Hello<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h2&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span> <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/ajax_request/liftAjax.js"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-style: italic"><span style="color: #9A1900">// &lt;![CDATA[</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">var</span></span> lift_page <span style="color: #990000">=</span> <span style="color: #FF0000">"F557573613430HI02U4"</span><span style="color: #990000">;</span>
  <span style="font-style: italic"><span style="color: #9A1900">// ]]&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/script&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/body&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/html&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_17">Discussion</h4>
<div class="paragraph"><p>If you find your tags not appearing the the <span class="monospaced">&lt;head&gt;</span> section, check that
the HTML in your template and page is valid HTML5.</p></div>
<div class="paragraph"><p>You can also use <span class="monospaced">&lt;lift:head&gt;...&lt;/lift:head&gt;</span> to wrap a number of
expressions, and will see <span class="monospaced">&lt;head_merge&gt;...&lt;/head_merge&gt;</span> used in code
example as an alternative to <span class="monospaced">&lt;lift:head&gt;</span>.</p></div>
<div class="paragraph"><p>You may also see <span class="monospaced">data-lift="head"</span> is also used as an alternative to
<span class="monospaced">class="lift:head"</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_17">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Mailing list discussion on <em>Designer Friendly Way of Head Merge</em> at <a href="https://groups.google.com/d/msg/liftweb/rG_pOXdp4Ew/cPHTyTDhmWEJ">https://groups.google.com/d/msg/liftweb/rG_pOXdp4Ew/cPHTyTDhmWEJ</a>.
</p>
</li>
<li>
<p>
The W3C HTML validator is a useful tool for tracking down HTML markup issues that may cause problems with content being moved into the head of your page. <a href="http://validator.w3.org/">http://validator.w3.org/</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_404_page">Custom 404 Page</h3>
<div class="sect3">
<h4 id="_problem_18">Problem</h4>
<div class="paragraph"><p>You want to show a customised "404" (page not found) page.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_17">Solution</h4>
<div class="paragraph"><p>In <span class="monospaced">Boot.scala</span> add the following:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.uriNotFound.prepend(NamedPF</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"404handler"</span><span style="color: #990000">)</span><span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #990000">(</span>req<span style="color: #990000">,</span>failure<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #000000">NotFoundAsTemplate(ParsePath(List</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"404"</span><span style="color: #990000">),</span><span style="color: #FF0000">"html"</span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">))</span>
<span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The file <span class="monospaced">src/main/webapp/404.html</span> will now be served for requests to
unknown resources.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_18">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">uriNotFound</span> Lift rule needs to return a <span class="monospaced">NotFound</span> in reply to a
<span class="monospaced">Req</span> (request) and optional <span class="monospaced">Failure</span>. This allows you to customise the
response based on the type of failure or the request that was made.</p></div>
<div class="paragraph"><p>There are three types of <span class="monospaced">NotFound</span>:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">NotFoundAsTemplate</span> is useful to invoke the Lift template processing
facilities from a <span class="monospaced">ParsePath</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">NotFoundAsResponse</span> allows you to return a specific <span class="monospaced">LiftResponse</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">NotFoundAsNode</span> wrappers a <span class="monospaced">NodeSeq</span> for Lift to translate into a 404
response.
</p>
</li>
</ul></div>
<div class="paragraph"><p>In case you&#8217;re wondering, the two <span class="monospaced">false</span> arguments to <span class="monospaced">ParsePath</span>
indicates the path we&#8217;ve given isn&#8217;t absolute, and doesn&#8217;t end in a
slash.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_18">See Also</h4>
<div class="paragraph"><p>The Wiki entry for this topic: <a href="http://www.assembla.com/spaces/liftweb/wiki/Custom_404_-_URI_not_found_page">http://www.assembla.com/spaces/liftweb/wiki/Custom_404_-_URI_not_found_page</a></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_other_custom_status_pages">Other Custom Status Pages</h3>
<div class="sect3">
<h4 id="_problem_19">Problem</h4>
<div class="paragraph"><p>You want to show a customised page for certain HTTP status codes.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_18">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">LiftRules.responseTransformers</span> to match against the response and
supply an alternative.</p></div>
<div class="paragraph"><p>For example, suppose we want to provide a customised page for 403
("Forbidden") statuses created in your Lift application. In <span class="monospaced">Boot.scala</span>
we could add the following:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftRules<span style="color: #990000">.</span>responseTransformers<span style="color: #990000">.</span>append <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> r <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> r<span style="color: #990000">.</span>toResponse<span style="color: #990000">.</span>code <span style="font-weight: bold"><span style="color: #0000FF">==</span></span> <span style="color: #993399">403</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">RedirectResponse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/403.html"</span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> r <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> r
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The file <em>src/main/webapp/403.html</em> will now be served for requests that
generate 403 status codes. Other, non 403, requests are left untransformed.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_19">Discussion</h4>
<div class="paragraph"><p><span class="monospaced">LiftRules.responseTransformers</span> allows you to supply
<span class="monospaced">LiftResponse =&gt; LiftResponse</span> functions to change a response at the end
of the HTTP processing cycle. This is a very general mechanism: in this
example we are matching on a status code, but we could match on anything
exposed by <span class="monospaced">LiftResponse</span>.</p></div>
<div class="paragraph"><p>We&#8217;ve shown a <span class="monospaced">RedirectResponse</span> being
returned but there are many different kinds of <span class="monospaced">LiftResponse</span> we could
send to the client.</p></div>
<div class="paragraph"><p>One way to test the above example is to add the following to Boot to
make all requests to <em>/secret</em> return a 403:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> Protected <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">If(</span></span><span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">ForbiddenResponse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"no way"</span><span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> entries <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">List</span></span><span style="color: #990000">(</span>
  <span style="font-weight: bold"><span style="color: #000000">Menu.i</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Home"</span><span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="color: #FF0000">"index"</span><span style="color: #990000">,</span>
  <span style="font-weight: bold"><span style="color: #000000">Menu.i</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"secret"</span><span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="color: #FF0000">"secret"</span> <span style="color: #990000">&gt;&gt;</span> Protected<span style="color: #990000">,</span>
  <span style="font-weight: bold"><span style="color: #000000">Menu.i</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"403"</span><span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="color: #FF0000">"403"</span> <span style="color: #990000">&gt;&gt;</span> Hidden
  <span style="font-style: italic"><span style="color: #9A1900">// rest of your site map here...</span></span>
<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>If you request <em>/secret</em>, a 403 response will be triggered, which will match the response transformer showing you
the <em>403.html</em> page.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_19">See Also</h4>
<div class="paragraph"><p><em>The Request/Response Lifecycle</em> section in <em>Exploring Lift</em> in gives more details about the processing pipeline.
<a href="http://exploring.liftweb.net/master/index-9.html#toc-Section-9.2">http://exploring.liftweb.net/master/index-9.html#toc-Section-9.2
</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_links_in_notices">Links in Notices</h3>
<div class="sect3">
<h4 id="_problem_20">Problem</h4>
<div class="paragraph"><p>You want to include a clickable link in your <span class="monospaced">S.error</span>, <span class="monospaced">S.notice</span> or
<span class="monospaced">S.warning</span> messages.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_19">Solution</h4>
<div class="paragraph"><p>Include a <span class="monospaced">NodeSeq</span> containing a link in your notice:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">S.error</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"checkPrivacyPolicy"</span><span style="color: #990000">,</span>
  <span style="color: #990000">&lt;</span>span<span style="color: #990000">&gt;</span>See our <span style="color: #990000">&lt;</span>a href<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"/policy"</span><span style="color: #990000">&gt;</span>privacy policy<span style="color: #990000">&lt;/</span>a<span style="color: #990000">&gt;&lt;/</span>span<span style="color: #990000">&gt;)</span></tt></pre></div></div>
<div class="paragraph"><p>You might pair this with the following in your template:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:Msg?id=checkPrivacyPolicy"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/div&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_20">See Also</h4>
<div class="paragraph"><p>Lift notices are described on the Wiki: <a href="http://www.assembla.com/spaces/liftweb/wiki/Lift_Notices_and_Auto_Fadeout">http://www.assembla.com/spaces/liftweb/wiki/Lift_Notices_and_Auto_Fadeout</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_rendering_textile_markup">Rendering Textile Markup</h3>
<div class="sect3">
<h4 id="_problem_21">Problem</h4>
<div class="paragraph"><p>You want to render Textile markup in your web app.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_20">Solution</h4>
<div class="paragraph"><p>Install the Lift Textile module in your <span class="monospaced">build.sbt</span> file by adding the
following to the list of dependencies:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">"net.liftmodules"</span> <span style="color: #990000">%%</span> <span style="color: #FF0000">"textile"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>liftVersion <span style="color: #990000">+</span> <span style="color: #FF0000">"1.1"</span><span style="color: #990000">)</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"compile-&gt;default"</span><span style="color: #990000">,</span></tt></pre></div></div>
<div class="paragraph"><p>You can then use the module to render Textile using the <span class="monospaced">toHtml</span> method:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftmodules<span style="color: #990000">.</span>textile<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftmodules<span style="color: #990000">.</span>textile<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

scala<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">TextileParser.toHtml</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"""h1. Hi!</span>
<span style="color: #FF0000"> |</span>
<span style="color: #FF0000"> | The module in "</span>Lift<span style="color: #FF0000">":http://www.liftweb.net for turning Textile markup</span>
<span style="color: #FF0000"> | into HTML is pretty easy to use.</span>
<span style="color: #FF0000"> |</span>
<span style="color: #FF0000"> | * As you can see</span>
<span style="color: #FF0000"> | * in this example</span>
<span style="color: #FF0000"> |"""</span><span style="color: #990000">)</span>
res0<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
<span style="font-weight: bold"><span style="color: #000000">NodeSeq</span></span><span style="color: #990000">(&lt;</span>h1<span style="color: #990000">&gt;</span>Hi<span style="color: #990000">!&lt;/</span>h1<span style="color: #990000">&gt;,</span>
<span style="color: #990000">,</span> <span style="color: #990000">&lt;</span>p<span style="color: #990000">&gt;</span>The module in <span style="color: #990000">&lt;</span>a href<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"http://www.liftweb.net"</span><span style="color: #990000">&gt;</span>Lift<span style="color: #990000">&lt;/</span>a<span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> turning
Textile markup into HTML is pretty easy to use<span style="color: #990000">.&lt;/</span>p<span style="color: #990000">&gt;,</span>
<span style="color: #990000">,</span> <span style="color: #990000">&lt;</span>ul<span style="color: #990000">&gt;&lt;</span>li<span style="color: #990000">&gt;</span> As you can see<span style="color: #990000">&lt;/</span>li<span style="color: #990000">&gt;</span>
<span style="color: #990000">&lt;</span>li<span style="color: #990000">&gt;</span> In <span style="font-weight: bold"><span style="color: #0000FF">this</span></span> example<span style="color: #990000">&lt;/</span>li<span style="color: #990000">&gt;</span>
<span style="color: #990000">&lt;/</span>ul<span style="color: #990000">&gt;,</span>
<span style="color: #990000">,</span> <span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_20">Discussion</h4>
<div class="paragraph"><p>There&#8217;s nothing special code has to do to become a Lift module, although there are common conventions: they typically are packaged as <em>net.liftmodules</em>, but don&#8217;t have to be; they usually depend on a version of Lift; they sometimes use the hooks provided by <span class="monospaced">LiftRules</span> to provide a particular behaviour.  Anyone can create and publish a Lift module, and anyone can contribute to existing modules. In the end, they are declared as dependencies in SBT, and pulled into your code just like any other dependency.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/moduleversioning.png" alt="images/moduleversioning.png">
</div>
</div>
<div class="paragraph"><p>The dependency version is made up of two elements: the Lift version, and the module version. This is because modules have their own release cycle, so you could have versions 1.1, 1.2 and 1.3 all for the same version of Lift. However, they may also depend on certain features of Lift, hence the combined version number.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_21">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
There&#8217;s no real specification of what Textile is, but there are references available which cover the typical kinds of mark up to enter and what HTML you can expect to see: <a href="http://redcloth.org/hobix.com/textile/">http://redcloth.org/hobix.com/textile/</a>.
</p>
</li>
<li>
<p>
<em>Lift in Action</em>, chapter 7 contains a Wiki example that uses the
Textile plugin.
</p>
</li>
<li>
<p>
The home of the Textile module: <a href="https://github.com/liftmodules/textile">
<a href="https://github.com/liftmodules/textile">https://github.com/liftmodules/textile</a></a>.
</p>
</li>
<li>
<p>
The unit tests for the Textile module give you a good set of examples of what is supported: <a href="https://github.com/liftmodules/textile/blob/master/src/test/scala/net/liftmodules/textile/TextileSpec.scala">https://github.com/liftmodules/textile/blob/master/src/test/scala/net/liftmodules/textile/TextileSpec.scala</a>.
</p>
</li>
<li>
<p>
<a href="http://www.liftmodules.net">http://www.liftmodules.net</a> describes the module system in Lift.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_forms_processing_in_lift">Forms Processing in Lift</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section gives examples of working with Lift forms in different
ways.</p></div>
<div class="sect2">
<h3 id="_plain_old_form_processing">Plain old form processing</h3>
<div class="sect3">
<h4 id="_problem_22">Problem</h4>
<div class="paragraph"><p>You want to process form data in a regular old-fashioned, non-Ajax, way.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_21">Solution</h4>
<div class="paragraph"><p>Extract form values with <span class="monospaced">S.param</span>. For example, we can show a form,
process an input value, and echo the value back out. Here we have
<span class="monospaced">dumbForm.html</span> which contains a form wrapped in a snippet:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:DumbForm"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;form</span></span>  <span style="color: #009900">action</span><span style="color: #990000">=</span><span style="color: #FF0000">"/dumbForm.html"</span> <span style="color: #009900">method</span><span style="color: #990000">=</span><span style="color: #FF0000">"post"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text"</span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"it"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"something"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"submit"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Go"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/form&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"result"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span> <span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Pick out the values in the snippet:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> code<span style="color: #990000">.</span>snippet

<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>common<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">DumbForm</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> inputParam <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">{</span>
    r <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> S<span style="color: #990000">.</span>request <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> r<span style="color: #990000">.</span>post<span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">?</span>  <span style="font-style: italic"><span style="color: #9A1900">// restricting to POST requests</span></span>
    v <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> <span style="font-weight: bold"><span style="color: #000000">S.param</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"it"</span><span style="color: #990000">)</span>
  <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">yield</span></span> v

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> inputParam <span style="font-weight: bold"><span style="color: #0000FF">match</span></span> <span style="color: #FF0000">{</span>
      <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">Full</span></span><span style="color: #990000">(</span>x<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Input is: "</span><span style="color: #990000">+</span>x<span style="color: #990000">)</span>
        <span style="color: #FF0000">"#result *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> x

      <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"No input present! Rendering input form HTML"</span><span style="color: #990000">)</span>
        PassThru
  <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>When you run this code you&#8217;ll see
<span class="monospaced">No input present! Rendering input form HTML</span> on the console, and when
you press "Go" you&#8217;ll see <span class="monospaced">Input is: something</span> and the "something" will
appear on the page.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_21">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">DumbForm</span> snippet extracts the input parameter using a for
comprehension. The result will be of type <span class="monospaced">Box[String]</span> which we then
match on to decide what to do next.</p></div>
<div class="paragraph"><p>In this example, we are also checking that the request is a POST request
before extracting the value of the <span class="monospaced">it</span> form parameter.</p></div>
<div class="paragraph"><p>Screen or Wizard provide alternatives for form processing, but sometimes
you just want to pull values from a request, as demonstrated in this
recipe.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_22">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<em>Simply Lift</em>, section 4.1,
<a href="http://simply.liftweb.net/index-4.1.html#toc-Section-4.1">Old Fashioned
Dumb Forms</a> and 4.9
<a href="http://stable.simply.liftweb.net/#toc-Section-4.9">But sometimes Old
Fashioned is good</a>.
</p>
</li>
<li>
<p>
<a href="https://github.com/marekzebrowski/lift-basics">Simple forms</a>, example
Lift project.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_ajax_form_processing">Ajax form processing</h3>
<div class="sect3">
<h4 id="_problem_23">Problem</h4>
<div class="paragraph"><p>You want to process a form on the server via Ajax, without reloading the
whole page.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_22">Solution</h4>
<div class="paragraph"><p>Mark your form as an Ajax form with <span class="monospaced">lift:form.ajax</span> and supply a
function to run on the server when the form is submitted. Given this
form&#8230;</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:AjaxExample"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;form</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:form.ajax"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text"</span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"info"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">""</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"submit"</span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"sb"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"go!"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/form&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"result"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/div&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>&#8230;we use the following snippet to accept the text field input of <span class="monospaced">info</span>
and send back a JavasScript command to update the <span class="monospaced">result</span> div with the
value sent to us:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> code<span style="color: #990000">.</span>snippet

<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>SHtml
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>js<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> JsCmds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>Text

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">AjaxExample</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">var</span></span> inputVal <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"default"</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">process</span></span><span style="color: #990000">()</span><span style="font-weight: bold"><span style="color: #0000FF">:</span></span> JsCmd <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Received: "</span><span style="color: #990000">+</span>inputVal<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">SetHtml</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"result"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">Text</span></span><span style="color: #990000">(</span>inputVal<span style="color: #990000">))</span>
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">"name=info"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">(</span>
        <span style="font-weight: bold"><span style="color: #000000">SHtml.text</span></span><span style="color: #990000">(</span>inputVal<span style="color: #990000">,</span> inputVal <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">)</span> <span style="color: #990000">++</span>
        <span style="font-weight: bold"><span style="color: #000000">SHtml.hidden</span></span><span style="color: #990000">(</span>process<span style="color: #990000">)</span> <span style="color: #990000">)</span>
  <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_22">Discussion</h4>
<div class="paragraph"><p>The form&#8217;s <span class="monospaced">info</span> input is bound to a <span class="monospaced">SHtml.text</span> box which will set
the local <span class="monospaced">inputVal</span> variable to the value submitted by the form.</p></div>
<div class="paragraph"><p>The hidden field instructs Lift to call the <span class="monospaced">() =&gt;âAny</span> function
(<span class="monospaced">process</span>, in this example) when the form is submitted. The end result
is the text entered is echoed back by setting the HTML node <span class="monospaced">result</span>.
There are many other <span class="monospaced">JsCmd`s you could send, including `Noop</span> if you
decide to send nothing.</p></div>
<div class="paragraph"><p>In <span class="monospaced">SHtml</span> you will see functions starting with "ajax" (e.g.,
<span class="monospaced">ajaxText</span>). These are great for field-level Ajax interactions, such as
triggering actions on input or selection changes.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_23">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<em>Simply Lift</em>, chapter 4.8
<a href="http://stable.simply.liftweb.net/#toc-Section-4.8">Ajax</a>.
</p>
</li>
<li>
<p>
Example <a href="https://github.com/marekzebrowski/lift-basics">simple forms</a>
Lift project.
</p>
</li>
<li>
<p>
<a href="http://www.assembla.com/spaces/liftweb/wiki/cool_tips">Server side
function order</a> on the Lift Cool Tips Wiki page.
*
<a href="http://scala-tools.org/mvnsites/liftweb-2.4/net/liftweb/http/SHtml.html">SHtml
Scala Doc</a>.
</p>
</li>
<li>
<p>
Lift&#8217;s <a href="http://demo.liftweb.net/ajax">Ajax Demo page</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_ajax_json_form_processing">Ajax JSON form processing</h3>
<div class="sect3">
<h4 id="_problem_24">Problem</h4>
<div class="paragraph"><p>You want to process a form via Ajax, sending the data in JSON format.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_23">Solution</h4>
<div class="paragraph"><p>Make use of Lift&#8217;s <span class="monospaced">jlift.js</span> Javascript and <span class="monospaced">JsonHandler</span> code.
Consider this HTML, which is not in a form, but includes <span class="monospaced">jlift.js</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:JsonForm"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>

 <span style="font-style: italic"><span style="color: #9A1900">&lt;!--  required for JSON forms processing --&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">src</span><span style="color: #990000">=</span><span style="color: #FF0000">"/classpath/jlift.js"</span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:tail"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span>

 <span style="font-style: italic"><span style="color: #9A1900">&lt;!--  placeholder script required to process the form --&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"jsonFormScript"</span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:tail"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/script&gt;</span></span>

 <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"formToJson"</span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"formToJson"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text"</span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"name"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Royal Society"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text"</span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"motto"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Nullius in verba"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"submit"</span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"sb"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"go!"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"result"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/div&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The server-side code to accept the input as JSON would be as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> code<span style="color: #990000">.</span>snippet

<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>js<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> JsCmds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">JsonForm</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
     <span style="color: #FF0000">"#formToJson"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">((</span>ns<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>NodeSeq<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">SHtml.jsonForm</span></span><span style="color: #990000">(</span>jsonHandler<span style="color: #990000">,</span> ns<span style="color: #990000">))</span> <span style="color: #990000">&amp;</span>
     <span style="color: #FF0000">"#jsonFormScript"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">Script</span></span><span style="color: #990000">(</span>jsonHandler<span style="color: #990000">.</span>jsCmd<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> jsonHandler <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> JsonHandler <span style="color: #FF0000">{</span>

      <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">apply</span></span><span style="color: #990000">(</span>in<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Any<span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">:</span></span> JsCmd <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> in <span style="font-weight: bold"><span style="color: #0000FF">match</span></span> <span style="color: #FF0000">{</span>
          <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">JsonCmd</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"processForm"</span><span style="color: #990000">,</span> target<span style="color: #990000">,</span> params<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Map<span style="color: #990000">[</span>String<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">],</span> all<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> name <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">params.getOrElse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"name"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"No Name"</span><span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> motto <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">params.getOrElse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"motto"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"No Motto"</span><span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #000000">SetHtml</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"result"</span><span style="color: #990000">,</span>
                <span style="font-weight: bold"><span style="color: #000000">Text</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"The motto of %s is %s"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span>motto<span style="color: #990000">))</span> <span style="color: #990000">)</span>

          <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
            <span style="font-weight: bold"><span style="color: #000000">SetHtml("result",Text</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Unknown command"</span><span style="color: #990000">))</span>
      <span style="color: #FF0000">}</span>

    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>If you click the go button and observe the network traffic, you&#8217;ll see
the following sent to the server:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span>
  <span style="color: #FF0000">"command"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"processForm"</span><span style="color: #990000">,</span>
  <span style="color: #FF0000">"params"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"name"</span><span style="color: #990000">:</span><span style="color: #FF0000">"Royal Society"</span><span style="color: #990000">,</span><span style="color: #FF0000">"motto"</span><span style="color: #990000">:</span><span style="color: #FF0000">"Nullius in verba"</span><span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The server will send back JavaScript to update the <span class="monospaced">results</span> div with
"The motto of the Royal Society is Nullius in verba".</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_23">Discussion</h4>
<div class="paragraph"><p>The key components in the example are:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">jlift.js</span> script that makes various JSON functions available; and
</p>
</li>
<li>
<p>
generated JavaScript code (<span class="monospaced">jsonHandler.jsCmd</span>) that is included on
the page to perform the actual submission.
</p>
</li>
</ol></div>
<div class="paragraph"><p>In the binding, <span class="monospaced">SHtml.jsonForm</span> takes the <span class="monospaced">jsonHandler</span> object which
will process the form elements, and wraps your template, <span class="monospaced">ns</span>, with a
<span class="monospaced">&lt;form&gt;</span> tag. We also bind the JavasScript required to the
<span class="monospaced">jsonFormScript</span> placeholder.</p></div>
<div class="paragraph"><p>When the form is submitted, the <span class="monospaced">JsonHandler.apply</span> allows us to pattern
match on the input and extract the values we need from a <span class="monospaced">Map</span>. Note
that compiling this code will produce a warning as <span class="monospaced">Map[String,_]</span> will
be "unchecked since it is eliminated by erasure".</p></div>
<div class="paragraph"><p>If you are implementing a REST service to process JSON, consider using
Rest helpers in Lift to do that.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_24">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.javabeat.net/2011/05/using-json-forms-with-ajax-in-lift-framework/">Using
JSON forms with AJAX in Lift Framework</a>.
</p>
</li>
<li>
<p>
<em>Lift in Action</em>, section 9.1.4 "Using JSON forms with AJAX".
</p>
</li>
<li>
<p>
Example Lift application demonstrating
<a href="https://github.com/marekzebrowski/lift-basics">Simple form</a> processing.
</p>
</li>
<li>
<p>
Section 10.4, JSON, in
<a href="http://exploring.liftweb.net/master/index-10.html">Exploring Lift</a>.
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Nullius_in_verba">Nullius in verba</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_conditionally_disable_a_checkbox">Conditionally disable a checkbox</h3>
<div class="sect3">
<h4 id="_problem_25">Problem</h4>
<div class="paragraph"><p>You want to add the <span class="monospaced">disabled</span> attribute to a <span class="monospaced">SHtml.checkbox</span> based on
a conditional check.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_24">Solution</h4>
<div class="paragraph"><p>Create a CSS selector transform to add the disabled attribute, and apply
it to your checkbox transform. For example, suppose you have a simple
checkbox:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Likes</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">var</span></span> likeTurtles <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> checkbox <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"*"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">SHtml.checkbox</span></span><span style="color: #990000">(</span>likeTurtles<span style="color: #990000">,</span> likeTurtles <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Further suppose you want to disable it roughly 50% of the time:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> disabler <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>math<span style="color: #990000">.</span>random <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">.</span>5d<span style="color: #990000">)</span> <span style="color: #FF0000">"* [disabled]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"disabled"</span>
 <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> PassThru

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> conditionallyDisabledCheckbox <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="color: #FF0000">"*"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">disabler</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #000000">SHtml.checkbox</span></span><span style="color: #990000">(</span>likeTurtles<span style="color: #990000">,</span> likeTurtles <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Using <span class="monospaced">lift:Likes.conditionallyDisabledCheckbox</span> the checkbox would be
disabled half the time.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_24">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">disabler</span> method returns a <span class="monospaced">NodeSeq=&gt;NodeSeq</span> function, meaning
when we apply it in <span class="monospaced">conditionallyDisabledCheckbox</span> we need to give it a
<span class="monospaced">NodeSeq</span>, which is exactly what <span class="monospaced">SHtml.checkbox</span> provides.</p></div>
<div class="paragraph"><p>The <span class="monospaced">[disabled]</span> part of the CSS selector is selecting the disabled
attribute and replacing it with the value on the right of the <span class="monospaced">#&gt;</span>,
which is "disabled" in this example.</p></div>
<div class="paragraph"><p>What this combination means is that half the time the disabled attribute
will be set on the checkbox, and half the time the checkbox <span class="monospaced">NodeSeq</span>
will be left untouched because <span class="monospaced">PassThru</span> does not change the <span class="monospaced">NodeSeq</span>.</p></div>
<div class="paragraph"><p>The example above separates the test from the checkbox only to make it
easier to write this discussion section. You can of course in-line the
test, as is done in the mailing list post referenced below.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_25">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Mailing list question regarding
<a href="https://groups.google.com/d/topic/liftweb/KBVhkuM1NQQ/discussion">how to
conditionally mark a SHtml.checkbox as disabled</a>.
</p>
</li>
<li>
<p>
<em>Simply Lift</em> <a href="http://simply.liftweb.net/index-7.10.html">7.10 CSS
Selector Transforms</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_use_a_select_box_with_multiple_options">Use a select box with multiple options</h3>
<div class="sect3">
<h4 id="_problem_26">Problem</h4>
<div class="paragraph"><p>You want to show the user a number of options in a select box, and allow
them to select multiple values.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_25">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">SHtml.multiSelect</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MySnippet</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> multi <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Item</span><span style="color: #990000">(</span>id<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">,</span> name<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> inventory <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Item</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Coffee"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #000000">Item</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"b"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Milk"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span>
       <span style="font-weight: bold"><span style="color: #000000">Item</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"c"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Sugar"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span>

     <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> options <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #000000">List[</span></span><span style="color: #990000">(</span>String<span style="color: #990000">,</span>String<span style="color: #990000">)]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
       <span style="font-weight: bold"><span style="color: #000000">inventory.map</span></span><span style="color: #990000">(</span>i <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">.</span>id <span style="color: #990000">-&gt;</span> i<span style="color: #990000">.</span>name<span style="color: #990000">))</span>

     <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> default <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> inventory<span style="color: #990000">.</span>head<span style="color: #990000">.</span>id <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span>

     <span style="color: #FF0000">"#opts *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span>
       <span style="font-weight: bold"><span style="color: #000000">SHtml.multiSelect</span></span><span style="color: #990000">(</span>options<span style="color: #990000">,</span> default<span style="color: #990000">,</span> xs <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Selected: "</span><span style="color: #990000">+</span>xs<span style="color: #990000">))</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The corresponding template would be:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:MySnippet.multi?form=post"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>What can I getcha?<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"opts"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>options go here<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"submit"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Submit"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>This will render as something like:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;form</span></span> <span style="color: #009900">action</span><span style="color: #990000">=</span><span style="color: #FF0000">"/"</span> <span style="color: #009900">method</span><span style="color: #990000">=</span><span style="color: #FF0000">"post"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;div&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>What can I getcha?<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"opts"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;select</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"F25749422319ALP1BW"</span> <span style="color: #009900">multiple</span><span style="color: #990000">=</span><span style="color: #FF0000">"true"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;option</span></span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"a"</span> <span style="color: #009900">selected</span><span style="color: #990000">=</span><span style="color: #FF0000">"selected"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Coffee<span style="font-weight: bold"><span style="color: #0000FF">&lt;/option&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;option</span></span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"b"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Milk<span style="font-weight: bold"><span style="color: #0000FF">&lt;/option&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;option</span></span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"c"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Sugar<span style="font-weight: bold"><span style="color: #0000FF">&lt;/option&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;/select&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Submit"</span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"submit"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/form&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_25">Discussion</h4>
<div class="paragraph"><p>Recall that an HTML select consists of a set of options, each of which
has a value and a name. To reflect this, the above examples takes our
<span class="monospaced">inventory</span> of objects and turns it into a list of (value,name) string
pairs, called <span class="monospaced">options</span>.</p></div>
<div class="paragraph"><p>The function given to <span class="monospaced">multiSelect</span> will receive the values (ids), not
the names, of the options. That is, if you ran the above code, and
selected "Coffee" and "Milk" the function would see <span class="monospaced">List("a", "b")</span>.</p></div>
<div class="sect4">
<h5 id="_selected_no_options">Selected no options</h5>
<div class="paragraph"><p>Be aware if no options are selected at all, your handling function is
not called. This is described in ticket 1139. One way to work around
this to to add a hidden function to reset the list. For example, we
could modify the above code to be a stateful snippet and remember the
values we selected:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MySnippet</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> StatefulSnippet <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> dispatch <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"multi"</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> multi
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Item</span><span style="color: #990000">(</span>id<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">,</span> name<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> inventory <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Item</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Coffee"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #000000">Item</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"b"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Milk"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span>
    <span style="font-weight: bold"><span style="color: #000000">Item</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"c"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Sugar"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span>

  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> options <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #000000">List[</span></span><span style="color: #990000">(</span>String<span style="color: #990000">,</span>String<span style="color: #990000">)]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">inventory.map</span></span><span style="color: #990000">(</span>i <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">.</span>id <span style="color: #990000">-&gt;</span> i<span style="color: #990000">.</span>name<span style="color: #990000">))</span>

  <span style="font-weight: bold"><span style="color: #0000FF">var</span></span> current <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> inventory<span style="color: #990000">.</span>head<span style="color: #990000">.</span>id <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> multi <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"#opts *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">(</span>
    <span style="font-weight: bold"><span style="color: #000000">SHtml.hidden(</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> current <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">)</span> <span style="color: #990000">++</span>
    <span style="font-weight: bold"><span style="color: #000000">SHtml.multiSelect</span></span><span style="color: #990000">(</span>options<span style="color: #990000">,</span> current<span style="color: #990000">,</span> current <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">)</span>
  <span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Each time the form is submited the <span class="monospaced">current</span> list of IDs is set to
whatever you have selected in the browser. But note that we have started
with a hidden function that resets <span class="monospaced">current</span> to the empty list, meaning
that if the receiving function in <span class="monospaced">multiSelect</span> is never called, that
would mean you have nothing selected. That may be useful, depending on
what behaviour you need in your application.</p></div>
</div>
<div class="sect4">
<h5 id="_type_safe_options">Type-safe options</h5>
<div class="paragraph"><p>If you don&#8217;t want to work in terms of <span class="monospaced">String</span> values for an option, you
can use <span class="monospaced">multiSelectObj</span>. In this variation the list of options still
provides a text name, but the value is in terms of a class. Likewise,
the list of default values will be a list of class instances:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> options <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #000000">List[</span></span><span style="color: #990000">(</span>Item<span style="color: #990000">,</span>String<span style="color: #990000">)]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">inventory.map</span></span><span style="color: #990000">(</span>i <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">-&gt;</span> i<span style="color: #990000">.</span>name<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> current <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> inventory<span style="color: #990000">.</span>head <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span></tt></pre></div></div>
<div class="paragraph"><p>The call to generate the multi-select from this data is similar, but
note that the function receives a list of <span class="monospaced">Item</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">"#opts *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">SHtml.multiSelectObj</span></span><span style="color: #990000">(</span>options<span style="color: #990000">,</span> current<span style="color: #990000">,</span>
  <span style="color: #990000">(</span>xs<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> List<span style="color: #990000">[</span>Item<span style="color: #990000">])</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Got "</span><span style="color: #990000">+</span>xs<span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect4">
<h5 id="_enumerations">Enumerations</h5>
<div class="paragraph"><p>You can use <span class="monospaced">multiSelectObj</span> with enumerations:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Item <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Enumeration <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">type</span></span> Item <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Value
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> Coffee<span style="color: #990000">,</span> Milk<span style="color: #990000">,</span> Sugar <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Value
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> Item<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> options <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #000000">List[</span></span><span style="color: #990000">(</span>Item<span style="color: #990000">,</span>String<span style="color: #990000">)]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="font-weight: bold"><span style="color: #000000">Item.values.toList.map</span></span><span style="color: #990000">(</span>i <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">-&gt;</span> i<span style="color: #990000">.</span>toString<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">var</span></span> current <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Item<span style="color: #990000">.</span>Coffee <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> multi <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"#opts *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">SHtml.multiSelectObj[Item]</span></span><span style="color: #990000">(</span>options<span style="color: #990000">,</span> current<span style="color: #990000">,</span>
  xs <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Got "</span><span style="color: #990000">+</span>xs<span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_26">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<em>Exploring Lift</em>, Chapter 6,
<a href="http://exploring.liftweb.net/master/index-6.html">Forms in Lift</a>.
</p>
</li>
<li>
<p>
<a href="https://www.assembla.com/spaces/liftweb/tickets/1139">Ticket 1139</a>,
Cannot clear out multiselect.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest">REST</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dry_urls">DRY URLs</h3>
<div class="sect3">
<h4 id="_problem_27">Problem</h4>
<div class="paragraph"><p>You found yourself repeating parts of URL paths in your RestHelper, and
you Don&#8217;t want to Repeat Yourself.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_26">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">prefix</span> in your RestHelper:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">object</span></span> RestAPI <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> RestHelper <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #000000">serve</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"bugs"</span> <span style="color: #990000">/</span> <span style="color: #FF0000">"by-state"</span> prefix <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"open"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> JsonGet <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">&lt;</span>p<span style="color: #990000">&gt;</span>None open<span style="color: #990000">&lt;/</span>p<span style="color: #990000">&gt;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"closed"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> JsonGet <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">&lt;</span>p<span style="color: #990000">&gt;</span>None closed<span style="color: #990000">&lt;/</span>p<span style="color: #990000">&gt;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> state <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> JsonDelete <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">&lt;</span>p<span style="color: #990000">&gt;</span>All deleted<span style="color: #990000">&lt;/</span>p<span style="color: #990000">&gt;</span>
  <span style="color: #FF0000">}</span><span style="color: #990000">)</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_26">Discussion</h4>
<div class="paragraph"><p>You can have many <span class="monospaced">serve</span> blocks in your <span class="monospaced">RestHelper</span>, which helps give
your REST service structure.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_27">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://simply.liftweb.net/index-5.3.html">RestHelper</a>, section 5.3 of
<em>Simply Lift</em>.
</p>
</li>
<li>
<p>
Wiki page on
<a href="http://www.assembla.com/spaces/liftweb/wiki/REST_Web_Services">REST Web
Services</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_google_sitemap">Google Sitemap</h3>
<div class="sect3">
<h4 id="_problem_28">Problem</h4>
<div class="paragraph"><p>You want to make a Google Sitemap using Lift&#8217;s rendering capabilities.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_27">Solution</h4>
<div class="paragraph"><p>Simply create a file (e.g. <span class="monospaced">sitemap.html</span>) in your <span class="monospaced">webapp</span> folder with
a valid XML-Sitemap markup:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"&gt;
&lt;lift:MySitemapContent.base&gt;
    &lt;url&gt;
        &lt;loc&gt;&lt;/loc&gt;
        &lt;changefreq&gt;daily&lt;/changefreq&gt;
        &lt;priority&gt;1.0&lt;/priority&gt;
        &lt;lastmod&gt;&lt;/lastmod&gt;
    &lt;/url&gt;
&lt;/lift:MySitemapContent.base&gt;
&lt;lift:MySitemapContent.list&gt;
    &lt;url&gt;
        &lt;loc&gt;&lt;/loc&gt;
        &lt;lastmod&gt;&lt;/lastmod&gt;
    &lt;/url&gt;
&lt;/lift:MySitemapContent.list&gt;
&lt;/urlset&gt;</pre>
</div></div>
<div class="paragraph"><p>Make a snippet to fill the required gaps:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MySitemapContent</span> <span style="color: #990000">\</span><span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">lazy</span></span> <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> entries <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">MyDBRecord.findAll</span></span><span style="color: #990000">(..)</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> base<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> CssSel <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
    <span style="color: #FF0000">"loc *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"http://%s/"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span>S<span style="color: #990000">.</span>hostName<span style="color: #990000">)</span> <span style="color: #990000">&amp;</span>
    <span style="color: #FF0000">"lastmod *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">someDate.toString</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"yyyy-MM-dd'T'HH:mm:ss.SSSZZ"</span><span style="color: #990000">)</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> list<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> CssSel <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
    <span style="color: #FF0000">"url *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">entries.map</span></span><span style="color: #990000">(</span>post <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
    <span style="color: #FF0000">"loc *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"http://%s%s"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span>S<span style="color: #990000">.</span>hostName<span style="color: #990000">,</span> post<span style="color: #990000">.</span>url<span style="color: #990000">)</span> <span style="color: #990000">&amp;</span>
    <span style="color: #FF0000">"lastmod *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">post.date.toString</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"yyyy-MM-dd'T'HH:mm:ss.SSSZZ"</span><span style="color: #990000">))</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Note that Google Sitemaps need dates to be in ISO 8601 format. The built-in`java.text.SimpleDateFormat`does not support this format prior to Java 7. If you are using Java 6 you need to use`org.joda.time.DateTime`.
With Java 7 "yyyy-MM-dd&#8217;T'HH:mmXXX" can be used as the pattern for the
formatting.</p></div>
<div class="paragraph"><p>We could run this template through Lift&#8217;s default HTML render engine and
simply add it to Lift&#8217;s own Sitemap, but we want our valid XML to be
delivered as XML rather than HTML. So instead we will use <span class="monospaced">RestHelper</span>
to return a <span class="monospaced">XmlResponse</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>rest<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> MySitemap <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> RestHelper <span style="color: #FF0000">{</span>
  serve <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">Req</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"sitemap"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> GetRequest<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #000000">XmlResponse(S.render</span></span><span style="color: #990000">(&lt;</span>lift<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>embed what<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"sitemap"</span> <span style="color: #990000">/&gt;,</span>
       S<span style="color: #990000">.</span>request<span style="color: #990000">.</span>get<span style="color: #990000">.</span>request<span style="color: #990000">).</span>head<span style="color: #990000">)</span>
    <span style="color: #FF0000">}</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Wire this into your application in <span class="monospaced">Boot.scala</span>, for example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.statelessDispatchTable.append</span></span><span style="color: #990000">(</span>code<span style="color: #990000">.</span>lib<span style="color: #990000">.</span>MySitemap<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Test this service using a tool like cURL:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">\</span>$ curl http<span style="font-weight: bold"><span style="color: #0000FF">:</span></span><span style="font-style: italic"><span style="color: #9A1900">//127.0.0.1:8080/sitemap</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_28">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://support.google.com/webmasters/bin/answer.py?hl=en&amp;answer=156184">About
Google Sitemaps</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_missing_file_suffix">Missing file suffix</h3>
<div class="sect3">
<h4 id="_problem_29">Problem</h4>
<div class="paragraph"><p>Your RestHelper expects a filename as part of the URL, but the suffix
(extension) is missing, and you need it.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_28">Solution</h4>
<div class="paragraph"><p>Access <span class="monospaced">req.path.suffix</span> to recover the suffix. For example, when
processing <span class="monospaced">/download/123.png</span> you want to be able reconstruct
<span class="monospaced">123.png</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">reunite</span></span><span style="color: #990000">(</span>name<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">,</span> suffix<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>suffix<span style="color: #990000">.</span>isEmpty<span style="color: #990000">)</span> name <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> name<span style="color: #990000">+</span><span style="color: #FF0000">"."</span><span style="color: #990000">+</span>suffix

serve <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"download"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> name <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> Get req <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #000000">Text</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"You requested "</span><span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #000000">reunite</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> req<span style="color: #990000">.</span>path<span style="color: #990000">.</span>suffix<span style="color: #990000">))</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Requesting this URL with a command like cURL will show you the filename
as expected:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>\$ curl http://127.0.0.1:8080/download/123.png
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
You requested 123.png</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_discussion_27">Discussion</h4>
<div class="paragraph"><p>When Lift parses a request it splits the request into constituent parts
(e.g., turning the path into a <span class="monospaced">List[String]</span>), and this includes a
separation of some suffixes. This is great for pattern matching when you
want to change behaviour based on the suffix, but a hinderance in this
particular situation.</p></div>
<div class="paragraph"><p>Only those suffixes defined in <span class="monospaced">LiftRules.explicitlyParsedSuffixes</span> are
split from the filename. This includes many of the common file suffixes
(such as "png", "atom", "json") and also some you may not be so familiar
with, such as "com". That last one is the cause of URLs that contain
email addresses being split from "user@example.org" into "user@example"
and a suffix of "com".</p></div>
<div class="paragraph"><p>You can modify <span class="monospaced">LiftRules.explicitlyParsedSuffixes</span> to be whatever set
of values you want.</p></div>
<div class="paragraph"><p>Note that if the suffix is not in <span class="monospaced">explicitlyParsedSuffixes</span>, the suffix
will be an empty String and the <span class="monospaced">name</span> (in the above example) will be
the file name with the suffix still attached.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_29">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Source for
<a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/HttpHelpers.scala">HttpHelpers.scala</a>
where you can find the default list of known suffixes.
</p>
</li>
<li>
<p>
Mailing list discussion
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/zj8kazJPzmI">RestHelper
GET strips off .com when GETting email as parameter with .com address</a>.
</p>
</li>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/h5-LdtRDfiw">REST
helper: how to get file extension</a> mailing list discussion.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_failing_to_match_on_a_file_suffix">Failing to match on a file suffix</h3>
<div class="sect3">
<h4 id="_problem_30">Problem</h4>
<div class="paragraph"><p>You&#8217;re trying to match on a file suffix (extension), but your match is
failing.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_29">Solution</h4>
<div class="paragraph"><p>Ensure the suffix you&#8217;re matching on is included in
<span class="monospaced">LiftRules.explicitlyParsedSuffixes</span>.</p></div>
<div class="paragraph"><p>As an example, perhaps you want to match anything ending in <span class="monospaced">.csv</span> at
your <span class="monospaced">/reports/</span> URL:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">Req</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"reports"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> name <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">,</span> <span style="color: #FF0000">"csv"</span><span style="color: #990000">,</span> GetRequest<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #000000">Text</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Here's your CSV report for "</span><span style="color: #990000">+</span>name<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>You&#8217;re expecting <span class="monospaced">/reports/foo.csv</span> to produce "Here&#8217;s your CSV report
for foo", but you get a 404.</p></div>
<div class="paragraph"><p>In <span class="monospaced">Boot.scala</span> add the following:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftRules<span style="color: #990000">.</span>explicitlyParsedSuffixes <span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"csv"</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_28">Discussion</h4>
<div class="paragraph"><p>This is the flip side of the <em>Missing file suffix</em> recipe: Lift only
splits out the suffixes it knows about in
<span class="monospaced">LiftRules.explicitlyParsedSuffixes</span>.</p></div>
<div class="paragraph"><p>Without adding ".csv" to the <span class="monospaced">explicitlyParsedSuffixes</span>, the example URL
would match with&#8230;</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">Req</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"reports"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> name <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">,</span> GetRequest<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #990000">...</span></tt></pre></div></div>
<div class="paragraph"><p>&#8230;with <span class="monospaced">name</span> set to "foo.csv" not "foo".</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_30">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="Missing+file+suffix.html">Missing file suffix</a> recipe.
</p>
</li>
<li>
<p>
<a href="https://groups.google.com/d/topic/liftweb/UwZQ8f2MmLE/discussion">REST
Requst suffix matching</a> mailing list discussion.
</p>
</li>
<li>
<p>
<a href="http://simply.liftweb.net/index-5.2.html">REST the hard way</a>, section
5.2 of <em>Simply Lift</em>.
</p>
</li>
<li>
<p>
<a href="http://simply.liftweb.net/index-5.3.html">Making it easier with
RestHelper</a>, section 5.3 of <em>Simply Lift</em>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_accept_binary_data_in_a_rest_service">Accept binary data in a REST service</h3>
<div class="sect3">
<h4 id="_problem_31">Problem</h4>
<div class="paragraph"><p>You want to accept an image upload or other binary data in your RESTful
service.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_30">Solution</h4>
<div class="paragraph"><p>Access the request body in your rest helper:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>rest<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> MyUpload <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> RestHelper <span style="color: #FF0000">{</span>
  serve <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"upload"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> Post req <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">{</span>
        bodyBytes <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> req<span style="color: #990000">.</span>body <span style="color: #990000">?~</span> <span style="color: #FF0000">"No Body Bytes"</span>
      <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">yield</span></span> <span style="color: #990000">&lt;</span>b<span style="color: #990000">&gt;</span>got an image of <span style="color: #FF0000">{</span>bodyBytes<span style="color: #990000">.</span>length<span style="color: #FF0000">}</span> bytes<span style="color: #990000">&lt;/</span>b<span style="color: #990000">&gt;</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Wire this into your application in <span class="monospaced">Boot.scala</span>, for example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.statelessDispatchTable.append</span></span><span style="color: #990000">(</span>code<span style="color: #990000">.</span>lib<span style="color: #990000">.</span>MyUpload<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Test this service using a tool like cURL:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">\</span>$ curl <span style="color: #990000">-</span>X POST <span style="color: #990000">--</span>data<span style="color: #990000">-</span>binary <span style="color: #FF0000">"@dog.jpg"</span> <span style="color: #990000">\</span>
  <span style="color: #990000">-</span>H <span style="color: #FF0000">'Content-Type: image/jpg'</span> http<span style="font-weight: bold"><span style="color: #0000FF">:</span></span><span style="font-style: italic"><span style="color: #9A1900">//127.0.0.1:8080/upload</span></span>
<span style="color: #990000">&lt;?</span>xml version<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"1.0"</span> encoding<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"UTF-8"</span><span style="color: #990000">?&gt;</span>
<span style="color: #990000">&lt;</span>b<span style="color: #990000">&gt;</span>got an image of <span style="color: #993399">43685</span> bytes<span style="color: #990000">&lt;/</span>b<span style="color: #990000">&gt;</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_29">Discussion</h4>
<div class="paragraph"><p>In the above example the binary data is accessed via the <span class="monospaced">req.body</span>,
yielding a <span class="monospaced">Box[LiftResponse]</span> which in this case is XML.</p></div>
<div class="paragraph"><p>In the case where there is no body, a 404 would be returned with a text
body of "No Body Bytes".</p></div>
<div class="paragraph"><p>Note that web containers, such as Jetty and Tomcat, may place limits on
the size of an upload. You will recognise this situation by an error
such as "java.lang.IllegalStateException: Form too large705784&gt;200000".
Check with documentation for the container for changing these limits.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_31">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/6MnWRPP3TcU">Mailing
list discussion</a> including code for restricting a request based on mime
type.
</p>
</li>
<li>
<p>
<a href="http://stackoverflow.com/questions/3861455/form-too-large-exception">Form
too large in Jetty</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_returning_json">Returning JSON</h3>
<div class="sect3">
<h4 id="_problem_32">Problem</h4>
<div class="paragraph"><p>You want to return JSON from a REST call.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_31">Solution</h4>
<div class="paragraph"><p>Use the JSON DSL. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> code<span style="color: #990000">.</span>lib

<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>rest<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>json<span style="color: #990000">.</span>JObject
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>json<span style="color: #990000">.</span>JsonDSL<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> QuotationAPI <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> RestHelper <span style="color: #FF0000">{</span>

 serve <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"quotation"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> JsonGet <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
   <span style="color: #990000">(</span><span style="color: #FF0000">"text"</span> <span style="color: #990000">-&gt;</span> <span style="color: #FF0000">"A beach house isn't just real estate. It's a state of mind."</span><span style="color: #990000">)</span> <span style="color: #990000">~</span>
   <span style="color: #990000">(</span><span style="color: #FF0000">"by"</span> <span style="color: #990000">-&gt;</span> <span style="color: #FF0000">"Douglas Adams"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> JObject
 <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Wire this into <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.statelessDispatch.append</span></span><span style="color: #990000">(</span>code<span style="color: #990000">.</span>lib<span style="color: #990000">.</span>QuotationAPI<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Running this example produces:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ curl -H 'Content-type: text/json' http://127.0.0.1:8080/quotation
{
  "text":"A beach house isn't just real estate. It's a state of mind.",
  "by":"Douglas Adams"
}</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_discussion_30">Discussion</h4>
<div class="paragraph"><p>The "type ascription" at the end of the JSON expression (<span class="monospaced">: JObject</span>)
tells the compiler that the expression is expected to be of type
<span class="monospaced">JObject</span>. This is required to allow the DSL to work. If would not be
required if, for example, you were calling a function that was defined
to return a <span class="monospaced">JObject</span>.</p></div>
<div class="paragraph"><p>The JSON DSL allows you to created nested structures, lists and
everything else you expect of JSON. The <em>Readme</em> in the <em>See Also</em>
section is a great place to read about the library.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_32">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
The <a href="https://github.com/lift/framework/tree/master/core/json">Lift JSON
Readme</a> is a great source of documentation and examples of using the
JSON package in Lift.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javascript_ajax_comet">Javascript, Ajax, Comet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_trigger_server_side_code_from_a_button_press">Trigger server-side code from a button press</h3>
<div class="sect3">
<h4 id="_problem_33">Problem</h4>
<div class="paragraph"><p>You want to trigger some server-side code when the user presses a
button.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_32">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">ajaxInvoke</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>SHtml
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>js<span style="color: #990000">.</span>JsCmds

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MySnippet</span> <span style="color: #FF0000">{</span>

 <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> easy <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"#myButton [onclick]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">SHtml.ajaxInvoke(</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"click"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">JsCmds.Alert</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hi"</span><span style="color: #990000">)</span>
    <span style="color: #FF0000">}</span> <span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In this snippet we are binding the click event of a button with the id
of "myButton" to an <span class="monospaced">ajaxInvoke</span>: when the button is pressed, Lift
arranges for the function you gave <span class="monospaced">ajaxInvoke</span> to be executed.</p></div>
<div class="paragraph"><p>In this example, we are printing "click" to the console and returning a
JavaScript alert dialog. The corresponding HTML might be:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:MySnippet.easy"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;button</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"myButton"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Click me<span style="font-weight: bold"><span style="color: #0000FF">&lt;/button&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_31">Discussion</h4>
<div class="paragraph"><p>The signature of the function you pass to <span class="monospaced">ajaxInvoke</span> is
<span class="monospaced">Unit =&gt; JsCmd</span>, meaning you can trigger a range of behaviours, from
returning <span class="monospaced">Noop</span> if you want nothing to happen, through changing DOM
element, all the way up to executing arbitrary JavaScript.</p></div>
<div class="paragraph"><p>The example above is using a button, but will work on any element that
has an event you can bind to.</p></div>
<div class="paragraph"><p>Related to <span class="monospaced">ajaxInvoke</span> are the following functions:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">SHtml.onEvent</span>, which has the signature <span class="monospaced">String =&gt; JsCmd</span> because it
is passed the <span class="monospaced">value</span> of the node it is attached to. In the above
example, this would be the empty string as the button has no value.
</p>
</li>
<li>
<p>
<span class="monospaced">SHtml.ajaxCall</span> which is more general than <span class="monospaced">onEvent</span>, as you give it
the expression you want passed to your server-side code.
</p>
</li>
<li>
<p>
<span class="monospaced">SHtml.jsonCall</span> which is even more general: you give it a function
that will return a JSON object when executed on the client, and this
object will be passed to your server-side function.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_see_also_33">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
The "<a href="http://blog.fmpwizard.com/scala-lift-custom-wizard">Call Scala
code from JavaScript</a>" section of a blog post from Diego Medina.
</p>
</li>
<li>
<p>
<a href="http://exploring.liftweb.net/onepage/index.html#toc-Section-11">AJAX
and Comment in Lift</a> in <em>Exploring Lift</em>.
</p>
</li>
<li>
<p>
Chapter 9 of <em>Lift in Action</em>.
</p>
</li>
<li>
<p>
<em>Simply Lift</em> on
<a href="http://simply.liftweb.net/index-4.8.html#toc-Section-4.8">Ajax</a>.
</p>
</li>
<li>
<p>
Mailing list discussion on the
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/N7ttFlumvuk">easiest
way to trigger server-side Scala code</a>.
</p>
</li>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/uAgy21xOMRs">Bind
a button click with SHtml.onEvent</a> mailing list thread.
</p>
</li>
<li>
<p>
<a href="https://github.com/lift/framework/blob/master/web/webkit/src/main/scala/net/liftweb/http/SHtml.scala">SHtml.scala source code</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_set_up_client_side_actions_from_your_scala_code">Set up client-side actions from your Scala code</h3>
<div class="sect3">
<h4 id="_problem_34">Problem</h4>
<div class="paragraph"><p>In your Lift code you want to set up a action that is run purely in
client-side JavaScript.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_33">Solution</h4>
<div class="paragraph"><p>Bind the appropriate event hander with Javascript. Here&#8217;s an example
where we make a button slowly fade away when you press it, but notice
that we&#8217;re setting up this binding in our server-side Lift code:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HelloWorld</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> buttonBind <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
    <span style="color: #FF0000">"#button [onclick]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #FF0000">"$('#button').fadeOut('slow')"</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In the template we&#8217;d perhaps say:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;form</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:HelloWorld.buttonBind"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"button"</span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"button"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Click me"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/form&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Lift will render the page as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;form&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;input</span></span> <span style="color: #009900">onclick</span><span style="color: #990000">=</span><span style="color: #FF0000">"$('#button').fadeOut('slow')"</span>
    <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Click me"</span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"button"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"button"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/form&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_32">Discussion</h4>
<div class="paragraph"><p>Lift includes a JavaScript abstraction which you can use to build up
more elaborate expressions for the client-side. For example you can
combine basic commands:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> buttonBind <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="color: #FF0000">"#button [onclick]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">(</span>
     <span style="font-weight: bold"><span style="color: #000000">Alert</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Here we go..."</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;</span> <span style="font-weight: bold"><span style="color: #000000">RedirectTo</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"http://liftweb.net"</span><span style="color: #990000">)</span>
    <span style="color: #990000">).</span>toJsCmd</tt></pre></div></div>
<div class="paragraph"><p>&#8230;which pops up an alert dialog and then sends you to liftweb.net.
<em>Exploring Lift</em> gives a good summary of the commands available to you.</p></div>
<div class="paragraph"><p>Another option is to use <span class="monospaced">JE.Call</span> to execute a Javascript function with
parameters. Suppose we have this function defined:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">greet</span></span><span style="color: #990000">(</span>who<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #000000">alert</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello "</span><span style="color: #990000">+</span>who<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>We could bind a client-side button press to this client-side function
like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> buttonBind <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="color: #FF0000">"#button [onclick]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">JE.Call</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"greet"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"you"</span><span style="color: #990000">).</span>toJsCmd</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_34">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
The <a href="https://groups.google.com/d/msg/liftweb/uAgy21xOMRs/bDjS69VWpp4J">mailing list discussion</a> that suggested this.
</p>
</li>
<li>
<p>
<a href="http://exploring.liftweb.net/master/index-10.html#toc-Chapter-10">Chapter 10</a> of <em>Exploring Lift</em>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_focus_on_a_field_on_page_load">Focus on a field on page load</h3>
<div class="sect3">
<h4 id="_problem_35">Problem</h4>
<div class="paragraph"><p>When a page loads you want the browser to select a particular field for
input focus from the user&#8217;s keyboard.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_34">Solution</h4>
<div class="paragraph"><p>Wrap your snippet with <span class="monospaced">FocusOnLoad</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>js<span style="color: #990000">.</span>JsCmds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="color: #990000">...</span>
<span style="color: #FF0000">"name=username"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">FocusOnLoad(SHtml.text</span></span><span style="color: #990000">(</span>username<span style="color: #990000">,</span> username <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>The above will match against <span class="monospaced">name="username"</span> element in the HTML and
replace it with a text input field that will be focused on automatically
when the page loads.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_33">Discussion</h4>
<div class="paragraph"><p><span class="monospaced">FocusOnLoad</span> is an example of a <span class="monospaced">NodeSeq =&gt; NodeSeq</span> transformation. In
this case, it takes the result of <span class="monospaced">SHtml.text</span> and appends it with the
JavasScript required to set focus on that field. The example uses
<span class="monospaced">SHtml.text</span> but it could be any <span class="monospaced">NodeSeq</span>.</p></div>
<div class="paragraph"><p>Related classes are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Focus</span>, which takes an element id and sets focus on the element via a
<span class="monospaced">JsCmd</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">SetValueAndFocus</span> which is like <span class="monospaced">Focus</span> but takes an additional
<span class="monospaced">String</span> value to set on the element.
</p>
</li>
</ul></div>
<div class="paragraph"><p>These two are useful if you need to set focus from Ajax or Comet
components, or any JavaScript Lift response.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_35">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://exploring.liftweb.net/master/index-10.html#toc-Chapter-10">Lift
and JavaScript</a>, <em>Exploring Lift</em>, chapter 10.
</p>
</li>
<li>
<p>
<a href="http://groups.google.com/group/liftweb/browse_thread/thread/c513317f7b01b40a/a95a0426c7e17a46?lnk=gst&amp;q=FocusOnLoad#">FocusOnLoad
for fields you&#8217;re creating in a snippet</a>
</p>
</li>
<li>
<p>
<a href="http://groups.google.com/group/liftweb/browse_thread/thread/541e6f3a156ccc47/fc501899e7537290?lnk=gst&amp;q=FocusOnLoad#fc501899e7537290">FocusOnLoad
in LiftScreen</a>
</p>
</li>
<li>
<p>
<a href="http://stackoverflow.com/questions/3852122/how-do-i-keep-focus-on-a-textbox-using-lift-the-scala-framework">How
do I keep focus on a textbox?</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/lift/framework/blob/master/web/webkit/src/main/scala/net/liftweb/http/js/JsCommands.scala">JsCommands.scala
source</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_add_css_class_to_an_ajax_form">Add CSS class to an Ajax Form</h3>
<div class="sect3">
<h4 id="_problem_36">Problem</h4>
<div class="paragraph"><p>You want to set the CSS class of an AJAX form.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_35">Solution</h4>
<div class="paragraph"><p>Name the class via <span class="monospaced">?class=</span> query parameter:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;form</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:form.ajax?class=myClass"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
...
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/form&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_34">Discussion</h4>
<div class="paragraph"><p>If you need to set multiple CSS classes, encode a space between the
class names, e.g., <span class="monospaced">class=myClass%20anotherClass</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_36">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<em>Simply Lift</em> on <a href="http://simply.liftweb.net/index-4.8.html">Ajax</a>.
</p>
</li>
<li>
<p>
Mailing list on <a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/EEINT9t8Wd4">Attaching
CSS class to ajax form using designer friendly template doesn&#8217;t work</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_show_a_template_inside_a_page_dynamically">Show a template inside a page dynamically</h3>
<div class="sect3">
<h4 id="_problem_37">Problem</h4>
<div class="paragraph"><p>You want to load an entire page with template and snippets inside of
another template on the fly (i.e., without a browser refresh).</p></div>
</div>
<div class="sect3">
<h4 id="_solution_36">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">Template</span> to load the template, and <span class="monospaced">SetHtml</span> to place the content
on the page.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> code<span style="color: #990000">.</span>snippet

<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> js<span style="color: #990000">.</span>JsCmds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MySnippet</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> sendContent <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Templates</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"some"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #FF0000">"page"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">).</span>
    <span style="font-weight: bold"><span style="color: #000000">map</span></span><span style="color: #990000">(</span>ns <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">SetHtml</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"here"</span><span style="color: #990000">,</span> ns<span style="color: #990000">))</span> openOr Noop

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> render <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"name=clickme [onclick]"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">SHtml.ajaxInvoke</span></span><span style="color: #990000">(</span>sendContent <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Combine this with:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:MySnippet"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;button</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"clickme"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Click Me<span style="font-weight: bold"><span style="color: #0000FF">&lt;/button&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"here"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Content will appear here<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Clicking the button will cause the content of <span class="monospaced">/some/page.html</span> to be
loaded into the <span class="monospaced">here</span> div.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_35">Discussion</h4>
<div class="paragraph"><p><span class="monospaced">Templates</span> produces a <span class="monospaced">Box[NodeSeq]</span>, the contents of which are mapped
to a <span class="monospaced">JsCmd</span> which is sent back to the browser to put the contents of
the page into the div.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_37">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://scala-tools.org/mvnsites/liftweb-2.4/net/liftweb/http/js/JsCmds$$SetHtml.html">SetHtml</a>
documentation.
</p>
</li>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/C5UhQn5blHk">Loading Pages With Templates from Other Pages</a> mailing list discussion.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pipeline">Pipeline</h2>
<div class="sectionbody">
<div class="paragraph"><p>This chapter deals with solutions relating to the Lift processing
pipeline.</p></div>
<div class="paragraph"><p>You can get a great overview of the pipeline, including diagrams, from
<em>Exploring Lift</em> at <a href="http://exploring.liftweb.net/master/index-9.html#toc-Section-9.2">http://exploring.liftweb.net/master/index-9.html#toc-Section-9.2</a>
and also from from the Lift pipeline Wiki page at
<a href="http://www.assembla.com/spaces/liftweb/wiki/HTTP_Pipeline">http://www.assembla.com/spaces/liftweb/wiki/HTTP_Pipeline</a>.</p></div>
<div class="sect2">
<h3 id="_streaming_content">Streaming Content</h3>
<div class="sect3">
<h4 id="_problem_38">Problem</h4>
<div class="paragraph"><p>You want to stream content back to the web client.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_37">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">OutputStreamResponse</span>, passing it a function that will write to the
<span class="monospaced">OutputStream</span> that Lift supplies.</p></div>
<div class="paragraph"><p>In this example we&#8217;ll stream all the integers from 1:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span><span style="color: #FF0000">{</span>Req<span style="color: #990000">,</span>OutputStreamResponse<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>rest<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Numbers <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> RestHelper <span style="color: #FF0000">{</span>

  <span style="font-style: italic"><span style="color: #9A1900">// Generate numbers, converted to Array[Byte]</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> infinite <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Stream.from(1).map</span></span><span style="color: #990000">(</span>num2bytes<span style="color: #990000">)</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">num2bytes</span></span><span style="color: #990000">(</span>x<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #009900">Int</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">(</span>x <span style="color: #990000">+</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">getBytes</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"utf-8"</span><span style="color: #990000">)</span>

  serve <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">Req</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"numbers"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #000000">OutputStreamResponse(</span></span> <span style="color: #990000">(</span>out<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">infinite.foreach</span></span><span style="color: #990000">(</span>out<span style="color: #990000">.</span>write<span style="color: #990000">)</span> <span style="color: #990000">)</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Wire this into Lift in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.dispatch.append</span></span><span style="color: #990000">(</span>Numbers<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Visiting <em>http://127.0.0.1:8080/numbers</em> will generate a 200 status code
and start producing the integers from 1.</p></div>
<div class="paragraph"><p>For more control over status codes, headers and cookies, there are a
variety of signatures for the <span class="monospaced">OutputStreamResponse</span> object. For the
most control, create an instance of the <span class="monospaced">OutputStreamResponse</span> class:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">OutputStreamResponse</span><span style="color: #990000">(</span>
  <span style="font-weight: bold"><span style="color: #000000">out:</span></span> <span style="color: #990000">(</span>OutputStream<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> Unit<span style="color: #990000">,</span>
  size<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #009900">Long</span><span style="color: #990000">,</span>
  headers<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #000000">List[</span></span><span style="color: #990000">(</span>String<span style="color: #990000">,</span> String<span style="color: #990000">)],</span>
  cookies<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> List<span style="color: #990000">[</span>HTTPCookie<span style="color: #990000">],</span>
  code<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #009900">Int</span><span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_36">Discussion</h4>
<div class="paragraph"><p>The function you give as the first argument to <span class="monospaced">OutputStreamResponse</span> is
called with the output stream to the client. This means that the bytes
you are writing to the <span class="monospaced">out</span> stream are being written to the client.</p></div>
<div class="paragraph"><p>Any headers you set (such as <span class="monospaced">Content-type</span>), or status code, may
already have been set by the time your function is called. Note that
setting <span class="monospaced">size</span> to <span class="monospaced">-1</span> causes the <span class="monospaced">Content-length</span> header to be skipped.</p></div>
<div class="paragraph"><p>There are two related types of response: <span class="monospaced">InMemoryResponse</span> and
<span class="monospaced">StreamingResponse</span></p></div>
<div class="sect4">
<h5 id="_inmemoryresponse">InMemoryResponse</h5>
<div class="paragraph"><p><span class="monospaced">InMemoryResponse</span> is useful if you have already assembled the full
content to send to the client. The signature is straightforward:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">InMemoryResponse</span><span style="color: #990000">(</span>
  data<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Array<span style="color: #990000">[</span><span style="color: #009900">Byte</span><span style="color: #990000">],</span>
  headers<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #000000">List[</span></span><span style="color: #990000">(</span>String<span style="color: #990000">,</span> String<span style="color: #990000">)],</span>
  cookies<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> List<span style="color: #990000">[</span>HTTPCookie<span style="color: #990000">],</span>
  code<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #009900">Int</span><span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect4">
<h5 id="_streamingresponse">StreamingResponse</h5>
<div class="paragraph"><p><span class="monospaced">StreamingResponse</span> pulls bytes into the output stream. This contrasts
with <span class="monospaced">OutputStreamResponse</span>, where you are pushing data to the client.</p></div>
<div class="paragraph"><p>Construct this type of response by providing a method that can be read
from:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">StreamingResponse</span><span style="color: #990000">(</span>
  data<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">read</span></span><span style="color: #990000">(</span>buf<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Array<span style="color: #990000">[</span><span style="color: #009900">Byte</span><span style="color: #990000">])</span><span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #009900">Int</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
  <span style="font-weight: bold"><span style="color: #000000">onEnd:</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> Unit<span style="color: #990000">,</span>
  size<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #009900">Long</span><span style="color: #990000">,</span>
  headers<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #000000">List[</span></span><span style="color: #990000">(</span>String<span style="color: #990000">,</span> String<span style="color: #990000">)],</span>
  cookies<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> List<span style="color: #990000">[</span>HTTPCookie<span style="color: #990000">],</span>
  code<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="color: #009900">Int</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Notice the use of a structural type for the <span class="monospaced">data</span> parameter. Anything
with a matching <span class="monospaced">read</span> method can be given here, including
<span class="monospaced">java.io.InputStream</span>-like objects, meaning <span class="monospaced">StreamingResponse</span> can act
as a pipe from input to output. Lift pulls 8k chunks from your
<span class="monospaced">StreamingResponse</span> to send to the client.</p></div>
<div class="paragraph"><p>Your <span class="monospaced">data</span> <span class="monospaced">read</span> function should follow the semantics of Java IO and
return "the total number of bytes read into the buffer, or -1 is there
is no more data because the end of the stream has been reached".</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_38">See Also</h4>
<div class="paragraph"><p>The contract for Java IO is described at <a href="http://docs.oracle.com/javase/6/docs/api/java/io/InputStream.html">http://docs.oracle.com/javase/6/docs/api/java/io/InputStream.html</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_serving_a_file_with_access_control">Serving a File with Access Control</h3>
<div class="sect3">
<h4 id="_problem_39">Problem</h4>
<div class="paragraph"><p>You have a file on disk, you want to allow a user to download it, but
only if they are allowed to. If they are not allowed to, you
want to explain why.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_38">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">RestHelper</span> to serve the file or an explanation page.</p></div>
<div class="paragraph"><p>For example,
suppose we have the file <em>/tmp/important</em> and we only want selected
requests to download that file from the <em>/download/important</em> URL. The
structure for that would be:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">object</span></span> DownloadService <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> RestHelper <span style="color: #FF0000">{</span>

  <span style="font-style: italic"><span style="color: #9A1900">// Code explained below to go here</span></span>

  serve <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"download"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #000000">Known</span></span><span style="color: #990000">(</span>fileId<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> Get req <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>permitted<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #000000">fileResponse</span></span><span style="color: #990000">(</span>fileId<span style="color: #990000">)</span>
      <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="font-weight: bold"><span style="color: #000000">Full(RedirectResponse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/sorry"</span><span style="color: #990000">))</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>We are allowing users to download "known" files. That is, files which we
approve of for access. We do this because opening up the file system to
any unfiltered end-user input pretty much means your server will be
compromised.</p></div>
<div class="paragraph"><p>For our example, <span class="monospaced">Known</span> is checking a static list of names:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> knownFiles <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">List</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"important"</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Known <span style="color: #FF0000">{</span>
 <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">unapply</span></span><span style="color: #990000">(</span>fileId<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Option<span style="color: #990000">[</span>String<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">knownFiles.find</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">==</span></span> fileId<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>For requests to these known resources, we convert the REST request into
a <span class="monospaced">Box[LiftResponse]</span>. For permitted access we serve up the file:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> permitted <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> scala<span style="color: #990000">.</span>math<span style="color: #990000">.</span>random <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">.</span>5d

<span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">fileResponse</span></span><span style="color: #990000">(</span>fileId<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Box<span style="color: #990000">[</span>LiftResponse<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">{</span>
    file <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> Box <span style="color: #990000">!!</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">java.io.File</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/tmp/"</span><span style="color: #990000">+</span>fileId<span style="color: #990000">)</span>
    input <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> <span style="font-weight: bold"><span style="color: #000000">tryo</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">java.io.FileInputStream</span></span><span style="color: #990000">(</span>file<span style="color: #990000">))</span>
 <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">yield</span></span> <span style="font-weight: bold"><span style="color: #000000">StreamingResponse</span></span><span style="color: #990000">(</span>input<span style="color: #990000">,</span>
    <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> input<span style="color: #990000">.</span>close<span style="color: #990000">,</span>
    file<span style="color: #990000">.</span>length<span style="color: #990000">,</span>
    <span style="color: #990000">(</span><span style="color: #FF0000">"Content-Disposition"</span> <span style="color: #990000">-&gt;</span> <span style="color: #FF0000">"attachment; filename="</span><span style="color: #990000">+</span>fileId<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">,</span>
    <span style="color: #009900">Nil</span><span style="color: #990000">,</span> <span style="color: #993399">200</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>If no permission is given, the user is redirected to <span class="monospaced">/sorry.html</span>.</p></div>
<div class="paragraph"><p>All of this is wired into Lift in <span class="monospaced">Boot.scala</span> with:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.dispatch.append</span></span><span style="color: #990000">(</span>DownloadService<span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_37">Discussion</h4>
<div class="paragraph"><p>By turning the request into a <span class="monospaced">Box[LiftResponse]</span> we are able to serve
up the file, send the user to a different page, and also allow Lift to
handle the 404 (<span class="monospaced">Empty</span>) cases.</p></div>
<div class="paragraph"><p>If we added a test to see if the file existed on disk in <span class="monospaced">fileResponse</span>
that would cause the method to evaluate to <span class="monospaced">Empty</span> for missing files,
which triggers a 404. As the code stands, if the file does not exist,
the <span class="monospaced">tryo</span> would give us a <span class="monospaced">Failure</span> which would turn into a 404 error
with a body of "/tmp/important (No such file or directory)".</p></div>
<div class="paragraph"><p>Because we are testing for known resources via the <span class="monospaced">Known</span> extractor as
part of the pattern for <em>/download/</em>, unknown resources will not be
passed through to our <span class="monospaced">File</span> access code. Again, Lift will return a 404
for these.</p></div>
<div class="paragraph"><p>Guard expressions can also be useful for these kinds of situations:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>serve <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"download"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #000000">Known</span></span><span style="color: #990000">(</span>id<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span> Get <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> permitted <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">fileResponse</span></span><span style="color: #990000">(</span>id<span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">"download"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> Get req <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">RedirectResponse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/sorry"</span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>You can mix and match extractors, guards and conditions in your response
to best fit the way you want the code to look and work.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_39">See Also</h4>
<div class="paragraph"><p>This recipe comes from the <em>PHP&#8217;s readfile equivalent for Lift</em> discussion on the Lift mailing list: <a href="https://groups.google.com/d/topic/liftweb/7N2OUInltUE/discussion">https://groups.google.com/d/topic/liftweb/7N2OUInltUE/discussion</a>.</p></div>
<div class="paragraph"><p><em>Chatper 24: Extractors</em> from <em>Programming in Scala</em>: <a href="http://www.artima.com/pins1ed/extractors.html">http://www.artima.com/pins1ed/extractors.html</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_access_restriction_by_http_header">Access Restriction by HTTP header</h3>
<div class="sect3">
<h4 id="_problem_40">Problem</h4>
<div class="paragraph"><p>You need to control access to a page based on the value of a HTTP
header.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_39">Solution</h4>
<div class="paragraph"><p>Use a custom <span class="monospaced">If</span> in SiteMap:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> HeaderRequired <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">If</span></span><span style="color: #990000">(</span>
  <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">S.request.map(_.header</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ALLOWED"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">==</span></span> <span style="font-weight: bold"><span style="color: #000000">Full</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"YES"</span><span style="color: #990000">))</span> openOr <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span>
  <span style="color: #FF0000">"Access not allowed"</span>
<span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900">// Build SiteMap</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> entries <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">List</span></span><span style="color: #990000">(</span>
      <span style="font-weight: bold"><span style="color: #000000">Menu.i</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Restricted"</span><span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="color: #FF0000">"restricted"</span> <span style="color: #990000">&gt;&gt;</span> HeaderRequired
<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>In this example <em>restricted.html</em> can only be viewed if the request
includes a HTTP header called <span class="monospaced">ALLOWED</span> with a value of <span class="monospaced">Yes</span>. Any other
request for the page will be redirected with a Lift error notice of
"Access not allowed".</p></div>
<div class="paragraph"><p>This can be tested from the command line using a tool like cURL:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ curl http://127.0.0.1:8080/restricted.html -H "ALLOWED:YES"</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_discussion_38">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">If</span> test ensures the <span class="monospaced">() =&gt; Boolean</span> function you supply as a first
argument returns <span class="monospaced">true</span> before the page it applies to is shown. The
second argument is what Lift does if the test isn&#8217;t true, and should be
a <span class="monospaced">() =&gt; LiftResponse</span> function, meaning you can return whatever you
like, including redirects to other pages.</p></div>
<div class="paragraph"><p>In the example we are making use of a convenient implicit conversation
from a <span class="monospaced">String</span> ("Access not allowed") to a redirection that will take
the user to the home page (actually
<span class="monospaced">LiftRules.siteMapFailRedirectLocation</span>) with a notice which shows the
string.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_40">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Chapter 7, "SiteMap and access control" in <em>Lift in Action</em>.
</p>
</li>
<li>
<p>
[Chapter 7 of <em>Exploring Lift</em>: <a href="http://exploring.liftweb.net/onepage/index.html#toc-Chapter-7">http://exploring.liftweb.net/onepage/index.html#toc-Chapter-7</a>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>This recipe is derived from the <em>Testing a Loc for a HTTP Header Value for Access Control</em> mailing list discussion: <a href="https://groups.google.com/d/topic/liftweb/CtSGkPbgEVw/discussion">https://groups.google.com/d/topic/liftweb/CtSGkPbgEVw/discussion</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_debugging_a_request">Debugging a Request</h3>
<div class="sect3">
<h4 id="_problem_41">Problem</h4>
<div class="paragraph"><p>You want to debug a request and see what&#8217;s arriving to your Lift application.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_40">Solution</h4>
<div class="paragraph"><p>Add an <span class="monospaced">onBeginServicing</span> function in <span class="monospaced">Boot.scala</span> to log the request.
For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftRules<span style="color: #990000">.</span>onBeginServicing<span style="color: #990000">.</span>append <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> r <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Received: "</span><span style="color: #990000">+</span>r<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_39">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">onBeginServicing</span> call is called early in the Lift pipeline, before
<span class="monospaced">S</span> is set up, and before Lift has the chance to 404 your request. The
function signature it expects is <span class="monospaced">Req =&gt; Unit</span>.</p></div>
<div class="paragraph"><p>If you want to select only certain paths, you can. For example, to track
all requests starting <em>/paypal</em>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftRules<span style="color: #990000">.</span>onBeginServicing<span style="color: #990000">.</span>append <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> r <span style="font-weight: bold"><span style="color: #0000FF">@</span></span> <span style="font-weight: bold"><span style="color: #000000">Req(List</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"paypal"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span>r<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>There is also an <span class="monospaced">onEndServicing</span> which can be given functions of type
<span class="monospaced">(Req, Box[LiftResponse]) =&gt; Unit</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_41">See Also</h4>
<div class="paragraph"><p>There are various hooks into the Lift pipeline, and further explanation on the mailing list.  For example, <em>What&#8217;s the difference between LiftRules.early and LiftRules.onBeginServicing and when does S.locale get initialized?</em> from the Lift mailing list: <a href="https://groups.google.com/d/topic/liftweb/K0S1rU0qtX0/discussion">https://groups.google.com/d/topic/liftweb/K0S1rU0qtX0/discussion</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_running_code_when_sessions_are_created_or_destroyed">Running Code when Sessions are Created (or Destroyed)</h3>
<div class="sect3">
<h4 id="_problem_42">Problem</h4>
<div class="paragraph"><p>You want to carry out actions when a session is created or destroyed.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_41">Solution</h4>
<div class="paragraph"><p>Make use of the hooks in <span class="monospaced">LiftSession</span>. For example, in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftSession<span style="color: #990000">.</span>afterSessionCreate <span style="font-weight: bold"><span style="color: #0000FF">::=</span></span>
 <span style="color: #990000">(</span> <span style="color: #990000">(</span>s<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>LiftSession<span style="color: #990000">,</span> r<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>Req<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Session created"</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>

LiftSession<span style="color: #990000">.</span>onBeginServicing <span style="font-weight: bold"><span style="color: #0000FF">::=</span></span>
 <span style="color: #990000">(</span> <span style="color: #990000">(</span>s<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>LiftSession<span style="color: #990000">,</span> r<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>Req<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Processing request"</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>

LiftSession<span style="color: #990000">.</span>onShutdownSession <span style="font-weight: bold"><span style="color: #0000FF">::=</span></span>
 <span style="color: #990000">(</span> <span style="color: #990000">(</span>s<span style="font-weight: bold"><span style="color: #0000FF">:</span></span>LiftSession<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Session going away"</span><span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_40">Discussion</h4>
<div class="paragraph"><p>The hooks in <span class="monospaced">LiftSession</span> allow you to insert code at various points in
the session lifecycle: when the session is created, at the start of
servicing the request, after servicing, when the session is about to
shutdown, at shutdown&#8230; the pipeline diagrams from the start of this chapter
is a useful guide to these stages.</p></div>
<div class="paragraph"><p>If the request path has been marked as being stateless via
<span class="monospaced">LiftRules.statelessReqTest</span>, the above example would only execute the
<span class="monospaced">onBeginServicing</span> functions.</p></div>
<div class="paragraph"><p>Note that the Lift session is not the same as the HTTP Session.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_42">See Also</h4>
<div class="paragraph"><p>These hooks are used in an example application to demonstrate how you might log a user out of your web application if they login via another browser:  <a href="https://github.com/dpp/starting_point/commit/729f05f9010b80139440369c4e1d0889cac346cf">https://github.com/dpp/starting_point/commit/729f05f9010b80139440369c4e1d0889cac346cf</a>.</p></div>
<div class="paragraph"><p>Session management is discussed in section 9.5 of <em>Exploring Lift</em>: <a href="http://exploring.liftweb.net/master/index-9.html#toc-Section-9.5">http://exploring.liftweb.net/master/index-9.html#toc-Section-9.5</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_run_code_when_lift_shuts_down">Run Code when Lift Shuts Down</h3>
<div class="sect3">
<h4 id="_problem_43">Problem</h4>
<div class="paragraph"><p>You want to have some code executed when your Lift application is
shutting down.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_42">Solution</h4>
<div class="paragraph"><p>Append to <span class="monospaced">LiftRules.unloadHooks</span>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.unloadHooks.append(</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Shutting down"</span><span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_41">Discussion</h4>
<div class="paragraph"><p>You append functions of type <span class="monospaced">() =&gt; Unit</span> and these functions are run
right at the end of the Lift handler, after sessions have been
destroyed, Lift actors have been shutdown, and requests have finished
being handled. This is triggered, in the words of the Java servlet
specification, "by the web container to indicate to a filter that it is
being taken out of service".</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_43">See Also</h4>
<div class="paragraph"><p><a href="#RunTasksPeriodically">[RunTasksPeriodically]</a> includes an example of using a unload hook.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_running_stateless">Running Stateless</h3>
<div class="sect3">
<h4 id="_problem_44">Problem</h4>
<div class="paragraph"><p>You want to force you application to be stateless at the HTTP level.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_43">Solution</h4>
<div class="paragraph"><p>In <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftRules<span style="color: #990000">.</span>enableContainerSessions <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span>
LiftRules<span style="color: #990000">.</span>statelessReqTest<span style="color: #990000">.</span>append <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span> <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>All requests will now be treated as stateless. Any attempt to use state,
such as via <span class="monospaced">SessionVar</span> for example, will trigger a warning in
developer mode: "Access to Lift&#8217;s statefull features from Stateless mode.
The operation on state will not complete."</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_42">Discussion</h4>
<div class="paragraph"><p>HTTP session creation is controlled via <span class="monospaced">enableContainerSessions</span>, and
applies for all requests. Leaving this value at the default (<span class="monospaced">true</span>)
allows more fine-grained control over which requests are stateless.</p></div>
<div class="paragraph"><p>Using <span class="monospaced">statelessReqTest</span> allows you to decide based on the
<span class="monospaced">StatelessReqTest</span> if it should be stateless (<span class="monospaced">true</span>) or not (<span class="monospaced">false</span>).
For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">asset</span></span><span style="color: #990000">(</span>file<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="font-weight: bold"><span style="color: #000000">List</span></span><span style="color: #990000">(</span><span style="color: #FF0000">".js"</span><span style="color: #990000">,</span> <span style="color: #FF0000">".gif"</span><span style="color: #990000">,</span> <span style="color: #FF0000">".css"</span><span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">exists</span></span><span style="color: #990000">(</span>file<span style="color: #990000">.</span>endsWith<span style="color: #990000">)</span>

LiftRules<span style="color: #990000">.</span>statelessReqTest<span style="color: #990000">.</span>append <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">StatelessReqTest</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"index"</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span><span style="color: #990000">,</span> httpReq<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>  <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">StatelessReqTest(List</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> file<span style="color: #990000">),</span>  <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">asset</span></span><span style="color: #990000">(</span>file<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>This example would only make the index page and any GIFs, JavaScript and
CSS files stateless. The <span class="monospaced">httpReq</span> part is a <span class="monospaced">HTTPRequest</span> instance,
allowing you to base the decision on the content of the request
(cookies, user agent, etc).</p></div>
<div class="paragraph"><p>Another option is <span class="monospaced">LiftRules.statelessDispatch</span> which allows you to
register a function which returns a <span class="monospaced">LiftResponse</span>. This will be
executed without a session, and convenient for REST-based services.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_44">See Also</h4>
<div class="paragraph"><p>This stateless request control was introduced in Lift 2.2.  The announcement on the mailing list gives more details: <a href="https://groups.google.com/d/topic/liftweb/2rVMCnWppSo/discussion">https://groups.google.com/d/topic/liftweb/2rVMCnWppSo/discussion</a>.</p></div>
<div class="paragraph"><p>The Wiki page on stateless requests describes Lift&#8217;s behaviour if statefull actions are attempted: <a href="http://www.assembla.com/wiki/show/liftweb/Stateless_Requests">http://www.assembla.com/wiki/show/liftweb/Stateless_Requests</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_catch_any_exception">Catch Any exception</h3>
<div class="sect3">
<h4 id="_problem_45">Problem</h4>
<div class="paragraph"><p>You want a wrapper around all requests to catch exceptions and display
something to the user.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_44">Solution</h4>
<div class="paragraph"><p>Declare an exception handler in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftRules<span style="color: #990000">.</span>exceptionHandler<span style="color: #990000">.</span>prepend <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #990000">(</span>runMode<span style="color: #990000">,</span> request<span style="color: #990000">,</span> exception<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #000000">logger.error</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Boom! At "</span><span style="color: #990000">+</span>request<span style="color: #990000">.</span>uri<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">InternalServerErrorResponse</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In the above example, all exceptions for all requests at all run modes
are being matched, causing an error to be logged and a 500 (internal
server error) to be returned to the browser.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_43">Discussion</h4>
<div class="paragraph"><p>The partial function you add to <span class="monospaced">exceptionHandler</span> needs to return a
<span class="monospaced">LiftResponse</span> (i.e., something to send to the browser). The default
behaviour is to return an <span class="monospaced">XhtmlResponse</span>, which in
<span class="monospaced">Props.RunModes.Development</span> gives details of the exception, and in all
other run modes simply says "Something unexpected happened".</p></div>
<div class="paragraph"><p>You can return any kind of <span class="monospaced">LiftResponse</span>, including <span class="monospaced">RedirectResponse</span>,
<span class="monospaced">JsonResponse</span>, <span class="monospaced">XmlResponse</span>, <span class="monospaced">JavaScriptResponse</span> and so on.</p></div>
<div class="paragraph"><p>This second example shows matching on Ajax requests only, and returning
a JavaScript dialog to the browser:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>js<span style="color: #990000">.</span>JsCmds<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> ajax <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> LiftRules<span style="color: #990000">.</span>ajaxPath

LiftRules<span style="color: #990000">.</span>exceptionHandler<span style="color: #990000">.</span>prepend <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #990000">(</span>mode<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">Req</span></span><span style="color: #990000">(</span>ajax <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> PostRequest<span style="color: #990000">),</span> ex<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #000000">logger.error</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Error handing ajax"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">JavaScriptResponse(Alert</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Boom!"</span><span style="color: #990000">))</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>This Ajax example will jump in before Lift&#8217;s default behaviour for Ajax
errors. The default is to retry the Ajax command three times
(<span class="monospaced">LiftRules.ajaxRetryCount</span>), and then execute
<span class="monospaced">LiftRules.ajaxDefaultFailure</span>, which will pop up a dialog saying: "The
server cannot be contacted at this time"</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_45">See Also</h4>
<div class="paragraph"><p>This recipe was derived from a mailing list discussion: <a href="http://groups.google.com/group/liftweb/browse_thread/thread/842954ffc333b0f9">http://groups.google.com/group/liftweb/browse_thread/thread/842954ffc333b0f9</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_span_class_monospaced_httpservletrequest_span">Accessing <span class="monospaced">HttpServletRequest</span></h3>
<div class="sect3">
<h4 id="_problem_46">Problem</h4>
<div class="paragraph"><p>To satisfy some API you need access to the <span class="monospaced">HttpServletRequest</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_45">Solution</h4>
<div class="paragraph"><p>Cast <span class="monospaced">S.request</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>S
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>http<span style="color: #990000">.</span>provider<span style="color: #990000">.</span>servlet<span style="color: #990000">.</span>HTTPRequestServlet
<span style="font-weight: bold"><span style="color: #000080">import</span></span> javax<span style="color: #990000">.</span>servlet<span style="color: #990000">.</span>http<span style="color: #990000">.</span>HttpServletRequest

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> servletRequest<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Box<span style="color: #990000">[</span>HttpServletRequest<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">{</span>
  req <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> S<span style="color: #990000">.</span>request
  inner <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> <span style="font-weight: bold"><span style="color: #000000">Box.asA[HTTPRequestServlet]</span></span><span style="color: #990000">(</span>req<span style="color: #990000">.</span>request<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">yield</span></span> inner<span style="color: #990000">.</span>req</tt></pre></div></div>
<div class="paragraph"><p>You can then make your API call:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>servletRequest<span style="color: #990000">.</span>foreach <span style="color: #FF0000">{</span> r <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">yourApiCall</span></span><span style="color: #990000">(</span>r<span style="color: #990000">)</span> <span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_44">Discussion</h4>
<div class="paragraph"><p>Note that the results is a <span class="monospaced">Box</span> because there might not be a request
when you evaluate <span class="monospaced">servletRequest</span>&#8201;&#8212;&#8201;or you might one day port to a
different deployment environment and not be running on a standard Java
servlet container.</p></div>
<div class="paragraph"><p>As your code will have a direct dependency on the Java Servlet API,
you&#8217;ll need to include this dependency in your SBT build:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">"javax.servlet"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"servlet-api"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"2.5"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"provided-&gt;default"</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_46">See Also</h4>
<div class="paragraph"><p>This recipe was created from the mailing list <em>HttpRequest conversion</em> discussion: <a href="https://groups.google.com/d/topic/liftweb/67tQXSY9XS4/discussion">https://groups.google.com/d/topic/liftweb/67tQXSY9XS4/discussion</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_secure_requests_only">Secure Requests Only</h3>
<div class="sect3">
<h4 id="_problem_47">Problem</h4>
<div class="paragraph"><p>You want to ensure clients are using HTTPs.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_46">Solution</h4>
<div class="paragraph"><p>Add an <span class="monospaced">earlyResponse</span> function in <span class="monospaced">Boot.scala</span> redirecting insecure
requests. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LiftRules<span style="color: #990000">.</span>earlyResponse<span style="color: #990000">.</span>append <span style="color: #FF0000">{</span> <span style="color: #990000">(</span>req<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Req<span style="color: #990000">)</span> â <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>req<span style="color: #990000">.</span>request<span style="color: #990000">.</span>scheme <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"https"</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> uriAndQueryString <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> req<span style="color: #990000">.</span>uri <span style="color: #990000">+</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">req.request.queryString.map</span></span><span style="color: #990000">(</span>s <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #FF0000">"?"</span><span style="color: #990000">+</span>s<span style="color: #990000">)</span> openOr <span style="color: #FF0000">""</span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> uri <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"https://%s%s"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span>req<span style="color: #990000">.</span>request<span style="color: #990000">.</span>serverName<span style="color: #990000">,</span> uriAndQueryString<span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #000000">Full(PermRedirectResponse</span></span><span style="color: #990000">(</span>uri<span style="color: #990000">,</span> req<span style="color: #990000">,</span> req<span style="color: #990000">.</span>cookies<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">*))</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> Empty <span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_45">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">earlyResponse</span> call is called early in the Lift pipeline. It is
used to execute code before a request is handled and, if required, exit the
pipeline and return a response. The function signature expected is
<span class="monospaced">Req =&gt; Box[LiftResponse]</span>.</p></div>
<div class="paragraph"><p>The ideal method to ensure requests are served using the correct scheme
would be via web server configuration, such as Apache or Nginx. This
isn&#8217;t possible in some cases, such as when your application is deployed
to a PaaS such as CloudBees.</p></div>
<div class="sect4">
<h5 id="_amazon_load_balancer">Amazon Load Balancer</h5>
<div class="paragraph"><p>For Amazon Elastic Load Balancer note that you need to use
<span class="monospaced">X-Forwarded-Proto</span> header to detect HTTPs. As mentioned in their
<em>Overview of Elastic Load Balancing</em> document, "Your server access logs
contain only the protocol used between the server and the load balancer;
they contain no information about the protocol used between the client
and the load balancer." In this situation modify the above test from
<span class="monospaced">req.request.scheme != "https"</span> to:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">req.header</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"X-Forwarded-Proto"</span><span style="color: #990000">)</span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Full</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"https"</span><span style="color: #990000">)</span></tt></pre></div></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_47">See Also</h4>
<div class="paragraph"><p>The <em>Overview of Elastic Load Balancing</em> can be found at: <a href="http://docs.amazonwebservices.com/ElasticLoadBalancing/latest/DeveloperGuide/arch-loadbalancing.html">http://docs.amazonwebservices.com/ElasticLoadBalancing/latest/DeveloperGuide/arch-loadbalancing.html</a>.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relational_database_persistence_with_record_and_squeryl">Relational database persistence with Record and Squeryl</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_using_a_jndi_datasource">Using a JNDI datasource</h3>
<div class="sect3">
<h4 id="_problem_48">Problem</h4>
<div class="paragraph"><p>You want to use a JNDI data source for your Record+Squeryl Lift
application.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_47">Solution</h4>
<div class="paragraph"><p>In <span class="monospaced">Boot.scala</span> call <span class="monospaced">initWithSquerylSession</span>&#8230;</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> javax<span style="color: #990000">.</span>sql<span style="color: #990000">.</span>DataSource
<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> ds <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">InitialContext</span></span><span style="color: #990000">().</span>
  <span style="font-weight: bold"><span style="color: #000000">lookup</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"java:comp/env/jdbc/mydb"</span><span style="color: #990000">).</span>asInstanceOf<span style="color: #990000">[</span>DataSource<span style="color: #990000">]</span>

<span style="font-weight: bold"><span style="color: #000000">SquerylRecord.initWithSquerylSession</span></span><span style="color: #990000">(</span>
  <span style="font-weight: bold"><span style="color: #000000">Session.create(ds.getConnection</span></span><span style="color: #990000">(),</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> MySQLAdapter<span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>&#8230;replacing <span class="monospaced">mydb</span> with the name given to your database in your JNDI
configuration, and replacing <span class="monospaced">MySQLAdapter</span> with the appropriate adapter
for the database you are using.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_46">Discussion</h4>
<div class="paragraph"><p>The Java Naming and Directory Interface (JNDI) is service provided by
the web container (e.g., Jetty, Tomcat, etc) which allows you to
configure a database connection in the container and then refer the
connection by name in your application. One advantage of this is that
you can avoid including database credentials to your Lift source base.</p></div>
<div class="paragraph"><p>The configuration of JNDI is different for each container, and may vary
with versions of the container you use. The <em>See Also</em> section includes
links to the documentation pages for popular containers.</p></div>
<div class="paragraph"><p>Some environments may also require that you to mention the JNDI resource
in your <span class="monospaced">src/main/webapp/WEB-INF/web.xml</span> file:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;resource-ref&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;res-ref-name&gt;</span></span>jdbc/mydb<span style="font-weight: bold"><span style="color: #0000FF">&lt;/res-ref-name&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;res-type&gt;</span></span>javax.sql.DataSource<span style="font-weight: bold"><span style="color: #0000FF">&lt;/res-type&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;res-auth&gt;</span></span>Container<span style="font-weight: bold"><span style="color: #0000FF">&lt;/res-auth&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/resource-ref&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_48">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
List of
<a href="http://squeryl.org/api/org/squeryl/adapters/package.html">Squeryl database adapters</a>.
</p>
</li>
<li>
<p>
An example <a href="http://www.assembla.com/spaces/liftweb/wiki/Apache_and_Jetty_Configuration">Jetty JNDI configuration</a> on the Lift wiki.
</p>
</li>
<li>
<p>
<a href="http://docs.codehaus.org/display/JETTY/JNDI">Jetty 6 JNDI documentation</a>.
</p>
</li>
<li>
<p>
Eclipse <a href="http://wiki.eclipse.org/Jetty/Howto/Configure_JNDI_Datasource">Jetty JNDI documentation</a>.
</p>
</li>
<li>
<p>
<a href="http://tomcat.apache.org/tomcat-7.0-doc/jndi-resources-howto.html">Tomcat 7</a> JNDI information.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_validation_to_a_field">Adding validation to a field</h3>
<div class="sect3">
<h4 id="_problem_49">Problem</h4>
<div class="paragraph"><p>You want to add validation to a field in your model.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_48">Solution</h4>
<div class="paragraph"><p>Override <span class="monospaced">validations</span>. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> title <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">StringField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">256</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> validations <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">valMinLen</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Title cannot be blank"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">.</span>validations
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In your snippet you can check the validations, for example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> thing <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">MyThing.createRecord.title</span></span><span style="color: #990000">(</span>title<span style="color: #990000">)</span>
thing<span style="color: #990000">.</span>validate <span style="font-weight: bold"><span style="color: #0000FF">match</span></span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #009900">Nil</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// No validation problems, so code here to save thing</span></span>
    <span style="font-weight: bold"><span style="color: #000000">S.redirectTo</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/success"</span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> xs <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-style: italic"><span style="color: #9A1900">// One or more validation problems!</span></span>
    <span style="font-weight: bold"><span style="color: #000000">S.error</span></span><span style="color: #990000">(</span>xs<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In your template, you can reference the column to show any error:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;p</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:Msg?id=title_id&amp;errorClass=error"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Msg to appear here<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_47">Discussion</h4>
<div class="paragraph"><p>The built-in validations are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">valMinLen</span>&#8201;&#8212;&#8201;validate a string is at least a given length, as shown above.
</p>
</li>
<li>
<p>
<span class="monospaced">valMaxLen</span>&#8201;&#8212;&#8201;validate that a string is not above a given length.
</p>
</li>
<li>
<p>
<span class="monospaced">valRegex</span>&#8201;&#8212;&#8201;validate a string matches the given pattern.
</p>
</li>
</ul></div>
<div class="paragraph"><p>An example of regular expression validation would be:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>regex<span style="color: #990000">.</span>Pattern

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> url <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">StringField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">1024</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> validations <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
    <span style="font-weight: bold"><span style="color: #000000">valRegex</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #000000">Pattern.compile</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"^https?://.*"</span><span style="color: #990000">),</span>
              <span style="color: #FF0000">"URLs should start http:// or https://"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">.</span>validations
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_49">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Source for <a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/BaseField.scala">BaseField.scala</a> which includes the definition of <span class="monospaced">StringValidators</span>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_custom_validation_logic">Implementing custom validation logic</h3>
<div class="sect3">
<h4 id="_problem_50">Problem</h4>
<div class="paragraph"><p>You want to provide your own validation logic and apply it to a field in
a record.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_49">Solution</h4>
<div class="paragraph"><p>Implement a function from the type of field you want to validate to
<span class="monospaced">List[FieldError]</span>. Perhaps we want to ensure that no-one added to the
database can have the same name, so we need to provide a
<span class="monospaced">String =&gt; List[FieldError]</span> function:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Person</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Record<span style="color: #990000">[</span>Person<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> KeyedRecord<span style="color: #990000">[</span>Person<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Person

  <span style="font-weight: bold"><span style="color: #0000FF">@</span></span><span style="font-weight: bold"><span style="color: #000000">Column</span></span><span style="color: #990000">(</span>name <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"id"</span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> idField <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">LongField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span>

  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> name <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">StringField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> validations <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
      <span style="font-weight: bold"><span style="color: #000000">valUnique</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Please change your name"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">.</span>validations
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">valUnique</span></span><span style="color: #990000">(</span>errorMsg<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> â <span style="font-weight: bold"><span style="color: #000000">String)</span></span><span style="color: #990000">(</span>name<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #0000FF">:</span></span> List<span style="color: #990000">[</span>FieldError<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
    <span style="font-weight: bold"><span style="color: #000000">Person.byName</span></span><span style="color: #990000">(</span>name<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">match</span></span> <span style="color: #FF0000">{</span>
      <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #000000">Some</span></span><span style="color: #990000">(</span>name<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">FieldError</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>name<span style="color: #990000">,</span> errorMsg<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="color: #009900">Nil</span>
      <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="color: #009900">Nil</span>
  <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_48">Discussion</h4>
<div class="paragraph"><p>By convention validation functions have two argument lists: the first
for the error message; the second to receive the value to validate. This
allows you to easily re-use your validation function on other fields.</p></div>
<div class="paragraph"><p>The <span class="monospaced">FieldError</span> you return needs to know the field it applies to as
well as the message to display. In the example the field is <span class="monospaced">name</span>, but
we&#8217;ve used <span class="monospaced">this.name</span> to avoid confusion with the <span class="monospaced">Some(name)</span> in the
pattern match or the <span class="monospaced">name</span> passed as an argument to <span class="monospaced">valUnique</span>.</p></div>
<div class="paragraph"><p>In case you&#8217;re wondering, the implementation of <span class="monospaced">Person.byName</span> might
be:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">byName</span></span><span style="color: #990000">(</span>name<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="font-weight: bold"><span style="color: #000000">from</span></span><span style="color: #990000">(</span>YourSchema<span style="color: #990000">.</span>people<span style="color: #990000">)</span>
  <span style="color: #990000">(</span>p <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">where(lower</span></span><span style="color: #990000">(</span>p<span style="color: #990000">.</span>name<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">===</span></span> <span style="font-weight: bold"><span style="color: #000000">lower</span></span><span style="color: #990000">(</span>name<span style="color: #990000">))</span>
  <span style="font-weight: bold"><span style="color: #000000">select</span></span> <span style="color: #990000">(</span>l<span style="color: #990000">)).</span>headOption</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_50">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Source for <a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/BaseField.scala">BaseField.scala</a> which includes the definition of <span class="monospaced">StringValidators</span>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_modify_a_field_value_before_it_is_set">Modify a field value before it is set</h3>
<div class="sect3">
<h4 id="_problem_51">Problem</h4>
<div class="paragraph"><p>You want to modify the value of a field, so the value in your model is
the modified version.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_50">Solution</h4>
<div class="paragraph"><p>Override <span class="monospaced">setFilter</span>. For example, to remove leading and trailing
whitespace entered by the user:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> title <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">StringField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">256</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
   <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> setFilter <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> trim <span style="font-weight: bold"><span style="color: #0000FF">_</span></span> <span style="font-weight: bold"><span style="color: #0000FF">::</span></span> <span style="font-weight: bold"><span style="color: #0000FF">super</span></span><span style="color: #990000">.</span>setFilter
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_49">Discussion</h4>
<div class="paragraph"><p>The built-in filters are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">crop</span>&#8201;&#8212;&#8201;enforces the field&#8217;s min and max length by truncation.
</p>
</li>
<li>
<p>
<span class="monospaced">trim</span>&#8201;&#8212;&#8201;applies <span class="monospaced">String.trim</span> to the field value.
</p>
</li>
<li>
<p>
<span class="monospaced">toUpper</span> and <span class="monospaced">toLower</span>&#8201;&#8212;&#8201;change the case of the field value.
</p>
</li>
<li>
<p>
<span class="monospaced">removeRegExChars</span>&#8201;&#8212;&#8201;removes matching regular expression characters.
</p>
</li>
<li>
<p>
<span class="monospaced">notNull</span>&#8201;&#8212;&#8201;coverts null values to an empty string.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_see_also_51">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Source for <a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/BaseField.scala">BaseField.scala</a> which includes the definition of the filters.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_put_a_random_value_in_a_column">Put a random value in a column</h3>
<div class="sect3">
<h4 id="_problem_52">Problem</h4>
<div class="paragraph"><p>You need a column to hold a random value.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_51">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">UniqueIdField</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> myColumn <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">UniqueIdField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span><span style="color: #993399">32</span><span style="color: #990000">)</span> <span style="color: #FF0000">{}</span></tt></pre></div></div>
<div class="paragraph"><p>The size value, 32 in this example, controls the number of characters in
the random field.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_50">Discussion</h4>
<div class="paragraph"><p>The field is a kind of <span class="monospaced">StringField</span> and the default value for the field
comes from <span class="monospaced">StringHelpers.randomString</span>.</p></div>
<div class="paragraph"><p>Note the <span class="monospaced">{}</span> in the example: this is required as <span class="monospaced">UniqueIdField</span> is an
abstract class.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_52">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Source for <a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/StringHelpers.scala">StringHelpers</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_created_and_updated_timestamps_for_a_squeryl_record">Automatic created and updated timestamps for a Squeryl Record</h3>
<div class="sect3">
<h4 id="_problem_53">Problem</h4>
<div class="paragraph"><p>You want created and updated fields on your records and would like them
automatically updated when a row is added or updated.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_52">Solution</h4>
<div class="paragraph"><p>Define the following traits:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">trait</span></span> <span style="color: #008080">Created</span><span style="color: #990000">[</span>T <span style="font-weight: bold"><span style="color: #0000FF">&lt;:</span></span> Created<span style="color: #990000">[</span>T<span style="color: #990000">]]</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Record<span style="color: #990000">[</span>T<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  self<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> T <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> created<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> DateTimeField<span style="color: #990000">[</span>T<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">DateTimeField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> defaultValue <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Calendar<span style="color: #990000">.</span>getInstance
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">trait</span></span> <span style="color: #008080">Updated</span><span style="color: #990000">[</span>T <span style="font-weight: bold"><span style="color: #0000FF">&lt;:</span></span> Updated<span style="color: #990000">[</span>T<span style="color: #990000">]]</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Record<span style="color: #990000">[</span>T<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  self<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> T <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> updated <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">DateTimeField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> defaultValue <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Calendar<span style="color: #990000">.</span>getInstance
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> onUpdate <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">updated</span></span><span style="color: #990000">(</span>Calendar<span style="color: #990000">.</span>getInstance<span style="color: #990000">)</span>

<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">trait</span></span> <span style="color: #008080">CreatedUpdated</span><span style="color: #990000">[</span>T <span style="font-weight: bold"><span style="color: #0000FF">&lt;:</span></span> Updated<span style="color: #990000">[</span>T<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> Created<span style="color: #990000">[</span>T<span style="color: #990000">]]</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span>
  Updated<span style="color: #990000">[</span>T<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> Created<span style="color: #990000">[</span>T<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
    self<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> T <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Add to your model, for example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">YourRecord</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Record<span style="color: #990000">[</span>YourRecord<span style="color: #990000">]</span>
  <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> KeyedRecord<span style="color: #990000">[</span><span style="color: #009900">Long</span><span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> CreatedUpdated<span style="color: #990000">[</span>YourRecord<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> YourRecord
    <span style="font-style: italic"><span style="color: #9A1900">//field entries ...</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Finally, arrange for the <span class="monospaced">updated</span> field to be updated:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">YourSchema</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Schema <span style="color: #FF0000">{</span>
  <span style="color: #990000">...</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> callbacks <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Seq</span></span><span style="color: #990000">(</span>
    beforeUpdate<span style="color: #990000">[</span>YourRecord<span style="color: #990000">]</span> call <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">.</span>onUpdate<span style="color: #FF0000">}</span>
  <span style="color: #990000">)</span>
  <span style="color: #990000">...</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_51">Discussion</h4>
<div class="paragraph"><p><em>This recipe requires Lift 2.5 or later.</em></p></div>
<div class="paragraph"><p>Although there is a built in <span class="monospaced">net.lifetweb.record.LifecycleCallbacks</span>
trait in which allows you trigger behaviour onUpdate, afterDelete and so
on, it is only for use on individual Fields, rather than Records. As our
goal is to update the <span class="monospaced">updated</span> field when any part of the Record
changes, we can&#8217;t use the <span class="monospaced">LiftcycleCallbacks</span> here.</p></div>
<div class="paragraph"><p>Instead, the <span class="monospaced">CreatedUpdated</span> trait simplifies adding an <span class="monospaced">updated</span> and
<span class="monospaced">created</span> fields to a Record, but we do need to remember to add a hook
into the schema to ensure the <span class="monospaced">updated</span> value is changed when a record
is modified. This is why we set the <span class="monospaced">callbacks</span> on the Schema.</p></div>
<div class="paragraph"><p>It should be noted that <span class="monospaced">onUpdate</span> is only called on full updates and
not on partial updates with Squeryl. A full update is when the object is
altered and then saved; a partial update is where you attempt to alter
many objects via a query.</p></div>
<div class="paragraph"><p>If you&#8217;re interested in other automations for Record, the Squery schema
callbacks also support other triggered behaviours:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">beforeInsert</span> and <span class="monospaced">afterInsert</span>
</p>
</li>
<li>
<p>
<span class="monospaced">afterSelect</span>
</p>
</li>
<li>
<p>
<span class="monospaced">beforeUpdate</span> and <span class="monospaced">afterUpdate</span>
</p>
</li>
<li>
<p>
<span class="monospaced">beforeDelete</span> and <span class="monospaced">afterDelete</span>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_see_also_53">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://squeryl.org/inserts-updates-delete.html">Explanation of full vs
partial update in Squeryl</a>.
</p>
</li>
<li>
<p>
Mailing list discussion
<a href="https://groups.google.com/d/msg/liftweb/G4U14pQbZZ4/V24YvhUPvEEJ">regarding
LifecycleCallbacks</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_logging_sql">Logging SQL</h3>
<div class="sect3">
<h4 id="_problem_54">Problem</h4>
<div class="paragraph"><p>You want to see the SQL being executed by Record with Squeryl.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_53">Solution</h4>
<div class="paragraph"><p>Add the following anytime you have a Squeryl season, such as just before
your query:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">org.squeryl.Session.currentSession.setLogger</span></span><span style="color: #990000">(</span> s <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span>s<span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>By providing a <span class="monospaced">String =&gt; Unit</span> function to <span class="monospaced">setLogger</span>, Squeryl will
execute that function with the SQL it runs. In this example, we are
simply printing the SQL to the console.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_52">Discussion</h4>
<div class="paragraph"><p>This recipe is not specific to Lift, and will work wherever you use
Squeryl.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_54">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Squeryl <a href="http://squeryl.org/getting-started.html">getting started</a> page.
</p>
</li>
<li>
<p>
Squeryl page on <a href="http://squeryl.org/miscellaneous.html">logging the
generated SQL</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_model_a_column_with_mysql_mediumtext">Model a column with MySQL MEDIUMTEXT</h3>
<div class="sect3">
<h4 id="_problem_55">Problem</h4>
<div class="paragraph"><p>You want to use MySQL&#8217;s <span class="monospaced">MEDIUMTEXT</span> for a column, but <span class="monospaced">StringField</span>
doesn&#8217;t have this option.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_54">Solution</h4>
<div class="paragraph"><p>Use Squeryl&#8217;s <span class="monospaced">dbType</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">on(mytable)</span></span><span style="color: #990000">(</span>t <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">declare</span></span><span style="color: #990000">(</span>
  t<span style="color: #990000">.</span>mycolumn defineAs <span style="font-weight: bold"><span style="color: #000000">dbType</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"MEDIUMTEXT"</span><span style="color: #990000">)</span>
<span style="color: #990000">))</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_53">Discussion</h4>
<div class="paragraph"><p>You can continue to use <span class="monospaced">StringField</span>, but regardless of the size you
pass, the schema will be:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">create</span></span> <span style="font-weight: bold"><span style="color: #0000FF">table</span></span> mytable <span style="color: #990000">(</span>
    mycolumn <span style="color: #009900">MEDIUMTEXT</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span>
<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This recipe is not specific to Lift, and will work wherever you use
Squeryl.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_55">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Squeryl <a href="http://squeryl.org/schema-definition.html">schema defintion</a>
page.
</p>
</li>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/TXbDGdX54LQ">MySQL,
Squeryl and MEDIUMTEXT with Record</a> mailing list discussion.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relational_database_persistence_with_mapper">Relational database persistence with Mapper</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_sequence_numbers_and_existing_data">Sequence numbers and existing data</h3>
<div class="sect3">
<h4 id="_problem_56">Problem</h4>
<div class="paragraph"><p>You have a table with data in it, but Lift inserts new records with a
primary key starting from 1, or some other value that may already exist.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_55">Solution</h4>
<div class="paragraph"><p>Work with the native sequence facility in your database to set the
starting sequence value to be the value you want Lift to use.</p></div>
<div class="paragraph"><p>The first step is to work out what value you want the sequence to start
from. Most likely this will be just after the largest primary key ID in
the table you&#8217;re working with. With PostgreSQL, for example, you can
check this via the <span class="monospaced">psql</span> command:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">SELECT</span></span> MAX<span style="color: #990000">(</span>id<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">FROM</span></span> mytable<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>To find out what sequences exist, run <span class="monospaced">\ds</span> in <span class="monospaced">psql</span>. The sequence to
change will contain the name of your table. You can then change the
value:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">ALTER</span></span> SEQUENCE mytable_id_seq RESTART <span style="font-weight: bold"><span style="color: #0000FF">WITH</span></span> <span style="color: #993399">1000</span><span style="color: #990000">;</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_54">Discussion</h4>
<div class="paragraph"><p>Lift defers to the database sequence facility to generate primary key
values. If you insert data by-passing the sequence, the sequence value
will not know about the specific primary key values you have used (this
is not Lift-specific). The solution above resolves this by updating the
starting sequence number to skip over the rows that already exist in
your database.</p></div>
<div class="paragraph"><p>The same instructions apply for using Record as well as Mapper.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_56">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Mailing list discussion "<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/eAelsvlFkaI">Mapper starts counting primary keys with key 1 in a non-empty table</a>".
</p>
</li>
<li>
<p>
PostgreSQL <a href="http://www.postgresql.org/docs/9.1/static/functions-sequence.html">Sequence
Manipulation Functions</a>.
</p>
</li>
<li>
<p>
MySQL <a href="http://dev.mysql.com/doc/refman/5.6/en/example-auto-increment.html">AUTO-INCREMENT</a>
describes how to use ALTER TABLE to change the sequence value.
</p>
</li>
<li>
<p>
<a href="http://www.techonthenet.com/oracle/sequences.php">Updating ORACLE sequence</a> involves changing the incrementing step to cover the values to skip.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_detect_if_the_schema_has_changed">Detect if the schema has changed</h3>
<div class="sect3">
<h4 id="_problem_57">Problem</h4>
<div class="paragraph"><p>You do not want to automatically migrate your schema, but you want to
know if it is out of date.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_56">Solution</h4>
<div class="paragraph"><p>Run <span class="monospaced">Schemifier</span> and capture the changes it would make if allowed. For
example, in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> cmds <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Schemifier.schemify</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span> Schemifier<span style="color: #990000">.</span>infoF <span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">,</span> User<span style="color: #990000">,</span> Company<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>cmds<span style="color: #990000">.</span>isEmpty<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #000000">error</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Database schema is out of date. The following is missing: </span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">+</span>
    <span style="font-weight: bold"><span style="color: #000000">cmds.mkString</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">))</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_55">Discussion</h4>
<div class="paragraph"><p>The arguments and return value for <span class="monospaced">schemify</span> are:</p></div>
<div class="ulist"><ul>
<li>
<p>
performWrite - the example uses <span class="monospaced">false</span> meaning the database won&#8217;t be updated.
</p>
</li>
<li>
<p>
structureOnly - <span class="monospaced">true</span> to check the tables and columns (not indexes).
</p>
</li>
<li>
<p>
logFunc - for logging, but only if we are writing to the database, which we are not.
</p>
</li>
<li>
<p>
tables (mapper objects) - the tables to include.
</p>
</li>
<li>
<p>
The result is a <span class="monospaced">List[String]</span> which are the statements required to update the database.
</p>
</li>
</ul></div>
<div class="paragraph"><p>From the above description you may be able to select the parameters that
best fit your needs.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_57">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/lift/framework/blob/master/persistence/mapper/src/main/scala/net/liftweb/mapper/Schemifier.scala">Schemifier.scala</a> source.
</p>
</li>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!msg/liftweb/DM4kYVz_Z2c/vO0t-So3vVcJ">Mailing
list discussion</a>.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mongodb_persistence_with_record">MongoDB Persistence with Record</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section gives recipes for making use of MongoDB in your Lift
application. You should get acquainted with the
<a href="https://www.assembla.com/spaces/liftweb/wiki/MongoDB">Lift Wiki pages for
Mongo</a>. For recipes regarding Mongo itself, check out the
<a href="http://cookbook.mongodb.org/">MongoDB Cookbook</a>.</p></div>
<div class="sect2">
<h3 id="_connecting_to_a_mongo_database">Connecting to a Mongo Database</h3>
<div class="sect3">
<h4 id="_problem_58">Problem</h4>
<div class="paragraph"><p>You want to connect to a MongoDB.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_57">Solution</h4>
<div class="paragraph"><p>Configure your connection using <span class="monospaced">net.liftweb.mongodb</span> and <span class="monospaced">com.mongodb</span>
in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> com<span style="color: #990000">.</span>mongodb<span style="color: #990000">.</span><span style="color: #FF0000">{</span>ServerAddress<span style="color: #990000">,</span> Mongo<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>mongodb<span style="color: #990000">.</span><span style="color: #FF0000">{</span>MongoDB<span style="color: #990000">,</span>DefaultMongoIdentifier<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> srvr <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ServerAddress</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"127.0.0.1"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"20717"</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000000">MongoDB.defineDb</span></span><span style="color: #990000">(</span>DefaultMongoIdentifier<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Mongo</span></span><span style="color: #990000">(</span>srvr<span style="color: #990000">),</span> <span style="color: #FF0000">"mydb"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This will give you a connection to a local MongoDB database called
"mydb".</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_56">Discussion</h4>
<div class="paragraph"><p>If your database needs authentication, use <span class="monospaced">MongoDB.defineDbAuth</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">MongoDB.defineDbAuth</span></span><span style="color: #990000">(</span>DefaultMongoIdentifier<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Mongo</span></span><span style="color: #990000">(</span>srvr<span style="color: #990000">),</span>
  <span style="color: #FF0000">"mydb"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"username"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"password"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Some cloud services will give you a URL to connect to, such as
"alex.mongohq.com:10050/fglvBskrsdsdsDaGNs1". In this case, the host and
the port make up the first part, and the database name is the part after
the <span class="monospaced">/</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_58">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.assembla.com/wiki/show/liftweb/Mongo_Configuration">Mongo
Configuration</a> on the wiki contains more details and options, including
configuration for replica sets.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_storing_a_hash_in_a_mongo_record">Storing a Hash in a Mongo Record</h3>
<div class="sect3">
<h4 id="_problem_59">Problem</h4>
<div class="paragraph"><p>You want to store a hash map in Mongo.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_58">Solution</h4>
<div class="paragraph"><p>Create a Mongo Record which contains a <span class="monospaced">MongoMapField</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>mongodb<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>mongodb<span style="color: #990000">.</span>record<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>mongodb<span style="color: #990000">.</span>record<span style="color: #990000">.</span>field<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Country</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> MongoRecord<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> StringPk<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Country
  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> population <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">MongoMapField[Country,Int]</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Country <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Country <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> MongoMetaRecord<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> collectionName <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"example.earth"</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In this example we are creating a record for infomation about a country,
and the <span class="monospaced">population</span> is a map from a <span class="monospaced">String</span> key to an <span class="monospaced">Integer</span> value.</p></div>
<div class="paragraph"><p>We can use it in a snippet like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HelloWorld</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> uk <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Country.find</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"uk"</span><span style="color: #990000">)</span> openOr <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> info <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Map</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Brighton"</span> <span style="color: #990000">-&gt;</span> <span style="color: #993399">134293</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"Birmingham"</span> <span style="color: #990000">-&gt;</span> <span style="color: #993399">970892</span><span style="color: #990000">,</span>
       <span style="color: #FF0000">"Liverpool"</span> <span style="color: #990000">-&gt;</span> <span style="color: #993399">469017</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">Country.createRecord.id("uk").population(info).save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span>
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> facts <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"#facts"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="color: #990000">(</span>
      <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">{</span> <span style="color: #990000">(</span>name<span style="color: #990000">,</span>pop<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> uk<span style="color: #990000">.</span>population<span style="color: #990000">.</span>is<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">yield</span></span>
        <span style="color: #FF0000">".name *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> name <span style="color: #990000">&amp;</span> <span style="color: #FF0000">".pop *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> pop
      <span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>When this snippet is called, it looks up a record by <span class="monospaced">_id</span> of "uk" or
creates it using some canned information. The template to go with the
snippet could include:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;div</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"lift:HelloWorld.facts"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;table&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;thead&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;tr&gt;&lt;th&gt;</span></span>City<span style="font-weight: bold"><span style="color: #0000FF">&lt;/th&gt;&lt;th&gt;</span></span>Population<span style="font-weight: bold"><span style="color: #0000FF">&lt;/th&gt;&lt;/tr&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/thead&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;tbody&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;tr</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"facts"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"name"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Name here<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;&lt;td</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"pop"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Population<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;/tr&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/tbody&gt;</span></span>
 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/table&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/div&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>In Mongo the resulting data structure would be:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ mongo scratch
MongoDB shell version: 2.0.7
connecting to: scratch
&gt; show collections
example.earth
system.indexes
&gt; db.example.earth.find()
{ "_id" : "uk", "population" : { "Brighton" : 134293,
    "Birmingham" : 970892, "Liverpool" : 469017 } }</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_discussion_57">Discussion</h4>
<div class="paragraph"><p>The default value for the map will be an empty map, represented in Mongo
as <span class="monospaced">({ "_id" : "uk", "population" : { } })</span></p></div>
<div class="paragraph"><p>To insert data from your snippet, you can modify the record to supply a
new <span class="monospaced">Map</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">uk.population</span></span><span style="color: #990000">(</span>uk<span style="color: #990000">.</span>population<span style="color: #990000">.</span>is <span style="color: #990000">+</span> <span style="color: #990000">(</span><span style="color: #FF0000">"Westminster"</span><span style="color: #990000">-&gt;</span><span style="color: #993399">81766</span><span style="color: #990000">)).</span><span style="font-weight: bold"><span style="color: #000000">save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>To access an individual element of the map, you can use <span class="monospaced">get</span> (or
<span class="monospaced">value</span>):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">uk.population.get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"San Francisco"</span><span style="color: #990000">)</span>
<span style="font-style: italic"><span style="color: #9A1900">// will throw java.util.NoSuchElementException</span></span></tt></pre></div></div>
<div class="paragraph"><p>â¦or you can access via the standard Scala map interface:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> sf <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Option<span style="color: #990000">[</span><span style="color: #009900">Int</span><span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">uk.population.is.get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"San Francisco"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="sect4">
<h5 id="_what_the_map_can_contain">What the map can contain</h5>
<div class="paragraph"><p>You should be aware that <span class="monospaced">MongoMapField</span> supports only primitive types
at the moment.</p></div>
<div class="paragraph"><p>The mapped filed is typed, <span class="monospaced">String =&gt; Int</span> in this case, but of course
Mongo will let you mix types. If you do modify the Mongo record in the
database and mix types, you&#8217;ll get a <span class="monospaced">java.lang.ClassCastException</span> at
runtime.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_59">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups=#!topic/liftweb/XoseG-8mIPc">MongoMapField
Query</a> mailing list discussion.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_embedding_a_document_inside_a_mongo_record">Embedding a Document inside a Mongo Record</h3>
<div class="sect3">
<h4 id="_problem_60">Problem</h4>
<div class="paragraph"><p>You have a Mongo record, and you want to embed another set of values
inside it as a single entity.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_59">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">BsonRecord</span> to define the document to embed, and embed it using
<span class="monospaced">BsonRecordField</span>. Here&#8217;s an example of storing information about an
image within a record:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Image</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> BsonRecord<span style="color: #990000">[</span>Image<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Image
  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> url <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">StringField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> <span style="color: #993399">1024</span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> width <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">IntField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> height <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">IntField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Image <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Image <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> BsonMetaRecord<span style="color: #990000">[</span>Image<span style="color: #990000">]</span></tt></pre></div></div>
<div class="paragraph"><p>We can reference instances of the <span class="monospaced">Image</span> class via <span class="monospaced">BsonRecordField</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Country</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> MongoRecord<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> StringPk<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Country
  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> flag <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">BsonRecordField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> Image<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Country <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Country <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> MongoMetaRecord<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> collectionName <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"example.earth"</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>To associate a value:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> unionJack <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="font-weight: bold"><span style="color: #000000">Image.createRecord.url("http://bit.ly/unionflag200").width(200).height</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #000000">uk.createRecord.id("uk").flag(unionJack).save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>In Mongo, the resulting data structure would be:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; db.example.earth.findOne()
{
  "_id" : "uk",
  "flag" : {
    "url" : "http://bit.ly/unionflag200",
    "width" : 200,
    "height" : 100
  }
}</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_discussion_58">Discussion</h4>
<div class="paragraph"><p>If you don&#8217;t set a value on the embedded document, the default will be
saved as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">"flag"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">{</span> <span style="color: #FF0000">"width"</span> <span style="color: #990000">:</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #FF0000">"height"</span> <span style="color: #990000">:</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #FF0000">"url"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">""</span> <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>You can prevent this by making the image optional:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">object</span></span> image <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">BsonRecordField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> Image<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> optional<span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">?</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>With <span class="monospaced">optional_?</span> set in this way the image part of the Mongo document
won&#8217;t be saved if the value is not set. Within Scala you will then want
to access the value with <span class="monospaced">valueBox</span> call:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> img <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Box<span style="color: #990000">[</span>Image<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> uk<span style="color: #990000">.</span>flag<span style="color: #990000">.</span>valueBox</tt></pre></div></div>
<div class="paragraph"><p>In fact, regardless of the setting of <span class="monospaced">optional_?</span> you can access the
value using <span class="monospaced">valueBox</span>.</p></div>
<div class="paragraph"><p>An alternative is to always provide a default value for the embedded
document:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">object</span></span> image <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">BsonRecordField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> Image<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
 <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> defaultValue <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
  <span style="font-weight: bold"><span style="color: #000000">Image.createRecord.url("http://bit.ly/unionflag200").width(200).height</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_see_also_60">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.assembla.com/spaces/liftweb/wiki/Mongo_Record_Embedded_Objects">Mongo
Record Embedded Objects</a> on the Lift Wiki.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_linking_between_mongo_records">Linking between Mongo Records</h3>
<div class="sect3">
<h4 id="_problem_61">Problem</h4>
<div class="paragraph"><p>You have a Mongo record and want to include a link to another record.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_60">Solution</h4>
<div class="paragraph"><p>Create a reference using a <span class="monospaced">MongoRefField</span> such as <span class="monospaced">ObjectIdRefField</span> or
<span class="monospaced">StringRefField</span>, and dereference the record using the <span class="monospaced">obj</span> call.</p></div>
<div class="paragraph"><p>As an example we can create records representing countries, where a
country references the planet where you can find it:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Planet</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span><span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> MongoRecord<span style="color: #990000">[</span>Planet<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> StringPk<span style="color: #990000">[</span>Planet<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Planet
  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> review <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">StringField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span><span style="color: #993399">1024</span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Planet <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Planet <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> MongoMetaRecord<span style="color: #990000">[</span>Planet<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> collectionName <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"example.planet"</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Country</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> MongoRecord<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> StringPk<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Country
  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> planet <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">StringRefField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> Planet<span style="color: #990000">,</span> <span style="color: #993399">128</span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Country <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Country <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> MongoMetaRecord<span style="color: #990000">[</span>Country<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> collectionName <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"example.country"</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In a snippet we can make us of the link:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HelloWorld</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> uk <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Country.find</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"uk"</span><span style="color: #990000">)</span> openOr <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> earth <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Planet.createRecord.id("earth").review("Harmless").save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">Country.createRecord.id("uk").planet(earth.id.is).save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span>
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> facts <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
    <span style="color: #FF0000">".country *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> uk<span style="color: #990000">.</span>id <span style="color: #990000">&amp;</span>
    <span style="color: #FF0000">".planet"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> uk<span style="color: #990000">.</span>planet<span style="color: #990000">.</span>obj<span style="color: #990000">.</span>map<span style="color: #FF0000">{</span> p <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
      <span style="color: #FF0000">".name *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> p<span style="color: #990000">.</span>id <span style="color: #990000">&amp;</span>
      <span style="color: #FF0000">".review *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> p<span style="color: #990000">.</span>review <span style="color: #FF0000">}</span>
  <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>For the value <span class="monospaced">uk</span> we lookup an existing record, or create one if none
is found. Note that <span class="monospaced">earth</span> is created as a separate Mongo record, and
then referenced in the <span class="monospaced">planet</span> field with the id of the planet.</p></div>
<div class="paragraph"><p>Retrieving the reference is via the <span class="monospaced">obj</span> method, which returns a
<span class="monospaced">Box[Planet]</span> in this example.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_59">Discussion</h4>
<div class="paragraph"><p>Referenced records are fetched from Mongo when you call the <span class="monospaced">obj</span> method
on a <span class="monospaced">MongoRefField</span>. You can see this by turning on logging in the
Mongo driver. Do this by adding the following to the start of your
<span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">System.setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"DEBUG.MONGO"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"true"</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000000">System.setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"DB.TRACE"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"true"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Having done this, the first time you run the snippet above your console
will include:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>INFO: find: scratch.example.country { "_id" : "uk"}
INFO: update: scratch.example.planet { "_id" : "earth"} { "_id" : "earth" ,
    "review" : "Harmless"}
INFO: update: scratch.example.country { "_id" : "uk"} { "_id" : "uk" ,
    "planet" : "earth"}
INFO: find: scratch.example.planet { "_id" : "earth"}</pre>
</div></div>
<div class="paragraph"><p>What you&#8217;re seeing here is the initial look up for "uk", followed by the
creation of the "earth" record and an update which is saving the "uk"
record. Finally, there is a lookup of "earth" when <span class="monospaced">uk.obj</span> is called in
the <span class="monospaced">fact</span> method.</p></div>
<div class="paragraph"><p>The <span class="monospaced">obj</span> call will cache the <span class="monospaced">planet</span> reference. That means you could
say&#8230;</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">".country *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> uk<span style="color: #990000">.</span>id <span style="color: #990000">&amp;</span>
<span style="color: #FF0000">".planet *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">uk.planet.obj.map</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">.</span>id<span style="color: #990000">)</span> <span style="color: #990000">&amp;</span>
<span style="color: #FF0000">".review *"</span> <span style="font-weight: bold"><span style="color: #0000FF">#</span></span><span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">uk.planet.obj.map</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">.</span>review<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>&#8230;and you&#8217;d still only see one query for the "earth" record despite
calling <span class="monospaced">obj</span> multiple times. The flip side of that is if the "earth"
record was updated elsewhere in Mongo after you called <span class="monospaced">obj</span>, you would
not see the change from a call to <span class="monospaced">uk.obj</span> unless you reloaded the <span class="monospaced">uk</span>
record first.</p></div>
<div class="sect4">
<h5 id="_querying_by_reference">Querying by reference</h5>
<div class="paragraph"><p>Searching for records by a reference is straight-forward:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> earth <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Planet <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">...</span>
<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> onEarth <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> List<span style="color: #990000">[</span>Country<span style="color: #990000">]</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Country.findAll</span></span><span style="color: #990000">(</span>Country<span style="color: #990000">.</span>planet<span style="color: #990000">.</span>name<span style="color: #990000">,</span> earth<span style="color: #990000">.</span>id<span style="color: #990000">.</span>is<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Or in this case, because we have String references, we could just say:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> onEarth <span style="font-weight: bold"><span style="color: #0000FF">:</span></span> List<span style="color: #990000">[</span>Country<span style="color: #990000">]</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Country.findAll</span></span><span style="color: #990000">(</span>Country<span style="color: #990000">.</span>planet<span style="color: #990000">.</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"earth"</span><span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect4">
<h5 id="_updating_and_deleting">Updating and deleting</h5>
<div class="paragraph"><p>Updating a reference is as you&#8217;d expect:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">uk.planet.obj.foreach(_.review</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Mostly harmless."</span><span style="color: #990000">).</span>update<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This would result in:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>INFO: update: scratch.example.planet { "_id" : "earth"} { "\$set" : {
   "review" : "Mostly harmless."}}</pre>
</div></div>
<div class="paragraph"><p>A <span class="monospaced">uk.planet.obj</span> call will now return a planet with the new review.</p></div>
<div class="paragraph"><p>Or you could replace the reference with another:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">uk.planet</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #000000">Planet.createRecord.id("mars").save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">).</span>id<span style="color: #990000">.</span>is <span style="font-weight: bold"><span style="color: #000000">).save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>To remove the reference:</p></div>
<div class="paragraph"><p><span class="monospaced">scala uk.planet(Empty).save(true)</span> This removes the link, but the Mongo
record pointed to by the link will remain in the database. If you remove
the object being referenced, a later call to <span class="monospaced">obj</span> will return an
<span class="monospaced">Empty</span> box.</p></div>
</div>
<div class="sect4">
<h5 id="_types_of_link">Types of link</h5>
<div class="paragraph"><p>The example uses a <span class="monospaced">StringRefField</span> as the Mongo records themselves use
plain strings as `_id`s, and as such we had to set the size of the
string we are storing (128). Other reference types are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">ObjectIdRefField</span> - possibly the most frequently used kind of reference, when you want to reference via the usual default <span class="monospaced">ObjectId</span> reference in Mongo.
</p>
</li>
<li>
<p>
<span class="monospaced">UUIDRefField</span> - for records with an id based on <span class="monospaced">java.util.UUID</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">StringRefField</span> - as used in this example.
</p>
</li>
<li>
<p>
<span class="monospaced">IntRefField</span> and <span class="monospaced">LongRefField</span> - for when you&#8217;re using a numeric value as an id.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_61">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.assembla.com/wiki/show/liftweb/Mongo_Record_Referenced_Objects">Mongo
Record Referenced Objects</a> wiki page.
</p>
</li>
<li>
<p>
<a href="http://stackoverflow.com/questions/9545341/configure-logging-for-the-mongodb-java-driver">Configure logging for the MongoDB Java driver</a> on Stackoverflow.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_storing_geospatial_values">Storing Geospatial Values</h3>
<div class="sect3">
<h4 id="_problem_62">Problem</h4>
<div class="paragraph"><p>You want to store (lat,lon) information in Mongo.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_61">Solution</h4>
<div class="paragraph"><p>Create a <span class="monospaced">Geo</span> container and use when you need it in your model. For
example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Geo</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> BsonRecord<span style="color: #990000">[</span>Geo<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Geo

  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> lat <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">DoubleField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">object</span></span> lon <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> <span style="font-weight: bold"><span style="color: #000000">DoubleField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Geo <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Geo <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> BsonMetaRecord<span style="color: #990000">[</span>Geo<span style="color: #990000">]</span></tt></pre></div></div>
<div class="paragraph"><p>You can reference instances in your schema:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Thing</span> <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> MongoRecord<span style="color: #990000">[</span>Thing<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> meta <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> Thing

  <span style="font-weight: bold"><span style="color: #0000FF">val</span></span> loc <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">BsonRecordField</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span>Geo<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> optional<span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">?</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> Thing <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Thing <span style="font-weight: bold"><span style="color: #0000FF">with</span></span> MongoMetaRecord<span style="color: #990000">[</span>Thing<span style="color: #990000">]</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #000080">import</span></span> mongodb<span style="color: #990000">.</span>BsonDSL<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
  <span style="font-weight: bold"><span style="color: #000000">ensureIndex</span></span><span style="color: #990000">(</span>loc<span style="color: #990000">.</span>name <span style="color: #990000">-&gt;</span> <span style="color: #FF0000">"2d"</span><span style="color: #990000">,</span> unique<span style="font-weight: bold"><span style="color: #0000FF">=false</span></span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>To store a value you could do something like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> place <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Geo.createRecord.lat(50.816673d).lon</span></span><span style="color: #990000">(-</span><span style="color: #993399">0</span><span style="color: #990000">.</span>13441d<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> thing <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Thing.createRecord.loc(place).save</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This will produce data in Mongo that looks like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span> <span style="color: #FF0000">"loc"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">{</span> <span style="color: #FF0000">"lon"</span> <span style="color: #990000">:</span> <span style="color: #990000">-</span><span style="color: #993399">0.13441</span><span style="color: #990000">,</span> <span style="color: #FF0000">"lat"</span> <span style="color: #990000">:</span> <span style="color: #993399">50.816673</span> <span style="color: #FF0000">}</span> <span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_60">Discussion</h4>
<div class="paragraph"><p>The <span class="monospaced">unique=false</span> in the <span class="monospaced">ensureIndex</span> highlights that you can control
whether locations needs to be unique (no duplications) or not.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_62">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Mailing list discussion of <a href="https://groups.google.com/d/topic/liftweb/qTCry26wfOc/discussion">https://groups.google.com/d/topic/liftweb/qTCry26wfOc/discussion</a> [Geospatial indexing on lift-mongodb-record].
</p>
</li>
<li>
<p>
Mongo&#8217;s <a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing">Geospacial Indexing</a> page.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_in_and_around_lift">In and Around Lift</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section gives examples of working with Lift and other systems, such
as sending email or scheduling tasks.</p></div>
<div class="sect2">
<h3 id="_sending_plain_text_email">Sending plain text email</h3>
<div class="sect3">
<h4 id="_problem_63">Problem</h4>
<div class="paragraph"><p>You want to send a plain email from your Lift application.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_62">Solution</h4>
<div class="paragraph"><p>Use the <span class="monospaced">Mailer</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Mailer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000000">Mailer.sendMail</span></span><span style="color: #990000">(</span>
  <span style="font-weight: bold"><span style="color: #000000">From</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"you@example.org"</span><span style="color: #990000">),</span>
  <span style="font-weight: bold"><span style="color: #000000">Subject</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello"</span><span style="color: #990000">),</span>
  <span style="font-weight: bold"><span style="color: #000000">To</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"other@example.org"</span><span style="color: #990000">),</span>
  <span style="font-weight: bold"><span style="color: #000000">PlainMailBodyType</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello from Lift"</span><span style="color: #990000">)</span> <span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_61">Discussion</h4>
<div class="paragraph"><p><span class="monospaced">Mailer</span> sends the message asynchronously, meaning <span class="monospaced">sendMail</span> will
return immediately, so you don&#8217;t have to worry about the time costs of
negotiating with an SMTP server. There&#8217;s also a <span class="monospaced">blockingSendMail</span>
method if you want to wait.</p></div>
<div class="paragraph"><p>By default, the SMTP server used will be <span class="monospaced">localhost</span>. You can change
this by setting the <span class="monospaced">mail.smtp.host</span> property. For example, add the line
<span class="monospaced">mail.smtp.host=smtp.example.org</span> to
<span class="monospaced">src/mail/resources/props/default.props</span>. Mailer also supports JNDI as a
source of email sessions.</p></div>
<div class="paragraph"><p>The signature of <span class="monospaced">sendMail</span> requires a <span class="monospaced">From</span>, <span class="monospaced">Subject</span> and then any
number of <span class="monospaced">MailTypes</span>. In the example we added two: <span class="monospaced">PlainMailBodyType</span>
and <span class="monospaced">To</span>. You can add others including <span class="monospaced">BCC</span>, <span class="monospaced">ReplyTo</span> and
<span class="monospaced">MessageHeader</span> (a name and value pair), and you can add them multiple
times.</p></div>
<div class="paragraph"><p>The default character set is UTF-8. If you need to change this replace
the use of <span class="monospaced">PlainMailBodyType</span> with
<span class="monospaced">PlainPlusBodyType("Hello from Lift", "ISO8859_1")</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_63">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://exploring.liftweb.net/master/index-F.html#toc-Appendix-F">Exploring
Lift</a>, Appendix F.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_html_email">Sending HTML email</h3>
<div class="sect3">
<h4 id="_problem_64">Problem</h4>
<div class="paragraph"><p>You want to send an HTML email from your Lift application.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_63">Solution</h4>
<div class="paragraph"><p>Give <span class="monospaced">Mailer</span> a <span class="monospaced">NodeSeq</span> containing your HTML message:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Mailer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> html <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">&lt;</span>html<span style="color: #990000">&gt;</span>
   <span style="color: #990000">&lt;</span>head<span style="color: #990000">&gt;</span>
     <span style="color: #990000">&lt;</span>title<span style="color: #990000">&gt;</span>Hello<span style="color: #990000">&lt;/</span>title<span style="color: #990000">&gt;</span>
   <span style="color: #990000">&lt;/</span>head<span style="color: #990000">&gt;</span>
   <span style="color: #990000">&lt;</span>body<span style="color: #990000">&gt;</span>
    <span style="color: #990000">&lt;</span>h1<span style="color: #990000">&gt;</span>Hello<span style="color: #990000">&lt;/</span>h1<span style="color: #990000">&gt;</span>
   <span style="color: #990000">&lt;/</span>body<span style="color: #990000">&gt;</span>
  <span style="color: #990000">&lt;/</span>html<span style="color: #990000">&gt;</span>

<span style="font-weight: bold"><span style="color: #000000">Mailer.sendMail</span></span><span style="color: #990000">(</span>
  <span style="font-weight: bold"><span style="color: #000000">From</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Myself &lt;me@example.org&gt;"</span><span style="color: #990000">),</span>
  <span style="font-weight: bold"><span style="color: #000000">Subject</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello"</span><span style="color: #990000">),</span>
  <span style="font-weight: bold"><span style="color: #000000">To</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"you@example.org"</span><span style="color: #990000">),</span>
  html<span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_62">Discussion</h4>
<div class="paragraph"><p>An implicit converts the <span class="monospaced">NodeSeq</span> into a <span class="monospaced">XHTMLMailBodyType</span>. This
ensures the mime type of the email is "text/html". Despite the name of
XHTML, the message is to converted into a string for transmission using
HTML5 semantics.</p></div>
<div class="paragraph"><p>The character encoding for HTML email, UTF-8, can be changed by setting
<span class="monospaced">mail.charset</span> in your Lift properties file.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_authenticated_email">Sending authenticated email</h3>
<div class="sect3">
<h4 id="_problem_65">Problem</h4>
<div class="paragraph"><p>You need to authenticate with an SMTP server to send email.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_64">Solution</h4>
<div class="paragraph"><p>Set the <span class="monospaced">Mailer.authenticator</span> in <span class="monospaced">Boot</span> with the credentials for your
SMTP server and enable the <span class="monospaced">mail.smtp.auth</span> flag in your Lift props
file.</p></div>
<div class="paragraph"><p>Modify <span class="monospaced">Boot.scala</span> to include:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Mailer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> javax<span style="color: #990000">.</span>mail<span style="color: #990000">.</span><span style="color: #FF0000">{</span>Authenticator<span style="color: #990000">,</span>PasswordAuthentication<span style="color: #FF0000">}</span>

Mailer<span style="color: #990000">.</span>authenticator <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">{</span>
  user <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> <span style="font-weight: bold"><span style="color: #000000">Props.get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"mail.user"</span><span style="color: #990000">)</span>
  pass <span style="font-weight: bold"><span style="color: #0000FF">&lt;-</span></span> <span style="font-weight: bold"><span style="color: #000000">Props.get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"mail.password"</span><span style="color: #990000">)</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">yield</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Authenticator <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">override</span></span> <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> getPasswordAuthentication <span style="font-weight: bold"><span style="color: #0000FF">=</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">PasswordAuthentication</span></span><span style="color: #990000">(</span>user<span style="color: #990000">,</span>pass<span style="color: #990000">)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In this example we expect the username and password to come from Lift
properties, so we need to modify
<span class="monospaced">src/main/resources/props/default.props</span> to include them:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>mail<span style="color: #990000">.</span>smtp<span style="color: #990000">.</span>auth<span style="font-weight: bold"><span style="color: #0000FF">=true</span></span>
mail<span style="color: #990000">.</span>user<span style="font-weight: bold"><span style="color: #0000FF">=</span></span>me<span style="font-weight: bold"><span style="color: #0000FF">@</span></span>example<span style="color: #990000">.</span>org
mail<span style="color: #990000">.</span>password<span style="font-weight: bold"><span style="color: #0000FF">=</span></span>correct horse battery staple
mail<span style="color: #990000">.</span>smtp<span style="color: #990000">.</span>host<span style="font-weight: bold"><span style="color: #0000FF">=</span></span>smtp<span style="color: #990000">.</span>sendgrid<span style="color: #990000">.</span>net</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_63">Discussion</h4>
<div class="paragraph"><p>We&#8217;ve used Lift properties as a way to configure SMTP authentication.
This has the benefit of allowing us to enable authentication for just
some run modes. For example, if our <span class="monospaced">default.props</span> did not contain
authentication settings, but our <span class="monospaced">production.default.props</span> did, then no
authentication would happen in development mode, ensuring we can&#8217;t
accidentally send email outside of a production environment.</p></div>
<div class="paragraph"><p>But you don&#8217;t have to use a properties file for this (the Lift Mailer
also supports JNDI). However, some mail services do require
<span class="monospaced">mail.smtp.auth=true</span> to be set.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_64">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
The <a href="http://javamail.kenai.com/nonav/javadocs/com/sun/mail/smtp/package-summary.html">com.sun.mail.smtp description</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_email_with_attachments">Sending email with attachments</h3>
<div class="sect3">
<h4 id="_problem_66">Problem</h4>
<div class="paragraph"><p>You want to send an email with one or more attachments.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_65">Solution</h4>
<div class="paragraph"><p>Use Mailer&#8217;s <span class="monospaced">XHTMLPlusImages</span> body types:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">val</span></span> content <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"Planet,Discoverer</span><span style="color: #CC33CC">\r\n</span><span style="color: #FF0000">"</span> <span style="color: #990000">+</span>
  <span style="color: #FF0000">"HR 8799 c, Marois et al</span><span style="color: #CC33CC">\r\n</span><span style="color: #FF0000">"</span> <span style="color: #990000">+</span>
  <span style="color: #FF0000">"Kepler-22b, Kepler Science Team</span><span style="color: #CC33CC">\r\n</span><span style="color: #FF0000">"</span>

<span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">CSVFile</span><span style="color: #990000">(</span>bytes<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Array<span style="color: #990000">[</span><span style="color: #009900">Byte</span><span style="color: #990000">],</span>
  filename<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"file.csv"</span><span style="color: #990000">,</span>
  mime<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> String <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"text/csv; charset=utf8; header=present"</span> <span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> attach <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">CSVFile(content.mkString.getBytes</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"utf8"</span><span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> body <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #990000">&lt;</span>p<span style="color: #990000">&gt;</span>Please research the enclosed<span style="color: #990000">.&lt;/</span>p<span style="color: #990000">&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> msg <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">XHTMLPlusImages</span></span><span style="color: #990000">(</span>body<span style="color: #990000">,</span>
  <span style="font-weight: bold"><span style="color: #000000">PlusImageHolder</span></span><span style="color: #990000">(</span>attach<span style="color: #990000">.</span>filename<span style="color: #990000">,</span> attach<span style="color: #990000">.</span>mime<span style="color: #990000">,</span> attach<span style="color: #990000">.</span>bytes<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #000000">Mailer.sendMail</span></span><span style="color: #990000">(</span>
  <span style="font-weight: bold"><span style="color: #000000">From</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"me@example.org"</span><span style="color: #990000">,</span>
  <span style="font-weight: bold"><span style="color: #000000">Subject</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Planets"</span><span style="color: #990000">),</span>
  <span style="font-weight: bold"><span style="color: #000000">To</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"you@example.org"</span><span style="color: #990000">),</span>
  msg<span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_64">Discussion</h4>
<div class="paragraph"><p><span class="monospaced">XHTMLPlusImages</span> can also accept more than one <span class="monospaced">PlusImageHolder</span> if you
have more than one file to attach.</p></div>
<div class="paragraph"><p>Messages are sent using the "related" multi-part mime heading with
"inline" disposition.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_65">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
Lift ticket 1197 to <a href="https://github.com/lift/framework/issues/1197">improve Mailer functionality for attachments</a>
</p>
</li>
<li>
<p>
Wikipedia entry on <a href="http://en.wikipedia.org/wiki/MIME">Multipurpose Internet Mail Extensions (MIME)</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_logging_email_rather_than_sending">Logging email rather than sending</h3>
<div class="sect3">
<h4 id="_problem_67">Problem</h4>
<div class="paragraph"><p>You don&#8217;t want email sent when developing your Lift application locally,
but you do want to see what would have been sent.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_66">Solution</h4>
<div class="paragraph"><p>The solution is to use <span class="monospaced">Mailer.devModeSend</span> and here is an example for
<span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Mailer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> javax<span style="color: #990000">.</span>mail<span style="color: #990000">.</span>internet<span style="color: #990000">.</span><span style="color: #FF0000">{</span>MimeMessage<span style="color: #990000">,</span>MimeMultipart<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">stringify</span></span><span style="color: #990000">(</span>m<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> Any<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> m <span style="font-weight: bold"><span style="color: #0000FF">match</span></span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> mm<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> MimeMultipart <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">mm.getBodyPart</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">).</span>getContent
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> otherwise <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> otherwise<span style="color: #990000">.</span>toString
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">Mailer.devModeSend.default.set(</span></span> <span style="color: #990000">(</span>m<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> MimeMessage<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #000000">logger.info</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Would have sent "</span><span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #000000">stringify</span></span><span style="color: #990000">(</span>m<span style="color: #990000">.</span>getContent<span style="color: #990000">))</span>
<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This example is changing the behaviour of <span class="monospaced">Mailer</span> when your Lift
application is in developer mode (which it is by default). We are
logging a message only, and using a utility function to get the contents
of the first body part of the message. The key part is setting a
<span class="monospaced">MimeMessage =&gt; Unit</span> function on <span class="monospaced">Mailer.devModeSend</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_65">Discussion</h4>
<div class="paragraph"><p>When developing an application it is inconvenient to have to worry about
setting up an SMTP server or inadvertently sending test messages to
users. The above is a useful way to know what would have been sent.</p></div>
<div class="paragraph"><p>You can control how and if mail is sent using the <span class="monospaced">*ModeSend</span> functions
available for the different Lift RunModes (dev, staging, production,
profile, pilot and test). The default is to send email, except for
<span class="monospaced">testModeSend</span>, which only logs the send.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_run_a_task_later">Run a task later</h3>
<div class="sect3">
<h4 id="_problem_68">Problem</h4>
<div class="paragraph"><p>You want to schedule code to run later.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_67">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">net.liftweb.util.Schedule</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">Schedule(</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> <span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"doing it"</span><span style="color: #990000">),</span> <span style="color: #993399">30</span> seconds<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This would cause "doing it" to be printed on the console after 30
seconds.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_66">Discussion</h4>
<div class="paragraph"><p><span class="monospaced">Schedule</span> also includes a <span class="monospaced">schedule</span> method which will send a specified
actor a specified message after a given delay.</p></div>
<div class="paragraph"><p>The above example makes use of the Lift <span class="monospaced">TimeHelpers</span>, but there are
variant calls that accept <span class="monospaced">Long</span> millisecond values.</p></div>
<div class="paragraph"><p>Schedule returns a <span class="monospaced">ScheduledFuture[Unit]</span> from the Java concurrency
library, which allows you to <span class="monospaced">cancel</span> the activity.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_66">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/Schedule.scala">Schedule.scala</a>
source.
</p>
</li>
<li>
<p>
<a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ScheduledFuture.html">java.util.concurrent.ScheduledFuture</a> JavaDoc.
</p>
</li>
<li>
<p>
Recipe for <a href="Run+tasks+periodically.html">Running tasks periodically</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="RunTasksPeriodically">Run Tasks Periodically</h3>
<div class="sect3">
<h4 id="_problem_69">Problem</h4>
<div class="paragraph"><p>You want a scheduled task to run periodically.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_68">Solution</h4>
<div class="paragraph"><p>Use <span class="monospaced">net.liftweb.util.Schedule</span> ensuring that you call <span class="monospaced">schedule</span> again
during your task to re-schedule it. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Schedule
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>actor<span style="color: #990000">.</span>LiftActor
<span style="font-weight: bold"><span style="color: #000080">import</span></span> net<span style="color: #990000">.</span>liftweb<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Helpers<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">object</span></span> MyScheduledTask <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> LiftActor <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">DoIt</span><span style="color: #990000">()</span>
  <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Stop</span><span style="color: #990000">()</span>

  <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">var</span></span> stopped <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span>

   <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> messageHandler <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">{</span>
     <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> DoIt <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
       <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>stopped<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #000000">Schedule.schedule</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> DoIt<span style="color: #990000">,</span> <span style="color: #993399">10</span> minutes<span style="color: #990000">)</span>
       <span style="font-style: italic"><span style="color: #9A1900">// ... do useful work here</span></span>

     <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> Stop <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span>
       stopped <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
   <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The example creates a <span class="monospaced">LiftActor</span> for the work to be done. On receipt of
a <span class="monospaced">DoIt</span> message, the actor re-schedules itself before doing whatever
useful work needs to be done. In this way, the actor will be called
every 10 minutes.</p></div>
<div class="paragraph"><p>The <span class="monospaced">Schedule.schedule</span> call is ensuring that <span class="monospaced">this</span> actor is sent the
<span class="monospaced">DoIt</span> message after 10 minutes.</p></div>
<div class="paragraph"><p>To start this process off, possibly in <span class="monospaced">Boot.scala</span>, just send the
<span class="monospaced">DoIt</span> message to the actor.</p></div>
<div class="paragraph"><p>To ensure the process stops correctly when Lift shuts down, we register
a shutdown hook in <span class="monospaced">Boot.scala</span> to send the <span class="monospaced">Stop</span> message to prevent
future re-schedules:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LiftRules.unloadHooks.append(</span></span> <span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">=&gt;</span></span> MyScheduledTask <span style="color: #990000">!</span> MyScheduledTask<span style="color: #990000">.</span>Stop <span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_67">Discussion</h4>
<div class="paragraph"><p>Without the <span class="monospaced">Stop</span> message your actor would continue to be rescheduled
until the JVM exits. This may be acceptable, but note that during
development with SBT, without the <span class="monospaced">Stop</span> message, you will continue to
schedule tasks after issuing the <span class="monospaced">container:stop</span> command.</p></div>
<div class="paragraph"><p>Schedule returns a <span class="monospaced">ScheduledFuture[Unit]</span> from the Java concurrency
library, which allows you to <span class="monospaced">cancel</span> the activity.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_67">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/lift/framework/blob/master/core/util/src/main/scala/net/liftweb/util/Schedule.scala">Schedule.scala</a> source.
</p>
</li>
<li>
<p>
<a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ScheduledFuture.html">java.util.concurrent.ScheduledFuture</a> JavaDoc.
</p>
</li>
<li>
<p>
Chapter 1 of <em>Lift in Action</em> includes a CometActor clock example that
uses <span class="monospaced">Schedule</span>, and further examples can be found in chapters 4 and 9.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_fetching_urls">Fetching URLs</h3>
<div class="sect3">
<h4 id="_problem_70">Problem</h4>
<div class="paragraph"><p>You want to fetch a URL from inside your Lift app.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_69">Solution</h4>
<div class="paragraph"><p>Use <em>Dispatch</em>, "a library for HTTP interaction, from asynchronous GETs
to multi-part OAuth-enticated POSTs". Before you start, include the
dependencies in your <span class="monospaced">build.sbt</span> file:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>libraryDependencies <span style="color: #990000">++</span><span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Seq</span></span><span style="color: #990000">(</span>
 <span style="color: #FF0000">"net.databinder"</span> <span style="color: #990000">%%</span> <span style="color: #FF0000">"dispatch-core"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"0.8.8"</span><span style="color: #990000">,</span>
 <span style="color: #FF0000">"net.databinder"</span> <span style="color: #990000">%%</span> <span style="color: #FF0000">"dispatch-http"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"0.8.8"</span><span style="color: #990000">,</span>
 <span style="color: #FF0000">"net.databinder"</span> <span style="color: #990000">%%</span> <span style="color: #FF0000">"dispatch-tagsoup"</span> <span style="color: #990000">%</span> <span style="color: #FF0000">"0.8.8"</span>
<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Databinder is structured into a set of modules (e.g., for oAuth and
Twitter). Above we&#8217;re including a set for an example of fetching a URL
and extracting all the meta tags:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> scala<span style="color: #990000">.</span>xml<span style="color: #990000">.</span>NodeSeq
<span style="font-weight: bold"><span style="color: #000080">import</span></span> dispatch<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> dispatch<span style="color: #990000">.</span>tagsoup<span style="color: #990000">.</span>TagSoupHttp<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">_</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> page <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">url</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"http://www.w3.org/"</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">metas</span></span><span style="color: #990000">(</span>ns<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> NodeSeq<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> ns <span style="color: #990000">\\</span> <span style="color: #FF0000">"meta"</span>

<span style="font-weight: bold"><span style="color: #0000FF">val</span></span> result<span style="font-weight: bold"><span style="color: #0000FF">:</span></span> NodeSeq <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="font-weight: bold"><span style="color: #000000">Http</span></span><span style="color: #990000">(</span>page <span style="color: #990000">&lt;/&gt;</span> metas<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The above produces:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">NodeSeq</span></span><span style="color: #990000">(&lt;</span>meta content<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"text/html; charset=utf-8"</span> http<span style="color: #990000">-</span>equiv<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"Content-Type"</span><span style="color: #990000">&gt;&lt;/</span>meta<span style="color: #990000">&gt;,</span>
 <span style="color: #990000">&lt;</span>meta content<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"width=device-width"</span> name<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"viewport"</span><span style="color: #990000">&gt;&lt;/</span>meta<span style="color: #990000">&gt;,</span>
 <span style="color: #990000">&lt;</span>meta content<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"The World Wide Web Consortium (W3C) is an international community where</span>
<span style="color: #FF0000">  Member organizations, a full-time staff, and the public work together to develop Web</span>
<span style="color: #FF0000">  standards."</span> name<span style="font-weight: bold"><span style="color: #0000FF">=</span></span><span style="color: #FF0000">"description"</span><span style="color: #990000">&gt;&lt;/</span>meta<span style="color: #990000">&gt;)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_68">Discussion</h4>
<div class="paragraph"><p>As URL fetching has latency, you will want to look at making the request
from an actor, a lazy-load snippet, via the various Dispatch executors
or similar mechanism.</p></div>
<div class="paragraph"><p><em>Dispatch</em> offers a range of operators in addition to the <span class="monospaced">&lt;/&gt;</span> XML one
used above. You can extract text, JSON, consume the stream, or throw
away the content. The <em>Periodic table</em> gives a great high-level view of
what&#8217;s available.</p></div>
<div class="paragraph"><p>Related to <em>TagSoup</em>, <em>Dispatch</em> also integrates with <em>JSoup</em>, which
includes functions for manipulating the real-world HTML you fetch.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_68">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://dispatch.databinder.net/Dispatch.html">Dispatch</a>.
</p>
</li>
<li>
<p>
<a href="http://www.flotsam.nl/dispatch-periodic-table.html">Periodic table of Dispatch operators</a>.
</p>
</li>
<li>
<p>
<a href="http://dispatch.databinder.net/JSoup.html">JSoup Dispatch</a> documentation.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deployment">Production Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_deploying_to_cloudbees">Deploying to CloudBees</h3>
<div class="sect3">
<h4 id="_problem_71">Problem</h4>
<div class="paragraph"><p>You have an account with the CloudBees PaaS hosting environment, and you
want to deploy your Lift application there.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_70">Solution</h4>
<div class="paragraph"><p>Use the SBT <span class="monospaced">package</span> command to produce a WAR file that can be deployed
to CloudBees, and then use the SDK to configure and deploy your
application.</p></div>
<div class="paragraph"><p>For best performance you will want to ensure the Lift run mode is set to
"production". Do this from the CloudBees SDK command line:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ bees config<span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #0000FF">set</span></span> -a myaccount/myapp run<span style="color: #990000">.</span><span style="color: #009900">mode</span><span style="color: #990000">=</span>production</tt></pre></div></div>
<div class="paragraph"><p>This will set the run mode to production for your CloudBees applications
identified as "myaccount/myapp". Omitting the <span class="monospaced">-a</span> will set it for your
whole CloudBees account.</p></div>
<div class="paragraph"><p>CloudBees will remember this setting, so you only need to do it once.</p></div>
<div class="paragraph"><p>You can then deploy:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ sbt package
<span style="color: #990000">...</span>
<span style="color: #990000">[</span>info<span style="color: #990000">]</span> Packaging /Users/richard/myapp/target/scala-<span style="color: #993399">2.9</span><span style="color: #990000">.</span><span style="color: #993399">1</span>/myapp<span style="color: #990000">.</span>war<span style="color: #990000">...</span>
<span style="color: #990000">...</span>
$ bees app<span style="color: #990000">:</span>deploy <span style="color: #990000">.</span>/target/scala-<span style="color: #993399">2.9</span><span style="color: #990000">.</span><span style="color: #993399">1</span>/myapp<span style="color: #990000">.</span>war</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_discussion_69">Discussion</h4>
<div class="paragraph"><p>If you are deploying a single application to multiple CloudBees
instances, be aware that by default CloudBees will round robin requests
to each instance. If you use any of Lift&#8217;s state features you&#8217;ll want to
enable session affinity (sticky sessions):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ bees app<span style="color: #990000">:</span>update -a myaccount/myapp <span style="color: #009900">stickySession</span><span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span></tt></pre></div></div>
<div class="paragraph"><p>If you are using comet, it&#8217;ll work fine, but CloudBees default is to do
request buffering. This allows CloudBees to do smart things, such as re-routing
requests in a cluster if one machine does not respond. A
consequence of request buffering is that long-polling comet requests will timeout more
often. To turn off this feature set the following:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ bees app<span style="color: #990000">:</span>update -a myaccount/myapp <span style="color: #009900">disableProxyBuffering</span><span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span></tt></pre></div></div>
<div class="paragraph"><p>As with the run mode setting, CloudBees will remember these settings, so you
only need to set them once.</p></div>
<div class="sect4">
<h5 id="_rdbms_configuration">RDBMS configuration</h5>
<div class="paragraph"><p>If you are using a SQL database in your application, you&#8217;ll want to
configue <span class="monospaced">src/main/webapp/WEB-INF/cloudbees-web.xml</span>. For
example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;?xml</span></span> <span style="color: #009900">version</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span><span style="font-weight: bold"><span style="color: #000080">?&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;cloudbees-web-app</span></span> <span style="color: #009900">xmlns</span><span style="color: #990000">=</span><span style="color: #FF0000">"http://www.cloudbees.com/xml/webapp/1"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;appid&gt;</span></span>myaccount/myapp<span style="font-weight: bold"><span style="color: #0000FF">&lt;/appid&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;resource</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"jdbc/mydb"</span> <span style="color: #009900">auth</span><span style="color: #990000">=</span><span style="color: #FF0000">"Container"</span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"javax.sql.DataSource"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"username"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"dbuser"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"password"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"dbpassword"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"url"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"jdbc:cloudbees://mydb"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>

  <span style="font-style: italic"><span style="color: #9A1900">&lt;!-- Connection Pool settings:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">   http://commons.apache.org/dbcp/configuration.html</span></span>
<span style="font-style: italic"><span style="color: #9A1900">   --&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"maxActive"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"10"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"maxIdle"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"2"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"maxWait"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"15000"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"removeAbandoned"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"true"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"removeAbandonedTimeout"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"300"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"logAbandoned"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"true"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>

  <span style="font-style: italic"><span style="color: #9A1900">&lt;!-- Avoid idle timeouts --&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"validationQuery"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"SELECT 1"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;param</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"testOnBorrow"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"true"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>

 <span style="font-weight: bold"><span style="color: #0000FF">&lt;/resource&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;/cloudbees-web-app&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The above is a JNDI database configuration, defining a connection to a
CloudBees database called "mydb". This will be used by Lift if the JNDI
name is referenced in <span class="monospaced">Boot.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DefaultConnectionIdentifier<span style="color: #990000">.</span>jndiName <span style="font-weight: bold"><span style="color: #0000FF">=</span></span> <span style="color: #FF0000">"jdbc/mydb"</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>DB<span style="color: #990000">.</span>jndiJdbcConnAvailable<span style="font-weight: bold"><span style="color: #0000FF">_</span></span><span style="color: #990000">?)</span> <span style="color: #FF0000">{</span>
  <span style="font-style: italic"><span style="color: #9A1900">// set up alternative local database connection here</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Because the JDNI setting is only defined in <span class="monospaced">cloudbees-web.xml</span> it will
only be available in a CloudBees environment. This means you can develop
against a different database locally, and use your CloudBees database
when deploying.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_69">See Also</h4>
<div class="paragraph"><p>A plugin is available to automate deployments from SBT. The plugin and the excellent
instructions for installing and configuring it can be found at <a href="https://github.com/timperrett/sbt-cloudbees-plugin">https://github.com/timperrett/sbt-cloudbees-plugin</a>.</p></div>
<div class="paragraph"><p>For integration with messaging systems, you may been to access your CloudBees instance application
hostname and port number.  You can find this at <a href="https://developer.cloudbees.com/bin/view/Main/Finding+out+app+port+and+hostname">https://developer.cloudbees.com/bin/view/Main/Finding+out+app+port+and+hostname</a>.  This CloudBees developer portal contains a "Resources" section which provides details
of the CloudBees services.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_mysql_unicode_charset_encoding">MySQL unicode charset encoding</h3>
<div class="sect3">
<h4 id="_problem_72">Problem</h4>
<div class="paragraph"><p>Some characters stored in your MySQL database are appearing as <span class="monospaced">???</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_71">Solution</h4>
<div class="paragraph"><p>Ensure:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Boot.scala</span> includes: <span class="monospaced">LiftRules.early.append(_.setCharacterEncoding("UTF-8"))</span>
</p>
</li>
<li>
<p>
Your JDBC connections URL includes <span class="monospaced">?useUnicode=true&amp;characterEncoding=UTF-8</span>
</p>
</li>
<li>
<p>
Your MySQL database has been created using a UTF-8 character set.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_see_also_70">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!topic/liftweb/DL9AFyU5y2k">EMail thread on the Lift mailing list</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/d6y/mysql-lift-charset-test">MySQL UTF-8 test Lift app</a> - although it uses SBT 0.7 so is rather out of date.
</p>
</li>
<li>
<p>
<a href="http://dev.mysql.com/doc/refman/5.6/en/connector-j-reference-configuration-properties.html">MySQL JDBC COnfiguration reference</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_bug_reports_amp_getting_help">Contributing, bug reports &amp; getting help</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_to_add_a_new_recipe_to_this_cookbook">How to add a new recipe to this Cookbook</h3>
<div class="sect3">
<h4 id="_problem_73">Problem</h4>
<div class="paragraph"><p>You&#8217;d like to add a new page to this cookbook.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_72">Solution</h4>
<div class="paragraph"><p>If you&#8217;re comfortable using Git, you can fork the repository and send a
push request.</p></div>
<div class="paragraph"><p>Alternatively, download the template file, write your recipe, and email
to the Lift mailing list.</p></div>
<div class="paragraph"><p>The template is:
<a href="https://raw.github.com/d6y/lift-cookbook/master/template.md">https://raw.github.com/d6y/lift-cookbook/master/template.md</a></p></div>
</div>
<div class="sect3">
<h4 id="_discussion_70">Discussion</h4>
<div class="paragraph"><p>The cookbook is structured using Markdown and Pamflet. Each recipe is a
file with the same structure as the template file, and gives one good
solution to a problem. Feel free to discuss alternatives or related
concepts in the discussion section.</p></div>
<div class="paragraph"><p>If you&#8217;ve forked the project from Github, you&#8217;ll find all the pages in
the <span class="monospaced">docs</span> folder, with sub-folders for each section. The filenames are
used for ordering the pages and sections. Feel free to send pull
requests.</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_71">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/d6y/lift-cookbook/">This project on Github</a>
</p>
</li>
<li>
<p>
<a href="http://daringfireball.net/projects/markdown/syntax">Markdown syntax guide</a>
</p>
</li>
<li>
<p>
<a href="http://pamflet.databinder.net/Pamflet.html">Pamflet</a>
</p>
</li>
<li>
<p>
<a href="http://pamflet.databinder.net/Filenames+and+Page+Names.html">Pamflet filenames and titles</a>
</p>
</li>
<li>
<p>
<a href="http://pamflet.databinder.net/Source+Code+Highlighting.html">Formatting source code</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_report_bugs">How to report bugs</h3>
<div class="sect3">
<h4 id="_problem_74">Problem</h4>
<div class="paragraph"><p>You&#8217;ve found a bug and want to report it.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_73">Solution</h4>
<div class="paragraph"><p>Discuss your findings on the Lift mailing list, saying what you&#8217;re
seeing, and what you&#8217;d expect to see.</p></div>
<div class="paragraph"><p>By all means look at <a href="https://github.com/lift/modules/issues">existing
issues</a> to see if your issue is there or recently fixed, but do not
raise a ticket unless asked to do so by a Lift committer on the mailing
list.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_71">Discussion</h4>
<div class="paragraph"><p><strong>"If Lift is not behaving as you expect, please ask questions about what
you&#8217;re seeing. The ideal form of these questions is <em>When I do X, my
Lift app does Y, but I expect it to do Z, why?</em> This provides a set of
language to discuss your application and the way that Lift responds to
requests. Perhaps there&#8217;s a way of improving Lift. Perhaps there&#8217;s a
concept that&#8217;s different in Lift than you might be used to. Perhaps
there&#8217;s a documentation issue that can help bridge the gap between what
Lift is doing and what you expect it to do. Most importantly, just
because Lift is behaving differently than you expect it to, it&#8217;s not
necessarily a bug in Lift."</strong> (from
<a href="http://lift.la/expected-behavior-in-the-lift-community">Expected Behavior
in the Lift community</a>)</p></div>
</div>
<div class="sect3">
<h4 id="_see_also_72">See Also</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.assembla.com/wiki/show/liftweb/Posting_example_code">How to post a code example</a>
</p>
</li>
<li>
<p>
<a href="http://www.assembla.com/wiki/show/liftweb/Creating_tickets">Creating tickets</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Last updated 2012-12-17 18:08:11 GMT
</div>
</div>
</body>
</html>
